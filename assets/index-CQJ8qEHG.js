import{r as hi}from"./katex-_RySEpAz.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var De,w,pn,dn,ae,Bt,_n,dt,mn,xt,_t,mt,vn,$e={},gn=[],fi=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,tt=Array.isArray;function te(n,e){for(var t in e)n[t]=e[t];return n}function Ct(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function Ze(n,e,t){var i,s,r,o={};for(r in e)r=="key"?i=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?De.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)o[r]===void 0&&(o[r]=n.defaultProps[r]);return Ce(n,o,i,s,null)}function Ce(n,e,t,i,s){var r={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++pn,__i:-1,__u:0};return s==null&&w.vnode!=null&&w.vnode(r),r}function le(n){return n.children}function Q(n,e){this.props=n,this.context=e}function _e(n,e){if(e==null)return n.__?_e(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?_e(n):null}function yn(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return yn(n)}}function vt(n){(!n.__d&&(n.__d=!0)&&ae.push(n)&&!Ye.__r++||Bt!==w.debounceRendering)&&((Bt=w.debounceRendering)||_n)(Ye)}function Ye(){var n,e,t,i,s,r,o,a;for(ae.sort(dt);n=ae.shift();)n.__d&&(e=ae.length,i=void 0,r=(s=(t=n).__v).__e,o=[],a=[],t.__P&&((i=te({},s)).__v=s.__v+1,w.vnode&&w.vnode(i),Ht(t.__P,i,s,t.__n,t.__P.namespaceURI,32&s.__u?[r]:null,o,r??_e(s),!!(32&s.__u),a),i.__v=s.__v,i.__.__k[i.__i]=i,wn(o,i,a),i.__e!=r&&yn(i)),ae.length>e&&ae.sort(dt));Ye.__r=0}function bn(n,e,t,i,s,r,o,a,l,c,f){var h,d,p,_,g,x,y=i&&i.__k||gn,v=e.length;for(l=pi(t,e,y,l,v),h=0;h<v;h++)(p=t.__k[h])!=null&&(d=p.__i===-1?$e:y[p.__i]||$e,p.__i=h,x=Ht(n,p,d,s,r,o,a,l,c,f),_=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&kt(d.ref,null,p),f.push(p.ref,p.__c||_,p)),g==null&&_!=null&&(g=_),4&p.__u||d.__k===p.__k?l=Vn(p,l,n):typeof p.type=="function"&&x!==void 0?l=x:_&&(l=_.nextSibling),p.__u&=-7);return t.__e=g,l}function pi(n,e,t,i,s){var r,o,a,l,c,f=t.length,h=f,d=0;for(n.__k=new Array(s),r=0;r<s;r++)(o=e[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=r+d,(o=n.__k[r]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Ce(null,o,null,null,null):tt(o)?Ce(le,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?Ce(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,a=null,(c=o.__i=di(o,t,l,h))!==-1&&(h--,(a=t[c])&&(a.__u|=2)),a==null||a.__v===null?(c==-1&&d--,typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?d--:c==l+1?d++:(c>l?d--:d++,o.__u|=4))):n.__k[r]=null;if(h)for(r=0;r<f;r++)(a=t[r])!=null&&!(2&a.__u)&&(a.__e==i&&(i=_e(a)),xn(a,a));return i}function Vn(n,e,t){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,e=Vn(i[s],e,t));return e}n.__e!=e&&(e&&n.type&&!t.contains(e)&&(e=_e(n)),t.insertBefore(n.__e,e||null),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Xe(n,e){return e=e||[],n==null||typeof n=="boolean"||(tt(n)?n.some(function(t){Xe(t,e)}):e.push(n)),e}function di(n,e,t,i){var s,r,o=n.key,a=n.type,l=e[t];if(l===null||l&&o==l.key&&a===l.type&&!(2&l.__u))return t;if(i>(l!=null&&!(2&l.__u)?1:0))for(s=t-1,r=t+1;s>=0||r<e.length;){if(s>=0){if((l=e[s])&&!(2&l.__u)&&o==l.key&&a===l.type)return s;s--}if(r<e.length){if((l=e[r])&&!(2&l.__u)&&o==l.key&&a===l.type)return r;r++}}return-1}function Gt(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||fi.test(e)?t:t+"px"}function We(n,e,t,i,s){var r;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||Gt(n.style,e,"");if(t)for(e in t)i&&t[e]===i[e]||Gt(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(mn,"$1")),e=e.toLowerCase()in n||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+r]=t,t?i?t.u=i.u:(t.u=xt,n.addEventListener(e,r?mt:_t,r)):n.removeEventListener(e,r?mt:_t,r);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function Ot(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=xt++;else if(e.t<t.u)return;return t(w.event?w.event(e):e)}}}function Ht(n,e,t,i,s,r,o,a,l,c){var f,h,d,p,_,g,x,y,v,B,A,z,F,H,P,G,k,O=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(f=w.__b)&&f(e);e:if(typeof O=="function")try{if(y=e.props,v="prototype"in O&&O.prototype.render,B=(f=O.contextType)&&i[f.__c],A=f?B?B.props.value:f.__:i,t.__c?x=(h=e.__c=t.__c).__=h.__E:(v?e.__c=h=new O(y,A):(e.__c=h=new Q(y,A),h.constructor=O,h.render=mi),B&&B.sub(h),h.props=y,h.state||(h.state={}),h.context=A,h.__n=i,d=h.__d=!0,h.__h=[],h._sb=[]),v&&h.__s==null&&(h.__s=h.state),v&&O.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=te({},h.__s)),te(h.__s,O.getDerivedStateFromProps(y,h.__s))),p=h.props,_=h.state,h.__v=e,d)v&&O.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),v&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(v&&O.getDerivedStateFromProps==null&&y!==p&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(y,A),!h.__e&&(h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(y,h.__s,A)===!1||e.__v==t.__v)){for(e.__v!=t.__v&&(h.props=y,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(j){j&&(j.__=e)}),z=0;z<h._sb.length;z++)h.__h.push(h._sb[z]);h._sb=[],h.__h.length&&o.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(y,h.__s,A),v&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(p,_,g)})}if(h.context=A,h.props=y,h.__P=n,h.__e=!1,F=w.__r,H=0,v){for(h.state=h.__s,h.__d=!1,F&&F(e),f=h.render(h.props,h.state,h.context),P=0;P<h._sb.length;P++)h.__h.push(h._sb[P]);h._sb=[]}else do h.__d=!1,F&&F(e),f=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++H<25);h.state=h.__s,h.getChildContext!=null&&(i=te(te({},i),h.getChildContext())),v&&!d&&h.getSnapshotBeforeUpdate!=null&&(g=h.getSnapshotBeforeUpdate(p,_)),a=bn(n,tt(G=f!=null&&f.type===le&&f.key==null?f.props.children:f)?G:[G],e,t,i,s,r,o,a,l,c),h.base=e.__e,e.__u&=-161,h.__h.length&&o.push(h),x&&(h.__E=h.__=null)}catch(j){if(e.__v=null,l||r!=null)if(j.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else for(k=r.length;k--;)Ct(r[k]);else e.__e=t.__e,e.__k=t.__k;w.__e(j,e,t)}else r==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=_i(t.__e,e,t,i,s,r,o,l,c);return(f=w.diffed)&&f(e),128&e.__u?void 0:a}function wn(n,e,t){for(var i=0;i<t.length;i++)kt(t[i],t[++i],t[++i]);w.__c&&w.__c(e,n),n.some(function(s){try{n=s.__h,s.__h=[],n.some(function(r){r.call(s)})}catch(r){w.__e(r,s.__v)}})}function _i(n,e,t,i,s,r,o,a,l){var c,f,h,d,p,_,g,x=t.props,y=e.props,v=e.type;if(v=="svg"?s="http://www.w3.org/2000/svg":v=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),r!=null){for(c=0;c<r.length;c++)if((p=r[c])&&"setAttribute"in p==!!v&&(v?p.localName==v:p.nodeType==3)){n=p,r[c]=null;break}}if(n==null){if(v==null)return document.createTextNode(y);n=document.createElementNS(s,v,y.is&&y),a&&(w.__m&&w.__m(e,r),a=!1),r=null}if(v===null)x===y||a&&n.data===y||(n.data=y);else{if(r=r&&De.call(n.childNodes),x=t.props||$e,!a&&r!=null)for(x={},c=0;c<n.attributes.length;c++)x[(p=n.attributes[c]).name]=p.value;for(c in x)if(p=x[c],c!="children"){if(c=="dangerouslySetInnerHTML")h=p;else if(!(c in y)){if(c=="value"&&"defaultValue"in y||c=="checked"&&"defaultChecked"in y)continue;We(n,c,null,p,s)}}for(c in y)p=y[c],c=="children"?d=p:c=="dangerouslySetInnerHTML"?f=p:c=="value"?_=p:c=="checked"?g=p:a&&typeof p!="function"||x[c]===p||We(n,c,p,x[c],s);if(f)a||h&&(f.__html===h.__html||f.__html===n.innerHTML)||(n.innerHTML=f.__html),e.__k=[];else if(h&&(n.innerHTML=""),bn(n,tt(d)?d:[d],e,t,i,v=="foreignObject"?"http://www.w3.org/1999/xhtml":s,r,o,r?r[0]:t.__k&&_e(t,0),a,l),r!=null)for(c=r.length;c--;)Ct(r[c]);a||(c="value",v=="progress"&&_==null?n.removeAttribute("value"):_!==void 0&&(_!==n[c]||v=="progress"&&!_||v=="option"&&_!==x[c])&&We(n,c,_,x[c],s),c="checked",g!==void 0&&g!==n[c]&&We(n,c,g,x[c],s))}return n}function kt(n,e,t){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(s){w.__e(s,t)}}function xn(n,e,t){var i,s;if(w.unmount&&w.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||kt(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){w.__e(r,e)}i.base=i.__P=null}if(i=n.__k)for(s=0;s<i.length;s++)i[s]&&xn(i[s],e,t||typeof n.type!="function");t||Ct(n.__e),n.__c=n.__=n.__e=void 0}function mi(n,e,t){return this.constructor(n,t)}function vi(n,e,t){var i,s,r,o;e==document&&(e=document.documentElement),w.__&&w.__(n,e),s=(i=!1)?null:e.__k,r=[],o=[],Ht(e,n=e.__k=Ze(le,null,[n]),s||$e,$e,e.namespaceURI,s?null:e.firstChild?De.call(e.childNodes):null,r,s?s.__e:e.firstChild,i,o),wn(r,n,o)}function gi(n,e,t){var i,s,r,o,a=te({},n.props);for(r in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)r=="key"?i=e[r]:r=="ref"?s=e[r]:a[r]=e[r]===void 0&&o!==void 0?o[r]:e[r];return arguments.length>2&&(a.children=arguments.length>3?De.call(arguments,2):t),Ce(n.type,a,i||n.key,s||n.ref,null)}function Mt(n,e){var t={__c:e="__cC"+vn++,__:n,Consumer:function(i,s){return i.children(s)},Provider:function(i){var s,r;return this.getChildContext||(s=new Set,(r={})[e]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.forEach(function(a){a.__e=!0,vt(a)})},this.sub=function(o){s.add(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){s&&s.delete(o),a&&a.call(o)}}),i.children}};return t.Provider.__=t.Consumer.contextType=t}De=gn.slice,w={__e:function(n,e,t,i){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(n)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,i||{}),o=s.__d),o)return s.__E=s}catch(a){n=a}throw n}},pn=0,dn=function(n){return n!=null&&n.constructor==null},Q.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=te({},this.state),typeof n=="function"&&(n=n(te({},t),this.props)),n&&te(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),vt(this))},Q.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),vt(this))},Q.prototype.render=le,ae=[],_n=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,dt=function(n,e){return n.__v.__b-e.__v.__b},Ye.__r=0,mn=/(PointerCapture)$|Capture$/i,xt=0,_t=Ot(!1),mt=Ot(!0),vn=0;var yi=0;function u(n,e,t,i,s,r){e||(e={});var o,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?o=e[a]:l[a]=e[a];var c={type:n,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--yi,__i:-1,__u:0,__source:s,__self:r};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return w.vnode&&w.vnode(c),c}var ce,I,ct,Wt,Le=0,Cn=[],D=w,Ut=D.__b,Rt=D.__r,zt=D.diffed,Ft=D.__c,qt=D.unmount,jt=D.__;function Ee(n,e){D.__h&&D.__h(I,n,Le||e),Le=0;var t=I.__H||(I.__H={__:[],__h:[]});return n>=t.__.length&&t.__.push({}),t.__[n]}function St(n){return Le=1,bi(kn,n)}function bi(n,e,t){var i=Ee(ce++,2);if(i.t=n,!i.__c&&(i.__=[t?t(e):kn(void 0,e),function(a){var l=i.__N?i.__N[0]:i.__[0],c=i.t(l,a);l!==c&&(i.__N=[c,i.__[1]],i.__c.setState({}))}],i.__c=I,!I.u)){var s=function(a,l,c){if(!i.__c.__H)return!0;var f=i.__c.__H.__.filter(function(d){return!!d.__c});if(f.every(function(d){return!d.__N}))return!r||r.call(this,a,l,c);var h=i.__c.props!==a;return f.forEach(function(d){if(d.__N){var p=d.__[0];d.__=d.__N,d.__N=void 0,p!==d.__[0]&&(h=!0)}}),r&&r.call(this,a,l,c)||h};I.u=!0;var r=I.shouldComponentUpdate,o=I.componentWillUpdate;I.componentWillUpdate=function(a,l,c){if(this.__e){var f=r;r=void 0,s(a,l,c),r=f}o&&o.call(this,a,l,c)},I.shouldComponentUpdate=s}return i.__N||i.__}function nt(n,e){var t=Ee(ce++,3);!D.__s&&At(t.__H,e)&&(t.__=n,t.i=e,I.__H.__h.push(t))}function Ke(n,e){var t=Ee(ce++,4);!D.__s&&At(t.__H,e)&&(t.__=n,t.i=e,I.__h.push(t))}function Pe(n){return Le=5,it(function(){return{current:n}},[])}function Vi(n,e,t){Le=6,Ke(function(){return typeof n=="function"?(n(e()),function(){return n(null)}):n?(n.current=e(),function(){return n.current=null}):void 0},t==null?t:t.concat(n))}function it(n,e){var t=Ee(ce++,7);return At(t.__H,e)&&(t.__=n(),t.__H=e,t.__h=n),t.__}function Hn(n){var e=I.context[n.__c],t=Ee(ce++,9);return t.c=n,e?(t.__==null&&(t.__=!0,e.sub(I)),e.props.value):n.__}function wi(){for(var n;n=Cn.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(qe),n.__H.__h.forEach(gt),n.__H.__h=[]}catch(e){n.__H.__h=[],D.__e(e,n.__v)}}D.__b=function(n){I=null,Ut&&Ut(n)},D.__=function(n,e){n&&e.__k&&e.__k.__m&&(n.__m=e.__k.__m),jt&&jt(n,e)},D.__r=function(n){Rt&&Rt(n),ce=0;var e=(I=n.__c).__H;e&&(ct===I?(e.__h=[],I.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.i=t.__N=void 0})):(e.__h.forEach(qe),e.__h.forEach(gt),e.__h=[],ce=0)),ct=I},D.diffed=function(n){zt&&zt(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(Cn.push(e)!==1&&Wt===D.requestAnimationFrame||((Wt=D.requestAnimationFrame)||xi)(wi)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.i=void 0})),ct=I=null},D.__c=function(n,e){e.some(function(t){try{t.__h.forEach(qe),t.__h=t.__h.filter(function(i){return!i.__||gt(i)})}catch(i){e.some(function(s){s.__h&&(s.__h=[])}),e=[],D.__e(i,t.__v)}}),Ft&&Ft(n,e)},D.unmount=function(n){qt&&qt(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(i){try{qe(i)}catch(s){e=s}}),t.__H=void 0,e&&D.__e(e,t.__v))};var Zt=typeof requestAnimationFrame=="function";function xi(n){var e,t=function(){clearTimeout(i),Zt&&cancelAnimationFrame(e),setTimeout(n)},i=setTimeout(t,100);Zt&&(e=requestAnimationFrame(t))}function qe(n){var e=I,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),I=e}function gt(n){var e=I;n.__c=n.__(),I=e}function At(n,e){return!n||n.length!==e.length||e.some(function(t,i){return t!==n[i]})}function kn(n,e){return typeof e=="function"?e(n):e}const Ci={id:"wire",name:"Wire",category:"Conductors",prefix:"W",shapes:[["l",-15,15,15,-15]],pins:[["a",-15,15],["a",15,-15]],labels:[0,0,"cm"],device:null},Hi={id:"g",name:"Ground",category:"Conductors",prefix:"G",shapes:[["l",0,0,0,15],["l",-20,15,20,15],["l",-10,20,10,20],["l",-5,25,5,25]],pins:[["a",0,0]],labels:[0,30,"ct"],device:null},ki={id:"p",name:"Port",category:"Conductors",prefix:"P",shapes:[["l",0,-15,0,0],["c",0,-25,10]],pins:[["a",0,0]],labels:[0,-40,"cb"],device:null},se={wire:Ci,ground:Hi,port:ki};class q extends Error{name="CircuitError";constructor(e,t){super(e,t)}}class b{static number(e){return{type:"number",...e}}static string(e){return{type:"string",...e}}static temp=b.number({defaultValue:26.85,range:["real",">",-273.15],title:"device temperature in degrees Celsius"});schema=new Map;values=new Map;constructor(e){for(const[t,i]of Object.entries(e))this.schema.set(t,i)}names(){return[...this.schema.keys()]}prop(e){const t=this.schema.get(e);if(t==null){const i=this.names();throw new q(`Unknown property [${e}]. Expected one of ${i.map(s=>`[${s}]`).join(", ")}.`)}return t}from(e){for(const[t,i]of e.values.entries())this.set(t,i)}hasAll(){for(const[e,t]of this.schema.entries())if(!this.values.has(e)&&t.defaultValue==null)return!1;return!0}has(e){return this.prop(e),this.values.has(e)}set(e,t){const i=this.prop(e);switch(i.type){case"number":{Mi(i,e,t);break}case"string":{Si(i,e,t);break}}return this.values.set(e,t),this}getNumber(e,t=null){const i=this.prop(e);if(i.type!=="number")throw new q(`Property [${e}] is not a number.`);const s=this.values.get(e)??t??i.defaultValue;if(s==null)throw new q(`Property [${e}] has no value.`);return s}getString(e,t=null){const i=this.prop(e);if(i.type!=="string")throw new q(`Property [${e}] is not a string.`);const s=this.values.get(e)??t??i.defaultValue;if(s==null)throw new q(`Property [${e}] has no value.`);return s}}function Mi(n,e,t){if(typeof t!="number")throw new q(`Invalid value for property [${e}]. Expected a number, got ${ie(t)}.`);const{range:i=["real"]}=n,[s,...r]=i;switch(s){case"real":if(!Number.isFinite(t))throw new q(`Invalid value for property [${e}]. Not a finite value.`);break;case"integer":if(!Number.isInteger(t))throw new q(`Invalid value for property [${e}]. Not an integer value.`);break}let o=0;for(;o<r.length;){const a=r[o++],l=r[o++];switch(a){case">":if(t<=l)throw new q(`Invalid value for property [${e}]. Expected a value larger than ${l}, got ${ie(t)}.`);break;case">=":if(t<l)throw new q(`Invalid value for property [${e}]. Expected a value larger than or equal to ${l}, got ${ie(t)}.`);break;case"<":if(t>=l)throw new q(`Invalid value for property [${e}]. Expected a value less than ${l}, got ${ie(t)}.`);break;case"<=":if(t>l)throw new q(`Invalid value for property [${e}]. Expected a value less than or equal to ${l}, got ${ie(t)}.`);break;case"<>":if(t===l)throw new q(`Invalid value for property [${e}]. Expected a value not equal to ${l}.`);break}}}function Si(n,e,t){if(typeof t!="string")throw new q(`Invalid value for property [${e}]. Expected a string, got ${ie(t)}.`);const{range:i=[]}=n;if(i.length>0&&!i.includes(t))throw new q(`Invalid value for property [${e}]. Expected one of ${i.map(s=>ie(s)).join(", ")}, got ${ie(t)}.`)}function ie(n){switch(typeof n){case"string":return`"${n}"`;case"number":return String(n)}return`[${n}]`}class E{static dummy=new class extends E{static id="DUMMY";static numTerminals=0;static propertiesSchema={};static stateSchema={length:0,ops:[]};constructor(){super("DUMMY")}};static id;static numTerminals;static propertiesSchema;static stateSchema;static linear=!0;static Dc=class extends E{initTr(t,i){this.initDc(t,i)}loadTr(t,i,s){this.loadDc(t,i,s)}endTr(t,i){this.endDc(t,i)}};id;properties;state;diffs=[];constructor(e){this.id=e;const{propertiesSchema:t,stateSchema:i}=this.deviceClass;this.properties=new b(t),this.state=new Float64Array(i.length)}get deviceClass(){return this.constructor}connect(e,t){}init(e){}initDc(e,t){}loadDc(e,t,i){}endDc(e,t){}initTr(e,t){}loadTr(e,t,i){}endTr(e,t){}initAc(e){}loadAc(e,t,i){}endAc(e){}}function Ai(n){const e=new Array(n);for(let t=0;t<n;t++)e[t]=yt(n);return e}function Ii(n,e=0){for(const t of n)t.fill(e)}function yt(n){return new Float64Array(n)}function Yt(n,e=0){n.fill(e)}function It(n,e){e.set(n)}function $i(n){const e=new Int32Array(n);return Mn(e),e}function Mn(n){for(let e=0;e<n.length;e++)n[e]=e}function Sn(n,e,t){return Li(n,e,t,t)}function Li(n,e,t,i){let s=t,r=Math.abs(n[t][i]);for(t++;t<e;){const o=Math.abs(n[t][i]);o>r&&(s=t,r=o),t++}return s}function Je(n,e,t){const i=n[e];n[e]=n[t],n[t]=i}class Pi extends Error{name="MathError";constructor(e,t){super(e,t)}}class $t extends Pi{name="SingularMatrixError";constructor(e){super("Singular matrix.",e)}}function Ti(n){const{size:e,A:t,x:i,b:s}=n;for(let r=0;r<e;r++){n.findPivot(r);const o=t[r][r];if(o===0)throw new $t;for(let a=r;a<e;a++)t[r][a]/=o;s[r]/=o;for(let a=0;a<e;a++)if(a!==r){const l=t[a][r];for(let c=r;c<e;c++)t[a][c]-=t[r][c]*l;s[a]-=s[r]*l}}It(s,i)}function Ni(n){const{size:e,A:t,x:i,b:s}=n;for(let r=0;r<e-1;r++){n.findPivot(r);const o=t[r][r];if(o===0)throw new $t;for(let a=r+1;a<e;a++){const l=t[a][r]/o;for(let c=r;c<e;c++)t[a][c]-=t[r][c]*l;s[a]-=s[r]*l}}for(let r=e-1;r>=0;r--){s[r]/=t[r][r];for(let o=r-1;o>=0;o--)s[o]-=t[o][r]*s[r]}It(s,i)}function Di(n){const{size:e,A:t,perm:i}=n;for(let s=0;s<e;s++){Bi(t,i,e,s);const r=t[s][s];if(r===0)throw new $t;for(let o=s+1;o<e;o++)t[s][o]/=r;for(let o=s+1;o<e;o++)for(let a=s+1;a<e;a++)t[o][a]-=t[o][s]*t[s][a]}}function Ei(n){const{size:e,A:t,x:i,b:s,perm:r}=n;for(let o=0;o<e;o++){let a=0;for(let l=0;l<o;l++)a+=t[o][l]*i[l];i[o]=(s[r[o]]-a)/t[o][o]}for(let o=e-1;o>=0;o--){let a=0;for(let l=o+1;l<e;l++)a+=t[o][l]*s[l];s[o]=i[o]-a}It(s,i)}function Bi(n,e,t,i){const s=Sn(n,t,i);s!==i&&(Je(n,i,s),Je(e,i,s))}var He;(function(n){n.Gauss="gauss",n.GaussJordan="gauss-jordan",n.LU="lu"})(He||(He={}));class Gi{size;A;x;b;perm;constructor(e){this.size=e,this.A=Ai(e),this.x=yt(e),this.b=yt(e),this.perm=$i(e)}clear(){Ii(this.A),Yt(this.x),Yt(this.b),Mn(this.perm)}solve(e){switch(e){case He.Gauss:Ni(this);break;case He.GaussJordan:Ti(this);break;case He.LU:Di(this),Ei(this);break}}findPivot(e){const{size:t,A:i,b:s}=this,r=Sn(i,t,e);r!==e&&(Je(i,e,r),Je(s,e,r))}}var Xt;(function(n){n.Euler="euler",n.Trapezoidal="trapezoidal",n.Gear="gear"})(Xt||(Xt={}));const Kt=Symbol("tran"),Oi=Symbol("index");class An{[Kt];[Oi];V=0;C=0;I=0;Geq=0;Ieq=0;diff(e,t){this[Kt].diff(this,e,t)}}const Wi=6;(()=>{const n=new Array;for(let e=0;e<=Wi+1;e++)n.push(new Gi(e));return n})();class Ui extends E{static id="C";static numTerminals=2;static propertiesSchema={C:b.number({title:"capacitance",range:["real",">",0]}),V0:b.number({title:"initial voltage",defaultValue:0})};static stateSchema={length:4,ops:[{index:2,name:"V",unit:"V"},{index:3,name:"I",unit:"A"}]};diff=new An;na;nb;constructor(e){super(e),this.diffs.push(this.diff)}connect(e,[t,i]){this.na=t,this.nb=i}init(e){e[0]=this.properties.getNumber("C"),e[1]=this.properties.getNumber("V0")}endDc(e,t){const{na:i,nb:s}=this;e[2]=i.voltage-s.voltage,e[3]=0}loadTr(e,{time:t},i){const{diff:s,na:r,nb:o}=this,a=e[0],l=t>0?r.voltage-o.voltage:e[1];s.diff(l,a),e[2]=s.V,e[3]=s.I,i.stampConductance(r,o,s.Geq),i.stampCurrentSource(r,o,s.Ieq)}loadAc(e,t,i){const{na:s,nb:r}=this,o=e[0],a=2*Math.PI*t*o;i.stampConductance(s,r,0,a)}}class Ri extends E{static id="L";static numTerminals=2;static propertiesSchema={L:b.number({title:"inductance",range:["real",">",0]}),I0:b.number({title:"initial current",defaultValue:0})};static stateSchema={length:4,ops:[{index:2,name:"V",unit:"V"},{index:3,name:"I",unit:"A"}]};diff=new An;na;nb;branch;constructor(e){super(e),this.diffs.push(this.diff)}connect(e,[t,i]){this.na=t,this.nb=i,this.branch=e.makeBranch(this.na,this.nb)}init(e){e[0]=this.properties.getNumber("L"),e[1]=this.properties.getNumber("I0")}loadDc(e,t,i){const{na:s,nb:r,branch:o}=this;i.stampVoltageSource(s,r,o,0)}endDc(e,t){const{branch:i}=this;e[2]=0,e[3]=i.current}loadTr(e,{time:t},i){const{diff:s,na:r,nb:o,branch:a}=this,l=e[0],c=t>0?a.current:e[1];s.diff(c,l),e[2]=s.I,e[3]=s.V,i.stampA(a,a,-s.Geq),i.stampVoltageSource(r,o,a,s.Ieq)}loadAc(e,t,i){const{na:s,nb:r}=this,o=e[0],a=-1/(2*Math.PI*t*o);i.stampConductance(s,r,0,a)}}class zi extends E.Dc{static id="R";static numTerminals=2;static propertiesSchema={R:b.number({title:"resistance",range:["real","<>",0]})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};na;nb;connect(e,[t,i]){this.na=t,this.nb=i}init(e){const t=this.properties.getNumber("R");e[0]=1/t}loadDc(e,t,i){const{na:s,nb:r}=this,o=e[0];i.stampConductance(s,r,o)}endDc(e,t){const{na:i,nb:s}=this,r=e[0],o=i.voltage-s.voltage,a=o*r;e[1]=o,e[2]=a}loadAc(e,t,i){const{na:s,nb:r}=this,o=e[0];i.stampConductance(s,r,o,0)}}function Be(n){return n+273.15}const Fi=Be(26.85),qi=1602176634e-28,ji=1380649e-29,Zi=3,Yi=1.11,Xi=2/Math.PI,Ki=Math.PI/2,J=1e-12,In="npn",$n="pnp",Lt="nfet",Pt="pfet";function Ji(n){switch(n){case In:return 1;case $n:return-1}}function Ln(n){switch(n){case Lt:return 1;case Pt:return-1}}function pe(n,e,t){const i=n/Fi,s=t*n*(ji/qi),r=e*Math.pow(i,Zi/t)*Math.exp((i-1)*(Yi/s)),o=s*Math.log(s/Math.sqrt(2)/r);return[s,r,o]}function ue(n,e,t){if(n>=0){const i=1/t;return e*(Math.exp(i*n)-1)}else return 0}function he(n,e,t){if(n>=0){const i=1/t;return i*e*Math.exp(i*n)}else return 0}function fe(n,e,t,i){if(n>=0&&n>i&&Math.abs(n-e)>2*t)if(e>0){const s=(n-e)/t;s>0?n=e+t*(2+Math.log(s-2)):n=e-t*(2+Math.log(2-s))}else n=i;return n}function Ue(n,e){return Math.abs(n-e)>.5?n>e?e+.5:e-.5:n}class Pn extends E.Dc{static id="BJT";static numTerminals=3;static propertiesSchema={polarity:b.string({range:[In,$n],title:"transistor polarity"}),Bf:b.number({defaultValue:100,range:["real",">",0],title:"forward beta"}),Br:b.number({defaultValue:1,range:["real",">",0],title:"reverse beta"}),Is:b.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),Nf:b.number({defaultValue:1,range:["real",">",0],title:"forward emission coefficient"}),Nr:b.number({defaultValue:1,range:["real",">",0],title:"reverse emission coefficient"}),Vaf:b.number({defaultValue:10,range:["real",">=",0],title:"forward Early voltage"}),Var:b.number({defaultValue:0,range:["real",">=",0],title:"reverse Early voltage"}),temp:b.temp};static stateSchema={length:16,ops:[{index:8,name:"Vbe",unit:"V"},{index:9,name:"Vbc",unit:"V"},{index:10,name:"Vce",unit:"V"},{index:11,name:"Ie",unit:"A"},{index:12,name:"Ic",unit:"A"},{index:13,name:"Ib",unit:"A"}]};static linear=!1;ne;nb;nc;connect(e,[t,i,s]){this.ne=t,this.nb=i,this.nc=s}initDc(e,t){const i=this.properties.getString("polarity"),s=this.properties.getNumber("Bf"),r=this.properties.getNumber("Br"),o=this.properties.getNumber("Is"),a=this.properties.getNumber("Nf"),l=this.properties.getNumber("Nr"),c=Be(this.properties.getNumber("temp",t.temp)),f=Ji(i),h=s/(s+1),d=r/(r+1),[p,,_]=pe(c,o,a),[g,,x]=pe(c,o,l),[,y]=pe(c,o,1);e[0]=f,e[1]=h,e[2]=d,e[3]=y,e[4]=p,e[5]=g,e[6]=_,e[7]=x}eval(e,t){const{ne:i,nb:s,nc:r}=this,o=e[0],a=e[1],l=e[2],c=e[3],f=e[4],h=e[5],d=e[6],p=e[7];let _=o*(s.voltage-i.voltage),g=o*(s.voltage-r.voltage);t&&(_=fe(_,o*e[8],f,d),g=fe(g,o*e[9],h,p));const x=ue(_,c,f),y=ue(g,c,h),v=l*y-x,B=a*x-y,A=he(_,c,f)+J,z=he(g,c,h)+J;e[8]=o*_,e[9]=o*g,e[10]=o*(_-g),e[11]=o*v,e[12]=o*B,e[13]=o*-(v+B),e[14]=A,e[15]=z}loadDc(e,t,i){const{ne:s,nb:r,nc:o}=this;this.eval(e,!0);const a=e[0],l=e[1],c=e[2],f=a*e[8],h=a*e[9],d=a*e[11],p=a*e[12],_=e[14],g=e[15],x=-_,y=-g,v=c*g,B=l*_;i.stampConductance(s,r,-x),i.stampConductance(o,r,-y),i.stampTransconductance(s,r,o,r,-v),i.stampTransconductance(o,r,s,r,-B),i.stampCurrentSource(s,r,a*(d-x*f-v*h)),i.stampCurrentSource(o,r,a*(p-B*f-y*h))}endDc(e,t){this.eval(e,!1)}}class st extends E.Dc{static id="Diode";static numTerminals=2;static propertiesSchema={Is:b.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:b.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:b.temp};static stateSchema={length:7,ops:[{index:4,name:"V",unit:"V"},{index:5,name:"I",unit:"A"}]};static linear=!1;na;nc;connect(e,[t,i]){this.na=t,this.nc=i}initDc(e,t){const i=this.properties.getNumber("Is"),s=this.properties.getNumber("N"),r=Be(this.properties.getNumber("temp",t.temp)),[o,a,l]=pe(r,i,s);e[0]=a,e[2]=o,e[3]=l}eval(e,t){const{na:i,nc:s}=this,r=e[0],o=e[2],a=e[3];let l=i.voltage-s.voltage;t&&(l=fe(l,e[4],o,a));const c=ue(l,r,o),f=he(l,r,o)+J;e[4]=l,e[5]=c,e[6]=f}loadDc(e,t,i){const{na:s,nc:r}=this;this.eval(e,!0);const o=e[4],a=e[5],l=e[6];i.stampConductance(s,r,l),i.stampCurrentSource(s,r,a-l*o)}endDc(e,t){this.eval(e,!1)}}class Tn extends E.Dc{static id="JFET";static numTerminals=3;static propertiesSchema={polarity:b.string({range:[Lt,Pt],title:"transistor polarity"}),Vth:b.number({defaultValue:-2,range:["real"],title:"threshold voltage"}),beta:b.number({defaultValue:1e-4,range:["real",">",0],title:"transconductance parameter"}),lambda:b.number({defaultValue:0,range:["real",">=",0],title:"channel-length modulation parameter"}),Is:b.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:b.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:b.temp};static stateSchema={length:17,ops:[{index:7,name:"Vgs",unit:"V"},{index:10,name:"Vgd",unit:"V"},{index:13,name:"Vds",unit:"V"},{index:14,name:"Ids",unit:"A"}]};static linear=!1;ns;ng;nd;connect(e,[t,i,s]){this.ns=t,this.ng=i,this.nd=s}initDc(e,t){const i=this.properties.getString("polarity"),s=this.properties.getNumber("Vth"),r=this.properties.getNumber("beta"),o=this.properties.getNumber("lambda"),a=this.properties.getNumber("Is"),l=this.properties.getNumber("N"),c=Be(this.properties.getNumber("temp",t.temp)),f=Ln(i),[h,d,p]=pe(c,a,l);e[0]=f,e[1]=s,e[2]=r,e[3]=o,e[4]=d,e[5]=h,e[6]=p}eval(e,t){const{ns:i,ng:s,nd:r}=this,o=e[0],a=e[1],l=e[2],c=e[3],f=e[4],h=e[5],d=e[6];let p=o*(s.voltage-i.voltage),_=o*(s.voltage-r.voltage);t&&(p=fe(p,o*e[7],h,d),_=fe(_,o*e[10],h,d));const g=p-_,x=ue(p,f,h),y=he(p,f,h)+J,v=ue(_,f,h),B=he(_,f,h)+J;let A,z,F;if(p>=_){const H=p-a;if(H<=0)A=0,z=J,F=0;else{const P=c*g,G=l*(1+P);H<=g?(A=G*H*H,z=l*c*H*H,F=2*G*H):(A=G*g*(2*H-g),z=2*G*(H-g)+l*P*(2*H-g),F=2*G*g)}}else{const H=_-a;if(H<=0)A=0,z=J,F=0;else{const P=-g,G=c*P,k=l*(1+G);H<=P?(A=-k*H*H,z=l*c*H*H+2*k*H,F=-2*k*H):(A=-k*P*(2*H-P),z=2*k*H+l*G*(2*H-P),F=-2*k*P)}}e[7]=o*p,e[10]=o*_,e[13]=o*g,e[8]=o*x,e[9]=y,e[11]=o*v,e[12]=B,e[14]=o*A,e[15]=z,e[16]=F}loadDc(e,t,i){const{ns:s,ng:r,nd:o}=this;this.eval(e,!0);const a=e[0],l=a*e[7],c=a*e[8],f=e[9],h=a*e[10],d=a*e[11],p=e[15],_=a*e[13],g=a*e[14],x=e[15],y=e[16];i.stampConductance(r,s,f),i.stampCurrentSource(r,s,a*(c-f*l)),i.stampConductance(r,o,p),i.stampCurrentSource(r,o,a*(d-p*h)),i.stampConductance(o,s,x),i.stampTransconductance(o,s,r,s,y),i.stampCurrentSource(o,s,a*(g-x*_-y*l))}endDc(e,t){this.eval(e,!1)}}class Nn extends E.Dc{static id="MOSFET";static numTerminals=4;static propertiesSchema={polarity:b.string({range:[Lt,Pt],title:"transistor polarity"}),Vth:b.number({range:["real"],title:"threshold voltage"}),beta:b.number({defaultValue:.02,range:["real",">",0],title:"transconductance parameter"}),lambda:b.number({defaultValue:0,range:["real",">=",0],title:"channel-length modulation parameter"}),Is:b.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:b.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:b.temp};static stateSchema={length:19,ops:[{index:13,name:"Vgs",unit:"V"},{index:14,name:"Vgd",unit:"V"},{index:15,name:"Vds",unit:"V"},{index:16,name:"Ids",unit:"A"}]};static linear=!1;ns;ng;nd;nb;connect(e,[t,i,s,r]){this.ns=t,this.ng=i,this.nd=s,this.nb=r}initDc(e,t){const i=this.properties.getString("polarity"),s=this.properties.getNumber("Vth"),r=this.properties.getNumber("beta"),o=this.properties.getNumber("lambda"),a=this.properties.getNumber("Is"),l=this.properties.getNumber("N"),c=Be(this.properties.getNumber("temp",t.temp)),f=Ln(i),[h,d,p]=pe(c,a,l);e[0]=f,e[1]=s,e[2]=r,e[3]=o,e[4]=d,e[5]=h,e[6]=p}eval(e,t){const{ns:i,ng:s,nd:r,nb:o}=this,a=e[0],l=e[1],c=e[2],f=e[3],h=e[4],d=e[5],p=e[6];let _=a*(o.voltage-i.voltage),g=a*(o.voltage-r.voltage),x=e[13]=a*(s.voltage-i.voltage),y=e[14]=a*(s.voltage-r.voltage),v=x-y;t&&(_=fe(_,a*e[7],d,p),g=fe(g,a*e[10],d,p),v>0?(x=Ue(x,a*e[13]),v=Ue(x-y,a*e[15])):(y=Ue(y,a*e[14]),v=Ue(x-y,a*e[15])));const B=ue(_,h,d),A=he(_,h,d)+J,z=ue(g,h,d),F=he(g,h,d)+J;let H,P,G;if(v>0){const k=x-a*l;if(k<=0)H=0,P=J,G=0;else{const O=f*v,j=c*(1+O);k<=v?(H=1/2*j*k*k,P=1/2*c*f*k*k,G=j*k):(H=j*v*(k-v/2),P=j*(k-v)+c*O*(k-v/2),G=j*v)}}else{const k=y-a*l;if(k<=0)H=0,P=J,G=0;else{const O=-v,j=f*O,we=c*(1+j);k<=O?(H=-.5*we*k*k,P=1/2*c*f*k*k,G=we*k):(H=-we*O*(k-O/2),P=we*k+c*j*(k-O/2),G=we*O)}}e[7]=a*_,e[10]=a*g,e[13]=a*x,e[14]=a*y,e[15]=a*v,e[8]=a*B,e[9]=A,e[11]=a*z,e[12]=F,e[16]=a*H,e[17]=P,e[18]=G}loadDc(e,t,i){const{ns:s,ng:r,nd:o,nb:a}=this;this.eval(e,!0);const l=e[0],c=l*e[7],f=l*e[10],h=l*e[13],d=l*e[14],p=l*e[15],_=l*e[8],g=e[9],x=l*e[11],y=e[12],v=l*e[16],B=e[17],A=e[18];i.stampConductance(a,s,g),i.stampCurrentSource(a,s,l*(_-g*c)),i.stampConductance(a,o,y),i.stampCurrentSource(a,o,l*(x-y*f)),p>0?(i.stampConductance(o,s,B),i.stampTransconductance(o,s,r,s,A),i.stampCurrentSource(o,s,l*(v-B*p-A*h))):(i.stampConductance(o,s,B),i.stampTransconductance(o,s,r,o,A),i.stampCurrentSource(o,s,l*(v-B*p-A*d)))}endDc(e,t){this.eval(e,!1)}}class Qi extends E.Dc{static id="OpAmp";static numTerminals=3;static propertiesSchema={gain:b.number({defaultValue:1e6,range:["real",">",0],title:"gain"}),Vmax:b.number({defaultValue:15,range:["real",">",0],title:"maximum absolute value of output voltage"})};static stateSchema={length:5,ops:[{index:2,name:"Vin",unit:"V"},{index:3,name:"Vout",unit:"V"}]};static linear=!1;np;nn;no;branch;connect(e,[t,i,s]){this.np=t,this.nn=i,this.no=s,this.branch=e.makeBranch(this.no,e.groundNode)}init(e){const t=this.properties.getNumber("gain"),i=this.properties.getNumber("Vmax");e[0]=t,e[1]=i}loadDc(e,t,i){const{np:s,nn:r,no:o,branch:a}=this,l=e[0],c=e[1],f=s.voltage-r.voltage,h=Ki*l*f/c,d=c*Xi*Math.atan(h),p=l/(1+h*h)+J;e[2]=f,e[3]=d,e[4]=p,i.stampA(o,a,1),i.stampA(a,s,p),i.stampA(a,r,-p),i.stampA(a,o,-1),i.stampB(a,p*f-d)}}class es extends E.Dc{static id="Ammeter";static numTerminals=2;static propertiesSchema={};static stateSchema={length:1,ops:[{index:0,name:"I",unit:"A"}]};np;nn;branch;connect(e,[t,i]){this.np=t,this.nn=i,this.branch=e.makeBranch(this.np,this.nn)}loadDc(e,t,i){const{np:s,nn:r,branch:o}=this;i.stampVoltageSource(s,r,o,0)}endDc(e,t){const{branch:i}=this;e[0]=i.current}}class ts extends E.Dc{static id="Voltmeter";static numTerminals=2;static propertiesSchema={};static stateSchema={length:1,ops:[{index:0,name:"V",unit:"V"}]};np;nn;connect(e,[t,i]){this.np=t,this.nn=i}endDc(e,t){const{np:i,nn:s}=this;e[0]=i.voltage-s.voltage}}class Ka extends E.Dc{static id="CCCS";static numTerminals=4;static propertiesSchema={gain:b.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;ncp;ncn;branch;connect(e,[t,i,s,r]){this.np=t,this.nn=i,this.ncp=s,this.ncn=r,this.branch=e.makeBranch(this.ncp,this.ncn)}init(e){e[0]=this.properties.getNumber("gain")}loadDc(e,t,i){const{np:s,nn:r,ncp:o,ncn:a,branch:l}=this,c=e[0];i.stampVoltageSource(o,a,l,0),i.stampA(s,l,c),i.stampA(r,l,-c)}endDc(e,t){const{np:i,nn:s,branch:r}=this,o=e[0],a=r.current*o,l=i.voltage-s.voltage;e[1]=a,e[2]=l}}class Ja extends E.Dc{static id="CCVS";static numTerminals=4;static propertiesSchema={gain:b.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;ncp;ncn;branch1;branch2;connect(e,[t,i,s,r]){this.np=t,this.nn=i,this.ncp=s,this.ncn=r,this.branch1=e.makeBranch(this.np,this.nn),this.branch2=e.makeBranch(this.ncp,this.ncn)}init(e){e[0]=this.properties.getNumber("gain")}loadDc(e,t,i){const{np:s,nn:r,branch1:o,ncp:a,ncn:l,branch2:c}=this,f=e[0];i.stampVoltageSource(s,r,o,0),i.stampVoltageSource(a,l,c,0),i.stampA(o,c,-f)}endDc(e,t){const{np:i,nn:s,branch1:r}=this,o=i.voltage-s.voltage,a=r.current;e[1]=o,e[2]=a}}class Qa extends E{static id="Iac";static numTerminals=2;static propertiesSchema={I:b.number({title:"amplitude"}),f:b.number({title:"frequency"}),phase:b.number({title:"phase",defaultValue:0})};static stateSchema={length:5,ops:[{index:3,name:"I",unit:"A"},{index:4,name:"V",unit:"V"}]};np;nn;connect(e,[t,i]){this.np=t,this.nn=i}init(e){const t=this.properties.getNumber("I"),i=this.properties.getNumber("f"),s=this.properties.getNumber("phase"),r=2*Math.PI*i,o=s/180*Math.PI;e[0]=t,e[1]=r,e[2]=o}endDc(e,t){e[3]=0,e[4]=0}loadTr(e,{time:t,sourceFactor:i},s){const{np:r,nn:o}=this,a=e[0],l=e[1],c=e[2],f=i*a*Math.sin(l*t+c);e[3]=f,s.stampCurrentSource(r,o,f)}endTr(e,t){const{np:i,nn:s}=this;e[4]=i.voltage-s.voltage}loadAc(e,t,i){const{np:s,nn:r}=this,o=e[0],a=e[2],l=o*Math.cos(a),c=o*Math.sin(a);i.stampCurrentSource(s,r,l,c)}}class ns extends E.Dc{static id="I";static numTerminals=2;static propertiesSchema={I:b.number({title:"current"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;connect(e,[t,i]){this.np=t,this.nn=i}init(e){e[0]=this.properties.getNumber("I")}loadDc(e,{sourceFactor:t},i){const{np:s,nn:r}=this,o=e[0],a=t*o;e[1]=a,i.stampCurrentSource(s,r,a)}endDc(e,t){const{np:i,nn:s}=this;e[2]=i.voltage-s.voltage}}class el extends E{static id="Vac";static numTerminals=2;static propertiesSchema={V:b.number({title:"amplitude"}),f:b.number({title:"frequency"}),phase:b.number({title:"phase",defaultValue:0})};static stateSchema={length:5,ops:[{index:3,name:"V",unit:"V"},{index:4,name:"I",unit:"A"}]};np;nn;branch;connect(e,[t,i]){this.np=t,this.nn=i,this.branch=e.makeBranch(this.np,this.nn)}init(e){const t=this.properties.getNumber("V"),i=this.properties.getNumber("f"),s=this.properties.getNumber("phase"),r=2*Math.PI*i,o=s/180*Math.PI;e[0]=t,e[1]=r,e[2]=o}loadDc(e,t,i){const{np:s,nn:r,branch:o}=this;i.stampVoltageSource(s,r,o,0)}endDc(e,t){e[3]=0,e[4]=0}loadTr(e,{time:t,sourceFactor:i},s){const{np:r,nn:o,branch:a}=this,l=e[0],c=e[1],f=e[2],h=i*l*Math.sin(c*t+f);e[3]=h,s.stampVoltageSource(r,o,a,h)}endTr(e,t){const{branch:i}=this,s=i.current;e[4]=s}loadAc(e,t,i){const{np:s,nn:r,branch:o}=this,a=e[0],l=e[2],c=a*Math.cos(l),f=a*Math.sin(l);i.stampVoltageSource(s,r,o,c,f)}}class tl extends E.Dc{static id="VCCS";static numTerminals=4;static propertiesSchema={gain:b.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;ncp;ncn;branch;connect(e,[t,i,s,r]){this.np=t,this.nn=i,this.ncp=s,this.ncn=r,this.branch=e.makeBranch(this.np,this.nn)}init(e){e[0]=this.properties.getNumber("gain")}loadDc(e,t,i){const{np:s,nn:r,ncp:o,ncn:a,branch:l}=this,c=e[0];i.stampA(s,l,1),i.stampA(r,l,-1),i.stampA(l,o,c),i.stampA(l,a,-c),i.stampA(l,l,-1)}endDc(e,t){const{np:i,nn:s,branch:r}=this;e[1]=r.current,e[2]=i.voltage-s.voltage}}class nl extends E.Dc{static id="VCVS";static numTerminals=4;static propertiesSchema={gain:b.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;ncp;ncn;branch;connect(e,[t,i,s,r]){this.np=t,this.nn=i,this.ncp=s,this.ncn=r,this.branch=e.makeBranch(this.np,this.nn)}init(e){e[0]=this.properties.getNumber("gain")}loadDc(e,t,i){const{np:s,nn:r,ncp:o,ncn:a,branch:l}=this,c=e[0];i.stampVoltageSource(s,r,l,0),i.stampA(l,o,-c),i.stampA(l,a,c)}endDc(e,t){const{np:i,nn:s,branch:r}=this;e[1]=i.voltage-s.voltage,e[2]=r.current}}class is extends E.Dc{static id="V";static numTerminals=2;static propertiesSchema={V:b.number({title:"voltage"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;branch;connect(e,[t,i]){this.np=t,this.nn=i,this.branch=e.makeBranch(this.np,this.nn)}init(e){e[0]=this.properties.getNumber("V")}loadDc(e,{sourceFactor:t},i){const{np:s,nn:r,branch:o}=this,a=e[0],l=t*a;e[1]=l,i.stampVoltageSource(s,r,o,l)}endDc(e,t){const{branch:i}=this;e[2]=i.current}}const ss={id:"r",name:"Resistor",category:"Linear",prefix:"R",shapes:[["l",0,-30,0,-20],["l",-8,-20,8,-20],["l",-8,20,8,20],["l",-8,-20,-8,20],["l",8,-20,8,20],["l",0,30,0,20]],pins:[["a",0,-30],["b",0,30]],labels:[15,0,"lm"],device:zi},rs={id:"c",name:"Capacitor",category:"Linear",prefix:"C",shapes:[["l",0,-30,0,-6],["l",-20,-6,20,-6],["l",-20,6,20,6],["l",0,30,0,6]],pins:[["a",0,-30],["b",0,30]],labels:[30,0,"lm"],device:Ui},os={id:"l",name:"Inductor",category:"Linear",prefix:"L",shapes:[["l",0,-30,0,-22],["a",0,-14,7,-90,90],["a",0,0,7,-90,90],["a",0,14,7,-90,90],["l",0,30,0,22]],pins:[["a",0,-30],["b",0,30]],labels:[15,0,"lm"],device:Ri},je={resistor:ss,capacitor:rs,inductor:os},rt=(n,e,t,i,s=10)=>{const r=Math.atan2(i-e,t-n),o=r-Math.PI/6,a=r+Math.PI/6;return[["l",n,e,t,i],["l",t,i,t-s*Math.cos(o),i-s*Math.sin(o)],["l",t,i,t-s*Math.cos(a),i-s*Math.sin(a)]]},as={id:"d",name:"Diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-15,-11,15,-11],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:st},ls={id:"dz",name:"Zener diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-20,-5,-15,-11],["l",-15,-11,15,-11],["l",15,-11,20,-17],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:st},cs={id:"ds",name:"Schottky diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-9,-17,-15,-17],["l",-15,-17,-15,-11],["l",-15,-11,15,-11],["l",15,-11,15,-5],["l",15,-5,9,-5],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:st},us={id:"dv",name:"Varicap diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-17],["l",-15,-17,15,-17],["l",-15,-11,15,-11],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:st},hs={id:"npn",name:"NPN bipolar junction transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-20],["l",0,30,0,20],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",-20,-5,0,-20],...rt(-20,5,0,20)],pins:[["c",0,-30],["e",0,30],["b",-30,0]],labels:[10,0,"lm"],device:Pn},fs={id:"pnp",name:"PNP bipolar junction transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-20],["l",0,30,0,20],["l",-30,0,-20,0],["l",-20,-15,-20,15],...rt(0,-20,-20,-5),["l",0,20,-20,5]],pins:[["e",0,-30],["c",0,30],["b",-30,0]],labels:[10,0,"lm"],device:Pn},ps={id:"nfet",name:"N-channel junction field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,10],["l",-30,0,-12,0],["l",0,-10,-12,-10],["l",0,10,-12,10],["l",-12,-15,-12,15],["l",-21,-5,-15,0],["l",-21,5,-15,0]],pins:[["d",0,-30],["s",0,30],["g",-30,0]],labels:[10,0,"lm"],device:Tn},ds={id:"pfet",name:"P-channel junction field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,10],["l",-30,0,-12,0],["l",0,-10,-12,-10],["l",0,10,-12,10],["l",-12,-15,-12,15],["l",-21,0,-15,-5],["l",-21,0,-15,5]],pins:[["s",0,-30],["d",0,30],["g",-30,0]],labels:[10,0,"lm"],device:Tn},_s={id:"nmos",name:"N-channel MOS field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,0],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",0,-10,-15,-10],["l",-15,-15,-15,-6],["l",0,0,-15,0],["l",-15,-3,-15,3],["l",-13,0,-8,-4],["l",-13,0,-8,4],["l",0,10,-15,10],["l",-15,15,-15,6]],pins:[["d",0,-30],["s",0,30],["g",-30,0]],labels:[10,0,"lm"],device:Nn},ms={id:"pmos",name:"P-channel MOS field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,0],["l",0,30,0,10],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",0,-10,-15,-10],["l",-15,-15,-15,-6],["l",0,0,-15,0],["l",-15,-3,-15,3],["l",-6,-4,-1,0],["l",-6,4,-1,0],["l",0,10,-15,10],["l",-15,15,-15,6]],pins:[["s",0,-30],["d",0,30],["g",-30,0]],labels:[10,0,"lm"],device:Nn},vs={id:"opamp",name:"Operational amplifier",category:"Nonlinear",prefix:"OA",shapes:[["l",-50,-30,-30,-30],["l",-50,30,-30,30],["l",30,0,50,0],["l",-30,-50,30,0],["l",-30,50,30,0],["l",-30,-50,-30,50],["l",-25,-30,-15,-30],["l",-20,-35,-20,-25],["l",-25,30,-15,30]],pins:[["noninv",-50,-30],["inv",-50,30],["out",50,0]],labels:[-30,55,"lt"],device:Qi},Z={diode:as,zener:ls,schottky:cs,varicap:us,npn:hs,pnp:fs,nfet:ps,pfet:ds,nmos:_s,pmos:ms,opamp:vs},gs={id:"vmeter",name:"Voltmeter",category:"Probes",prefix:"Pr",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,30,0,20],["t",0,0,"cm","V"],...rt(-25,25,25,-25)],pins:[["a",0,-30],["b",0,30]],labels:[25,0,"lm"],device:ts},ys={id:"ameter",name:"Ammeter",category:"Probes",prefix:"Pr",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,30,0,20],["t",0,0,"cm","A"],...rt(-25,25,25,-25)],pins:[["a",0,-30],["b",0,30]],labels:[25,0,"lm"],device:es},bs={vmeter:gs,ameter:ys},Vs={id:"vdc",name:"Ideal DC voltage source",category:"Sources",prefix:"V",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,-15,0,-5],["l",-5,-10,5,-10],["l",-5,10,5,10],["l",0,30,0,20]],pins:[["pos",0,-30],["neg",0,30]],labels:[25,0,"lm"],device:is},ws={id:"idc",name:"Ideal DC current source",category:"Sources",prefix:"I",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,10,0,-10],["l",0,-11,-5,-3],["l",0,-11,5,-3],["l",0,30,0,20]],pins:[["pos",0,-30],["neg",0,30]],labels:[25,0,"lm"],device:ns},Te={vdc:Vs,idc:ws};class xs{#e=new Map;constructor(e){for(const t of e)this.#e.set(t.id,t)}[Symbol.iterator](){return this.#e.values()}get(e){const t=this.#e.get(e);if(t==null)throw new Error(`Unknown symbol [${e}]`);return t}}const Dn=new xs([...Object.values(se),...Object.values(je),...Object.values(Z),...Object.values(Te),...Object.values(bs)]);var Cs=Symbol.for("preact-signals");function ot(){if(re>1)re--;else{for(var n,e=!1;ke!==void 0;){var t=ke;for(ke=void 0,bt++;t!==void 0;){var i=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&Bn(t))try{t.c()}catch(s){e||(n=s,e=!0)}t=i}}if(bt=0,re--,e)throw n}}function Hs(n){if(re>0)return n();re++;try{return n()}finally{ot()}}var S=void 0,ke=void 0,re=0,bt=0,Qe=0;function En(n){if(S!==void 0){var e=n.n;if(e===void 0||e.t!==S)return e={i:0,S:n,p:S.s,n:void 0,t:S,e:void 0,x:void 0,r:e},S.s!==void 0&&(S.s.n=e),S.s=e,n.n=e,32&S.f&&n.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=S.s,e.n=void 0,S.s.n=e,S.s=e),e}}function R(n){this.v=n,this.i=0,this.n=void 0,this.t=void 0}R.prototype.brand=Cs;R.prototype.h=function(){return!0};R.prototype.S=function(n){this.t!==n&&n.e===void 0&&(n.x=this.t,this.t!==void 0&&(this.t.e=n),this.t=n)};R.prototype.U=function(n){if(this.t!==void 0){var e=n.e,t=n.x;e!==void 0&&(e.x=t,n.e=void 0),t!==void 0&&(t.e=e,n.x=void 0),n===this.t&&(this.t=t)}};R.prototype.subscribe=function(n){var e=this;return Oe(function(){var t=e.value,i=S;S=void 0;try{n(t)}finally{S=i}})};R.prototype.valueOf=function(){return this.value};R.prototype.toString=function(){return this.value+""};R.prototype.toJSON=function(){return this.value};R.prototype.peek=function(){var n=S;S=void 0;try{return this.value}finally{S=n}};Object.defineProperty(R.prototype,"value",{get:function(){var n=En(this);return n!==void 0&&(n.i=this.i),this.v},set:function(n){if(n!==this.v){if(bt>100)throw new Error("Cycle detected");this.v=n,this.i++,Qe++,re++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{ot()}}}});function ne(n){return new R(n)}function Bn(n){for(var e=n.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Gn(n){for(var e=n.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){n.s=e;break}}}function On(n){for(var e=n.s,t=void 0;e!==void 0;){var i=e.p;e.i===-1?(e.S.U(e),i!==void 0&&(i.n=e.n),e.n!==void 0&&(e.n.p=i)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=i}n.s=t}function ye(n){R.call(this,void 0),this.x=n,this.s=void 0,this.g=Qe-1,this.f=4}(ye.prototype=new R).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Qe))return!0;if(this.g=Qe,this.f|=1,this.i>0&&!Bn(this))return this.f&=-2,!0;var n=S;try{Gn(this),S=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return S=n,On(this),this.f&=-2,!0};ye.prototype.S=function(n){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}R.prototype.S.call(this,n)};ye.prototype.U=function(n){if(this.t!==void 0&&(R.prototype.U.call(this,n),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};ye.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var n=this.t;n!==void 0;n=n.x)n.t.N()}};Object.defineProperty(ye.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var n=En(this);if(this.h(),n!==void 0&&(n.i=this.i),16&this.f)throw this.v;return this.v}});function Jt(n){return new ye(n)}function Wn(n){var e=n.u;if(n.u=void 0,typeof e=="function"){re++;var t=S;S=void 0;try{e()}catch(i){throw n.f&=-2,n.f|=8,Tt(n),i}finally{S=t,ot()}}}function Tt(n){for(var e=n.s;e!==void 0;e=e.n)e.S.U(e);n.x=void 0,n.s=void 0,Wn(n)}function ks(n){if(S!==this)throw new Error("Out-of-order effect");On(this),S=n,this.f&=-2,8&this.f&&Tt(this),ot()}function Ge(n){this.x=n,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}Ge.prototype.c=function(){var n=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{n()}};Ge.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Wn(this),Gn(this),re++;var n=S;return S=this,ks.bind(this,n)};Ge.prototype.N=function(){2&this.f||(this.f|=2,this.o=ke,ke=this)};Ge.prototype.d=function(){this.f|=8,1&this.f||Tt(this)};function Oe(n){var e=new Ge(n);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}var Un,ut,Rn=[];Oe(function(){Un=this.N})();function be(n,e){w[n]=e.bind(null,w[n]||function(){})}function et(n){ut&&ut(),ut=n&&n.S()}function zn(n){var e=this,t=n.data,i=Ss(t);i.value=t;var s=it(function(){for(var a=e,l=e.__v;l=l.__;)if(l.__c){l.__c.__$f|=4;break}var c=Jt(function(){var p=i.value.value;return p===0?0:p===!0?"":p||""}),f=Jt(function(){return!dn(c.value)}),h=Oe(function(){if(this.N=Fn,f.value){var p=c.value;a.base&&a.base.nodeType===3&&(a.base.data=p)}}),d=e.__$u.d;return e.__$u.d=function(){h(),d.call(this)},[f,c]},[]),r=s[0],o=s[1];return r.value?o.peek():o.value}zn.displayName="_st";Object.defineProperties(R.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:zn},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});be("__b",function(n,e){if(typeof e.type=="string"){var t,i=e.props;for(var s in i)if(s!=="children"){var r=i[s];r instanceof R&&(t||(e.__np=t={}),t[s]=r,i[s]=r.peek())}}n(e)});be("__r",function(n,e){et();var t,i=e.__c;i&&(i.__$f&=-2,(t=i.__$u)===void 0&&(i.__$u=t=function(s){var r;return Oe(function(){r=this}),r.c=function(){i.__$f|=1,i.setState({})},r}())),et(t),n(e)});be("__e",function(n,e,t,i){et(),n(e,t,i)});be("diffed",function(n,e){et();var t;if(typeof e.type=="string"&&(t=e.__e)){var i=e.__np,s=e.props;if(i){var r=t.U;if(r)for(var o in r){var a=r[o];a!==void 0&&!(o in i)&&(a.d(),r[o]=void 0)}else r={},t.U=r;for(var l in i){var c=r[l],f=i[l];c===void 0?(c=Ms(t,l,f,s),r[l]=c):c.o(f,s)}}}n(e)});function Ms(n,e,t,i){var s=e in n&&n.ownerSVGElement===void 0,r=ne(t);return{o:function(o,a){r.value=o,i=a},d:Oe(function(){this.N=Fn;var o=r.value.value;i[e]!==o&&(i[e]=o,s?n[e]=o:o?n.setAttribute(e,o):n.removeAttribute(e))})}}be("unmount",function(n,e){if(typeof e.type=="string"){var t=e.__e;if(t){var i=t.U;if(i){t.U=void 0;for(var s in i){var r=i[s];r&&r.d()}}}}else{var o=e.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}n(e)});be("__h",function(n,e,t,i){(i<3||i===9)&&(e.__$f|=2),n(e,t,i)});Q.prototype.shouldComponentUpdate=function(n,e){var t=this.__$u,i=t&&t.s!==void 0;for(var s in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var r=2&this.__$f;if(!(i||r||4&this.__$f)||1&this.__$f)return!0}else if(!(i||4&this.__$f)||3&this.__$f)return!0;for(var o in n)if(o!=="__source"&&n[o]!==this.props[o])return!0;for(var a in this.props)if(!(a in n))return!0;return!1};function Ss(n){return it(function(){return ne(n)},[])}var As=function(n){queueMicrotask(function(){queueMicrotask(n)})};function Is(){Hs(function(){for(var n;n=Rn.shift();)Un.call(n)})}function Fn(){Rn.push(this)===1&&(w.requestAnimationFrame||As)(Is)}const{round:m}=Math,$s=(n,e)=>n.x0<=e.x0&&e.x0<=n.x1&&n.y0<=e.y0&&e.y0<=n.y1||n.x0<=e.x0&&e.x0<=n.x1&&n.y0<=e.y1&&e.y1<=n.y1||n.x0<=e.x1&&e.x1<=n.x1&&n.y0<=e.y0&&e.y0<=n.y1||n.x0<=e.x1&&e.x1<=n.x1&&n.y0<=e.y1&&e.y1<=n.y1,Ls=(n,e)=>n.x0<=e.x0&&e.x0<=n.x1&&n.x0<=e.x1&&e.x1<=n.x1&&n.y0<=e.y0&&e.y0<=n.y1&&n.y0<=e.y1&&e.y1<=n.y1;let Ps=0;function Ts(){return Ps+=1}class Ns{#e=Ts();get id(){return this.#e}}let Nt=class extends Ns{moveTo(e,t){return this}includes(e,t){const{x0:i,y0:s,x1:r,y1:o}=this.area;return i<=e&&e<=r&&s<=t&&t<=o}};class Ve extends Nt{#e;#i;#n;#t;#r;#s;#a=null;constructor(e,t="lt",i=0,s=0){super(),this.#e=e,this.#i=t,this.#n=i,this.#t=s,this.#r=0,this.#s=0,this.#a=null}get text(){return this.#e}set text(e){this.#e=e,this.#r=0,this.#s=0,this.#a=null}get align(){return this.#i}set align(e){this.#i=e,this.#a=null}get x(){return this.#n}get y(){return this.#t}setSize(e,t){this.#r=e,this.#s=t,this.#a=null}get area(){return this.#a??=this.#u()}moveTo(e,t){return this.#n=e,this.#t=t,this.#a=null,this}#u(){let e=this.#i.charAt(0),t=this.#i.charAt(1),i=0,s=0,r=0,o=0;switch(e){case"l":i=this.#n,r=this.#n+this.#r;break;case"c":i=this.#n-this.#r/2,r=this.#n+this.#r/2;break;case"r":i=this.#n-this.#r,r=this.#n;break}switch(t){case"t":s=this.#t,o=this.#t+this.#s;break;case"m":s=this.#t-this.#s/2,o=this.#t+this.#s/2;break;case"b":s=this.#t-this.#s,o=this.#t;break}return{x0:i,y0:s,x1:r,y1:o}}}const N=4,$=2,L=1,Ds=[N|$|L,N|L,N|$,N,0,$,L,$|L],Es=[N,N|$,N|L,N|$|L,$|L,L,$,0],Bs=[$,$|L,0,L,N|$,N|L|$,N,N|L],Gs=[L,0,$|L,$,N|L,N,N|$|L,N|$],Os=(n,e)=>{switch(e){case"rl":return Ds[n]??0;case"rr":return Es[n]??0;case"mx":return Bs[n]??0;case"my":return Gs[n]??0}return 0},Ws=(n,e)=>{let[t,i,s]=n,r=0;return e&N&&(r=i,i=-s,s=r),e&$&&(i=-i),e&L&&(s=-s),[t,i,s]},qn=(n,e)=>{let t=n.charAt(0),i=n.charAt(1);if(e&$)switch(t){case"l":t="r";break;case"r":t="l";break}if(e&L)switch(i){case"t":i="b";break;case"b":i="t";break}return`${t}${i}`},Us=(n,e)=>{switch(n[0]){case"l":return Rs(n,e);case"c":return zs(n,e);case"a":return Fs(n,e);case"t":return qs(n,e)}return n},Rs=(n,e)=>{let[t,i,s,r,o]=n,a=0;return e&N&&(a=i,i=-s,s=a,a=r,r=-o,o=a),e&$&&(i=-i,r=-r),e&L&&(s=-s,o=-o),[t,i,s,r,o]},zs=(n,e)=>{let[t,i,s,r]=n,o=0;return e&N&&(o=i,i=-s,s=o),e&$&&(i=-i),e&L&&(s=-s),[t,i,s,r]},Fs=(n,e)=>{let[t,i,s,r,o,a]=n,l=0;return e&N&&(l=i,i=-s,s=l,o+=90,a+=90),e&$&&(i=-i,l=o,o=180-a,a=180-l),e&L&&(s=-s,l=o,o=-a,a=-l),[t,i,s,r,o,a]},qs=(n,e)=>{let[t,i,s,r,o]=n;r=qn(r,e);let a=0;return e&N&&(a=i,i=-s,s=a),e&$&&(i=-i),e&L&&(s=-s),[t,i,s,r,o]},js=(n,e)=>{let[t,i,s]=n;s=qn(s,e);let r=0;return e&N&&(r=t,t=-i,i=r),e&$&&(t=-t),e&L&&(i=-i),[t,i,s]},jn=({shapes:n,pins:e},t,i)=>{const s={x:0,y:0},r={x:0,y:0};for(const o of n)switch(o[0]){case"l":{const[a,l,c,f,h]=o;s.x=Math.min(s.x,l,f),s.y=Math.min(s.y,c,h),r.x=Math.max(r.x,l,f),r.y=Math.max(r.y,c,h);break}case"c":{const[a,l,c,f]=o;s.x=Math.min(s.x,l-f,l+f),s.y=Math.min(s.y,c-f,c+f),r.x=Math.max(r.x,l-f,l+f),r.y=Math.max(r.y,c-f,c+f);break}case"a":{const[a,l,c,f,h,d]=o;s.x=Math.min(s.x,l-f,l+f),s.y=Math.min(s.y,c-f,l+f),r.x=Math.max(r.x,l-f,c+f),r.y=Math.max(r.y,c-f,c+f);break}}for(const[o,a,l]of e)s.x=Math.min(s.x,a),s.y=Math.min(s.y,l),r.x=Math.max(r.x,a),r.y=Math.max(r.y,l);return{x0:t+s.x,y0:i+s.y,x1:t+r.x,y1:i+r.y}};class Zn{static anonymous(e){return`${e}?`}#e=new Map;constructor(e){for(const t of e)if(t instanceof ee){const i=this.#i(t.symbol.prefix);i.instances.push(t),i.names.add(t.name)}}getUniqueName(e){const t=this.#i(e);let i=1;for(;;){const s=`${e}${i}`;if(!t.names.has(s))return t.names.add(s),s;i+=1}}rename(e="none"){for(const[t,i]of this.#e.entries()){switch(e){case"none":break;case"horizontal":i.instances.sort((s,r)=>s.x-r.x||s.y-r.y);break;case"vertical":i.instances.sort((s,r)=>s.y-r.y||s.x-r.x);break}i.names.clear();for(const s of i.instances)s.name=this.getUniqueName(t)}}#i(e){let t=this.#e.get(e);return t==null&&this.#e.set(e,t={instances:[],names:new Set}),t}}class ee extends Nt{#e;#i;#n;#t;#r;#s;#a=null;#u=null;#p=null;#o=null;constructor(e,t=Zn.anonymous(e.prefix),i={},s=0,r=0,o=0){super(),this.#e=e,this.#i=t,this.#n=i,this.#t=s,this.#r=r,this.#s=o}get symbol(){return this.#e}get name(){return this.#i}set name(e){this.#i=e}get props(){return this.#n}set props(e){this.#n=e}get x(){return this.#t}get y(){return this.#r}get area(){return this.#o??=jn(this,this.#t,this.#r)}moveTo(e,t){return this.#t=e,this.#r=t,this.#o=null,this}get transform(){return this.#s}transformBy(e){return this.#s=Os(this.#s,e),this.#a=null,this.#u=null,this.#p=null,this.#o=null,this}get shapes(){return this.#a??=this.#e.shapes.map(e=>Us(e,this.#s))}get pins(){return this.#u??=this.#e.pins.map(e=>Ws(e,this.#s))}get labels(){return this.#p??=js(this.#e.labels,this.#s)}}class U extends Nt{#e;#i;#n;#t;#r;constructor(e,t,i,s){super(),this.#e=e,this.#i=t,this.#n=i,this.#t=s,this.#r=null}get x0(){return this.#e}set x0(e){this.#e=e,this.#r=null}get y0(){return this.#i}set y0(e){this.#i=e,this.#r=null}get x1(){return this.#n}set x1(e){this.#n=e,this.#r=null}get y1(){return this.#t}set y1(e){this.#t=e,this.#r=null}get x(){return this.#e}get y(){return this.#i}get area(){return this.#r??={x0:Math.min(this.#e,this.#n),y0:Math.min(this.#i,this.#t),x1:Math.max(this.#e,this.#n),y1:Math.max(this.#i,this.#t)}}moveTo(e,t){const i=this.#n-this.#e,s=this.#t-this.#i;return this.#e=e,this.#i=t,this.#n=e+i,this.#t=t+s,this.#r=null,this}includes(e,t){if(this.#i===this.#t){const h=this.#i,d=Math.min(this.#e,this.#n),p=Math.max(this.#e,this.#n);return d<=e&&e<=p&&h-3<=t&&t<=h+3}if(this.#e===this.#n){const h=this.#e,d=Math.min(this.#i,this.#t),p=Math.max(this.#i,this.#t);return d<=t&&t<=p&&h-3<=e&&e<=h+3}const s=Math.abs((this.#t-this.#i)*e-(this.#n-this.#e)*t+this.#n*this.#i-this.#t*this.#e),r=Math.sqrt((this.#t-this.#i)*(this.#t-this.#i)+(this.#n-this.#e)*(this.#n-this.#e)),o=s/r,a=Math.min(this.#e,this.#n),l=Math.min(this.#i,this.#t),c=Math.max(this.#e,this.#n),f=Math.max(this.#i,this.#t);return a<=e&&e<=c&&l<=t&&t<=f&&o<=3}}function Zs(n){const e=new Ys,t=new Xs;for(const s of n)if(s instanceof U){const{x0:r,y0:o,x1:a,y1:l}=s;if(o===l){e.addWire(o,s);continue}if(r===a){t.addWire(r,s);continue}continue}for(const s of n){if(s instanceof ee){for(const[r,o,a]of s.pins){const l=s.x+o,c=s.y+a;e.split(c,l,n),t.split(l,c,n)}continue}if(s instanceof U){const{x0:r,y0:o,x1:a,y1:l}=s;if(r===a&&o===l)continue;if(o===l){t.split(r,o,n),t.split(a,o,n);continue}if(r===a){e.split(o,r,n),e.split(l,r,n);continue}t.split(r,o,n),t.split(a,l,n),e.split(o,r,n),e.split(l,a,n);continue}}e.merge(),t.merge();let i=0;for(;i<n.length;){const s=n[i];if(s instanceof U){const{x0:r,y0:o,x1:a,y1:l}=s;if(r===a&&o===l){n.splice(i,1);continue}}i+=1}}class Ys{lines=new Map;addWire(e,t){const{x0:i,x1:s}=t;t.x0=Math.min(i,s),t.x1=Math.max(i,s),t.y0=e,t.y1=e;let r=this.lines.get(e);r==null&&this.lines.set(e,r={wires:[],breakpoints:[]}),r.wires.push(t)}split(e,t,i){let s=this.lines.get(e);if(s!=null){s.breakpoints.push(t);for(const r of s.wires)if(r.x0<t&&t<r.x1){const o=new U(t,e,r.x1,e);i.push(o),s.wires.push(o),r.x1=t}}}merge(){for(const{wires:e,breakpoints:t}of this.lines.values()){e.sort((s,r)=>s.x0-r.x0);let i=1;for(;i<e.length;){const s=e[i-1],r=e[i],o=t.indexOf(s.x1),a=t.indexOf(r.x0);(o===-1||a===-1||o!==a)&&s.x1>=r.x0&&(r.x0=s.x0,r.x1=Math.max(s.x1,r.x1),s.x1=s.x0),i+=1}}}}class Xs{lines=new Map;addWire(e,t){const{y0:i,y1:s}=t;t.y0=Math.min(i,s),t.y1=Math.max(i,s),t.x0=e,t.x1=e;let r=this.lines.get(e);r==null&&this.lines.set(e,r={wires:[],breakpoints:[]}),r.wires.push(t)}split(e,t,i){let s=this.lines.get(e);if(s!=null){s.breakpoints.push(t);for(const r of s.wires)if(r.y0<t&&t<r.y1){const o=new U(e,t,e,r.y1);i.push(o),s.wires.push(o),r.y1=t}}}merge(){for(const{wires:e,breakpoints:t}of this.lines.values()){e.sort((s,r)=>s.y0-r.y0);let i=1;for(;i<e.length;){const s=e[i-1],r=e[i],o=t.indexOf(s.y1),a=t.indexOf(r.y0);(o===-1||a===-1||o!==a)&&s.y1>=r.y0&&(r.y0=s.y0,r.y1=Math.max(s.y1,r.y1),s.y1=s.y0),i+=1}}}}function Ne(n){const e=[];for(const t of n){if(t instanceof ee){const{x:i,y:s,transform:r,symbol:o,name:a,props:l}=t;e.push(["i",i,s,r,o.id,a,l])}if(t instanceof U){const{x0:i,y0:s,x1:r,y1:o}=t;e.push(["w",i,s,r,o])}if(t instanceof Ve){const{x:i,y:s,align:r,text:o}=t;e.push(["f",i,s,r,o])}}return e}function me(n){const e=[];for(const t of n)switch(t[0]){case"i":{const[i,s,r,o,a,l,c]=t;e.push(new ee(Dn.get(a),l,c,s,r,o));break}case"w":{const[i,s,r,o,a]=t;e.push(new U(s,r,o,a));break}case"f":{const[i,s,r,o,a]=t;e.push(new Ve(a,o,s,r));break}}return e}class Ks{#e=[];get full(){return this.#e.length>0}take(){return me(this.#e)}put(e){this.#e=Ne(e)}clear(){this.#e=[]}}const Me=0,de=1,at=16,Yn=256,Xn=4096,Js=["input","textarea","select","INPUT","TEXTAREA","SELECT"];function Kn(...n){const e=n.map(Qs);return t=>{const{target:i}=t;if(i instanceof Element&&Js.includes(i.tagName))return!0;const s=xe(t);for(const r of e)if((r.key==="any"||r.key===t.key||r.key===t.code)&&r.mod===s&&r.handler(t,s)!==!1)return t.preventDefault(),!0;return!1}}function xe(n){let e=0;return n.shiftKey&&(e|=de),n.altKey&&(e|=at),n.ctrlKey&&(e|=Yn),n.metaKey&&(e|=Xn),e}function Qs([n,e]){let t="",i=Me;const s=n.split("+");for(;s.length>0;){const r=s.shift();switch(r){case"Shift":i|=de;break;case"Alt":i|=at;break;case"Ctrl":i|=Yn;break;case"Meta":i|=Xn;break;default:t=r;break}}return{key:t,mod:i,handler:e}}function ht(n){return{x:n.offsetX,y:n.offsetY}}const Se={instance:1,formula:2,wire:4096,notWire:4095,all:65535};function Qt(n,e,t,i=Se.all){for(const s of n)if(i&er(s)&&s.includes(e,t))return s;return null}function er(n){switch(!0){case n instanceof ee:return Se.instance;case n instanceof Ve:return Se.formula;case n instanceof U:return Se.wire}return 0}function tr(n){const e=[];for(const t of n)t instanceof ee&&e.push(t);return e}function nr(n){const e=[];for(const t of n)t instanceof U&&e.push(t);return e}function ir(n){const e=[];for(const t of n)t instanceof Ve&&e.push(t);return e}class sr{#e;#i;#n;constructor(e,t,i){this.#e=e,this.#i=t,this.#n=i}get name(){return this.#e}get elements(){return this.#i}get pins(){return this.#n}}class rr{#e;#i;#n;#t;constructor(e,t,i,s){this.#e=e,this.#i=t,this.#n=i,this.#t=s}get x(){return this.#e}get y(){return this.#i}get instance(){return this.#n}get name(){return this.#t}}function or(){const n=[],e=[],t=[];return new class{get pins(){return n}get joins(){return e}get nodes(){return t}getWires(){return null}getPins(){return null}}}function ar(n){const e=[],t=[],i=[],s=new Map,r=new cr(s,t,i);for(const o of n){if(o instanceof ee){for(const[a,l,c]of o.pins){const f=o.x+l,h=o.y+c,d=new rr(f,h,o,a);e.push(d),r.addPin(d)}continue}o instanceof U&&r.addWire(o)}return r.connect(),new class{get pins(){return e}get joins(){return t}get nodes(){return i}getWires(o,a){return s.get(Ae(o,a))?.wires??null}getPins(o,a){return s.get(Ae(o,a))?.pins??null}}}const lr=new Set([Te.vdc,Te.idc,Z.opamp,Z.npn,Z.pnp,Z.nmos,Z.pmos,Z.nfet,Z.pfet]);class cr{cells;joins;nodes;names;constructor(e,t,i){this.cells=e,this.joins=t,this.nodes=i,this.names=new Set(["ground"])}addPin(e){this.getCell(e.x,e.y).pins.push(e)}addWire(e){this.getCell(e.x0,e.y0).wires.push(e),this.getCell(e.x1,e.y1).wires.push(e)}getCell(e,t){const i=Ae(e,t);let s=this.cells.get(i);return s==null&&this.cells.set(i,s={x:e,y:t,wires:[],pins:[],color:null}),s}connect(){this.connectGrounds(),this.connectPorts(),this.connectWithSuggestedNames();let e=1;for(const t of this.cells.values())t.pins.length>0&&t.color==null&&(this.walk([t],this.getColor(this.getUniqueName(`_n${e}`))),e+=1);for(const t of this.cells.values())t.wires.length+t.pins.length>2&&this.joins.push({x:t.x,y:t.y})}connectGrounds(){const e=this.getColor("ground");for(const t of this.cells.values())for(const i of t.pins)if(i.instance.symbol===se.ground){if(e.elements.push(i.instance),t.color==null)this.walk([t],e);else if(t.color!==e){this.conflict(e,t);return}}}connectPorts(){const e=new Map;for(const t of this.cells.values())for(const i of t.pins)if(i.instance.symbol===se.port){const{name:s}=i.instance;this.names.add(s);let r=e.get(s);if(r==null&&e.set(s,r=this.getColor(s)),r.elements.push(i.instance),t.color==null)this.walk([t],r);else if(t.color!==r){this.conflict(r,t);return}}}connectWithSuggestedNames(){for(const e of this.cells.values())for(const t of e.pins)if(lr.has(t.instance.symbol)&&e.color==null){const i=`_${t.instance.name}_${t.name}`;this.walk([e],this.getColor(this.getUniqueName(i)))}}conflict(e,t){console.warn(`Node naming conflict: [${e.node.name}] and [${t.color.node.name}]`),this.nodes.length=0}walk(e,t){for(;;){const i=e.pop();if(i==null)break;i.color=t;for(const s of i.wires){t.elements.push(s);const r=i.x===s.x1&&i.y===s.y1?Ae(s.x0,s.y0):Ae(s.x1,s.y1),o=this.cells.get(r);o!=null&&o.color==null&&e.push(o)}for(const s of i.pins)t.pins.push(s)}}getColor(e){const t=[],i=[],s=new sr(e,t,i);return this.nodes.push(s),{node:s,elements:t,pins:i}}getUniqueName(e){if(this.names.has(e)){let t=1;for(;;){let i=`${e}_${t}`;if(!this.names.has(i)){e=i;break}t+=1}}return this.names.add(e),e}}function Ae(n,e){return e+32768<<16|n+32768<<0}const en={rewire(n){},connect(n){return or()}},tn={rewire(n){Zs(n)},connect(n){return ar(n)}};class Y{#e;#i;#n;#t;#r;#s;#a;constructor(e,t=tn){this.#e=[...e],this.#i=t,this.#n=null,this.#t=null,this.#r=null,this.#s=null,this.#a=null,this.#i.rewire(this.#e),e instanceof Y&&e.#u()}[Symbol.iterator](){return this.#e[Symbol.iterator]()}get instances(){return this.#n??=tr(this.#e)}get formulas(){return this.#t??=ir(this.#e)}get wires(){return this.#r??=nr(this.#e)}get network(){return this.#s??=this.#i.connect(this.#e)}get names(){return this.#a??=new Zn(this.#e)}append(e){return new Y([...this.#e,...e],this.#i)}delete(e){return new Y(this.#e.filter(t=>!e.has(t)),this.#i)}unwire(){return new Y(this.#e,en)}rewire(){return new Y(this.#e,tn)}rename(e="none"){const t=new Y(this.#e,this.#i);return t.names.rename(e),t}#u(){this.#e=[],this.#i=en,this.#n=null,this.#t=null,this.#r=null,this.#s=null,this.#a=null}}class ur{#e;#i;constructor(e){this.#e=[[Ne(e),"initial"]],this.#i=0}*[Symbol.iterator](){let e=0;for(const[t,i]of this.#e)yield[e,i],e+=1}get length(){return this.#e.length}push(e,t){this.#i+=1,this.#e.splice(this.#i),this.#e.push([Ne(e),t])}get canUndo(){return this.#i>0}undo(){this.canUndo&&(this.#i-=1);const[e]=this.#e[this.#i];return new Y(me(e))}get canRedo(){return this.#i<this.#e.length-1}redo(){this.canRedo&&(this.#i+=1);const[e]=this.#e[this.#i];return new Y(me(e))}}function ft(n){return n===Me?"l":n===de?"r":n===at?"d":"l"}function hr(n,e,t,i,s){return n===t&&e===i?[]:s==="d"?[new U(n,e,t,i)]:e===i?[new U(n,e,t,i)]:n===t?[new U(n,e,t,i)]:s==="l"?[new U(n,e,t,e),new U(t,e,t,i)]:[new U(n,e,n,i),new U(n,i,t,i)]}class nn{#e;constructor(e){this.#e=[...e].map(t=>({element:t,x:t.x,y:t.y}))}moveBy(e,t){for(const{element:i,x:s,y:r}of this.#e)i.moveTo(s+e,r+t)}reset(){for(const{element:e,x:t,y:i}of this.#e)e.moveTo(t,i)}}const X=10,fr=4,pr=30;class C{static defaultZoom=new C;#e;#i;#n;#t;static snap(e){return m(e/X)*X}static floor(e){return Math.floor(e/X)*X}static ceil(e){return Math.ceil(e/X)*X}constructor(e=X,t=0,i=0){e=m(e),t=m(t),i=m(i),e=Math.max(fr,e),e=Math.min(pr,e),this.#e=e,this.#i=t,this.#n=i,this.#t=e/X}get gridSize(){return this.#e}get x(){return this.#i}get y(){return this.#n}get scale(){return this.#t}scaleTo(e){return new C(X*e,this.#i,this.#n)}scaleBy(e){return new C(X*(this.#t+e),this.#i,this.#n)}zoomTo(e){return new C(e,this.#i,this.#n)}zoomBy(e){return new C(this.#e+e,this.#i,this.#n)}moveTo(e,t){return new C(this.#e,e,t)}moveBy(e,t){return new C(this.#e,this.#i+e,this.#n+t)}toGridX(e){return m((e-this.#i)/this.#t)}toGridY(e){return m((e-this.#n)/this.#t)}toScreenX(e){return m(e*this.#t+this.#i)}toScreenY(e){return m(e*this.#t+this.#n)}snapScreenX(e){return this.toScreenX(C.snap(this.toGridX(e)))}snapScreenY(e){return this.toScreenY(C.snap(this.toGridY(e)))}static center(e,t,i,s=!1){const r=i.x1-i.x0,o=i.y1-i.y0;let a=C.defaultZoom;return s&&r>0&&o>0&&(a=a.scaleTo(Math.min(e/(r+X*2),t/(o+X*2)))),a.moveTo(e/2-(r/2+i.x0)*a.scale,t/2-(o/2+i.y0)*a.scale)}}ne(new C);const T={symbol:{normal:"#222222",selected:"#0000ff"},pin:{normal:"#222222",selected:"#0000ff"},pinFill:{normal:"#ffffff",selected:"#ffffff"},wire:{normal:"#222222",selected:"#0000ff"},outline:"#22222222",selection:"#0000ff11",gridFine:"#00000066",gridCoarse:"#000000FF",crosshair:"#0000FF66"},V=.5;class Jn{#e;#i;constructor(e){this.#e=e,this.#i=e.getContext("2d")}get canvas(){return this.#e}get ctx(){return this.#i}get width(){return this.#e.width}get height(){return this.#e.height}reset(){this.#i.reset()}paintGrid(e){const t=e.scale,i=e.x,s=e.y,r=e.gridSize,o=10,a=i%r,l=i%(r*o),c=s%r,f=s%(r*o);this.#t((h,d,p)=>{if(t>=1){h.strokeStyle=T.gridFine,h.lineWidth=1,h.lineCap="butt",h.setLineDash([1,r-1]);for(let _=c;_<p;_+=r)h.beginPath(),h.moveTo(a,_+V),h.lineTo(d,_+V),h.stroke()}}),this.#t((h,d,p)=>{h.strokeStyle=t>=1?T.gridCoarse:T.gridFine,h.lineWidth=1,h.lineCap="butt",h.setLineDash([1,r-1]);for(let _=f;_<p;_+=r*o)h.beginPath(),h.moveTo(a,_+V),h.lineTo(d,_+V),h.stroke();for(let _=l;_<d;_+=r*o)h.beginPath(),h.moveTo(_+V,c),h.lineTo(_+V,p),h.stroke()}),this.#t((h,d,p)=>{h.strokeStyle=T.gridFine,h.lineWidth=1,h.lineCap="butt",h.beginPath(),h.moveTo(m(i-10*t)+V,m(s)+V),h.lineTo(m(i+10*t)+V,m(s)+V),h.moveTo(m(i)+V,m(s-10*t)+V),h.lineTo(m(i)+V,m(s+10*t)+V),h.stroke()})}paintCrosshair(e,{x:t,y:i},s){this.#t((r,o,a)=>{s?(r.strokeStyle=T.crosshair,r.lineWidth=1,r.lineCap="butt"):(r.strokeStyle=T.outline,r.lineWidth=1,r.lineCap="butt"),r.beginPath(),r.moveTo(0,e.snapScreenY(i)+V),r.lineTo(o,e.snapScreenY(i)+V),r.moveTo(e.snapScreenX(t)+V,0),r.lineTo(e.snapScreenX(t)+V,a),r.stroke()})}paintSelection(e,t,i){this.#t(s=>{s.fillStyle=T.selection,s.fillRect(m(t.x),m(t.y),m(i.x-t.x),m(i.y-t.y))})}paintInstance(e,t,i=!1){const s=e.scale,r=e.x,o=e.y,a=t.x,l=t.y;this.#t(c=>{i?(c.fillStyle=T.symbol.selected,c.strokeStyle=T.symbol.selected,c.lineWidth=3,c.lineCap="square"):(c.fillStyle=T.symbol.normal,c.strokeStyle=T.symbol.normal,c.lineWidth=1,c.lineCap="square");for(const f of t.shapes)switch(f[0]){case"l":{const[h,d,p,_,g]=f;c.beginPath(),c.moveTo(m(r+(a+d)*s)+V,m(o+(l+p)*s)+V),c.lineTo(m(r+(a+_)*s)+V,m(o+(l+g)*s)+V),c.stroke();break}case"c":{const[h,d,p,_]=f;c.beginPath(),c.ellipse(m(r+(a+d)*s)+V,m(o+(l+p)*s)+V,m(_*s),m(_*s),0,0,2*Math.PI),c.stroke();break}case"a":{const[h,d,p,_,g,x]=f;c.beginPath(),c.ellipse(m(r+(a+d)*s)+V,m(o+(l+p)*s)+V,m(_*s),m(_*s),0,g*(Math.PI/180),x*(Math.PI/180)),c.stroke();break}case"t":{const[h,d,p,_,g]=f;this.#n(c,e,_),c.fillText(g,r+(a+d)*s,o+(l+p)*s);break}}})}paintPins(e,t,i=!1){const s=e.scale,r=e.x,o=e.y,a=t.x,l=t.y;this.#t(c=>{i?(c.fillStyle=T.pinFill.selected,c.strokeStyle=T.pin.selected,c.lineWidth=3,c.lineCap="square"):(c.fillStyle=T.pinFill.normal,c.strokeStyle=T.pin.normal,c.lineWidth=1,c.lineCap="square");for(const f of t.pins){const[h,d,p]=f;c.beginPath(),c.ellipse(m(r+(a+d)*s)+V,m(o+(l+p)*s)+V,m(3*s),m(3*s),0,0,2*Math.PI),c.fill(),c.stroke()}})}paintLabels(e,t,i=!1){const s=e.scale,r=e.x,o=e.y,a=t.x,l=t.y;this.#t(c=>{i?c.fillStyle=T.symbol.selected:c.fillStyle=T.symbol.normal;const[f,h,d]=t.labels;this.#n(c,e,d),c.fillText(t.name,r+(a+f)*s,o+(l+h)*s)})}paintWire(e,t,i=!1){const s=e.scale,r=e.x,o=e.y;this.#t(a=>{i?(a.strokeStyle=T.wire.selected,a.lineWidth=3,a.lineCap="square"):(a.strokeStyle=T.wire.normal,a.lineWidth=1,a.lineCap="square");const{x0:l,y0:c,x1:f,y1:h}=t;a.beginPath(),a.moveTo(m(r+l*s)+V,m(o+c*s)+V),a.lineTo(m(r+f*s)+V,m(o+h*s)+V),a.stroke()})}paintJoins(e,t){const i=e.scale,s=e.x,r=e.y;this.#t(o=>{o.fillStyle=T.wire.normal;for(const{x:a,y:l}of t)o.beginPath(),o.ellipse(m(s+a*i)+V,m(r+l*i)+V,m(3*i),m(3*i),0,0,2*Math.PI),o.fill()})}paintOrigin(e,{x:t,y:i}){const s=e.scale,r=e.x,o=e.y;this.#t(a=>{a.strokeStyle=T.outline,a.lineWidth=1,a.lineCap="butt",a.beginPath(),a.moveTo(m(r+(t-10)*s)+V,m(o+i*s)+V),a.lineTo(m(r+(t+10)*s)+V,m(o+i*s)+V),a.moveTo(m(r+t*s)+V,m(o+(i-10)*s)+V),a.lineTo(m(r+t*s)+V,m(o+(i+10)*s)+V),a.stroke()})}paintArea(e,{x0:t,y0:i,x1:s,y1:r}){const o=e.scale,a=e.x,l=e.y;this.#t(c=>{c.strokeStyle=T.outline,c.lineWidth=1,c.lineCap="square",c.strokeRect(m(a+t*o)+V,m(l+i*o)+V,m((s-t)*o),m((r-i)*o))})}paintSymbolIcon(e,t,i){const s=jn(e,0,0),r=C.center(t,i,s,!0);this.paintInstance(r,{x:0,y:0,shapes:e.shapes})}#n(e,t,i){switch(e.font=`${20*t.scale}px serif`,i.charAt(0)){case"l":e.textAlign="left";break;case"c":e.textAlign="center";break;case"r":e.textAlign="right";break}switch(i.charAt(1)){case"t":e.textBaseline="top";break;case"m":e.textBaseline="middle";break;case"b":e.textBaseline="bottom";break}}#t=e=>{const t=this.#i;t.save(),e(t,this.#e.width,this.#e.height),t.restore()}}class W{#e;constructor(e=[]){this.#e=new Set;for(const{id:t}of e)this.#e.add(t)}[Symbol.iterator](){return this.#e[Symbol.iterator]()}get size(){return this.#e.size}get full(){return this.#e.size>0}has({id:e}){return this.#e.has(e)}filter(e){return[...e].filter(({id:t})=>this.#e.has(t))}select(e){return new W(e)}add(e){const t=new W;for(const i of this.#e)t.#e.add(i);for(const{id:i}of e)t.#e.add(i);return t}delete(e){const t=new W;for(const i of this.#e)t.#e.add(i);for(const{id:i}of e)t.#e.delete(i);return t}clear(){return new W}}function Qn(n){const e={x:1/0,y:1/0},t={x:-1/0,y:-1/0};for(const{area:i}of n)e.x=Math.min(e.x,i.x0),e.y=Math.min(e.y,i.y0),t.x=Math.max(t.x,i.x1),t.y=Math.max(t.y,i.y1);return e.x<t.x&&e.y<t.y?{x0:e.x,y0:e.y,x1:t.x,y1:t.y}:{x0:0,y0:0,x1:0,y1:0}}function dr(n,e){const t=e.charAt(0),i=e.charAt(1),s=Qn(n);let r=0,o=0;switch(t){case"l":r=s.x0;break;case"c":r=C.snap((s.x0+s.x1)/2);break;case"r":r=s.x1;break}switch(i){case"t":o=s.y0;break;case"m":o=C.snap((s.y0+s.y1)/2);break;case"b":o=s.y1;break}for(const a of n)a.moveTo(a.x-r,a.y-o)}class _r{#e;#i;#n=ne(new Y([]));#t=ne(new C);#r=ne(new W);#s=ne({type:"idle",cursor:{x:100,y:100},hovered:null});#a=new Ks;#u={current:null};#p;#o;constructor(e,t){this.#e=e,this.#i=new ur(t),this.#n.value=t;const i=o=>()=>{this.#t.value=this.#t.value.zoomBy(o)},s=(o,a)=>()=>{this.#t.value=this.#t.value.moveBy(o,a)},r=o=>()=>{this.pasteInstance(o)};this.#p=Kn(["Digit0",()=>{this.zoomTo("0")}],["Equal",i(1)],["Minus",i(-1)],["Home",()=>{this.zoomTo("1")}],["Space",()=>{this.zoomTo("all")}],["ArrowLeft",s(-10,0)],["Shift+ArrowLeft",s(-100,0)],["ArrowRight",s(10,0)],["Shift+ArrowRight",s(100,0)],["ArrowUp",s(0,-10)],["Shift+ArrowUp",s(0,-100)],["ArrowDown",s(0,10)],["Shift+ArrowDown",s(0,100)],["Ctrl+a",()=>{this.select("all")}],["Ctrl+x",()=>{this.selectionCut()}],["Ctrl+c",()=>{this.selectionCopy()}],["Ctrl+v",()=>{this.selectionPaste()}],["Delete",()=>{this.selectionDelete()}],["Ctrl+z",()=>{this.undo()}],["Ctrl+y",()=>{this.redo()}],["Alt+l",()=>{if(!this.transformSelection("rl"))return!1}],["Alt+r",()=>{if(!this.transformSelection("rr"))return!1}],["Alt+h",()=>{if(!this.transformSelection("mx"))return!1}],["Alt+v",()=>{if(!this.transformSelection("my"))return!1}],["Escape",()=>{if(!this.#c()){if(this.#r.value.full){this.#r.value=this.#r.value.clear();return}return!1}}],["w",()=>{if(this.#c(),!this.#g())return!1}],["g",r(se.ground)],["o",r(se.port)],["v",r(Te.vdc)],["i",r(Te.idc)],["r",r(je.resistor)],["c",r(je.capacitor)],["l",r(je.inductor)],["d",r(Z.diode)],["n",r(Z.npn)],["p",r(Z.pnp)],["Shift+N",r(Z.nmos)],["Shift+P",r(Z.pmos)],["a",r(Z.opamp)],["f",()=>{this.pasteFormula(String.raw`c = \pm\sqrt{a^2 + b^2}`)}])}get library(){return this.#e}get schematic(){return this.#n.value}get zoom(){return this.#t.value}get selection(){return this.#r.value}get mouseAction(){return this.#s.value}get focusRef(){return this.#u}attach(e){this.#o=new Jn(e),this.#t.value=this.#m(!1)}handleFocus=e=>{this.#l()};handleBlur=e=>{this.#c(),this.#l()};handleKeyDown=e=>{this.#p(e)||this.#v(e)};handleKeyUp=e=>{this.#v(e)};#v(e){const{key:t}=e,i=xe(e);if(t==="Shift"&&this.#x(t,i)){e.preventDefault();return}if(t==="Alt"&&this.#x(t,i)){e.preventDefault();return}if(t==="Shift"&&this.#M(t,i)){e.preventDefault();return}}handleMouseDown=e=>{const t=e.button,i=xe(e),s=ht(e);t===0&&i===Me&&(this.#_(s,i)||this.#V(s,i)||this.#y(s))||t===0&&i===de&&(this.#_(s,i)||this.#V(s,i)||this.#y(s))||t===0&&i===at&&this.#_(s,i)||t===1&&i===Me&&this.#B(s)};handleMouseMove=e=>{const t=xe(e),i=ht(e);this.#H(i)||this.#w(i,t)||this.#I(i)||this.#P(i)||this.#b(i,t)||this.#G(i)||this.#s.value.type==="idle"&&this.#C(i)&&this.#l(i)};handleMouseUp=e=>{const t=ht(e);this.#D(t)||this.#$(t)||this.#T(t)||this.#S(t)||this.#l(t)};handleWheel=e=>{e.preventDefault();const t=xe(e);if(this.#s.value.type==="idle"&&t===Me){this.#t.value=this.#t.value.zoomBy(-Math.sign(e.deltaY));return}};handleContextMenu=e=>{e.preventDefault()};#C(e){const t=this.#t.value.toGridX(e.x),i=this.#t.value.toGridY(e.y),s=this.#t.value.toGridX(this.#s.value.cursor.x),r=this.#t.value.toGridY(this.#s.value.cursor.y);return C.snap(t)!==C.snap(s)||C.snap(i)!==C.snap(r)}#l(e=this.#s.value.cursor){const t=C.snap(this.#t.value.toGridX(e.x)),i=C.snap(this.#t.value.toGridY(e.y)),s=Qt(this.#n.value,t,i,Se.notWire);this.#s.value={type:"idle",cursor:e,hovered:s}}#g(){if(this.#s.value.type==="idle"){this.#r.value=this.#r.value.clear();const{cursor:e}=this.#s.value;return this.#s.value={type:"place-wire",cursor:e},!0}return!1}#H(e){return this.#s.value.type==="place-wire"?(this.#s.value={type:"place-wire",cursor:e},!0):!1}#k(){return this.#s.value.type==="place-wire"?(this.#l(),!0):!1}#y(e){return this.#s.value.type==="idle"?(this.#r.value=this.#r.value.clear(),this.#s.value={type:"select",cursor:{...e},origin:{...e}},!0):!1}#b(e,t){if(this.#s.value.type==="select"){const{origin:i}=this.#s.value,s={x0:this.#t.value.toGridX(Math.min(i.x,e.x)),y0:this.#t.value.toGridY(Math.min(i.y,e.y)),x1:this.#t.value.toGridX(Math.max(i.x,e.x)),y1:this.#t.value.toGridY(Math.max(i.y,e.y))};for(const r of this.#n.value)(t===de?$s(s,r.area):Ls(s,r.area))?this.#r.value=this.#r.value.add([r]):this.#r.value=this.#r.value.delete([r]);return this.#s.value={type:"select",cursor:e,origin:i},!0}return!1}#M(e,t){return this.#s.value.type==="select"?this.#b(this.#s.value.cursor,t):!1}#S(e){if(this.#s.value.type==="select"){const{origin:t}=this.#s.value;return e.x===t.x&&e.y===t.y&&(this.#r.value=this.#r.value.clear()),this.#l(e),!0}return!1}#A(){return this.#s.value.type==="select"?(this.#r.value=new W,this.#l(),!0):!1}#V(e,t){if(this.#s.value.type==="idle"){const i=Qt(this.#n.value,this.#t.value.toGridX(e.x),this.#t.value.toGridY(e.y));if(i!=null){this.#r.value.has(i)||(this.#r.value=t===de?this.#r.value.add([i]):this.#r.value.select([i]));const s=Ne(this.#n.value),r=new nn(this.#r.value.filter(this.#n.value));return this.#n.value=this.#n.value.unwire(),this.#s.value={type:"move",cursor:{...e},origin:{...e},undo:s,mover:r},!0}}return!1}#I(e){if(this.#s.value.type==="move"){const{origin:t,undo:i,mover:s}=this.#s.value,r=C.snap(this.#t.value.toGridX(t.x)),o=C.snap(this.#t.value.toGridY(t.y)),a=C.snap(this.#t.value.toGridX(e.x)),l=C.snap(this.#t.value.toGridY(e.y));return s.moveBy(a-r,l-o),this.#n.value=this.#n.value.unwire(),this.#s.value={type:"move",cursor:e,origin:t,undo:i,mover:s},!0}return!1}#$(e){return this.#s.value.type==="move"?(this.#n.value=this.#n.value.rewire(),this.#l(e),this.#f("move selection"),!0):!1}#L(){if(this.#s.value.type==="move"){const{undo:e}=this.#s.value;return this.#n.value=new Y(me(e)),this.#r.value=new W,this.#l(),!0}return!1}#d(e){if(this.#s.value.type==="idle"){const{cursor:t}=this.#s.value;dr(e,"cm");const i=Ne(this.#n.value),s=new nn(e),r=C.snap(this.#t.value.toGridX(t.x)),o=C.snap(this.#t.value.toGridY(t.y));return s.moveBy(r,o),this.#n.value=this.#n.value.unwire().append(e).rename(),this.#r.value=new W(e),this.#s.value={type:"paste",cursor:t,undo:i,mover:s},!0}return!1}#P(e){if(this.#s.value.type==="paste"){const{undo:t,mover:i}=this.#s.value,s=C.snap(this.#t.value.toGridX(e.x)),r=C.snap(this.#t.value.toGridY(e.y));return i.moveBy(s,r),this.#n.value=this.#n.value.unwire(),this.#s.value={type:"paste",cursor:e,undo:t,mover:i},!0}return!1}#T(e){return this.#s.value.type==="paste"?(this.#n.value=this.#n.value.rewire(),this.#l(e),this.#f("paste"),!0):!1}#N(){if(this.#s.value.type==="paste"){const{undo:e}=this.#s.value;return this.#n.value=new Y(me(e)),this.#r.value=new W,this.#l(),!0}return!1}#_(e,t){return this.#s.value.type==="idle"&&this.#O(e)?(this.#r.value=this.#r.value.clear(),this.#s.value={type:"connect",cursor:{...e},origin:{...e},wires:[],shape:ft(t)},!0):this.#s.value.type==="place-wire"?(this.#s.value={type:"connect",cursor:{...e},origin:{...e},wires:[],shape:ft(t)},!0):!1}#w(e,t){if(this.#s.value.type==="connect"){const{origin:i}=this.#s.value,s=C.snap(this.#t.value.toGridX(i.x)),r=C.snap(this.#t.value.toGridY(i.y)),o=C.snap(this.#t.value.toGridX(e.x)),a=C.snap(this.#t.value.toGridY(e.y)),l=ft(t),c=hr(s,r,o,a,l);return this.#s.value={type:"connect",cursor:e,origin:i,wires:c,shape:l},!0}return!1}#x(e,t){return this.#s.value.type==="connect"?this.#w(this.#s.value.cursor,t):!1}#D(e){return this.#s.value.type==="connect"?(this.#n.value=this.#n.value.append(this.#s.value.wires),this.#l(e),this.#f("draw wires"),!0):!1}#E(){return this.#s.value.type==="connect"?(this.#l(),!0):!1}#B(e){return this.#s.value.type==="idle"?(this.#s.value={type:"scroll",cursor:{...e},origin:{...e},offset:{x:this.#t.value.x,y:this.#t.value.y}},!0):!1}#G(e){if(this.#s.value.type==="scroll"){const{origin:t,offset:i}=this.#s.value;return this.#t.value=this.#t.value.moveTo(i.x+(e.x-t.x),i.y+(e.y-t.y)),this.#s.value={type:"scroll",cursor:e,origin:t,offset:i},!0}return!1}#c(){return!!(this.#k()||this.#E()||this.#L()||this.#N()||this.#A())}#O(e){const{network:t}=this.#n.value,i=this.#t.value.toGridX(e.x),s=this.#t.value.toGridY(e.y),r=C.snap(i),o=C.snap(s);return r-5<=i&&i<=r+5&&o-5<=s&&s<=o+5&&(t.getWires(r,o)!=null||t.getPins(r,o)!=null)}#m(e){return C.center(this.#o.width,this.#o.height,Qn(this.#n.peek()),e)}#f(e){this.#i.push(this.#n.value,e)}transformSelection(e){if(this.#r.value.full){const[t]=this.#r.value.filter(this.#n.value);return t instanceof ee&&t.transformBy(e),this.#n.value=new Y(this.#n.value),this.#f("transform selection"),!0}return!1}pasteInstance(e){this.#c(),e===se.wire?this.#g():this.#d([new ee(e)])}pasteFormula(e){this.#c(),this.#d([new Ve(e,"cm")])}get canUndo(){return this.#i.canUndo}undo(){this.#i.canUndo&&(this.#c(),this.#n.value=this.#i.undo(),this.#r.value=new W)}get canRedo(){return this.#i.canRedo}redo(){this.#i.canRedo&&(this.#c(),this.#n.value=this.#i.redo(),this.#r.value=new W)}select(e){switch(this.#c(),e){case"all":this.#r.value=new W(this.#n.value);break;case"none":this.#r.value=new W;break;case"invert":this.#r.value=new W([...this.#n.value].filter(t=>!this.#r.value.has(t)));break;default:this.#r.value=new W(e);break}}selectionCut(){this.#c(),this.#r.value.size>0&&(this.#a.put(this.#r.value.filter(this.#n.value)),this.#n.value=this.#n.value.delete(this.#r.value),this.#r.value=new W,this.#f("cut"))}selectionCopy(){this.#c(),this.#r.value.size>0&&this.#a.put(this.#r.value.filter(this.#n.value))}selectionPaste(){this.#a.full&&(this.#c(),this.#d(this.#a.take()))}selectionDelete(){this.#c(),this.#r.value.size>0&&(this.#n.value=this.#n.value.delete(this.#r.value),this.#r.value=new W,this.#f("delete"))}zoomTo(e){switch(e){case"+":this.#t.value=this.#t.value.zoomBy(1);break;case"-":this.#t.value=this.#t.value.zoomBy(-1);break;case"0":this.#t.value=new C().moveTo(20,20);break;case"1":this.#t.value=this.#m(!1);break;case"all":this.#t.value=this.#m(!0);break}}focus(){this.#u.current?.focus()}blur(){this.#u.current?.blur()}get focused(){return this.#u.current?.focused??!1}paint(){const e=this.#t.peek(),t=this.#s.peek();switch(this.#o.reset(),this.#o.paintGrid(e),t.type){case"idle":this.#h(!1,t.hovered),this.focused&&this.#o.paintCrosshair(e,t.cursor,!1);break;case"scroll":this.#h(!1,null);break;case"select":this.#h(!1,null),this.#o.paintSelection(e,t.origin,t.cursor);break;case"place-wire":this.#h(!0,null),this.#o.paintCrosshair(e,t.cursor,!0);break;case"connect":this.#o.paintCrosshair(e,t.cursor,!0),this.#h(!0,null);for(const i of t.wires)this.#o.paintWire(e,i,!0);break;case"move":this.#h(!0,null);break;case"paste":this.#h(!0,null);break}}#h(e,t){const i=this.#n.peek(),s=this.#t.peek(),r=this.#r.peek();for(const o of i.instances)this.#o.paintInstance(s,o,r.has(o));for(const o of i.instances)this.#o.paintLabels(s,o,r.has(o));for(const o of i.formulas)o===t&&(this.#o.paintArea(s,o.area),this.#o.paintOrigin(s,o));for(const o of i.wires)this.#o.paintWire(s,o,r.has(o));for(const o of i.instances)(e||o===t)&&this.#o.paintPins(s,o,r.has(o));this.#o.paintJoins(s,i.network.joins)}}const ei=Mt(null);function oe(){return Hn(ei)}function ti(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=ti(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function ni(){for(var n,e,t=0,i="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=ti(n))&&(i&&(i+=" "),i+=e);return i}const mr="_root_1813r_1",vr="_item_1813r_9",gr="_selected_1813r_22";function yr(){const n=oe(),{schematic:e,selection:t}=n;return u("ul",{class:mr,children:e.instances.filter(({symbol:i})=>i!==se.ground&&i!==se.port).map(i=>u("li",{class:ni(vr,t.has(i)&&gr),onClick:()=>{n.select([i]),n.focus()},children:[i.symbol.id,":",i.name," (#",i.id,")"]},i.id))})}function ii({canvas:n,style:e,...t}){return u("canvas",{...t,ref:n,style:{display:"block",inlineSize:"100%",blockSize:"100%",...e}})}const si=n=>{const e=n.getContext("2d"),t=devicePixelRatio,{width:i,height:s}=n.getBoundingClientRect(),r=Math.max(1,i*t),o=Math.max(1,s*t);return(n.width!==r||n.height!==o)&&(n.width=r,n.height=o,e.scale(t,t)),{width:r,height:o}},br="_root_1ar66_1",Vr="_category_1ar66_5",wr="_title_1ar66_10",xr="_list_1ar66_15",Cr="_symbol_1ar66_24";function Hr(){const{library:n}=oe(),e=Object.groupBy(n,({category:t})=>t);return u("div",{class:br,children:Object.entries(e).map(([t,i])=>u(kr,{name:t,symbols:i},t))})}function kr({name:n,symbols:e}){return u("div",{class:Vr,children:[u("div",{class:wr,children:n}),u("div",{class:xr,children:e.map(t=>u(Mr,{symbol:t},t.id))})]})}function Mr({symbol:n}){const e=oe(),t=Pe(null);return nt(()=>{const{width:i,height:s}=si(t.current);new Jn(t.current).paintSymbolIcon(n,i,s)},[n]),u("div",{class:Cr,title:n.name,onClick:()=>{e.pasteInstance(n),e.focus()},children:u(ii,{canvas:t})})}const Sr="_root_k0zzy_1",Ar="_item_k0zzy_9";function Ir(){const n=oe(),{schematic:e}=n;return u("ul",{class:Sr,children:e.network.nodes.map(t=>u("li",{class:Ar,onClick:()=>{n.select(t.elements),n.focus()},children:t.name},t.name))})}var $r="M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z",Lr="M11 2H13V7H21V10H13V14H18V17H13V22H11V17H6V14H11V10H3V7H11V2Z",Pr="M4 22H2V2H4V22M22 7H6V10H22V7M16 14H6V17H16V14Z",Tr="M20 2H22V22H20V2M2 10H18V7H2V10M8 17H18V14H8V17Z",Nr="M22 22H2V20H22V22M10 2H7V18H10V2M17 8H14V18H17V8Z",Dr="M22 11H17V6H14V11H10V3H7V11H1.8V13H7V21H10V13H14V18H17V13H22V11Z",Er="M22 2V4H2V2H22M7 22H10V6H7V22M14 16H17V6H14V16Z",Br="M7,2H17A2,2 0 0,1 19,4V20A2,2 0 0,1 17,22H7A2,2 0 0,1 5,20V4A2,2 0 0,1 7,2M7,4V8H17V4H7M7,10V12H9V10H7M11,10V12H13V10H11M15,10V12H17V10H15M7,14V16H9V14H7M11,14V16H13V14H11M15,14V16H17V14H15M7,18V20H9V18H7M11,18V20H13V18H11M15,18V20H17V18H15Z",Gr="M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M12 20C7.59 20 4 16.41 4 12S7.59 4 12 4 20 7.59 20 12 16.41 20 12 20M16.59 7.58L10 14.17L7.41 11.59L6 13L10 17L18 9L16.59 7.58Z",Or="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",Wr="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z",Ur="M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z",Rr="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z",zr="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z",Fr="M15 21H17V19H15M19 9H21V7H19M3 5V19C3 20.1 3.9 21 5 21H9V19H5V5H9V3H5C3.9 3 3 3.9 3 5M19 3V5H21C21 3.9 20.1 3 19 3M11 23H13V1H11M19 17H21V15H19M15 5H17V3H15M19 13H21V11H19M19 21C20.1 21 21 20.1 21 19H19Z",qr="M3 15V17H5V15M15 19V21H17V19M19 3H5C3.9 3 3 3.9 3 5V9H5V5H19V9H21V5C21 3.9 20.1 3 19 3M21 19H19V21C20.1 21 21 20.1 21 19M1 11V13H23V11M7 19V21H9V19M19 15V17H21V15M11 19V21H13V19M3 19C3 20.1 3.9 21 5 21V19Z",jr="M20 18H4V8H20M20 6H12L10 4H4A2 2 0 0 0 2 6V18A2 2 0 0 0 4 20H20A2 2 0 0 0 22 18V8A2 2 0 0 0 20 6M14 9H16V13H19L15 17L11 13H14Z",Zr="M13 19C13 19.34 13.04 19.67 13.09 20H4C2.9 20 2 19.11 2 18V6C2 4.89 2.89 4 4 4H10L12 6H20C21.1 6 22 6.89 22 8V13.81C21.39 13.46 20.72 13.22 20 13.09V8H4V18H13.09C13.04 18.33 13 18.66 13 19M20 18V15H18V18H15V20H18V23H20V20H23V18H20Z",Yr="M20 18H4V8H20M20 6H12L10 4H4A2 2 0 0 0 2 6V18A2 2 0 0 0 4 20H20A2 2 0 0 0 22 18V8A2 2 0 0 0 20 6M16 17H14V13H11L15 9L19 13H16Z",Xr="M10,19H13V22H10V19M12,2C17.35,2.22 19.68,7.62 16.5,11.67C15.67,12.67 14.33,13.33 13.67,14.17C13,15 13,16 13,17H10C10,15.33 10,13.92 10.67,12.92C11.33,11.92 12.67,11.33 13.5,10.67C15.92,8.43 15.32,5.26 12,5A3,3 0 0,0 9,8H6A6,6 0 0,1 12,2Z",Kr="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",Jr="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z",Qr="M18 16H17.42L16.61 15.19C17.5 14 18 12.5 18 11C18 7.13 14.87 4 11 4C9.5 4 8 4.5 6.79 5.4C3.7 7.72 3.07 12.11 5.39 15.2C7.71 18.29 12.1 18.92 15.19 16.6L16 17.41V18L21 23L23 21L18 16M11 16C8.24 16 6 13.76 6 11S8.24 6 11 6 16 8.24 16 11 13.76 16 11 16M3 6L1 8V1H8L6 3H3V6M21 1V8L19 6V3H16L14 1H21M6 19L8 21H1V14L3 16V19H6Z",eo="M15.5,14H14.71L14.43,13.73C15.41,12.59 16,11.11 16,9.5A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,6.5 0 0,0 9.5,16C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5L19,20.5L20.5,19L15.5,14M9.5,14C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z",to="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z",no="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z",io="M13,4.07V1L8.45,5.55L13,10V6.09C15.84,6.57 18,9.03 18,12C18,14.97 15.84,17.43 13,17.91V19.93C16.95,19.44 20,16.08 20,12C20,7.92 16.95,4.56 13,4.07M7.1,18.32C8.26,19.22 9.61,19.76 11,19.93V17.9C10.13,17.75 9.29,17.41 8.54,16.87L7.1,18.32M6.09,13H4.07C4.24,14.39 4.79,15.73 5.69,16.89L7.1,15.47C6.58,14.72 6.23,13.88 6.09,13M7.11,8.53L5.7,7.11C4.8,8.27 4.24,9.61 4.07,11H6.09C6.23,10.13 6.58,9.28 7.11,8.53Z",so="M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,5.55Z",ro="M9,9H15V15H9M7,17H17V7H7M15,5H17V3H15M15,21H17V19H15M19,17H21V15H19M19,9H21V7H19M19,21A2,2 0 0,0 21,19H19M19,13H21V11H19M11,21H13V19H11M9,3H7V5H9M3,17H5V15H3M5,21V19H3A2,2 0 0,0 5,21M19,3V5H21A2,2 0 0,0 19,3M13,3H11V5H13M3,9H5V7H3M7,21H9V19H7M3,13H5V11H3M3,5H5V3A2,2 0 0,0 3,5Z",oo="M5,3H7V5H9V3H11V5H13V3H15V5H17V3H19V5H21V7H19V9H21V11H19V13H21V15H19V17H21V19H19V21H17V19H15V21H13V19H11V21H9V19H7V21H5V19H3V17H5V15H3V13H5V11H3V9H5V7H3V5H5V3Z",ao="M1,4.27L2.28,3L21,21.72L19.73,23L17,20.27V21H15V19H15.73L5,8.27V9H3V7H3.73L1,4.27M20,3A1,1 0 0,1 21,4V5H19V3H20M15,5V3H17V5H15M11,5V3H13V5H11M7,5V3H9V5H7M11,21V19H13V21H11M7,21V19H9V21H7M4,21A1,1 0 0,1 3,20V19H5V21H4M3,15H5V17H3V15M21,15V17H19V15H21M3,11H5V13H3V11M21,11V13H19V11H21M21,7V9H19V7H21Z",lo="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z",co="M16.59,5.41L15.17,4L12,7.17L8.83,4L7.41,5.41L12,10M7.41,18.59L8.83,20L12,16.83L15.17,20L16.58,18.59L12,14L7.41,18.59Z",uo="M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z";function ho(n,e){for(var t in e)n[t]=e[t];return n}function Vt(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var i in e)if(i!=="__source"&&n[i]!==e[i])return!0;return!1}function sn(n,e){this.props=n,this.context=e}function fo(n,e){function t(s){var r=this.props.ref,o=r==s.ref;return!o&&r&&(r.call?r(null):r.current=null),e?!e(this.props,s)||!o:Vt(this.props,s)}function i(s){return this.shouldComponentUpdate=t,Ze(n,s)}return i.displayName="Memo("+(n.displayName||n.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i}(sn.prototype=new Q).isPureReactComponent=!0,sn.prototype.shouldComponentUpdate=function(n,e){return Vt(this.props,n)||Vt(this.state,e)};var rn=w.__b;w.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),rn&&rn(n)};var po=w.__e;w.__e=function(n,e,t,i){if(n.then){for(var s,r=e;r=r.__;)if((s=r.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(n,e)}po(n,e,t,i)};var on=w.unmount;function ri(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),n.__c.__H=null),(n=ho({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c=null),n.__k=n.__k&&n.__k.map(function(i){return ri(i,e,t)})),n}function oi(n,e,t){return n&&t&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(i){return oi(i,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.appendChild(n.__e),n.__c.__e=!0,n.__c.__P=t)),n}function pt(){this.__u=0,this.o=null,this.__b=null}function ai(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function Re(){this.i=null,this.l=null}w.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&32&n.__u&&(n.type=null),on&&on(n)},(pt.prototype=new Q).__c=function(n,e){var t=e.__c,i=this;i.o==null&&(i.o=[]),i.o.push(t);var s=ai(i.__v),r=!1,o=function(){r||(r=!0,t.__R=null,s?s(a):a())};t.__R=o;var a=function(){if(!--i.__u){if(i.state.__a){var l=i.state.__a;i.__v.__k[0]=oi(l,l.__c.__P,l.__c.__O)}var c;for(i.setState({__a:i.__b=null});c=i.o.pop();)c.forceUpdate()}};i.__u++||32&e.__u||i.setState({__a:i.__b=i.__v.__k[0]}),n.then(o,o)},pt.prototype.componentWillUnmount=function(){this.o=[]},pt.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=ri(this.__b,t,i.__O=i.__P)}this.__b=null}var s=e.__a&&Ze(le,null,n.fallback);return s&&(s.__u&=-33),[Ze(le,null,e.__a?null:n.children),s]};var an=function(n,e,t){if(++t[1]===t[0]&&n.l.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.l.size))for(t=n.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.i=t=t[2]}};(Re.prototype=new Q).__a=function(n){var e=this,t=ai(e.__v),i=e.l.get(n);return i[0]++,function(s){var r=function(){e.props.revealOrder?(i.push(s),an(e,n,i)):s()};t?t(r):r()}},Re.prototype.render=function(n){this.i=null,this.l=new Map;var e=Xe(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return n.children},Re.prototype.componentDidUpdate=Re.prototype.componentDidMount=function(){var n=this;this.l.forEach(function(e,t){an(n,t,e)})};var _o=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,mo=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,vo=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,go=/[A-Z0-9]/g,yo=typeof document<"u",bo=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(n)};Q.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Q.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var ln=w.event;function Vo(){}function wo(){return this.cancelBubble}function xo(){return this.defaultPrevented}w.event=function(n){return ln&&(n=ln(n)),n.persist=Vo,n.isPropagationStopped=wo,n.isDefaultPrevented=xo,n.nativeEvent=n};var Co={enumerable:!1,configurable:!0,get:function(){return this.class}},cn=w.vnode;w.vnode=function(n){typeof n.type=="string"&&function(e){var t=e.props,i=e.type,s={},r=i.indexOf("-")===-1;for(var o in t){var a=t[o];if(!(o==="value"&&"defaultValue"in t&&a==null||yo&&o==="children"&&i==="noscript"||o==="class"||o==="className")){var l=o.toLowerCase();o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?o="ondblclick":l!=="onchange"||i!=="input"&&i!=="textarea"||bo(t.type)?l==="onfocus"?o="onfocusin":l==="onblur"?o="onfocusout":vo.test(o)&&(o=l):l=o="oninput":r&&mo.test(o)?o=o.replace(go,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&s[o=l]&&(o="oninputCapture"),s[o]=a}}i=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=Xe(t.children).forEach(function(c){c.props.selected=s.value.indexOf(c.props.value)!=-1})),i=="select"&&s.defaultValue!=null&&(s.value=Xe(t.children).forEach(function(c){c.props.selected=s.multiple?s.defaultValue.indexOf(c.props.value)!=-1:s.defaultValue==c.props.value})),t.class&&!t.className?(s.class=t.class,Object.defineProperty(s,"className",Co)):(t.className&&!t.class||t.class&&t.className)&&(s.class=s.className=t.className),e.props=s}(n),n.$$typeof=_o,cn&&cn(n)};var un=w.__r;w.__r=function(n){un&&un(n),n.__c};var hn=w.diffed;w.diffed=function(n){hn&&hn(n);var e=n.props,t=n.__e;t!=null&&n.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};const Ho="_root_1pl8d_1",K=fo(function({shape:e,viewBox:t="0 0 24 24",size:i="2rem",...s}){return u("svg",{class:Ho,viewBox:t,width:i,height:i,...s,children:u("path",{d:e})})}),lt="_root_17fw5_1",ko="_empty_17fw5_7",Dt="_title_17fw5_11",Mo="_prop_17fw5_16",So="_propName_17fw5_21",Ao="_propValue_17fw5_28",Io="_propTitle_17fw5_32";function $o(){const n=oe(),{schematic:e,selection:t}=n,i=t.filter(e);if(i.length===1){const[s]=i;if(s instanceof ee)return u(Lo,{instance:s});if(s instanceof Ve)return u(Po,{formula:s});if(s instanceof U)return u(To,{wire:s})}return u("div",{class:lt,children:u("div",{class:ko,children:"-"})})}function Lo({instance:n}){const{device:e}=n.symbol;return u("div",{class:lt,children:[u("div",{class:Dt,children:n.symbol.name}),u("div",{children:["name: ",n.name]}),e!=null&&u("ul",{children:Object.entries(e.propertiesSchema).map(([t,i])=>u("li",{children:[u("div",{class:Mo,children:[u("span",{class:So,children:t})," ",u("span",{class:Ao,children:i.defaultValue||"-"})]}),u("div",{class:Io,children:i.title})]}))})]})}function Po({formula:n}){return u("div",{class:lt,children:[u("div",{class:Dt,children:"Formula"}),u("div",{children:n.text}),u("p",{children:[u(K,{shape:Pr,size:"24px"}),u(K,{shape:Lr,size:"24px"}),u(K,{shape:Tr,size:"24px"}),u(K,{shape:Er,size:"24px"}),u(K,{shape:Dr,size:"24px"}),u(K,{shape:Nr,size:"24px"})]})]})}function To({wire:n}){return u("div",{class:lt,children:u("div",{class:Dt,children:"Wire"})})}function No(n){const[e,t]=St(new DOMRect);return nt(()=>{const{current:i}=n;if(i==null)return;const s=new ResizeObserver(()=>{t(i.getBoundingClientRect())});return s.observe(i),()=>{s.disconnect()}},[n]),e}const Do="_root_9tile_1",Eo="_selected_9tile_5";function Bo({formula:n,selected:e}){const t=Pe(null);return Ke(()=>{hi(n.text,t.current,{output:"mathml",displayMode:!0});const{width:i,height:s}=t.current.getBoundingClientRect();n.setSize(i,s)},[n,n.text]),u("div",{ref:t,class:ni(Do,e&&Eo),style:Go(n,n.align)})}function Go({x:n,y:e},t){switch(t){case"lt":return{position:"absolute",left:n,top:e,translate:"0% 0%"};case"lm":return{position:"absolute",left:n,top:e,translate:"0% -50%"};case"lb":return{position:"absolute",left:n,top:e,translate:"0% -100%"};case"ct":return{position:"absolute",left:n,top:e,translate:"-50% 0%"};case"cm":return{position:"absolute",left:n,top:e,translate:"-50% -50%"};case"cb":return{position:"absolute",left:n,top:e,translate:"-50% -100%"};case"rt":return{position:"absolute",left:n,top:e,translate:"-100% 0%"};case"rm":return{position:"absolute",left:n,top:e,translate:"-100% -50%"};case"rb":return{position:"absolute",left:n,top:e,translate:"-100% -100%"}}}const Oo="_root_1nll4_1";function Wo(){const{schematic:n,zoom:e,selection:t}=oe();return u("div",{class:Oo,style:{transformOrigin:"0px 0px",translate:`${e.x}px ${e.y}px`,scale:`${e.scale}`},children:n.formulas.map(i=>u(Bo,{formula:i,selected:t.has(i)},i.id))})}const Uo="_root_1hx45_1";function Ro(){const n=oe(),e=Pe(null),t=Pe(null),{width:i,height:s}=No(t);return Vi(n.focusRef,()=>({focus:()=>{e.current?.focus()},blur:()=>{e.current?.blur()},get focused(){return e.current===document.activeElement}})),Ke(()=>{i>0&&s>0&&(si(t.current),n.attach(t.current))},[n,i,s]),Ke(()=>{if(i>0&&s>0){const r=requestAnimationFrame(()=>{n.paint()});return()=>{cancelAnimationFrame(r)}}},[n,i,s,n.schematic,n.zoom,n.selection,n.mouseAction]),u("div",{ref:e,class:Uo,tabIndex:0,autofocus:!0,onFocus:n.handleFocus,onBlur:n.handleBlur,onKeyDown:n.handleKeyDown,onKeyUp:n.handleKeyUp,children:[u(ii,{canvas:t,onMouseDown:n.handleMouseDown,onMouseMove:n.handleMouseMove,onMouseUp:n.handleMouseUp,onWheel:n.handleWheel,onContextMenu:n.handleContextMenu}),u(Wo,{})]})}const zo=Mt(null),Fo="_root_3m5pl_1 _fadeIn_kq333_1";let qo=0;class jo{constructor(e,t){this.message=e,this.options=t}#e=qo+=1;get key(){return this.#e}}const ve=ne([]);function Zo(n){ve.value=[...ve.value,n]}function Yo(n){ve.value=ve.value.filter(e=>e!==n)}function Xo({message:n}){const e=Pe(null);return nt(()=>{n.options.modal?e.current?.showModal():e.current?.show()},[n]),u("dialog",{ref:e,class:Fo,onClose:()=>{Yo(n),n.options.onClose()},children:u(zo.Provider,{value:{close:()=>{e.current?.close()}},children:n.message})},n.key)}const Ko="_root_5uo3x_1";function Jo(){return u("div",{class:Ko,hidden:ve.value.length===0,children:ve.value.map(n=>u(Xo,{message:n}))})}function fn(n,{modal:e=!0,onClose:t=()=>{}}={}){Zo(new jo(n,{modal:e,onClose:t}))}const Qo="_alert_ppbdc_1 _fadeIn_kq333_1",ea="_message_ppbdc_17";class ta{#e=new Set;get pending(){return this.#e.size}delayed(e,t){let i=!1,s=!1;const r=()=>{s||(s=!0,this.#e.delete(o),clearTimeout(a))},o=new class{cancel(){r()}get fired(){return i}get cancelled(){return s}};this.#e.add(o);const a=setTimeout(()=>{s||(this.#e.delete(o),i=!0,t())},e);return o}repeated(e,t){let i=!1,s=!1;const r=()=>{s||(s=!0,this.#e.delete(o),clearInterval(a))},o=new class{cancel(){r()}get fired(){return i}get cancelled(){return s}};this.#e.add(o);const a=setInterval(()=>{s||(i=!0,t())},e);return o}cancelAll(){for(const e of this.#e)e.cancel();return this}}const na=new ta;let ia=0;class sa{constructor(e,t){this.message=e,this.options=t}#e=ia+=1;#i=null;get key(){return this.#e}delayed(e,t){this.clearDelayed(),this.#i=na.delayed(t,e)}clearDelayed(){this.#i!=null&&(this.#i.cancel(),this.#i=null)}}const ge=ne([]);function ra(n){ge.value=[...ge.value,n],li(n)}function wt(n){ge.value=ge.value.filter(e=>e!==n)}function oa(n,e){e?n.clearDelayed():li(n)}function li(n){n.options.autoClose&&n.delayed(()=>{wt(n)},n.options.autoClose)}const ci=Mt(null);function aa({toast:n,children:e}){return u(ci.Provider,{value:{close:()=>{wt(n)},hover:t=>{n.options.autoClose&&n.options.pauseOnHover&&oa(n,t)},click:()=>{n.options.closeOnClick&&wt(n)}},children:e})}function Et(){return Hn(ci)}function ui(n){return{onMouseEnter:()=>{n.hover(!0)},onMouseLeave:()=>{n.hover(!1)},onClick:()=>{n.click()}}}function la({children:n}){return gi(n,{...n.props,...ui(Et())})}function ca(){const n=Et();return u(K,{shape:Or,onClick:()=>{n.close()}})}function ua({severity:n}){switch(n){case"info":return u(ha,{});case"success":return u(fa,{});case"error":return u(pa,{});default:return null}}function ha(){return u(K,{shape:Kr})}function fa(){return u(K,{shape:Gr})}function pa(){return u(K,{shape:$r})}function da({children:n,severity:e=null,closeButton:t=!0}){const i=Et();return u("div",{class:Qo,...ui(i),popover:!0,children:[e&&u(ua,{severity:e}),u("div",{class:ea,children:n}),t&&u(ca,{})]})}const _a="_root_1k080_1";function ma(){return u("div",{class:_a,hidden:ge.value.length===0,children:[...ge.value].reverse().map(n=>u(aa,{toast:n,children:u(la,{children:n.message})},n.key))})}function va(n,{autoClose:e=3e3,pauseOnHover:t=!0,closeOnClick:i=!0}={}){ra(new sa(n,{autoClose:e,pauseOnHover:t,closeOnClick:i}))}function Ie({error:n}){return u(da,{severity:"error",children:n instanceof AggregateError?n.errors.map((e,t)=>u("p",{children:String(e)},t)):u("p",{children:String(n)})})}function ga(n,{autoClose:e=3e3,pauseOnHover:t=!0,closeOnClick:i=!1}={}){va(u(Ie,{error:n}),{autoClose:e,pauseOnHover:t,closeOnClick:i})}Ie.report=ga;const ya="_root_yio74_1",ba="_header_yio74_9",Va="_headerText_yio74_14",wa="_headerButton_yio74_25",xa="_content_yio74_29",Ca="_resize_yio74_36";function ze({title:n,children:e,style:t}){const[i,s]=St(!0);return u("div",{class:ya,style:t,children:[u("div",{class:ba,children:[u("span",{class:Va,children:n}),u("span",{class:wa,onClick:()=>{s(!i)},children:u(K,{shape:i?co:uo})})]}),i&&u(le,{children:[u("div",{class:xa,children:e}),u(Ha,{})]})]})}function Ha(){return u("svg",{class:Ca,viewBox:"0 0 24 24",children:u("path",{d:"M22,22H20V20H22V22M22,18H20V16H22V18M18,22H16V20H18V22M18,18H16V16H18V18M14,22H12V20H14V22M22,14H20V12H22V14Z"})})}const ka="_root_948vb_1",Ma="_toolbar_948vb_8",Sa="_schematic_948vb_17";function Aa(){return new Y(me([["i",50,50,0,"vdc","V1",{}],["i",150,50,0,"r","R1",{}],["i",50,120,0,"g","G1",{}],["f",250,50,"cm","I = \\frac{V}{R}"],["w",50,0,150,0],["w",50,100,150,100],["w",50,0,50,20],["w",50,80,50,100],["w",50,100,50,120],["w",150,0,150,20],["w",150,80,150,100]]))}const Ia="_root_sg434_1",$a="_button_sg434_8",La="_separator_sg434_38";function M({children:n}){return u("div",{class:Ia,children:n})}function Pa({shape:n,title:e,...t}){return u("button",{...t,class:$a,title:e,children:u(K,{shape:n})})}M.Button=Pa;function Ta(){return u("span",{class:La})}M.Separator=Ta;const Na="_root_1bk49_1",Da="_select_1bk49_8",Ea="_content_1bk49_13";function Ba(){return u("p",{children:"Capacitive reactance"})}function Ga(){return u("p",{children:"Inductive reactance"})}function Oa(){return u("p",{children:"Resistive voltage divider"})}function Wa(){return u("p",{children:"LC resonance"})}function Ua(){return u("p",{children:"Wavelength and frequency"})}const Fe=[{name:"Resistive voltage divider",component:Oa},{name:"Capacitive reactance",component:Ba},{name:"Inductive reactance",component:Ga},{name:"LC resonance",component:Wa},{name:"Wavelength and frequency",component:Ua}];function Ra(){const[n,e]=St(Fe[0]),{component:t}=n;return u("section",{class:Na,children:[u("select",{class:Da,value:n.name,onInput:({target:i})=>{const{value:s}=i;e(Fe.find(({name:r})=>r===s)??Fe[0])},children:Fe.map(({name:i})=>u("option",{value:i,children:i}))}),u("div",{class:Ea,children:u(t,{})})]})}const za="_root_8tr57_1";function Fa(){return u("section",{class:za,children:[u("p",{children:["To draw a wire, click and start moving the pointer from a device pin, a wire end, or a wire junction. To draw a wire from any location on the grid, press ",u("kbd",{children:"W"}),". To change a wire's angle, press ",u("kbd",{children:"Shift"}),". To draw a diagonal wire, press ",u("kbd",{children:"Alt"}),"."]}),u("p",{children:"Shortcuts:"}),u("ul",{children:[u("li",{children:[u("kbd",{children:"W"})," Start drawing a wire from any point on the grid"]}),u("li",{children:[u("kbd",{children:"Shift"})," While drawing a wire, changes the angle of the wire"]}),u("li",{children:[u("kbd",{children:"Alt"})," While drawing a wire, draws a diagonal wire"]}),u("li",{children:[u("kbd",{children:"G"})," Place a ground symbol"]}),u("li",{children:[u("kbd",{children:"O"})," Place a port symbol"]}),u("li",{children:[u("kbd",{children:"V"})," Place a voltage source"]}),u("li",{children:[u("kbd",{children:"I"})," Place a current source"]}),u("li",{children:[u("kbd",{children:"R"})," Place a resistor"]}),u("li",{children:[u("kbd",{children:"C"})," Place a capacitor"]}),u("li",{children:[u("kbd",{children:"L"})," Place an inductor"]}),u("li",{children:[u("kbd",{children:"D"})," Place a diode"]}),u("li",{children:[u("kbd",{children:"N"})," Place an NPN transistor"]}),u("li",{children:[u("kbd",{children:"P"})," Place a PNP transistor"]}),u("li",{children:[u("kbd",{children:"Shift+N"})," Place an N-channel MOSFET"]}),u("li",{children:[u("kbd",{children:"Shift+P"})," Place a P-channel MOSFET"]}),u("li",{children:[u("kbd",{children:"A"})," Place an operational amplifier"]}),u("li",{children:[u("kbd",{children:"Home"})," Zoom to 100%"]}),u("li",{children:[u("kbd",{children:"Space"})," Expand or shrink to cover the whole screen"]}),u("li",{children:[u("kbd",{children:"Ctrl+X"})," Cut selected item(s) to clipboard"]}),u("li",{children:[u("kbd",{children:"Ctrl+C"})," Copy selected item(s) to clipboard"]}),u("li",{children:[u("kbd",{children:"Ctrl+V"})," Paste item(s) from clipboard"]}),u("li",{children:[u("kbd",{children:"Ctrl+A"})," Select all"]}),u("li",{children:[u("kbd",{children:"Delete"})," Delete selected item(s)"]}),u("li",{children:[u("kbd",{children:"Alt+L"})," Rotate selected item(s) to the left"]}),u("li",{children:[u("kbd",{children:"Alt+R"})," Rotate selected item(s) to the right"]}),u("li",{children:[u("kbd",{children:"Alt+H"})," Flip selected item(s) from left to right"]}),u("li",{children:[u("kbd",{children:"Alt+V"})," Flip selected item(s) from top to bottom"]}),u("li",{children:[u("kbd",{children:"Ctrl+Z"})," Undo"]}),u("li",{children:[u("kbd",{children:"Ctrl+Y"})," Redo"]})]})]})}function qa(){const n=oe();return u(M,{children:[u(M.Button,{shape:jr,title:"Open schematic",onClick:()=>{Ie.report("Not implemented")}}),u(M.Button,{shape:Yr,title:"Save schematic",onClick:()=>{Ie.report("Not implemented")}}),u(M.Button,{shape:Zr,title:"New schematic",onClick:()=>{Ie.report("Not implemented")}}),u(M.Separator,{}),u(M.Button,{shape:ro,title:"Select all",onClick:()=>{n.select("all"),n.focus()}}),u(M.Button,{shape:oo,title:"Invert selection",onClick:()=>{n.select("invert"),n.focus()}}),u(M.Button,{shape:ao,title:"Clear selection",onClick:()=>{n.select("none"),n.focus()}}),u(M.Separator,{}),u(M.Button,{shape:Ur,title:"Cut selected item(s) to clipboard",onClick:()=>{n.selectionCut(),n.focus()}}),u(M.Button,{shape:Wr,title:"Copy selected item(s) to clipboard",onClick:()=>{n.selectionCopy(),n.focus()}}),u(M.Button,{shape:Rr,title:"Paste item(s) from clipboard",onClick:()=>{n.selectionPaste(),n.focus()}}),u(M.Button,{shape:zr,title:"Delete selected item(s)",onClick:()=>{n.selectionDelete(),n.focus()}}),u(M.Separator,{}),u(M.Button,{shape:io,title:"Rotate selected item(s) to the left",disabled:!n.selection.full,onClick:()=>{n.transformSelection("rl")}}),u(M.Button,{shape:so,title:"Rotate selected item(s) to the right",disabled:!n.selection.full,onClick:()=>{n.transformSelection("rr")}}),u(M.Button,{shape:Fr,title:"Flip selected item(s) from left to right",disabled:!n.selection.full,onClick:()=>{n.transformSelection("mx")}}),u(M.Button,{shape:qr,title:"Flip selected item(s) from top to bottom",disabled:!n.selection.full,onClick:()=>{n.transformSelection("my")}}),u(M.Separator,{}),u(M.Button,{shape:lo,title:"Undo",disabled:!n.canUndo,onClick:()=>{n.undo(),n.focus()}}),u(M.Button,{shape:no,title:"Redo",disabled:!n.canRedo,onClick:()=>{n.redo(),n.focus()}}),u(M.Separator,{}),u(M.Button,{shape:Jr,title:"Zoom 100%",onClick:()=>{n.zoomTo("1"),n.focus()}}),u(M.Button,{shape:to,title:"Zoom in",onClick:()=>{n.zoomTo("+"),n.focus()}}),u(M.Button,{shape:eo,title:"Zoom out",onClick:()=>{n.zoomTo("-"),n.focus()}}),u(M.Button,{shape:Qr,title:"View all",onClick:()=>{n.zoomTo("all"),n.focus()}}),u(M.Separator,{}),u(M.Button,{shape:Br,title:"Calculator",onClick:()=>{fn(u(Ra,{}),{modal:!0,onClose:()=>{n.focus()}})}}),u(M.Separator,{}),u(M.Button,{shape:Xr,title:"Help",onClick:()=>{fn(u(Fa,{}),{modal:!0,onClose:()=>{n.focus()}})}})]})}function ja(){const n=it(()=>new _r(Dn,Aa()),[]);return nt(()=>{const e=Kn(["Alt+v",()=>{}],["Alt+h",()=>{}],["Alt+r",()=>{}],["Alt+l",()=>{}],["Ctrl+a",()=>{}],["Ctrl+s",()=>{}],["Ctrl+o",()=>{}],["Ctrl+n",()=>{}],["Ctrl+r",()=>{}]);return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[n]),u(ei.Provider,{value:n,children:[u("main",{class:ka,children:[u("div",{class:Ma,children:u(qa,{})}),u("div",{class:Sa,children:u(Ro,{})}),u(ze,{title:"Instances",style:{insetInlineEnd:"38rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:u(yr,{})}),u(ze,{title:"Nodes",style:{insetInlineEnd:"20rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:u(Ir,{})}),u(ze,{title:"Library",style:{insetInlineEnd:"2rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:u(Hr,{})}),u(ze,{title:"Properties",style:{insetInlineStart:"2rem",insetBlockStart:"4rem",inlineSize:"20rem"},children:u($o,{})})]}),u(Jo,{}),u(ma,{})]})}vi(u(ja,{}),document.querySelector("#app"));
