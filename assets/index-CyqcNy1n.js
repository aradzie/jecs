import{r as Wn}from"./katex-tJs74nH5.js";import{M as Ks}from"./marked-6_4nRR25.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();var re,k,Fn,Rn,Vt,pn,jn,Zn,Xn,Qe,We,Fe,Yn,Xt={},Kn=[],Js=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,$e=Array.isArray;function ct(n,t){for(var e in t)n[e]=t[e];return n}function tn(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function ye(n,t,e){var s,i,r,o={};for(r in t)r=="key"?s=t[r]:r=="ref"?i=t[r]:o[r]=t[r];if(arguments.length>2&&(o.children=arguments.length>3?re.call(arguments,2):e),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)o[r]===void 0&&(o[r]=n.defaultProps[r]);return Wt(n,o,s,i,null)}function Wt(n,t,e,s,i){var r={type:n,props:t,key:e,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Fn,__i:-1,__u:0};return i==null&&k.vnode!=null&&k.vnode(r),r}function Ct(n){return n.children}function rt(n,t){this.props=n,this.context=t}function Lt(n,t){if(t==null)return n.__?Lt(n.__,n.__i+1):null;for(var e;t<n.__k.length;t++)if((e=n.__k[t])!=null&&e.__e!=null)return e.__e;return typeof n.type=="function"?Lt(n):null}function Jn(n){var t,e;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,t=0;t<n.__k.length;t++)if((e=n.__k[t])!=null&&e.__e!=null){n.__e=n.__c.base=e.__e;break}return Jn(n)}}function Re(n){(!n.__d&&(n.__d=!0)&&Vt.push(n)&&!be.__r++||pn!==k.debounceRendering)&&((pn=k.debounceRendering)||jn)(be)}function be(){for(var n,t,e,s,i,r,o,a=1;Vt.length;)Vt.length>a&&Vt.sort(Zn),n=Vt.shift(),a=Vt.length,n.__d&&(e=void 0,i=(s=(t=n).__v).__e,r=[],o=[],t.__P&&((e=ct({},s)).__v=s.__v+1,k.vnode&&k.vnode(e),en(t.__P,e,s,t.__n,t.__P.namespaceURI,32&s.__u?[i]:null,r,i??Lt(s),!!(32&s.__u),o),e.__v=s.__v,e.__.__k[e.__i]=e,es(r,e,o),e.__e!=i&&Jn(e)));be.__r=0}function Qn(n,t,e,s,i,r,o,a,l,u,f){var h,d,p,_,b,v,y=s&&s.__k||Kn,w=t.length;for(l=Qs(e,t,y,l,w),h=0;h<w;h++)(p=e.__k[h])!=null&&(d=p.__i===-1?Xt:y[p.__i]||Xt,p.__i=h,v=en(n,p,d,i,r,o,a,l,u,f),_=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&nn(d.ref,null,p),f.push(p.ref,p.__c||_,p)),b==null&&_!=null&&(b=_),4&p.__u||d.__k===p.__k?l=ts(p,l,n):typeof p.type=="function"&&v!==void 0?l=v:_&&(l=_.nextSibling),p.__u&=-7);return e.__e=b,l}function Qs(n,t,e,s,i){var r,o,a,l,u,f=e.length,h=f,d=0;for(n.__k=new Array(i),r=0;r<i;r++)(o=t[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=r+d,(o=n.__k[r]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Wt(null,o,null,null,null):$e(o)?Wt(Ct,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?Wt(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,a=null,(u=o.__i=ti(o,e,l,h))!==-1&&(h--,(a=e[u])&&(a.__u|=2)),a==null||a.__v===null?(u==-1&&d--,typeof o.type!="function"&&(o.__u|=4)):u!=l&&(u==l-1?d--:u==l+1?d++:(u>l?d--:d++,o.__u|=4))):n.__k[r]=null;if(h)for(r=0;r<f;r++)(a=e[r])!=null&&!(2&a.__u)&&(a.__e==s&&(s=Lt(a)),ns(a,a));return s}function ts(n,t,e){var s,i;if(typeof n.type=="function"){for(s=n.__k,i=0;s&&i<s.length;i++)s[i]&&(s[i].__=n,t=ts(s[i],t,e));return t}n.__e!=t&&(t&&n.type&&!e.contains(t)&&(t=Lt(n)),e.insertBefore(n.__e,t||null),t=n.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function we(n,t){return t=t||[],n==null||typeof n=="boolean"||($e(n)?n.some(function(e){we(e,t)}):t.push(n)),t}function ti(n,t,e,s){var i,r,o=n.key,a=n.type,l=t[e];if(l===null||l&&o==l.key&&a===l.type&&!(2&l.__u))return e;if(s>(l!=null&&!(2&l.__u)?1:0))for(i=e-1,r=e+1;i>=0||r<t.length;){if(i>=0){if((l=t[i])&&!(2&l.__u)&&o==l.key&&a===l.type)return i;i--}if(r<t.length){if((l=t[r])&&!(2&l.__u)&&o==l.key&&a===l.type)return r;r++}}return-1}function dn(n,t,e){t[0]=="-"?n.setProperty(t,e??""):n[t]=e==null?"":typeof e!="number"||Js.test(t)?e:e+"px"}function he(n,t,e,s,i){var r;t:if(t=="style")if(typeof e=="string")n.style.cssText=e;else{if(typeof s=="string"&&(n.style.cssText=s=""),s)for(t in s)e&&t in e||dn(n.style,t,"");if(e)for(t in e)s&&e[t]===s[t]||dn(n.style,t,e[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(Xn,"$1")),t=t.toLowerCase()in n||t=="onFocusOut"||t=="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),n.l||(n.l={}),n.l[t+r]=e,e?s?e.t=s.t:(e.t=Qe,n.addEventListener(t,r?Fe:We,r)):n.removeEventListener(t,r?Fe:We,r);else{if(i=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in n)try{n[t]=e??"";break t}catch{}typeof e=="function"||(e==null||e===!1&&t[4]!="-"?n.removeAttribute(t):n.setAttribute(t,t=="popover"&&e==1?"":e))}}function mn(n){return function(t){if(this.l){var e=this.l[t.type+n];if(t.u==null)t.u=Qe++;else if(t.u<e.t)return;return e(k.event?k.event(t):t)}}}function en(n,t,e,s,i,r,o,a,l,u){var f,h,d,p,_,b,v,y,w,A,N,G,Q,X,j,Y,M,H=t.type;if(t.constructor!==void 0)return null;128&e.__u&&(l=!!(32&e.__u),r=[a=t.__e=e.__e]),(f=k.__b)&&f(t);t:if(typeof H=="function")try{if(y=t.props,w="prototype"in H&&H.prototype.render,A=(f=H.contextType)&&s[f.__c],N=f?A?A.props.value:f.__:s,e.__c?v=(h=t.__c=e.__c).__=h.__E:(w?t.__c=h=new H(y,N):(t.__c=h=new rt(y,N),h.constructor=H,h.render=ni),A&&A.sub(h),h.props=y,h.state||(h.state={}),h.context=N,h.__n=s,d=h.__d=!0,h.__h=[],h._sb=[]),w&&h.__s==null&&(h.__s=h.state),w&&H.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=ct({},h.__s)),ct(h.__s,H.getDerivedStateFromProps(y,h.__s))),p=h.props,_=h.state,h.__v=t,d)w&&H.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),w&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(w&&H.getDerivedStateFromProps==null&&y!==p&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(y,N),!h.__e&&(h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(y,h.__s,N)===!1||t.__v==e.__v)){for(t.__v!=e.__v&&(h.props=y,h.state=h.__s,h.__d=!1),t.__e=e.__e,t.__k=e.__k,t.__k.some(function(P){P&&(P.__=t)}),G=0;G<h._sb.length;G++)h.__h.push(h._sb[G]);h._sb=[],h.__h.length&&o.push(h);break t}h.componentWillUpdate!=null&&h.componentWillUpdate(y,h.__s,N),w&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(p,_,b)})}if(h.context=N,h.props=y,h.__P=n,h.__e=!1,Q=k.__r,X=0,w){for(h.state=h.__s,h.__d=!1,Q&&Q(t),f=h.render(h.props,h.state,h.context),j=0;j<h._sb.length;j++)h.__h.push(h._sb[j]);h._sb=[]}else do h.__d=!1,Q&&Q(t),f=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++X<25);h.state=h.__s,h.getChildContext!=null&&(s=ct(ct({},s),h.getChildContext())),w&&!d&&h.getSnapshotBeforeUpdate!=null&&(b=h.getSnapshotBeforeUpdate(p,_)),a=Qn(n,$e(Y=f!=null&&f.type===Ct&&f.key==null?f.props.children:f)?Y:[Y],t,e,s,i,r,o,a,l,u),h.base=t.__e,t.__u&=-161,h.__h.length&&o.push(h),v&&(h.__E=h.__=null)}catch(P){if(t.__v=null,l||r!=null)if(P.then){for(t.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,t.__e=a}else for(M=r.length;M--;)tn(r[M]);else t.__e=e.__e,t.__k=e.__k;k.__e(P,t,e)}else r==null&&t.__v==e.__v?(t.__k=e.__k,t.__e=e.__e):a=t.__e=ei(e.__e,t,e,s,i,r,o,l,u);return(f=k.diffed)&&f(t),128&t.__u?void 0:a}function es(n,t,e){for(var s=0;s<e.length;s++)nn(e[s],e[++s],e[++s]);k.__c&&k.__c(t,n),n.some(function(i){try{n=i.__h,i.__h=[],n.some(function(r){r.call(i)})}catch(r){k.__e(r,i.__v)}})}function ei(n,t,e,s,i,r,o,a,l){var u,f,h,d,p,_,b,v=e.props,y=t.props,w=t.type;if(w=="svg"?i="http://www.w3.org/2000/svg":w=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),r!=null){for(u=0;u<r.length;u++)if((p=r[u])&&"setAttribute"in p==!!w&&(w?p.localName==w:p.nodeType==3)){n=p,r[u]=null;break}}if(n==null){if(w==null)return document.createTextNode(y);n=document.createElementNS(i,w,y.is&&y),a&&(k.__m&&k.__m(t,r),a=!1),r=null}if(w===null)v===y||a&&n.data===y||(n.data=y);else{if(r=r&&re.call(n.childNodes),v=e.props||Xt,!a&&r!=null)for(v={},u=0;u<n.attributes.length;u++)v[(p=n.attributes[u]).name]=p.value;for(u in v)if(p=v[u],u!="children"){if(u=="dangerouslySetInnerHTML")h=p;else if(!(u in y)){if(u=="value"&&"defaultValue"in y||u=="checked"&&"defaultChecked"in y)continue;he(n,u,null,p,i)}}for(u in y)p=y[u],u=="children"?d=p:u=="dangerouslySetInnerHTML"?f=p:u=="value"?_=p:u=="checked"?b=p:a&&typeof p!="function"||v[u]===p||he(n,u,p,v[u],i);if(f)a||h&&(f.__html===h.__html||f.__html===n.innerHTML)||(n.innerHTML=f.__html),t.__k=[];else if(h&&(n.innerHTML=""),Qn(t.type==="template"?n.content:n,$e(d)?d:[d],t,e,s,w=="foreignObject"?"http://www.w3.org/1999/xhtml":i,r,o,r?r[0]:e.__k&&Lt(e,0),a,l),r!=null)for(u=r.length;u--;)tn(r[u]);a||(u="value",w=="progress"&&_==null?n.removeAttribute("value"):_!==void 0&&(_!==n[u]||w=="progress"&&!_||w=="option"&&_!==v[u])&&he(n,u,_,v[u],i),u="checked",b!==void 0&&b!==n[u]&&he(n,u,b,v[u],i))}return n}function nn(n,t,e){try{if(typeof n=="function"){var s=typeof n.__u=="function";s&&n.__u(),s&&t==null||(n.__u=n(t))}else n.current=t}catch(i){k.__e(i,e)}}function ns(n,t,e){var s,i;if(k.unmount&&k.unmount(n),(s=n.ref)&&(s.current&&s.current!==n.__e||nn(s,null,t)),(s=n.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(r){k.__e(r,t)}s.base=s.__P=null}if(s=n.__k)for(i=0;i<s.length;i++)s[i]&&ns(s[i],t,e||typeof n.type!="function");e||tn(n.__e),n.__c=n.__=n.__e=void 0}function ni(n,t,e){return this.constructor(n,e)}function si(n,t,e){var s,i,r,o;t==document&&(t=document.documentElement),k.__&&k.__(n,t),i=(s=!1)?null:t.__k,r=[],o=[],en(t,n=t.__k=ye(Ct,null,[n]),i||Xt,Xt,t.namespaceURI,i?null:t.firstChild?re.call(t.childNodes):null,r,i?i.__e:t.firstChild,s,o),es(r,n,o)}function ii(n,t,e){var s,i,r,o,a=ct({},n.props);for(r in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),t)r=="key"?s=t[r]:r=="ref"?i=t[r]:a[r]=t[r]===void 0&&o!==void 0?o[r]:t[r];return arguments.length>2&&(a.children=arguments.length>3?re.call(arguments,2):e),Wt(n.type,a,s||n.key,i||n.ref,null)}function sn(n){function t(e){var s,i;return this.getChildContext||(s=new Set,(i={})[t.__c]=this,this.getChildContext=function(){return i},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(r){this.props.value!==r.value&&s.forEach(function(o){o.__e=!0,Re(o)})},this.sub=function(r){s.add(r);var o=r.componentWillUnmount;r.componentWillUnmount=function(){s&&s.delete(r),o&&o.call(r)}}),e.children}return t.__c="__cC"+Yn++,t.__=n,t.Provider=t.__l=(t.Consumer=function(e,s){return e.children(s)}).contextType=t,t}re=Kn.slice,k={__e:function(n,t,e,s){for(var i,r,o;t=t.__;)if((i=t.__c)&&!i.__)try{if((r=i.constructor)&&r.getDerivedStateFromError!=null&&(i.setState(r.getDerivedStateFromError(n)),o=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(n,s||{}),o=i.__d),o)return i.__E=i}catch(a){n=a}throw n}},Fn=0,Rn=function(n){return n!=null&&n.constructor==null},rt.prototype.setState=function(n,t){var e;e=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=ct({},this.state),typeof n=="function"&&(n=n(ct({},e),this.props)),n&&ct(e,n),n!=null&&this.__v&&(t&&this._sb.push(t),Re(this))},rt.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),Re(this))},rt.prototype.render=Ct,Vt=[],jn=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Zn=function(n,t){return n.__v.__b-t.__v.__b},be.__r=0,Xn=/(PointerCapture)$|Capture$/i,Qe=0,We=mn(!1),Fe=mn(!0),Yn=0;var ri=0;function c(n,t,e,s,i,r){t||(t={});var o,a,l=t;if("ref"in l)for(a in l={},t)a=="ref"?o=t[a]:l[a]=t[a];var u={type:n,props:l,key:e,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ri,__i:-1,__u:0,__source:i,__self:r};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return k.vnode&&k.vnode(u),u}var Ht,D,Oe,_n,Yt=0,ss=[],z=k,vn=z.__b,gn=z.__r,yn=z.diffed,bn=z.__c,wn=z.unmount,Vn=z.__;function oe(n,t){z.__h&&z.__h(D,n,Yt||t),Yt=0;var e=D.__H||(D.__H={__:[],__h:[]});return n>=e.__.length&&e.__.push({}),e.__[n]}function Ie(n){return Yt=1,oi(os,n)}function oi(n,t,e){var s=oe(Ht++,2);if(s.t=n,!s.__c&&(s.__=[e?e(t):os(void 0,t),function(a){var l=s.__N?s.__N[0]:s.__[0],u=s.t(l,a);l!==u&&(s.__N=[u,s.__[1]],s.__c.setState({}))}],s.__c=D,!D.__f)){var i=function(a,l,u){if(!s.__c.__H)return!0;var f=s.__c.__H.__.filter(function(d){return!!d.__c});if(f.every(function(d){return!d.__N}))return!r||r.call(this,a,l,u);var h=s.__c.props!==a;return f.forEach(function(d){if(d.__N){var p=d.__[0];d.__=d.__N,d.__N=void 0,p!==d.__[0]&&(h=!0)}}),r&&r.call(this,a,l,u)||h};D.__f=!0;var r=D.shouldComponentUpdate,o=D.componentWillUpdate;D.componentWillUpdate=function(a,l,u){if(this.__e){var f=r;r=void 0,i(a,l,u),r=f}o&&o.call(this,a,l,u)},D.shouldComponentUpdate=i}return s.__N||s.__}function Le(n,t){var e=oe(Ht++,3);!z.__s&&rn(e.__H,t)&&(e.__=n,e.u=t,D.__H.__h.push(e))}function Kt(n,t){var e=oe(Ht++,4);!z.__s&&rn(e.__H,t)&&(e.__=n,e.u=t,D.__h.push(e))}function Tt(n){return Yt=5,Te(function(){return{current:n}},[])}function is(n,t,e){Yt=6,Kt(function(){if(typeof n=="function"){var s=n(t());return function(){n(null),s&&typeof s=="function"&&s()}}if(n)return n.current=t(),function(){return n.current=null}},e==null?e:e.concat(n))}function Te(n,t){var e=oe(Ht++,7);return rn(e.__H,t)&&(e.__=n(),e.__H=t,e.__h=n),e.__}function rs(n){var t=D.context[n.__c],e=oe(Ht++,9);return e.c=n,t?(e.__==null&&(e.__=!0,t.sub(D)),t.props.value):n.__}function ai(){for(var n;n=ss.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(ve),n.__H.__h.forEach(je),n.__H.__h=[]}catch(t){n.__H.__h=[],z.__e(t,n.__v)}}z.__b=function(n){D=null,vn&&vn(n)},z.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),Vn&&Vn(n,t)},z.__r=function(n){gn&&gn(n),Ht=0;var t=(D=n.__c).__H;t&&(Oe===D?(t.__h=[],D.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0})):(t.__h.forEach(ve),t.__h.forEach(je),t.__h=[],Ht=0)),Oe=D},z.diffed=function(n){yn&&yn(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(ss.push(t)!==1&&_n===z.requestAnimationFrame||((_n=z.requestAnimationFrame)||li)(ai)),t.__H.__.forEach(function(e){e.u&&(e.__H=e.u),e.u=void 0})),Oe=D=null},z.__c=function(n,t){t.some(function(e){try{e.__h.forEach(ve),e.__h=e.__h.filter(function(s){return!s.__||je(s)})}catch(s){t.some(function(i){i.__h&&(i.__h=[])}),t=[],z.__e(s,e.__v)}}),bn&&bn(n,t)},z.unmount=function(n){wn&&wn(n);var t,e=n.__c;e&&e.__H&&(e.__H.__.forEach(function(s){try{ve(s)}catch(i){t=i}}),e.__H=void 0,t&&z.__e(t,e.__v))};var xn=typeof requestAnimationFrame=="function";function li(n){var t,e=function(){clearTimeout(s),xn&&cancelAnimationFrame(t),setTimeout(n)},s=setTimeout(e,100);xn&&(t=requestAnimationFrame(e))}function ve(n){var t=D,e=n.__c;typeof e=="function"&&(n.__c=void 0,e()),D=t}function je(n){var t=D;n.__c=n.__(),D=t}function rn(n,t){return!n||n.length!==t.length||t.some(function(e,s){return e!==n[s]})}function os(n,t){return typeof t=="function"?t(n):t}const ci={id:"wire",name:"Wire",category:"Conductors",prefix:"W",shapes:[["l",-15,15,15,-15]],pins:[["a",-15,15],["a",15,-15]],labels:[0,0,"cm"],device:null},ui={id:"g",name:"Ground",category:"Conductors",prefix:"G",shapes:[["l",0,0,0,15],["l",-20,15,20,15],["l",-10,20,10,20],["l",-5,25,5,25]],pins:[["a",0,0]],labels:[0,30,"ct"],device:null},hi={id:"p",name:"Port",category:"Conductors",prefix:"P",shapes:[["l",0,-15,0,0],["c",0,-25,10]],pins:[["a",0,0]],labels:[0,-40,"cb"],device:null},ut={wire:ci,ground:ui,port:hi};let m=class as{static number(t){return{type:"number",...t}}static string(t){return{type:"string",...t}}static temp=as.number({defaultValue:26.85,range:["real",">",-273.15],title:"device temperature in degrees Celsius"});schema=new Map;values=new Map;constructor(t){for(const[e,s]of Object.entries(t))this.schema.set(e,s)}names(){return[...this.schema.keys()]}prop(t){const e=this.schema.get(t);if(e==null){const s=this.names();throw new TypeError(`Unknown property [${t}]. Expected one of ${s.map(i=>`[${i}]`).join(", ")}.`)}return e}from(t){for(const[e,s]of t.values.entries())this.set(e,s)}hasAll(){for(const[t,e]of this.schema.entries())if(!this.values.has(t)&&e.defaultValue==null)return!1;return!0}has(t){return this.prop(t),this.values.has(t)}set(t,e){const s=this.prop(t);switch(s.type){case"number":{fi(s,t,e);break}case"string":{pi(s,t,e);break}}return this.values.set(t,e),this}getNumber(t,e=null){const s=this.prop(t);if(s.type!=="number")throw new TypeError(`Property [${t}] is not a number.`);const i=this.values.get(t)??e??s.defaultValue;if(i==null)throw new TypeError(`Property [${t}] has no value.`);return i}getString(t,e=null){const s=this.prop(t);if(s.type!=="string")throw new TypeError(`Property [${t}] is not a string.`);const i=this.values.get(t)??e??s.defaultValue;if(i==null)throw new TypeError(`Property [${t}] has no value.`);return i}};function fi(n,t,e){if(typeof e!="number")throw new TypeError(`Invalid value for property [${t}]. Expected a number, got ${_t(e)}.`);const{range:s=["real"]}=n,[i,...r]=s;switch(i){case"real":if(!Number.isFinite(e))throw new TypeError(`Invalid value for property [${t}]. Not a finite value.`);break;case"integer":if(!Number.isInteger(e))throw new TypeError(`Invalid value for property [${t}]. Not an integer value.`);break}let o=0;for(;o<r.length;){const a=r[o++],l=r[o++];switch(a){case">":if(e<=l)throw new TypeError(`Invalid value for property [${t}]. Expected a value larger than ${l}, got ${_t(e)}.`);break;case">=":if(e<l)throw new TypeError(`Invalid value for property [${t}]. Expected a value larger than or equal to ${l}, got ${_t(e)}.`);break;case"<":if(e>=l)throw new TypeError(`Invalid value for property [${t}]. Expected a value less than ${l}, got ${_t(e)}.`);break;case"<=":if(e>l)throw new TypeError(`Invalid value for property [${t}]. Expected a value less than or equal to ${l}, got ${_t(e)}.`);break;case"<>":if(e===l)throw new TypeError(`Invalid value for property [${t}]. Expected a value not equal to ${l}.`);break}}}function pi(n,t,e){if(typeof e!="string")throw new TypeError(`Invalid value for property [${t}]. Expected a string, got ${_t(e)}.`);const{range:s=[]}=n;if(s.length>0&&!s.includes(e))throw new TypeError(`Invalid value for property [${t}]. Expected one of ${s.map(i=>_t(i)).join(", ")}, got ${_t(e)}.`)}function _t(n){switch(typeof n){case"string":return`"${n}"`;case"number":return String(n)}return`[${n}]`}const st=new class{numSimulations=0;numIterations=0;reset(){this.numSimulations=0,this.numIterations=0}simulationStarted(){this.numSimulations+=1}simulationEnded(){}iterationStarted(){this.numIterations+=1}iterationEnded(){}toString(){return JSON.stringify(this,null,2)}toJSON(){const{numSimulations:t,numIterations:e}=this;return{numSimulations:t,numIterations:e}}};function di(n){return typeof n=="string"?n:n.symbol}function ae(n){return n+273.15}const mi=(n,t="")=>{if(!Number.isFinite(n)){if(n!==n)return"NaN";if(n===1/0)return"+Infinity";if(n===-1/0)return"-Infinity";throw new TypeError}const e=r=>String(Math.round(r*1e3)/1e3),s=di(t),i=Math.abs(n);return i<1e-15?`0${s}`:i<1e-9?`${e(n*1e12)}p${s}`:i<1e-6?`${e(n*1e9)}n${s}`:i<.001?`${e(n*1e6)}μ${s}`:i<1?`${e(n*1e3)}m${s}`:i<1e3?`${e(n)}${s}`:i<1e6?`${e(n*.001)}k${s}`:i<1e9?`${e(n*1e-6)}M${s}`:`${e(n*1e-9)}G${s}`},_i=n=>{const t=[],e=[];let s={title:null,rows:[]};for(const i of n)t.push({probe:i,index:t.length});return new class{group(i){s.rows.length>0&&e.push(s),s={title:i,rows:[]}}capture(){const i=new Float64Array(t.length);for(const{index:r,probe:o}of t)i[r]=o.measure();s.rows.push(i)}build(){return s.rows.length>0&&e.push(s),s={title:null,rows:[]},{columns:t.map(({probe:{name:i,unit:r},index:o})=>({name:i,unit:r,index:o})),rowGroups:e}}}};class ls{props;sweeps;constructor(t){this.props=new m(t),this.sweeps=[]}run(t){st.reset();const e=_i(this.getProbes(t));return this.runImpl(t,e),e.build()}}class cs extends Error{name="MathError";constructor(t,e){super(t,e)}}class $t extends cs{name="NumericOverflowError";constructor(t){super("Numeric overflow.",t)}}class on extends cs{name="SingularMatrixError";constructor(t){super("Singular matrix.",t)}}function vi(n){const t=new Array(n);for(let e=0;e<n;e++)t[e]=vt(n);return t}function gi(n,t=0){for(const e of n)e.fill(t)}function vt(n){return new Float64Array(n)}function mt(n,t=0){n.fill(t)}function xt(n,t){t.set(n)}function yi(n){const t=new Int32Array(n);return us(t),t}function us(n){for(let t=0;t<n.length;t++)n[t]=t}function hs(n,t,e){return bi(n,t,e,e)}function bi(n,t,e,s){let i=e,r=Math.abs(n[e][s]);for(e++;e<t;){const o=Math.abs(n[e][s]);o>r&&(i=e,r=o),e++}return i}function Ve(n,t,e){const s=n[t];n[t]=n[e],n[e]=s}function wi(n){const{size:t,A:e,x:s,b:i}=n;for(let r=0;r<t-1;r++){n.findPivot(r);const o=e[r][r];if(o===0)throw new on;for(let a=r+1;a<t;a++){const l=e[a][r]/o;for(let u=r;u<t;u++)e[a][u]-=e[r][u]*l;i[a]-=i[r]*l}}for(let r=t-1;r>=0;r--){i[r]/=e[r][r];for(let o=r-1;o>=0;o--)i[o]-=e[o][r]*i[r]}xt(i,s)}function Vi(n){const{size:t,A:e,x:s,b:i}=n;for(let r=0;r<t;r++){n.findPivot(r);const o=e[r][r];if(o===0)throw new on;for(let a=r;a<t;a++)e[r][a]/=o;i[r]/=o;for(let a=0;a<t;a++)if(a!==r){const l=e[a][r];for(let u=r;u<t;u++)e[a][u]-=e[r][u]*l;i[a]-=i[r]*l}}xt(i,s)}function xi(n){const{size:t,A:e,perm:s}=n;for(let i=0;i<t;i++){Mi(e,s,t,i);const r=e[i][i];if(r===0)throw new on;for(let o=i+1;o<t;o++)e[i][o]/=r;for(let o=i+1;o<t;o++)for(let a=i+1;a<t;a++)e[o][a]-=e[o][i]*e[i][a]}}function ki(n){const{size:t,A:e,x:s,b:i,perm:r}=n;for(let o=0;o<t;o++){let a=0;for(let l=0;l<o;l++)a+=e[o][l]*s[l];s[o]=(i[r[o]]-a)/e[o][o]}for(let o=t-1;o>=0;o--){let a=0;for(let l=o+1;l<t;l++)a+=e[o][l]*i[l];i[o]=s[o]-a}xt(i,s)}function Mi(n,t,e,s){const i=hs(n,e,s);i!==s&&(Ve(n,s,i),Ve(t,s,i))}var gt;(function(n){n.Gauss="gauss",n.GaussJordan="gauss-jordan",n.LU="lu"})(gt||(gt={}));class an{size;A;x;b;perm;constructor(t){this.size=t,this.A=vi(t),this.x=vt(t),this.b=vt(t),this.perm=yi(t)}clear(){gi(this.A),mt(this.x),mt(this.b),us(this.perm)}solve(t){switch(t){case gt.Gauss:wi(this);break;case gt.GaussJordan:Vi(this);break;case gt.LU:xi(this),ki(this);break}}findPivot(t){const{size:e,A:s,b:i}=this,r=hs(s,e,t);r!==t&&(Ve(s,t,r),Ve(i,t,r))}}class Ze extends Error{name="CircuitError";constructor(t,e){super(t,e)}}class Ci{}class Mt extends Ci{value;constructor(t){super(),this.value=t}eval(){return this.value}isConstant(){return!0}toString(){return String(this.value)}}class Hi{#t=new Map;constructor(){this.set("pi",new Mt(Math.PI)),this.set("e",new Mt(Math.E))}has(t){return this.#t.has(t)}get(t){const e=this.#t.get(t);if(e==null)throw new Ze(`Unknown variable [${t}].`);return e}set(t,e){this.#t.set(t,e)}[Symbol.iterator](){return this.#t.keys()}}class Si{#t;#n;constructor(t){this.#t=t,this.#n=[]}setProps(){for(const t of this.#n)t.setProp(this.#t)}add(t){this.#n.push(t)}[Symbol.iterator](){return this.#n[Symbol.iterator]()}}let fs=class{type="node";id;enabled=!0;index=-1;voltage=0;phase=0;constructor(t){this.id=t}toString(){return`Node[${this.id}]`}};class Ai{type="branch";a;b;enabled=!0;index=-1;current=0;phase=0;constructor(t,e){this.a=t,this.b=e}toString(){return`${this.a}~${this.b}`}}const yt=new fs("gnd");class ps{static propsSchema={temp:m.number({defaultValue:26.85,range:["real",">",-273.15],title:"default device temperature in degrees Celsius"})};#t=[];#n=new Map;#s=[];#e=new Map;#a=new Hi;#i=new Si(this.#a);temp;time;frequency;sourceFactor;constructor(){this.temp=0,this.time=0,this.frequency=0,this.sourceFactor=1}get groundNode(){return yt}get nodes(){return this.#t}get devices(){return this.#s}get equations(){return this.#a}get bindings(){return this.#i}makeNode(t){if(this.#n.has(t))throw new Ze(`Duplicate node [${t}]`);const e=new fs(t);return this.#n.set(e.id,e),this.#t.push(e),e}makeBranch(t,e){const s=new Ai(t,e);return this.#t.push(s),s}connect(t,e){const{id:s}=t;if(this.#e.has(s))throw new Ze(`Duplicate device instance [${s}]`);this.#s.push(t),this.#e.set(t.id,t),t.connect(this,e)}init(t){for(const e of this.#s)e.state.fill(0),e.init(e.props,e.state,t)}reset(){this.#a.set("temp",new Mt(this.temp)),this.#a.set("time",new Mt(this.time)),this.#a.set("frequency",new Mt(this.frequency)),this.#i.setProps();for(const t of this.#t)switch(t.type){case"node":t.voltage=0,t.phase=0;break;case"branch":t.current=0,t.phase=0;break}for(const t of this.#s)t.state.fill(0),t.reset(t.props,t.state)}loadDc(t){for(const e of this.#s)e.loadDc(e.state,this,t)}saveDc(){for(const t of this.#s)t.saveDc(t.state,this)}loadTr(t){for(const e of this.#s)e.loadTr(e.state,this,t)}saveTr(){for(const t of this.#s)t.saveTr(t.state,this)}loadAc(t){for(const e of this.#s)e.loadAc(e.state,this.frequency,t)}reindexNodes(){let t=[];for(const e of this.#t)e.enabled&&e!==yt?(e.index=t.length,t.push(e)):e.index=-1;return t}}class U{static dummy=new class extends U{static id="DUMMY";static numTerminals=0;static propsSchema={};static stateSchema={length:0,ops:[]};constructor(){super("DUMMY")}};static id;static numTerminals;static propsSchema;static stateSchema;static linear=!0;static Dc=class extends U{loadTr(e,s,i){this.loadDc(e,s,i)}saveTr(e,s){this.saveDc(e,s)}};id;props;state;diffs=[];constructor(t){this.id=t;const{propsSchema:e,stateSchema:s}=this.deviceClass;this.props=new m(e),this.state=new Float64Array(s.length)}get deviceClass(){return this.constructor}connect(t,e){}init(t,e,s){}reset(t,e){}loadDc(t,e,s){}saveDc(t,e){}loadTr(t,e,s){}saveTr(t,e){}loadAc(t,e,s){}}const kn=new Map([]);class W{name;reqArgs;optArgs;varArgs;fn;static add({name:t,reqArgs:e=1,optArgs:s=0,varArgs:i=!1,fn:r}){kn.set(t,new W(t,e,s,i,r))}static get(t){const e=kn.get(t);if(e==null)throw new TypeError(`Unknown function [${t}]`);return e}constructor(t,e,s,i,r){this.name=t,this.reqArgs=e,this.optArgs=s,this.varArgs=i,this.fn=r}call(t){const{name:e,reqArgs:s,optArgs:i,varArgs:r,fn:o}=this;if(s>t.length)throw new TypeError(`Too few arguments to function [${e}]`);if(!r&&s+i<t.length)throw new TypeError(`Too many arguments to function [${e}]`);return o(...t)}}W.add({name:"abs",fn:Math.abs});W.add({name:"sin",fn:Math.sin});W.add({name:"asin",fn:Math.asin});W.add({name:"cos",fn:Math.cos});W.add({name:"acos",fn:Math.acos});W.add({name:"tan",fn:Math.tan});W.add({name:"atan",fn:Math.atan});W.add({name:"exp",fn:Math.exp});W.add({name:"log",fn:Math.log});W.add({name:"log10",fn:Math.log10});W.add({name:"sqrt",fn:Math.sqrt});W.add({name:"pow",fn:Math.pow});W.add({name:"round",fn:Math.round});W.add({name:"floor",fn:Math.floor});W.add({name:"ceil",fn:Math.ceil});W.add({name:"min",reqArgs:2,varArgs:!0,fn:Math.min});W.add({name:"max",reqArgs:2,varArgs:!0,fn:Math.max});W.add({name:"dB",fn:n=>10*Math.log10(n)});class at{modelId;deviceClass;props;constructor(t,e,s={}){this.modelId=t,this.deviceClass=e,this.props=new m(e.propsSchema);for(const[i,r]of Object.entries(s))this.props.set(i,r)}}const Ni=n=>new class{name="time";unit="s";measure(){return n.time}},$i=n=>new class{name="frequency";unit="Hz";measure(){return n.frequency}},Ii=n=>new class{name=`#${n.id}:V`;unit="V";measure(){return n.voltage}},Li=n=>new class{name=`#${n.id}:phase`;unit="angle";measure(){return n.phase}},Ti=(n,t)=>new class{name=`${n.id}:${t.name}`;unit=t.unit;measure(){return n.state[t.index]}},ds=(n,t=!1)=>{const e=[];for(const s of n.nodes)switch(s.type){case"node":e.push(Ii(s)),t&&e.push(Li(s));break}return e},Pi=n=>{const t=[];for(const e of n.devices)for(const s of e.deviceClass.stateSchema.ops)t.push(Ti(e,s));return t};class Ei{#t;#n;constructor(t,e){this.#t=t,this.#n=e}stampA(t,e,s){if(!Number.isFinite(s))throw new $t;t!==yt&&e!==yt&&(this.#t[t.index][e.index]+=s)}stampB(t,e){if(!Number.isFinite(e))throw new $t;t!==yt&&(this.#n[t.index]+=e)}stampConductance(t,e,s){this.stampA(t,t,s),this.stampA(t,e,-s),this.stampA(e,t,-s),this.stampA(e,e,s)}stampTransconductance(t,e,s,i,r){this.stampA(t,s,r),this.stampA(t,i,-r),this.stampA(e,s,-r),this.stampA(e,i,r)}stampVoltageSource(t,e,s,i){this.stampA(t,s,1),this.stampA(e,s,-1),this.stampA(s,t,1),this.stampA(s,e,-1),this.stampB(s,i)}stampCurrentSource(t,e,s){this.stampB(t,-s),this.stampB(e,s)}}class Di{#t;#n;constructor(t,e){this.#t=t,this.#n=e}stampA(t,e,s,i){if(!Number.isFinite(s))throw new $t;if(!Number.isFinite(i))throw new $t;if(t!==yt&&e!==yt){const r=t.index*2,o=e.index*2;this.#t[r][o]+=s,this.#t[r][o+1]-=i,this.#t[r+1][o]+=i,this.#t[r+1][o+1]+=s}}stampB(t,e,s){if(!Number.isFinite(e))throw new $t;if(!Number.isFinite(s))throw new $t;if(t!==yt){const i=t.index*2;this.#n[i]+=e,this.#n[i+1]+=s}}stampConductance(t,e,s,i){this.stampA(t,t,s,i),this.stampA(t,e,-s,-i),this.stampA(e,t,-s,-i),this.stampA(e,e,s,i)}stampTransconductance(t,e,s,i,r,o){this.stampA(t,s,r,o),this.stampA(t,i,-r,-o),this.stampA(e,s,-r,-o),this.stampA(e,i,r,o)}stampVoltageSource(t,e,s,i,r){this.stampA(t,s,1,0),this.stampA(e,s,-1,0),this.stampA(s,t,1,0),this.stampA(s,e,-1,0),this.stampB(s,i,r)}stampCurrentSource(t,e,s,i){this.stampB(t,-s,-i),this.stampB(e,s,i)}stampCapacitor(t,e,s,i){const r=2*Math.PI*i*s;this.stampConductance(t,e,0,r)}stampInductor(t,e,s,i){const r=-1/(2*Math.PI*i*s);this.stampConductance(t,e,0,r)}}const Gi=n=>{const{length:t}=n,e=n[t-1];for(let s=t-1;s>0;s--)n[s]=n[s-1];n[0]=e};var L;(function(n){n.Euler="euler",n.Trapezoidal="trapezoidal",n.Gear="gear"})(L||(L={}));const Xe=Symbol("tran"),Ut=Symbol("index");class ms{[Xe];[Ut];V=0;C=0;I=0;Geq=0;Ieq=0;diff(t,e){this[Xe].diff(this,t,e)}}const _s=1,kt=6,Oi=(()=>{const n=new Array;for(let t=0;t<=kt+1;t++)n.push(new an(t));return n})();class qi{#t=[];#n=[];#s=new Float64Array(kt+1);#e=0;#a;#i;#o;#r;constructor(t=[]){for(let e=0;e<kt+1;e++)this.#n.push({time:0,delta:0,states:[]});for(const{diffs:e}of t)for(const s of e){s[Xe]=this,s[Ut]=this.#t.length,this.#t.push(s);for(const i of this.#n)i.states.push({V:0,C:0,I:0})}this.setMethod(L.Gear,kt)}setMethod(t,e){switch(t){case L.Euler:this.#a=L.Euler,this.#i=1;break;case L.Trapezoidal:this.#a=L.Trapezoidal,this.#i=2;break;case L.Gear:switch(e=Math.max(_s,Math.min(kt,e)),e){case 1:this.#a=L.Euler,this.#i=1;break;default:this.#a=L.Gear,this.#i=e;break}break}}nextStep(t,e){Gi(this.#n),this.#e+=1,this.#c(),this.#l(t,e)}#c(){switch(this.#a){case L.Euler:this.#o=L.Euler,this.#r=1;break;case L.Trapezoidal:this.#e<2?(this.#o=L.Euler,this.#r=1):(this.#o=L.Trapezoidal,this.#r=2);break;case L.Gear:this.#e<2?(this.#o=L.Euler,this.#r=1):(this.#o=L.Gear,this.#r=Math.min(this.#e,this.#i));break}}#l(t,e){switch(this.#n[0].time=t,this.#n[0].delta=e,this.#o){case L.Euler:{this.#s[0]=1/e,this.#s[1]=-1/e;break}case L.Trapezoidal:{this.#s[0]=2/e,this.#s[1]=-2/e;break}case L.Gear:{const s=Oi[this.#r+1],{A:i,x:r,b:o}=s;s.clear();for(let l=0;l<this.#r+1;l++)i[0][l]=1;let a=0;for(let l=0;l<this.#r;l++){a+=this.#n[l].delta;let u=1;for(let f=0;f<this.#r;f++)u*=a/this.#n[0].delta,i[f+1][l+1]=u}o[1]=-1/this.#n[0].delta,s.solve(gt.Gauss),this.#s.set(r);break}}}diff(t,e,s){switch(this.#o){case L.Euler:this.#d(t,e,s);break;case L.Trapezoidal:this.#f(t,e,s);break;case L.Gear:this.#p(t,e,s);break}}#d(t,e,s){const i=t[Ut],r=this.#n[0].states[i],o=this.#n[1].states[i],a=this.#s[0]*s,l=this.#s[1]*o.V*o.C,u=this.#s[0]*s*e+l;t.V=r.V=e,t.C=r.C=s,t.I=r.I=u,t.Geq=a,t.Ieq=l}#f(t,e,s){const i=t[Ut],r=this.#n[0].states[i],o=this.#n[1].states[i],a=this.#s[0]*s,l=this.#s[1]*o.V*o.C-o.I,u=this.#s[0]*s*e+l;t.V=r.V=e,t.C=r.C=s,t.I=r.I=u,t.Geq=a,t.Ieq=l}#p(t,e,s){const i=t[Ut],r=this.#n[0].states[i],o=this.#s[0]*s;let a=0;for(let u=1;u<this.#r+1;u++){const f=this.#n[u].states[i];a+=this.#s[u]*f.V*f.C}const l=this.#s[0]*s*e+a;t.V=r.V=e,t.C=r.C=s,t.I=r.I=l,t.Geq=o,t.Ieq=a}}class Bi{#t;#n;#s;#e;constructor(t){t.init("ac"),this.#t=t,this.#n=t.reindexNodes(),this.#s=new an(this.#n.length*2),this.#e=new Di(this.#s.A,this.#s.b)}solve(){st.simulationStarted(),st.iterationStarted(),this.#s.clear(),this.#t.loadAc(this.#e),this.#s.solve(gt.Gauss),this.#a(),st.iterationEnded(),st.simulationEnded()}#a(){for(const t of this.#n){const{index:e}=t,s=this.#s.x[e*2],i=this.#s.x[e*2+1];switch(t.type){case"node":t.voltage=Mn(s,i),t.phase=Cn(s,i);break;case"branch":t.current=Mn(s,i),t.phase=Cn(s,i);break}}}}function Mn(n,t){return Math.sqrt(n*n+t*t)}function Cn(n,t){return 180/Math.PI*Math.atan2(t,n)}class lt{id;static propsSchema={type:m.string({range:["lin","log"],title:"parameter sweep type"}),start:m.number({range:["real"],title:"parameter start value"}),stop:m.number({range:["real"],title:"parameter stop value"}),points:m.number({range:["integer",">",1],title:"number of points"})};static from(t,e){const s=new lt(t);return s.props.from(e),s}props=new m(lt.propsSchema);constructor(t){this.id=t}*[Symbol.iterator](){const{props:t}=this;yield*lt.iter(t)}static iter(t){const e=t.getString("type"),s=t.getNumber("start"),i=t.getNumber("stop"),r=t.getNumber("points");switch(e){case"lin":return lt.linIter(s,i,r);case"log":return lt.logIter(s,i,r);default:throw new TypeError}}static*linIter(t,e,s){const i=(e-t)/(s-1);for(let r=0;r<s;r++)yield t+r*i}static*logIter(t,e,s){const i=(Math.log(Math.abs(e))-Math.log(Math.abs(t)))/(s-1);for(let r=0;r<s;r++)yield t*Math.exp(r*i)}static walk(t,e){const{length:s}=t,i=[],r=o=>{if(o<s){const a=t[o];e.enter(a,o,i);for(const l of a)i.push({sweep:a,value:l}),e.set(a,l),r(o+1),i.pop();e.leave(a,o,i)}else e.end(i)};r(0)}}const vs=n=>{const t=({sweep:{id:e},value:s})=>`${e}=${mi(s)}`;return`"${n.map(t).join(", ")}"`};class gs extends ls{static propsSchema={...ps.propsSchema,type:m.string({range:["lin","log"],title:"frequency sweep type"}),start:m.number({range:["real",">",0],title:"start frequency"}),stop:m.number({range:["real",">",0],title:"stop frequency"}),points:m.number({range:["integer",">",1],title:"number of frequency points"})};constructor(){super(gs.propsSchema)}getProbes(t){return[$i(t),...ds(t,!0)]}runImpl(t,e){const{props:s}=this,i=s.getNumber("temp"),r=lt.from("frequency",s),o=new Bi(t);lt.walk(this.sweeps,{enter:(a,l,u)=>{},set:({id:a},l)=>{t.equations.set(a,new Mt(l))},end:a=>{a.length>0&&e.group(vs(a));for(const l of r)t.temp=i,t.time=NaN,t.frequency=l,t.reset(),o.solve(),e.capture()},leave:(a,l,u)=>{}})}}class zi extends Error{name="SimulationError";constructor(t,e){super(t,e)}}class Ui extends zi{name="ConvergenceError";constructor(t,e){super(t,e)}}const Wi=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1],Fi=[.001,1e-4,1e-5,1e-6,1e-7,1e-8,1e-9,0];class Hn{static propsSchema={abstol:m.number({defaultValue:1e-12,range:["real",">",0],title:"absolute current error tolerance in amperes"}),vntol:m.number({defaultValue:1e-6,range:["real",">",0],title:"absolute voltage error tolerance in volts"}),reltol:m.number({defaultValue:.001,range:["real",">",0],title:"relative error tolerance"}),maxIter:m.number({defaultValue:150,range:["integer",">",1],title:"maximum number of iterations"})};#t;#n;#s;#e;#a;#i;#o;#r;#c;#l;#d;#f;#p;constructor(t,e){t.init("dc"),this.#t=Ri(e),this.#n=t,this.#s=t.reindexNodes(),this.#e=new an(this.#s.length),this.#a=vt(this.#s.length),this.#i=vt(this.#s.length),this.#o=vt(this.#s.length),this.#r=vt(this.#s.length),this.#c=vt(this.#s.length),this.#l=new Ei(this.#e.A,this.#e.b),this.#d=0,this.#f=1,this.#p=0}solveDc(){this.#u=this.#b,this.#v=this.#x,st.simulationStarted(),this.#y(),st.simulationEnded()}solveTr(){this.#u=this.#k,this.#v=this.#M,st.simulationStarted(),this.#y(),st.simulationEnded()}#u;#v;#b=t=>{this.#n.loadDc(t)};#x=()=>{this.#n.saveDc()};#k=t=>{this.#n.loadTr(t)};#M=()=>{this.#n.saveTr()};#y(){if(this.#I(),mt(this.#o),mt(this.#c),!this.#C()&&(this.#V(),mt(this.#o),mt(this.#c),!this.#H()&&(this.#V(),mt(this.#o),mt(this.#c),!this.#S())))throw new Ui("Simulation did not converge.")}#C(){return this.#d=0,this.#f=1,this.#p=0,this.#_(this.#t.maxIter)}#H(){for(const t of Wi)if(this.#d=1,this.#f=t,this.#p=0,!this.#_(this.#t.maxIter))return!1;return!0}#S(){for(const t of Fi)if(this.#d=2,this.#f=1,this.#p=t,!this.#_(this.#t.maxIter))return!1;return!0}#_(t){this.#n.sourceFactor=this.#f;let e=0;for(;e<t;){this.#A();const s=e>0&&this.#$();if(xt(this.#i,this.#o),xt(this.#r,this.#c),s)return this.#v(),!0;e+=1}return!1}#A(){st.iterationStarted(),this.#e.clear(),this.#u(this.#l),this.#d===2&&this.#N(),xt(this.#e.b,this.#r),this.#e.solve(gt.Gauss),xt(this.#e.x,this.#i),this.#w(),st.iterationEnded()}#N(){for(let t=0;t<this.#e.size;t++)this.#e.A[t][t]+=this.#p}#$(){const{abstol:t,vntol:e,reltol:s}=this.#t;for(const i of this.#s){const{index:r}=i;switch(i.type){case"node":{const o=this.#o[r],a=this.#i[r];if(Math.abs(a-o)>=s*Math.abs(a)+e)return!1;const l=this.#c[r],u=this.#r[r];if(Math.abs(u-l)>=s*Math.abs(u)+t)return!1;break}case"branch":{const o=this.#o[r],a=this.#i[r];if(Math.abs(a-o)>=s*Math.abs(a)+t)return!1;const l=this.#c[r],u=this.#r[r];if(Math.abs(u-l)>=s*Math.abs(u)+e)return!1;break}}}return!0}#w(){for(const t of this.#s){const{index:e}=t;switch(t.type){case"node":t.voltage=this.#i[e];break;case"branch":t.current=this.#i[e];break}}}#I(){for(const t of this.#s){const{index:e}=t;switch(t.type){case"node":this.#a[e]=t.voltage;break;case"branch":this.#a[e]=t.current;break}}}#V(){for(const t of this.#s){const{index:e}=t;switch(t.type){case"node":t.voltage=this.#a[e];break;case"branch":t.current=this.#a[e];break}}}}function Ri(n){return{abstol:n.getNumber("abstol"),vntol:n.getNumber("vntol"),reltol:n.getNumber("reltol"),maxIter:n.getNumber("maxIter")}}class ys extends ls{static propsSchema={startTime:m.number({defaultValue:0,range:["real",">=",0],title:"simulation start time"}),stopTime:m.number({range:["real",">",0],title:"simulation stop time"}),timeStep:m.number({range:["real",">",0],title:"simulation time step"}),method:m.string({defaultValue:L.Gear,range:[L.Euler,L.Trapezoidal,L.Gear],title:"integration method"}),order:m.number({defaultValue:kt,range:["integer",">=",_s,"<=",kt],title:"integration order"}),dc:m.string({defaultValue:"yes",range:["yes","no"],title:"start with DC analysis"}),...ps.propsSchema,...Hn.propsSchema};constructor(){super(ys.propsSchema)}getProbes(t){return[Ni(t),...ds(t),...Pi(t)]}runImpl(t,e){const{props:s}=this,i=s.getNumber("startTime"),r=s.getNumber("stopTime"),o=s.getNumber("timeStep"),a=s.getString("method"),l=s.getNumber("order"),u=s.getString("dc"),f=s.getNumber("temp"),h=new Hn(t,s);lt.walk(this.sweeps,{enter:(d,p,_)=>{},set:({id:d},p)=>{t.equations.set(d,new Mt(p))},end:d=>{d.length>0&&e.group(vs(d)),t.temp=f,t.time=NaN,t.frequency=NaN,t.reset(),u==="yes"&&h.solveDc();const p=new qi(t.devices);p.setMethod(a,l);let _=0,b=0;for(;b<=r;)t.temp=f,t.time=b,t.frequency=NaN,p.nextStep(b,o),h.solveTr(),b>=i&&e.capture(),_+=1,b=o*_},leave:(d,p,_)=>{}})}}class ji extends U{static id="C";static numTerminals=2;static propsSchema={C:m.number({title:"capacitance",range:["real",">",0]}),V0:m.number({title:"initial voltage",defaultValue:0})};static stateSchema={length:4,ops:[{index:2,name:"V",unit:"V"},{index:3,name:"I",unit:"A"}]};diff=new ms;na;nb;constructor(t){super(t),this.diffs.push(this.diff)}connect(t,[e,s]){this.na=e,this.nb=s}reset(t,e){e[0]=t.getNumber("C"),e[1]=t.getNumber("V0")}saveDc(t,e){const{na:s,nb:i}=this;t[2]=s.voltage-i.voltage,t[3]=0}loadTr(t,{time:e},s){const{diff:i,na:r,nb:o}=this,a=t[0],l=e>0?r.voltage-o.voltage:t[1];i.diff(l,a),t[2]=i.V,t[3]=i.I,s.stampConductance(r,o,i.Geq),s.stampCurrentSource(r,o,i.Ieq)}loadAc(t,e,s){const{na:i,nb:r}=this,o=t[0];s.stampCapacitor(i,r,o,e)}}class Zi extends U{static id="L";static numTerminals=2;static propsSchema={L:m.number({title:"inductance",range:["real",">",0]}),I0:m.number({title:"initial current",defaultValue:0})};static stateSchema={length:4,ops:[{index:2,name:"V",unit:"V"},{index:3,name:"I",unit:"A"}]};diff=new ms;na;nb;branch;constructor(t){super(t),this.diffs.push(this.diff)}connect(t,[e,s]){this.na=e,this.nb=s,this.branch=t.makeBranch(this.na,this.nb)}init(t,e,s){this.branch.enabled=s!=="ac"}reset(t,e){e[0]=t.getNumber("L"),e[1]=t.getNumber("I0")}loadDc(t,e,s){const{na:i,nb:r,branch:o}=this;s.stampVoltageSource(i,r,o,0)}saveDc(t,e){const{branch:s}=this;t[2]=0,t[3]=s.current}loadTr(t,{time:e},s){const{diff:i,na:r,nb:o,branch:a}=this,l=t[0],u=e>0?a.current:t[1];i.diff(u,l),t[2]=i.I,t[3]=i.V,s.stampA(a,a,-i.Geq),s.stampVoltageSource(r,o,a,i.Ieq)}loadAc(t,e,s){const{na:i,nb:r}=this,o=t[0];s.stampInductor(i,r,o,e)}}class Xi extends U.Dc{static id="R";static numTerminals=2;static propsSchema={R:m.number({title:"resistance",range:["real","<>",0]})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};na;nb;connect(t,[e,s]){this.na=e,this.nb=s}reset(t,e){const s=t.getNumber("R");e[0]=1/s}loadDc(t,e,s){const{na:i,nb:r}=this,o=t[0];s.stampConductance(i,r,o)}saveDc(t,e){const{na:s,nb:i}=this,r=t[0],o=s.voltage-i.voltage,a=o*r;t[1]=o,t[2]=a}loadAc(t,e,s){const{na:i,nb:r}=this,o=t[0];s.stampConductance(i,r,o,0)}}const Pe=ae(26.85),Jt=1602176634e-28,Qt=1380649e-29,te=3,ee=1.11,Yi=2/Math.PI,Ki=Math.PI/2,nt=1e-12,bs="npn",ws="pnp",ln="nfet",cn="pfet";function Ji(n){switch(n){case bs:return 1;case ws:return-1}}function Vs(n){switch(n){case ln:return 1;case cn:return-1}}function St(n,t,e){return n>=0?t*(Math.exp(1/e*n)-1):0}function At(n,t,e){return n>=0?1/e*t*Math.exp(1/e*n):0}function Nt(n,t,e,s){if(n>=0&&n>s&&Math.abs(n-t)>2*e)if(t>0){const i=(n-t)/e;i>0?n=t+e*(2+Math.log(i-2)):n=t-e*(2+Math.log(2-i))}else n=s;return n}function fe(n,t){return Math.abs(n-t)>.5?n>t?t+.5:t-.5:n}function Ee(n,t){return Number.isFinite(n)?n:Number.isFinite(t)?t:0}class xe extends U.Dc{static id="BJT";static numTerminals=3;static propsSchema={polarity:m.string({range:[bs,ws],title:"transistor polarity"}),Bf:m.number({defaultValue:100,range:["real",">",0],title:"forward beta"}),Br:m.number({defaultValue:1,range:["real",">",0],title:"reverse beta"}),Is:m.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),Nf:m.number({defaultValue:1,range:["real",">",0],title:"forward emission coefficient"}),Nr:m.number({defaultValue:1,range:["real",">",0],title:"reverse emission coefficient"}),Vaf:m.number({defaultValue:10,range:["real",">=",0],title:"forward Early voltage"}),Var:m.number({defaultValue:0,range:["real",">=",0],title:"reverse Early voltage"}),temp:m.temp};static stateSchema={length:15,ops:[{index:7,name:"Vbe",unit:"V"},{index:8,name:"Vbc",unit:"V"},{index:9,name:"Vce",unit:"V"},{index:10,name:"Ie",unit:"A"},{index:11,name:"Ic",unit:"A"},{index:12,name:"Ib",unit:"A"}]};static linear=!1;ne;nb;nc;connect(t,[e,s,i]){this.ne=e,this.nb=s,this.nc=i}reset(t,e){const s=t.getString("polarity"),i=t.getNumber("Bf"),r=t.getNumber("Br"),o=t.getNumber("Is"),a=t.getNumber("Nf"),l=t.getNumber("Nr"),u=t.getNumber("temp",NaN);e[0]=Ji(s),e[1]=i/(i+1),e[2]=r/(r+1),e[3]=o,e[4]=a,e[5]=l,e[6]=u}loadDc(t,{temp:e},s){this.#t(t,e,!0);const{ne:i,nb:r,nc:o}=this,a=t[0],l=t[1],u=t[2],f=a*t[7],h=a*t[8],d=a*t[10],p=a*t[11],_=t[13],b=t[14],v=-_,y=-b,w=u*b,A=l*_;s.stampConductance(i,r,-v),s.stampConductance(o,r,-y),s.stampTransconductance(i,r,o,r,-w),s.stampTransconductance(o,r,i,r,-A),s.stampCurrentSource(i,r,a*(d-v*f-w*h)),s.stampCurrentSource(o,r,a*(p-A*f-y*h))}saveDc(t,{temp:e}){this.#t(t,e,!1)}#t(t,e,s){const{ne:i,nb:r,nc:o}=this,a=t[3],l=t[4],u=t[5],f=ae(Ee(t[6],e)),h=f/Pe,d=l*f*(Qt/Jt),p=u*f*(Qt/Jt),_=a*Math.pow(h,te/l)*Math.exp((h-1)*(ee/d)),b=a*Math.pow(h,te/u)*Math.exp((h-1)*(ee/p)),v=t[0],y=t[1],w=t[2];let A=v*(r.voltage-i.voltage),N=v*(r.voltage-o.voltage);if(s){const H=d*Math.log(d/Math.sqrt(2)/_);A=Nt(A,v*t[7],d,H);const P=p*Math.log(p/Math.sqrt(2)/b);N=Nt(N,v*t[8],p,P)}const G=St(A,_,d),Q=St(N,b,p),X=w*Q-G,j=y*G-Q,Y=At(A,_,d)+nt,M=At(N,b,p)+nt;t[7]=v*A,t[8]=v*N,t[9]=v*(A-N),t[10]=v*X,t[11]=v*j,t[12]=v*-(X+j),t[13]=Y,t[14]=M}}class le extends U.Dc{static id="Diode";static numTerminals=2;static propsSchema={Is:m.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:m.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:m.temp};static stateSchema={length:6,ops:[{index:3,name:"V",unit:"V"},{index:4,name:"I",unit:"A"}]};static linear=!1;na;nc;connect(t,[e,s]){this.na=e,this.nc=s}reset(t,e){const s=t.getNumber("Is"),i=t.getNumber("N"),r=t.getNumber("temp",NaN);e[0]=s,e[1]=i,e[2]=r}loadDc(t,{temp:e},s){this.#t(t,e,!0);const{na:i,nc:r}=this,o=t[3],a=t[4],l=t[5];s.stampConductance(i,r,l),s.stampCurrentSource(i,r,a-l*o)}saveDc(t,{temp:e}){this.#t(t,e,!1)}#t(t,e,s){const{na:i,nc:r}=this,o=t[0],a=t[1],l=ae(Ee(t[2],e)),u=l/Pe,f=a*l*(Qt/Jt),h=o*Math.pow(u,te/a)*Math.exp((u-1)*(ee/f));let d=i.voltage-r.voltage;if(s){const b=f*Math.log(f/Math.sqrt(2)/h);d=Nt(d,t[3],f,b)}const p=St(d,h,f),_=At(d,h,f)+nt;t[3]=d,t[4]=p,t[5]=_}}class ke extends U.Dc{static id="JFET";static numTerminals=3;static propsSchema={polarity:m.string({range:[ln,cn],title:"transistor polarity"}),Vth:m.number({defaultValue:-2,range:["real"],title:"threshold voltage"}),beta:m.number({defaultValue:1e-4,range:["real",">",0],title:"transconductance parameter"}),lambda:m.number({defaultValue:0,range:["real",">=",0],title:"channel-length modulation parameter"}),Is:m.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:m.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:m.temp};static stateSchema={length:17,ops:[{index:7,name:"Vgs",unit:"V"},{index:10,name:"Vgd",unit:"V"},{index:13,name:"Vds",unit:"V"},{index:14,name:"Ids",unit:"A"}]};static linear=!1;ns;ng;nd;connect(t,[e,s,i]){this.ns=e,this.ng=s,this.nd=i}reset(t,e){const s=t.getString("polarity"),i=t.getNumber("Vth"),r=t.getNumber("beta"),o=t.getNumber("lambda"),a=t.getNumber("Is"),l=t.getNumber("N"),u=t.getNumber("temp",NaN);e[0]=Vs(s),e[1]=i,e[2]=r,e[3]=o,e[4]=a,e[5]=l,e[6]=u}loadDc(t,{temp:e},s){this.#t(t,e,!0);const{ns:i,ng:r,nd:o}=this,a=t[0],l=a*t[7],u=a*t[8],f=t[9],h=a*t[10],d=a*t[11],p=t[15],_=a*t[13],b=a*t[14],v=t[15],y=t[16];s.stampConductance(r,i,f),s.stampCurrentSource(r,i,a*(u-f*l)),s.stampConductance(r,o,p),s.stampCurrentSource(r,o,a*(d-p*h)),s.stampConductance(o,i,v),s.stampTransconductance(o,i,r,i,y),s.stampCurrentSource(o,i,a*(b-v*_-y*l))}saveDc(t,{temp:e}){this.#t(t,e,!1)}#t(t,e,s){const{ns:i,ng:r,nd:o}=this,a=t[0],l=t[1],u=t[2],f=t[3],h=t[4],d=t[5],p=ae(Ee(t[6],e)),_=p/Pe,b=d*p*(Qt/Jt);let v=a*(r.voltage-i.voltage),y=a*(r.voltage-o.voltage);if(s){const M=h*Math.pow(_,te/d)*Math.exp((_-1)*(ee/b)),H=b*Math.log(b/Math.sqrt(2)/M);v=Nt(v,a*t[7],b,H),y=Nt(y,a*t[10],b,H)}const w=v-y,A=St(v,h,b),N=At(v,h,b)+nt,G=St(y,h,b),Q=At(y,h,b)+nt;let X,j,Y;if(v>=y){const M=v-l;if(M<=0)X=0,j=nt,Y=0;else{const H=f*w,P=u*(1+H);M<=w?(X=P*M*M,j=u*f*M*M,Y=2*P*M):(X=P*w*(2*M-w),j=2*P*(M-w)+u*H*(2*M-w),Y=2*P*w)}}else{const M=y-l;if(M<=0)X=0,j=nt,Y=0;else{const H=-w,P=f*H,$=u*(1+P);M<=H?(X=-$*M*M,j=u*f*M*M+2*$*M,Y=-2*$*M):(X=-$*H*(2*M-H),j=2*$*M+u*P*(2*M-H),Y=-2*$*H)}}t[7]=a*v,t[10]=a*y,t[13]=a*w,t[8]=a*A,t[9]=N,t[11]=a*G,t[12]=Q,t[14]=a*X,t[15]=j,t[16]=Y}}class It extends U.Dc{static id="MOSFET";static numTerminals=4;static propsSchema={polarity:m.string({range:[ln,cn],title:"transistor polarity"}),Vth:m.number({range:["real"],title:"threshold voltage"}),beta:m.number({defaultValue:.02,range:["real",">",0],title:"transconductance parameter"}),lambda:m.number({defaultValue:0,range:["real",">=",0],title:"channel-length modulation parameter"}),Is:m.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:m.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:m.temp};static stateSchema={length:19,ops:[{index:13,name:"Vgs",unit:"V"},{index:14,name:"Vgd",unit:"V"},{index:15,name:"Vds",unit:"V"},{index:16,name:"Ids",unit:"A"}]};static linear=!1;ns;ng;nd;nb;connect(t,[e,s,i,r]){this.ns=e,this.ng=s,this.nd=i,this.nb=r}reset(t,e){const s=t.getString("polarity"),i=t.getNumber("Vth"),r=t.getNumber("beta"),o=t.getNumber("lambda"),a=t.getNumber("Is"),l=t.getNumber("N"),u=t.getNumber("temp",NaN);e[0]=Vs(s),e[1]=i,e[2]=r,e[3]=o,e[4]=a,e[5]=l,e[6]=u}loadDc(t,{temp:e},s){const{ns:i,ng:r,nd:o,nb:a}=this;this.#t(t,e,!0);const l=t[0],u=l*t[7],f=l*t[10],h=l*t[13],d=l*t[14],p=l*t[15],_=l*t[8],b=t[9],v=l*t[11],y=t[12],w=l*t[16],A=t[17],N=t[18];s.stampConductance(a,i,b),s.stampCurrentSource(a,i,l*(_-b*u)),s.stampConductance(a,o,y),s.stampCurrentSource(a,o,l*(v-y*f)),p>0?(s.stampConductance(o,i,A),s.stampTransconductance(o,i,r,i,N),s.stampCurrentSource(o,i,l*(w-A*p-N*h))):(s.stampConductance(o,i,A),s.stampTransconductance(o,i,r,o,N),s.stampCurrentSource(o,i,l*(w-A*p-N*d)))}saveDc(t,{temp:e}){this.#t(t,e,!1)}#t(t,e,s){const{ns:i,ng:r,nd:o,nb:a}=this,l=t[0],u=t[1],f=t[2],h=t[3],d=t[4],p=t[5],_=ae(Ee(t[6],e)),b=_/Pe,v=p*_*(Qt/Jt);let y=l*(a.voltage-i.voltage),w=l*(a.voltage-o.voltage),A=t[13]=l*(r.voltage-i.voltage),N=t[14]=l*(r.voltage-o.voltage),G=A-N;if(s){const $=d*Math.pow(b,te/p)*Math.exp((b-1)*(ee/v)),tt=v*Math.log(v/Math.sqrt(2)/$);y=Nt(y,l*t[7],v,tt),w=Nt(w,l*t[10],v,tt),G>0?(A=fe(A,l*t[13]),G=fe(A-N,l*t[15])):(N=fe(N,l*t[14]),G=fe(A-N,l*t[15]))}const Q=St(y,d,v),X=At(y,d,v)+nt,j=St(w,d,v),Y=At(w,d,v)+nt;let M,H,P;if(G>0){const $=A-l*u;if($<=0)M=0,H=nt,P=0;else{const tt=h*G,dt=f*(1+tt);$<=G?(M=1/2*dt*$*$,H=1/2*f*h*$*$,P=dt*$):(M=dt*G*($-G/2),H=dt*($-G)+f*tt*($-G/2),P=dt*G)}}else{const $=N-l*u;if($<=0)M=0,H=nt,P=0;else{const tt=-G,dt=h*tt,zt=f*(1+dt);$<=tt?(M=-.5*zt*$*$,H=1/2*f*h*$*$,P=zt*$):(M=-zt*tt*($-tt/2),H=zt*$+f*dt*($-tt/2),P=zt*tt)}}t[7]=l*y,t[10]=l*w,t[13]=l*A,t[14]=l*N,t[15]=l*G,t[8]=l*Q,t[9]=X,t[11]=l*j,t[12]=Y,t[16]=l*M,t[17]=H,t[18]=P}}class Qi extends U.Dc{static id="OpAmp";static numTerminals=3;static propsSchema={gain:m.number({defaultValue:1e6,range:["real",">",0],title:"gain"}),Vmax:m.number({defaultValue:15,range:["real",">",0],title:"maximum absolute value of output voltage"})};static stateSchema={length:5,ops:[{index:2,name:"Vin",unit:"V"},{index:3,name:"Vout",unit:"V"}]};static linear=!1;np;nn;no;branch;connect(t,[e,s,i]){this.np=e,this.nn=s,this.no=i,this.branch=t.makeBranch(this.no,t.groundNode)}reset(t,e){const s=t.getNumber("gain"),i=t.getNumber("Vmax");e[0]=s,e[1]=i}loadDc(t,e,s){const{np:i,nn:r,no:o,branch:a}=this,l=t[0],u=t[1],f=i.voltage-r.voltage,h=Ki*l*f/u,d=u*Yi*Math.atan(h),p=l/(1+h*h)+nt;t[2]=f,t[3]=d,t[4]=p,s.stampA(o,a,1),s.stampA(a,i,p),s.stampA(a,r,-p),s.stampA(a,o,-1),s.stampB(a,p*f-d)}}class tr extends U.Dc{static id="Ammeter";static numTerminals=2;static propsSchema={};static stateSchema={length:1,ops:[{index:0,name:"I",unit:"A"}]};np;nn;branch;connect(t,[e,s]){this.np=e,this.nn=s,this.branch=t.makeBranch(this.np,this.nn)}loadDc(t,e,s){const{np:i,nn:r,branch:o}=this;s.stampVoltageSource(i,r,o,0)}saveDc(t,e){const{branch:s}=this;t[0]=s.current}}class er extends U.Dc{static id="Voltmeter";static numTerminals=2;static propsSchema={};static stateSchema={length:1,ops:[{index:0,name:"V",unit:"V"}]};np;nn;connect(t,[e,s]){this.np=e,this.nn=s}saveDc(t,e){const{np:s,nn:i}=this;t[0]=s.voltage-i.voltage}}class Tc extends U.Dc{static id="CCCS";static numTerminals=4;static propsSchema={gain:m.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;ncp;ncn;branch;connect(t,[e,s,i,r]){this.np=e,this.nn=s,this.ncp=i,this.ncn=r,this.branch=t.makeBranch(this.ncp,this.ncn)}reset(t,e){e[0]=t.getNumber("gain")}loadDc(t,e,s){const{np:i,nn:r,ncp:o,ncn:a,branch:l}=this,u=t[0];s.stampVoltageSource(o,a,l,0),s.stampA(i,l,u),s.stampA(r,l,-u)}saveDc(t,e){const{np:s,nn:i,branch:r}=this,o=t[0],a=r.current*o,l=s.voltage-i.voltage;t[1]=a,t[2]=l}}class Pc extends U.Dc{static id="CCVS";static numTerminals=4;static propsSchema={gain:m.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;ncp;ncn;branch1;branch2;connect(t,[e,s,i,r]){this.np=e,this.nn=s,this.ncp=i,this.ncn=r,this.branch1=t.makeBranch(this.np,this.nn),this.branch2=t.makeBranch(this.ncp,this.ncn)}reset(t,e){e[0]=t.getNumber("gain")}loadDc(t,e,s){const{np:i,nn:r,branch1:o,ncp:a,ncn:l,branch2:u}=this,f=t[0];s.stampVoltageSource(i,r,o,0),s.stampVoltageSource(a,l,u,0),s.stampA(o,u,-f)}saveDc(t,e){const{np:s,nn:i,branch1:r}=this,o=s.voltage-i.voltage,a=r.current;t[1]=o,t[2]=a}}class Ec extends U{static id="Iac";static numTerminals=2;static propsSchema={I:m.number({title:"amplitude"}),f:m.number({title:"frequency"}),phase:m.number({title:"phase",defaultValue:0})};static stateSchema={length:5,ops:[{index:3,name:"I",unit:"A"},{index:4,name:"V",unit:"V"}]};np;nn;connect(t,[e,s]){this.np=e,this.nn=s}reset(t,e){const s=t.getNumber("I"),i=t.getNumber("f"),r=t.getNumber("phase"),o=2*Math.PI*i,a=r/180*Math.PI;e[0]=s,e[1]=o,e[2]=a}saveDc(t,e){t[3]=0,t[4]=0}loadTr(t,{time:e,sourceFactor:s},i){const{np:r,nn:o}=this,a=t[0],l=t[1],u=t[2],f=s*a*Math.sin(l*e+u);t[3]=f,i.stampCurrentSource(r,o,f)}saveTr(t,e){const{np:s,nn:i}=this;t[4]=s.voltage-i.voltage}loadAc(t,e,s){const{np:i,nn:r}=this,o=t[0],a=t[2],l=o*Math.cos(a),u=o*Math.sin(a);s.stampCurrentSource(i,r,l,u)}}class nr extends U.Dc{static id="I";static numTerminals=2;static propsSchema={I:m.number({title:"current"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;connect(t,[e,s]){this.np=e,this.nn=s}reset(t,e){e[0]=t.getNumber("I")}loadDc(t,{sourceFactor:e},s){const{np:i,nn:r}=this,o=t[0],a=e*o;t[1]=a,s.stampCurrentSource(i,r,a)}saveDc(t,e){const{np:s,nn:i}=this;t[2]=s.voltage-i.voltage}}class Dc extends U{static id="Vac";static numTerminals=2;static propsSchema={V:m.number({title:"amplitude"}),f:m.number({title:"frequency"}),phase:m.number({title:"phase",defaultValue:0})};static stateSchema={length:5,ops:[{index:3,name:"V",unit:"V"},{index:4,name:"I",unit:"A"}]};np;nn;branch;connect(t,[e,s]){this.np=e,this.nn=s,this.branch=t.makeBranch(this.np,this.nn)}reset(t,e){const s=t.getNumber("V"),i=t.getNumber("f"),r=t.getNumber("phase"),o=2*Math.PI*i,a=r/180*Math.PI;e[0]=s,e[1]=o,e[2]=a}loadDc(t,e,s){const{np:i,nn:r,branch:o}=this;s.stampVoltageSource(i,r,o,0)}saveDc(t,e){t[3]=0,t[4]=0}loadTr(t,{time:e,sourceFactor:s},i){const{np:r,nn:o,branch:a}=this,l=t[0],u=t[1],f=t[2],h=s*l*Math.sin(u*e+f);t[3]=h,i.stampVoltageSource(r,o,a,h)}saveTr(t,e){const{branch:s}=this,i=s.current;t[4]=i}loadAc(t,e,s){const{np:i,nn:r,branch:o}=this,a=t[0],l=t[2],u=a*Math.cos(l),f=a*Math.sin(l);s.stampVoltageSource(i,r,o,u,f)}}class Gc extends U.Dc{static id="VCCS";static numTerminals=4;static propsSchema={gain:m.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;ncp;ncn;branch;connect(t,[e,s,i,r]){this.np=e,this.nn=s,this.ncp=i,this.ncn=r,this.branch=t.makeBranch(this.np,this.nn)}reset(t,e){e[0]=t.getNumber("gain")}loadDc(t,e,s){const{np:i,nn:r,ncp:o,ncn:a,branch:l}=this,u=t[0];s.stampA(i,l,1),s.stampA(r,l,-1),s.stampA(l,o,u),s.stampA(l,a,-u),s.stampA(l,l,-1)}saveDc(t,e){const{np:s,nn:i,branch:r}=this;t[1]=r.current,t[2]=s.voltage-i.voltage}}class Oc extends U.Dc{static id="VCVS";static numTerminals=4;static propsSchema={gain:m.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;ncp;ncn;branch;connect(t,[e,s,i,r]){this.np=e,this.nn=s,this.ncp=i,this.ncn=r,this.branch=t.makeBranch(this.np,this.nn)}reset(t,e){e[0]=t.getNumber("gain")}loadDc(t,e,s){const{np:i,nn:r,ncp:o,ncn:a,branch:l}=this,u=t[0];s.stampVoltageSource(i,r,l,0),s.stampA(l,o,-u),s.stampA(l,a,u)}saveDc(t,e){const{np:s,nn:i,branch:r}=this;t[1]=s.voltage-i.voltage,t[2]=r.current}}class sr extends U.Dc{static id="V";static numTerminals=2;static propsSchema={V:m.number({title:"voltage"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;branch;connect(t,[e,s]){this.np=e,this.nn=s,this.branch=t.makeBranch(this.np,this.nn)}reset(t,e){e[0]=t.getNumber("V")}loadDc(t,{sourceFactor:e},s){const{np:i,nn:r,branch:o}=this,a=t[0],l=e*a;t[1]=l,s.stampVoltageSource(i,r,o,l)}saveDc(t,e){const{branch:s}=this;t[2]=s.current}}new at("D",le,{Is:1e-14,N:1}),new at("NPN",xe,{polarity:"npn",Bf:100,Br:1,Is:1e-14,Nf:1,Nr:1,Vaf:10,Var:0}),new at("PNP",xe,{polarity:"pnp",Bf:100,Br:1,Is:1e-14,Nf:1,Nr:1,Vaf:10,Var:0}),new at("NFET",ke,{polarity:"nfet",Vth:-2,beta:1e-4,lambda:0,Is:1e-14,N:1}),new at("PFET",ke,{polarity:"pfet",Vth:-2,beta:1e-4,lambda:0,Is:1e-14,N:1}),new at("NMOS",It,{polarity:"nfet",Vth:2,beta:.02,lambda:0,Is:1e-14,N:1}),new at("PMOS",It,{polarity:"pfet",Vth:-2,beta:.02,lambda:0,Is:1e-14,N:1}),new at("DEPNMOS",It,{polarity:"nfet",Vth:-2,beta:.02,lambda:0,Is:1e-14,N:1}),new at("DEPPMOS",It,{polarity:"pfet",Vth:2,beta:.02,lambda:0,Is:1e-14,N:1});const ir={id:"r",name:"Resistor",category:"Linear",prefix:"R",shapes:[["l",0,-30,0,-20],["l",-8,-20,8,-20],["l",-8,20,8,20],["l",-8,-20,-8,20],["l",8,-20,8,20],["l",0,30,0,20]],pins:[["a",0,-30],["b",0,30]],labels:[15,0,"lm"],device:Xi},rr={id:"c",name:"Capacitor",category:"Linear",prefix:"C",shapes:[["l",0,-30,0,-6],["l",-20,-6,20,-6],["l",-20,6,20,6],["l",0,30,0,6]],pins:[["a",0,-30],["b",0,30]],labels:[30,0,"lm"],device:ji},or={id:"l",name:"Inductor",category:"Linear",prefix:"L",shapes:[["l",0,-30,0,-22],["a",0,-14,7,-90,90],["a",0,0,7,-90,90],["a",0,14,7,-90,90],["l",0,30,0,22]],pins:[["a",0,-30],["b",0,30]],labels:[15,0,"lm"],device:Zi},ge={resistor:ir,capacitor:rr,inductor:or},De=(n,t,e,s,i=10)=>{const r=Math.atan2(s-t,e-n),o=r-Math.PI/6,a=r+Math.PI/6;return[["l",n,t,e,s],["l",e,s,e-i*Math.cos(o),s-i*Math.sin(o)],["l",e,s,e-i*Math.cos(a),s-i*Math.sin(a)]]},ar={id:"d",name:"Diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-15,-11,15,-11],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:le},lr={id:"dz",name:"Zener diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-20,-5,-15,-11],["l",-15,-11,15,-11],["l",15,-11,20,-17],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:le},cr={id:"ds",name:"Schottky diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-9,-17,-15,-17],["l",-15,-17,-15,-11],["l",-15,-11,15,-11],["l",15,-11,15,-5],["l",15,-5,9,-5],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:le},ur={id:"dv",name:"Varicap diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-17],["l",-15,-17,15,-17],["l",-15,-11,15,-11],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:le},hr={id:"npn",name:"NPN bipolar junction transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-20],["l",0,30,0,20],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",-20,-5,0,-20],...De(-20,5,0,20)],pins:[["c",0,-30],["e",0,30],["b",-30,0]],labels:[10,0,"lm"],device:xe},fr={id:"pnp",name:"PNP bipolar junction transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-20],["l",0,30,0,20],["l",-30,0,-20,0],["l",-20,-15,-20,15],...De(0,-20,-20,-5),["l",0,20,-20,5]],pins:[["e",0,-30],["c",0,30],["b",-30,0]],labels:[10,0,"lm"],device:xe},pr={id:"nfet",name:"N-channel junction field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,10],["l",-30,0,-12,0],["l",0,-10,-12,-10],["l",0,10,-12,10],["l",-12,-15,-12,15],["l",-21,-5,-15,0],["l",-21,5,-15,0]],pins:[["d",0,-30],["s",0,30],["g",-30,0]],labels:[10,0,"lm"],device:ke},dr={id:"pfet",name:"P-channel junction field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,10],["l",-30,0,-12,0],["l",0,-10,-12,-10],["l",0,10,-12,10],["l",-12,-15,-12,15],["l",-21,0,-15,-5],["l",-21,0,-15,5]],pins:[["s",0,-30],["d",0,30],["g",-30,0]],labels:[10,0,"lm"],device:ke},mr={id:"nmos",name:"N-channel MOS field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,0],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",0,-10,-15,-10],["l",-15,-15,-15,-6],["l",0,0,-15,0],["l",-15,-3,-15,3],["l",-13,0,-8,-4],["l",-13,0,-8,4],["l",0,10,-15,10],["l",-15,15,-15,6]],pins:[["d",0,-30],["s",0,30],["g",-30,0]],labels:[10,0,"lm"],device:It},_r={id:"pmos",name:"P-channel MOS field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,0],["l",0,30,0,10],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",0,-10,-15,-10],["l",-15,-15,-15,-6],["l",0,0,-15,0],["l",-15,-3,-15,3],["l",-6,-4,-1,0],["l",-6,4,-1,0],["l",0,10,-15,10],["l",-15,15,-15,6]],pins:[["s",0,-30],["d",0,30],["g",-30,0]],labels:[10,0,"lm"],device:It},vr={id:"opamp",name:"Operational amplifier",category:"Nonlinear",prefix:"OA",shapes:[["l",-50,-30,-30,-30],["l",-50,30,-30,30],["l",30,0,50,0],["l",-30,-50,30,0],["l",-30,50,30,0],["l",-30,-50,-30,50],["l",-25,-30,-15,-30],["l",-20,-35,-20,-25],["l",-25,30,-15,30]],pins:[["noninv",-50,-30],["inv",-50,30],["out",50,0]],labels:[-30,55,"lt"],device:Qi},K={diode:ar,zener:lr,schottky:cr,varicap:ur,npn:hr,pnp:fr,nfet:pr,pfet:dr,nmos:mr,pmos:_r,opamp:vr},gr={id:"vmeter",name:"Voltmeter",category:"Probes",prefix:"Pr",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,30,0,20],["t",0,0,"cm","V"],...De(-25,25,25,-25)],pins:[["a",0,-30],["b",0,30]],labels:[25,0,"lm"],device:er},yr={id:"ameter",name:"Ammeter",category:"Probes",prefix:"Pr",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,30,0,20],["t",0,0,"cm","A"],...De(-25,25,25,-25)],pins:[["a",0,-30],["b",0,30]],labels:[25,0,"lm"],device:tr},br={vmeter:gr,ameter:yr},wr={id:"vdc",name:"Ideal DC voltage source",category:"Sources",prefix:"V",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,-15,0,-5],["l",-5,-10,5,-10],["l",-5,10,5,10],["l",0,30,0,20]],pins:[["pos",0,-30],["neg",0,30]],labels:[25,0,"lm"],device:sr},Vr={id:"idc",name:"Ideal DC current source",category:"Sources",prefix:"I",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,10,0,-10],["l",0,-11,-5,-3],["l",0,-11,5,-3],["l",0,30,0,20]],pins:[["pos",0,-30],["neg",0,30]],labels:[25,0,"lm"],device:nr},ne={vdc:wr,idc:Vr};class xr{#t=new Map;constructor(t){for(const e of t)this.#t.set(e.id,e)}[Symbol.iterator](){return this.#t.values()}get(t){const e=this.#t.get(t);if(e==null)throw new Error(`Unknown symbol [${t}]`);return e}}const xs=new xr([...Object.values(ut),...Object.values(ge),...Object.values(K),...Object.values(ne),...Object.values(br)]);var kr=Symbol.for("preact-signals");function Ge(){if(bt>1)bt--;else{for(var n,t=!1;Ft!==void 0;){var e=Ft;for(Ft=void 0,Ye++;e!==void 0;){var s=e.o;if(e.o=void 0,e.f&=-3,!(8&e.f)&&Ms(e))try{e.c()}catch(i){t||(n=i,t=!0)}e=s}}if(Ye=0,bt--,t)throw n}}function Mr(n){if(bt>0)return n();bt++;try{return n()}finally{Ge()}}var T=void 0,Ft=void 0,bt=0,Ye=0,Me=0;function ks(n){if(T!==void 0){var t=n.n;if(t===void 0||t.t!==T)return t={i:0,S:n,p:T.s,n:void 0,t:T,e:void 0,x:void 0,r:t},T.s!==void 0&&(T.s.n=t),T.s=t,n.n=t,32&T.f&&n.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=T.s,t.n=void 0,T.s.n=t,T.s=t),t}}function Z(n){this.v=n,this.i=0,this.n=void 0,this.t=void 0}Z.prototype.brand=kr;Z.prototype.h=function(){return!0};Z.prototype.S=function(n){this.t!==n&&n.e===void 0&&(n.x=this.t,this.t!==void 0&&(this.t.e=n),this.t=n)};Z.prototype.U=function(n){if(this.t!==void 0){var t=n.e,e=n.x;t!==void 0&&(t.x=e,n.e=void 0),e!==void 0&&(e.e=t,n.x=void 0),n===this.t&&(this.t=e)}};Z.prototype.subscribe=function(n){var t=this;return ue(function(){var e=t.value,s=T;T=void 0;try{n(e)}finally{T=s}})};Z.prototype.valueOf=function(){return this.value};Z.prototype.toString=function(){return this.value+""};Z.prototype.toJSON=function(){return this.value};Z.prototype.peek=function(){var n=T;T=void 0;try{return this.value}finally{T=n}};Object.defineProperty(Z.prototype,"value",{get:function(){var n=ks(this);return n!==void 0&&(n.i=this.i),this.v},set:function(n){if(n!==this.v){if(Ye>100)throw new Error("Cycle detected");this.v=n,this.i++,Me++,bt++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{Ge()}}}});function it(n){return new Z(n)}function Ms(n){for(var t=n.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function Cs(n){for(var t=n.s;t!==void 0;t=t.n){var e=t.S.n;if(e!==void 0&&(t.r=e),t.S.n=t,t.i=-1,t.n===void 0){n.s=t;break}}}function Hs(n){for(var t=n.s,e=void 0;t!==void 0;){var s=t.p;t.i===-1?(t.S.U(t),s!==void 0&&(s.n=t.n),t.n!==void 0&&(t.n.p=s)):e=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=s}n.s=e}function Ot(n){Z.call(this,void 0),this.x=n,this.s=void 0,this.g=Me-1,this.f=4}(Ot.prototype=new Z).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Me))return!0;if(this.g=Me,this.f|=1,this.i>0&&!Ms(this))return this.f&=-2,!0;var n=T;try{Cs(this),T=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return T=n,Hs(this),this.f&=-2,!0};Ot.prototype.S=function(n){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}Z.prototype.S.call(this,n)};Ot.prototype.U=function(n){if(this.t!==void 0&&(Z.prototype.U.call(this,n),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};Ot.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var n=this.t;n!==void 0;n=n.x)n.t.N()}};Object.defineProperty(Ot.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var n=ks(this);if(this.h(),n!==void 0&&(n.i=this.i),16&this.f)throw this.v;return this.v}});function Sn(n){return new Ot(n)}function Ss(n){var t=n.u;if(n.u=void 0,typeof t=="function"){bt++;var e=T;T=void 0;try{t()}catch(s){throw n.f&=-2,n.f|=8,un(n),s}finally{T=e,Ge()}}}function un(n){for(var t=n.s;t!==void 0;t=t.n)t.S.U(t);n.x=void 0,n.s=void 0,Ss(n)}function Cr(n){if(T!==this)throw new Error("Out-of-order effect");Hs(this),T=n,this.f&=-2,8&this.f&&un(this),Ge()}function ce(n){this.x=n,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}ce.prototype.c=function(){var n=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{n()}};ce.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Ss(this),Cs(this),bt++;var n=T;return T=this,Cr.bind(this,n)};ce.prototype.N=function(){2&this.f||(this.f|=2,this.o=Ft,Ft=this)};ce.prototype.d=function(){this.f|=8,1&this.f||un(this)};function ue(n){var t=new ce(n);try{t.c()}catch(e){throw t.d(),e}return t.d.bind(t)}var As,qe,Ns=[];ue(function(){As=this.N})();function qt(n,t){k[n]=t.bind(null,k[n]||function(){})}function Ce(n){qe&&qe(),qe=n&&n.S()}function $s(n){var t=this,e=n.data,s=Sr(e);s.value=e;var i=Te(function(){for(var a=t,l=t.__v;l=l.__;)if(l.__c){l.__c.__$f|=4;break}var u=Sn(function(){var p=s.value.value;return p===0?0:p===!0?"":p||""}),f=Sn(function(){return!Rn(u.value)}),h=ue(function(){if(this.N=Is,f.value){var p=u.value;a.base&&a.base.nodeType===3&&(a.base.data=p)}}),d=t.__$u.d;return t.__$u.d=function(){h(),d.call(this)},[f,u]},[]),r=i[0],o=i[1];return r.value?o.peek():o.value}$s.displayName="_st";Object.defineProperties(Z.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:$s},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});qt("__b",function(n,t){if(typeof t.type=="string"){var e,s=t.props;for(var i in s)if(i!=="children"){var r=s[i];r instanceof Z&&(e||(t.__np=e={}),e[i]=r,s[i]=r.peek())}}n(t)});qt("__r",function(n,t){Ce();var e,s=t.__c;s&&(s.__$f&=-2,(e=s.__$u)===void 0&&(s.__$u=e=function(i){var r;return ue(function(){r=this}),r.c=function(){s.__$f|=1,s.setState({})},r}())),Ce(e),n(t)});qt("__e",function(n,t,e,s){Ce(),n(t,e,s)});qt("diffed",function(n,t){Ce();var e;if(typeof t.type=="string"&&(e=t.__e)){var s=t.__np,i=t.props;if(s){var r=e.U;if(r)for(var o in r){var a=r[o];a!==void 0&&!(o in s)&&(a.d(),r[o]=void 0)}else r={},e.U=r;for(var l in s){var u=r[l],f=s[l];u===void 0?(u=Hr(e,l,f,i),r[l]=u):u.o(f,i)}}}n(t)});function Hr(n,t,e,s){var i=t in n&&n.ownerSVGElement===void 0,r=it(e);return{o:function(o,a){r.value=o,s=a},d:ue(function(){this.N=Is;var o=r.value.value;s[t]!==o&&(s[t]=o,i?n[t]=o:o?n.setAttribute(t,o):n.removeAttribute(t))})}}qt("unmount",function(n,t){if(typeof t.type=="string"){var e=t.__e;if(e){var s=e.U;if(s){e.U=void 0;for(var i in s){var r=s[i];r&&r.d()}}}}else{var o=t.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}n(t)});qt("__h",function(n,t,e,s){(s<3||s===9)&&(t.__$f|=2),n(t,e,s)});rt.prototype.shouldComponentUpdate=function(n,t){var e=this.__$u,s=e&&e.s!==void 0;for(var i in t)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var r=2&this.__$f;if(!(s||r||4&this.__$f)||1&this.__$f)return!0}else if(!(s||4&this.__$f)||3&this.__$f)return!0;for(var o in n)if(o!=="__source"&&n[o]!==this.props[o])return!0;for(var a in this.props)if(!(a in n))return!0;return!1};function Sr(n){return Te(function(){return it(n)},[])}var Ar=function(n){queueMicrotask(function(){queueMicrotask(n)})};function Nr(){Mr(function(){for(var n;n=Ns.shift();)As.call(n)})}function Is(){Ns.push(this)===1&&(k.requestAnimationFrame||Ar)(Nr)}const{round:g}=Math,$r=(n,t)=>n.x0<=t.x0&&t.x0<=n.x1&&n.y0<=t.y0&&t.y0<=n.y1||n.x0<=t.x0&&t.x0<=n.x1&&n.y0<=t.y1&&t.y1<=n.y1||n.x0<=t.x1&&t.x1<=n.x1&&n.y0<=t.y0&&t.y0<=n.y1||n.x0<=t.x1&&t.x1<=n.x1&&n.y0<=t.y1&&t.y1<=n.y1,Ir=(n,t)=>n.x0<=t.x0&&t.x0<=n.x1&&n.x0<=t.x1&&t.x1<=n.x1&&n.y0<=t.y0&&t.y0<=n.y1&&n.y0<=t.y1&&t.y1<=n.y1,Lr=["input","textarea","select","INPUT","TEXTAREA","SELECT"];function Ls(n){return n instanceof Element&&Lr.includes(n.tagName)}function Tr(){const{activeElement:n}=document;Ls(n)&&n.blur()}const I={None:0,Shift:1,Alt:2,Control:4,Meta:8,of:n=>{let t=I.None;return n.shiftKey&&(t|=I.Shift),n.altKey&&(t|=I.Alt),n.ctrlKey&&(t|=I.Control),n.metaKey&&(t|=I.Meta),t}};function Ts(...n){const t=n.map(Pr);return e=>{if(Ls(e.target))return!0;const s=I.of(e);for(const i of t)if((i.key==="any"||i.key===e.key||i.key===e.code)&&i.mod===s&&i.handler(e,s)!==!1)return e.preventDefault(),!0;return!1}}function Pr([n,t]){let e="",s=I.None;const i=n.split("+");for(;i.length>0;){const r=i.shift();switch(r){case"Shift":s|=I.Shift;break;case"Alt":s|=I.Alt;break;case"Ctrl":s|=I.Control;break;case"Meta":s|=I.Meta;break;default:e=r;break}}return{key:e,mod:s,handler:t}}const O=4,q=2,B=1,Er=[O|q|B,O|B,O|q,O,0,q,B,q|B],Dr=[O,O|q,O|B,O|q|B,q|B,B,q,0],Gr=[q,q|B,0,B,O|q,O|B|q,O,O|B],Or=[B,0,q|B,q,O|B,O,O|q|B,O|q],qr=(n,t)=>{switch(t){case"rl":return Er[n]??0;case"rr":return Dr[n]??0;case"mx":return Gr[n]??0;case"my":return Or[n]??0}return 0},Br=(n,t)=>{let[e,s,i]=n,r=0;return t&O&&(r=s,s=-i,i=r),t&q&&(s=-s),t&B&&(i=-i),[e,s,i]},ht=n=>n.charAt(0),ft=n=>n.charAt(1),zr=(n,t)=>{let e=ht(n),s=ft(n);switch(t){case"mx":switch(e){case"l":e="r";break;case"r":e="l";break}break;case"my":switch(s){case"t":s="b";break;case"b":s="t";break}break}return`${e}${s}`},Ps=(n,t)=>{if(t&O)switch(n){case"lt":n="rt";break;case"lm":n="ct";break;case"lb":n="lt";break;case"ct":n="rm";break;case"cb":n="lm";break;case"rt":n="rb";break;case"rm":n="cb";break;case"rb":n="lb";break}let e=ht(n),s=ft(n);if(t&q)switch(e){case"l":e="r";break;case"r":e="l";break}if(t&B)switch(s){case"t":s="b";break;case"b":s="t";break}return`${e}${s}`},Ur=(n,t)=>{switch(n[0]){case"l":return Wr(n,t);case"c":return Fr(n,t);case"a":return Rr(n,t);case"t":return jr(n,t)}return n},Wr=(n,t)=>{let[e,s,i,r,o]=n,a=0;return t&O&&(a=s,s=-i,i=a,a=r,r=-o,o=a),t&q&&(s=-s,r=-r),t&B&&(i=-i,o=-o),[e,s,i,r,o]},Fr=(n,t)=>{let[e,s,i,r]=n,o=0;return t&O&&(o=s,s=-i,i=o),t&q&&(s=-s),t&B&&(i=-i),[e,s,i,r]},Rr=(n,t)=>{let[e,s,i,r,o,a]=n,l=0;return t&O&&(l=s,s=-i,i=l,o+=90,a+=90),t&q&&(s=-s,l=o,o=180-a,a=180-l),t&B&&(i=-i,l=o,o=-a,a=-l),[e,s,i,r,o,a]},jr=(n,t)=>{let[e,s,i,r,o]=n;r=Ps(r,t);let a=0;return t&O&&(a=s,s=-i,i=a),t&q&&(s=-s),t&B&&(i=-i),[e,s,i,r,o]},Zr=(n,t)=>{let[e,s,i]=n;i=Ps(i,t);let r=0;return t&O&&(r=e,e=-s,s=r),t&q&&(e=-e),t&B&&(s=-s),[e,s,i]},Es=({shapes:n,pins:t},e,s)=>{const i={x:0,y:0},r={x:0,y:0};for(const o of n)switch(o[0]){case"l":{const[a,l,u,f,h]=o;i.x=Math.min(i.x,l,f),i.y=Math.min(i.y,u,h),r.x=Math.max(r.x,l,f),r.y=Math.max(r.y,u,h);break}case"c":{const[a,l,u,f]=o;i.x=Math.min(i.x,l-f,l+f),i.y=Math.min(i.y,u-f,u+f),r.x=Math.max(r.x,l-f,l+f),r.y=Math.max(r.y,u-f,u+f);break}case"a":{const[a,l,u,f,h,d]=o;i.x=Math.min(i.x,l-f,l+f),i.y=Math.min(i.y,u-f,l+f),r.x=Math.max(r.x,l-f,u+f),r.y=Math.max(r.y,u-f,u+f);break}}for(const[o,a,l]of t)i.x=Math.min(i.x,a),i.y=Math.min(i.y,l),r.x=Math.max(r.x,a),r.y=Math.max(r.y,l);return{x0:e+i.x,y0:s+i.y,x1:e+r.x,y1:s+r.y}};let Xr=0;function Yr(){return Xr+=1}class Kr{#t=Yr();get id(){return this.#t}}class An{#t=new Map;[Symbol.iterator](){return this.#t.values()}append(t){for(const e of t)this.#t.set(e.id,e);return this}delete(t){for(const e of t)this.#t.delete(e);return this}}let hn=class extends Kr{includes(t,e){const{x0:s,y0:i,x1:r,y1:o}=this.area;return s<=t&&t<=r&&i<=e&&e<=o}};class Ds{static anonymous(t){return`${t}?`}#t=new Map;constructor(t){for(const e of t)if(e instanceof pt){const s=this.#n(e.symbol.prefix);s.instances.push(e),s.names.add(e.name)}}getUniqueName(t){const e=this.#n(t);let s=1;for(;;){const i=`${t}${s}`;if(!e.names.has(i))return e.names.add(i),i;s+=1}}rename(t="none"){for(const[e,s]of this.#t.entries()){switch(t){case"none":break;case"horizontal":s.instances.sort((i,r)=>i.x-r.x||i.y-r.y);break;case"vertical":s.instances.sort((i,r)=>i.y-r.y||i.x-r.x);break}s.names.clear();for(const i of s.instances)i.name=this.getUniqueName(e)}}#n(t){let e=this.#t.get(t);return e==null&&this.#t.set(t,e={instances:[],names:new Set}),e}}const Pt=Jr();function Jr(){const n=()=>{throw new Error("unusable")};return new Proxy(Object.create(null),{apply:n,construct:n,defineProperty:n,deleteProperty:n,get:n,getOwnPropertyDescriptor:n,getPrototypeOf:n,has:n,isExtensible:n,ownKeys:n,preventExtensions:n,set:n,setPrototypeOf:n})}class se{static create({device:t}){const e=new se;return e.#t=new m(t?.propsSchema??{}),e}#t=Pt;constructor(){}setValue(t,e){return this.#t.set(t,e),this.#n()}import(t){return this.#n()}export(){return{}}#n(){const t=new se;return t.#t=this.#t,this.#t=Pt,t}}class pt extends hn{#t;#n;#s;#e;#a;#i;#o=null;#r=null;#c=null;#l=null;constructor(t,e=Ds.anonymous(t.prefix),s=se.create(t),i=0,r=0,o=0){super(),this.#t=t,this.#n=e,this.#s=s,this.#e=i,this.#a=r,this.#i=o}get symbol(){return this.#t}get name(){return this.#n}set name(t){this.#n=t}get props(){return this.#s}set props(t){this.#s=t}get x(){return this.#e}get y(){return this.#a}get transform(){return this.#i}moveTo(t,e){this.#e=t,this.#a=e,this.#l=null}transformBy(t,e,s){const i=this.#e,r=this.#a;switch(t){case"rl":this.#e=e+(r-s),this.#a=s-(i-e);break;case"rr":this.#e=e-(r-s),this.#a=s+(i-e);break;case"mx":this.#e=2*e-i;break;case"my":this.#a=2*s-r;break}this.#i=qr(this.#i,t),this.#o=null,this.#r=null,this.#c=null,this.#l=null}get area(){return this.#l??=Es(this,this.#e,this.#a)}get shapes(){return this.#o??=this.#t.shapes.map(t=>Ur(t,this.#i))}get pins(){return this.#r??=this.#t.pins.map(t=>Br(t,this.#i))}get labels(){return this.#c??=Zr(this.#t.labels,this.#i)}}const Qr=(n,t)=>{switch(t){case"rl":switch(n){case"h":return"v";case"v":return"h"}break;case"rr":switch(n){case"h":return"v";case"v":return"h"}break}return n};class Bt extends hn{#t;#n;#s;#e;#a;#i;#o;#r=null;constructor(t,e="lt",s="h",i=0,r=0){super(),this.#t=t.trim(),this.#n=e,this.#s=s,this.#e=i,this.#a=r,this.#i=0,this.#o=0,this.#r=null}get text(){return this.#t}set text(t){this.#t=t.trim(),this.#i=0,this.#o=0,this.#r=null}get align(){return this.#n}set align(t){this.#n=t,this.#r=null}get dir(){return this.#s}set dir(t){this.#s=t,this.#r=null}get x(){return this.#e}get y(){return this.#a}get width(){return this.#i}set width(t){this.#i=t,this.#r=null}get height(){return this.#o}set height(t){this.#o=t,this.#r=null}moveTo(t,e){this.#e=t,this.#a=e,this.#r=null}transformBy(t,e,s){const i=this.#e,r=this.#a;switch(t){case"rl":this.#e=e+(r-s),this.#a=s-(i-e);break;case"rr":this.#e=e-(r-s),this.#a=s+(i-e);break;case"mx":this.#e=2*e-i;break;case"my":this.#a=2*s-r;break}this.#n=zr(this.#n,t),this.#s=Qr(this.#s,t),this.#r=null}get area(){return this.#r??=this.#c()}#c(){let t=0,e=0,s=0,i=0;switch(this.#s){case"h":switch(ht(this.#n)){case"l":t=this.#e,s=this.#e+this.#i;break;case"c":t=this.#e-this.#i/2,s=this.#e+this.#i/2;break;case"r":t=this.#e-this.#i,s=this.#e;break}switch(ft(this.#n)){case"t":e=this.#a,i=this.#a+this.#o;break;case"m":e=this.#a-this.#o/2,i=this.#a+this.#o/2;break;case"b":e=this.#a-this.#o,i=this.#a;break}break;case"v":switch(ht(this.#n)){case"l":e=this.#a-this.#i,i=this.#a;break;case"c":e=this.#a-this.#i/2,i=this.#a+this.#i/2;break;case"r":e=this.#a,i=this.#a+this.#i;break}switch(ft(this.#n)){case"t":t=this.#e,s=this.#e+this.#o;break;case"m":t=this.#e-this.#o/2,s=this.#e+this.#o/2;break;case"b":t=this.#e-this.#o,s=this.#e;break}break}return{x0:t,y0:e,x1:s,y1:i}}}class F extends hn{#t;#n;#s;#e;#a;constructor(t,e,s,i){super(),this.#t=t,this.#n=e,this.#s=s,this.#e=i,this.#a=null}get x0(){return this.#t}set x0(t){this.#t=t,this.#a=null}get y0(){return this.#n}set y0(t){this.#n=t,this.#a=null}get x1(){return this.#s}set x1(t){this.#s=t,this.#a=null}get y1(){return this.#e}set y1(t){this.#e=t,this.#a=null}get x(){return this.#t}get y(){return this.#n}moveTo(t,e){const s=this.#t,i=this.#n,r=this.#s,o=this.#e;this.#t=t,this.#n=e,this.#s=t+(r-s),this.#e=e+(o-i),this.#a=null}transformBy(t,e,s){const i=this.#t,r=this.#n,o=this.#s,a=this.#e;switch(t){case"rl":this.#t=e+(r-s),this.#n=s-(i-e),this.#s=e+(a-s),this.#e=s-(o-e);break;case"rr":this.#t=e-(r-s),this.#n=s+(i-e),this.#s=e-(a-s),this.#e=s+(o-e);break;case"mx":this.#t=2*e-i,this.#s=2*e-o;break;case"my":this.#n=2*s-r,this.#e=2*s-a;break}this.#a=null}get area(){return this.#a??={x0:Math.min(this.#t,this.#s),y0:Math.min(this.#n,this.#e),x1:Math.max(this.#t,this.#s),y1:Math.max(this.#n,this.#e)}}includes(t,e){if(this.#n===this.#e){const h=this.#n,d=Math.min(this.#t,this.#s),p=Math.max(this.#t,this.#s);return d<=t&&t<=p&&h-3<=e&&e<=h+3}if(this.#t===this.#s){const h=this.#t,d=Math.min(this.#n,this.#e),p=Math.max(this.#n,this.#e);return d<=e&&e<=p&&h-3<=t&&t<=h+3}const i=Math.abs((this.#e-this.#n)*t-(this.#s-this.#t)*e+this.#s*this.#n-this.#e*this.#t),r=Math.sqrt((this.#e-this.#n)*(this.#e-this.#n)+(this.#s-this.#t)*(this.#s-this.#t)),o=i/r,a=Math.min(this.#t,this.#s),l=Math.min(this.#n,this.#e),u=Math.max(this.#t,this.#s),f=Math.max(this.#n,this.#e);return a<=t&&t<=u&&l<=e&&e<=f&&o<=3}}function Be(n){return n===I.None?"l":n===I.Shift?"r":n===I.Alt?"d":"l"}function to(n,t,e,s,i){return n===e&&t===s?[]:i==="d"?[new F(n,t,e,s)]:t===s?[new F(n,t,e,s)]:n===e?[new F(n,t,e,s)]:i==="l"?[new F(n,t,e,t),new F(e,t,e,s)]:[new F(n,t,n,s),new F(n,s,e,s)]}function eo(n){const t=new no,e=new so;for(const i of n)if(i instanceof F){const{x0:r,y0:o,x1:a,y1:l}=i;if(o===l){t.addWire(o,i);continue}if(r===a){e.addWire(r,i);continue}continue}for(const i of n){if(i instanceof pt){for(const[r,o,a]of i.pins){const l=i.x+o,u=i.y+a;t.split(u,l,n),e.split(l,u,n)}continue}if(i instanceof F){const{x0:r,y0:o,x1:a,y1:l}=i;if(r===a&&o===l)continue;if(o===l){e.split(r,o,n),e.split(a,o,n);continue}if(r===a){t.split(o,r,n),t.split(l,r,n);continue}e.split(r,o,n),e.split(a,l,n),t.split(o,r,n),t.split(l,a,n);continue}}t.merge(),e.merge();let s=0;for(;s<n.length;){const i=n[s];if(i instanceof F){const{x0:r,y0:o,x1:a,y1:l}=i;if(r===a&&o===l){n.splice(s,1);continue}}s+=1}}class no{lines=new Map;addWire(t,e){const{x0:s,x1:i}=e;e.x0=Math.min(s,i),e.x1=Math.max(s,i),e.y0=t,e.y1=t;let r=this.lines.get(t);r==null&&this.lines.set(t,r={wires:[],breakpoints:[]}),r.wires.push(e)}split(t,e,s){let i=this.lines.get(t);if(i!=null){i.breakpoints.push(e);for(const r of i.wires)if(r.x0<e&&e<r.x1){const o=new F(e,t,r.x1,t);s.push(o),i.wires.push(o),r.x1=e}}}merge(){for(const{wires:t,breakpoints:e}of this.lines.values()){t.sort((i,r)=>i.x0-r.x0);let s=1;for(;s<t.length;){const i=t[s-1],r=t[s],o=e.indexOf(i.x1),a=e.indexOf(r.x0);(o===-1||a===-1||o!==a)&&i.x1>=r.x0&&(r.x0=i.x0,r.x1=Math.max(i.x1,r.x1),i.x1=i.x0),s+=1}}}}class so{lines=new Map;addWire(t,e){const{y0:s,y1:i}=e;e.y0=Math.min(s,i),e.y1=Math.max(s,i),e.x0=t,e.x1=t;let r=this.lines.get(t);r==null&&this.lines.set(t,r={wires:[],breakpoints:[]}),r.wires.push(e)}split(t,e,s){let i=this.lines.get(t);if(i!=null){i.breakpoints.push(e);for(const r of i.wires)if(r.y0<e&&e<r.y1){const o=new F(t,e,t,r.y1);s.push(o),i.wires.push(o),r.y1=e}}}merge(){for(const{wires:t,breakpoints:e}of this.lines.values()){t.sort((i,r)=>i.y0-r.y0);let s=1;for(;s<t.length;){const i=t[s-1],r=t[s],o=e.indexOf(i.y1),a=e.indexOf(r.y0);(o===-1||a===-1||o!==a)&&i.y1>=r.y0&&(r.y0=i.y0,r.y1=Math.max(i.y1,r.y1),i.y1=i.y0),s+=1}}}}function ie(n){const t=[];for(const e of n){if(e instanceof pt){const{x:s,y:i,transform:r,symbol:o,name:a,props:l}=e;t.push(["i",s,i,r,o.id,a,l.export()])}if(e instanceof F){const{x0:s,y0:i,x1:r,y1:o}=e;t.push(["w",s,i,r,o])}if(e instanceof Bt){const{x:s,y:i,align:r,dir:o,text:a}=e;t.push(["n",s,i,r,o,a])}}return t}function Et(n){const t=[];for(const e of n)switch(e[0]){case"i":{const[s,i,r,o,a,l,u]=e,f=xs.get(a);t.push(new pt(f,l,se.create(f).import(u),i,r,o));break}case"w":{const[s,i,r,o,a]=e;t.push(new F(i,r,o,a));break}case"n":{const[s,i,r,o,a,l]=e;t.push(new Bt(l,o,a,i,r));break}}return t}const pe=new class{#t=[];get full(){return this.#t.length>0}take(){return Et(this.#t)}put(t){this.#t=ie(t)}clear(){this.#t=[]}};function io(n){const t=[];for(const e of n)e instanceof pt&&t.push(e);return t}function ro(n){const t=[];for(const e of n)e instanceof F&&t.push(e);return t}function oo(n){const t=[];for(const e of n)e instanceof Bt&&t.push(e);return t}const Rt={instance:1,note:2,wire:4096,notWire:4095,all:65535};function Nn(n,t,e,s=Rt.all){for(const i of n)if(s&ao(i)&&i.includes(t,e))return i;return null}function ao(n){switch(!0){case n instanceof pt:return Rt.instance;case n instanceof Bt:return Rt.note;case n instanceof F:return Rt.wire}return 0}class lo{#t;#n;#s;constructor(t,e,s){this.#t=t,this.#n=e,this.#s=s}get name(){return this.#t}get elements(){return this.#n}get pins(){return this.#s}}class co{#t;#n;#s;#e;constructor(t,e,s,i){this.#t=t,this.#n=e,this.#s=s,this.#e=i}get x(){return this.#t}get y(){return this.#n}get instance(){return this.#s}get name(){return this.#e}}function uo(){const n=[],t=[],e=[];return new class{get pins(){return n}get joins(){return t}get nodes(){return e}getWires(){return null}getPins(){return null}}}function ho(n){const t=[],e=[],s=[],i=new Map,r=new po(i,e,s);for(const o of n){if(o instanceof pt){for(const[a,l,u]of o.pins){const f=o.x+l,h=o.y+u,d=new co(f,h,o,a);t.push(d),r.addPin(d)}continue}o instanceof F&&r.addWire(o)}return r.connect(),new class{get pins(){return t}get joins(){return e}get nodes(){return s}getWires(o,a){return i.get(jt(o,a))?.wires??null}getPins(o,a){return i.get(jt(o,a))?.pins??null}}}const fo=new Set([ne.vdc,ne.idc,K.opamp,K.npn,K.pnp,K.nmos,K.pmos,K.nfet,K.pfet]);class po{cells;joins;nodes;names;constructor(t,e,s){this.cells=t,this.joins=e,this.nodes=s,this.names=new Set(["ground"])}addPin(t){this.getCell(t.x,t.y).pins.push(t)}addWire(t){this.getCell(t.x0,t.y0).wires.push(t),this.getCell(t.x1,t.y1).wires.push(t)}getCell(t,e){const s=jt(t,e);let i=this.cells.get(s);return i==null&&this.cells.set(s,i={x:t,y:e,wires:[],pins:[],color:null}),i}connect(){this.connectGrounds(),this.connectPorts(),this.connectWithSuggestedNames();let t=1;for(const e of this.cells.values())e.pins.length>0&&e.color==null&&(this.walk([e],this.getColor(this.getUniqueName(`_n${t}`))),t+=1);for(const e of this.cells.values())e.wires.length+e.pins.length>2&&this.joins.push({x:e.x,y:e.y})}connectGrounds(){const t=this.getColor("ground");for(const e of this.cells.values())for(const s of e.pins)if(s.instance.symbol===ut.ground){if(t.elements.push(s.instance),e.color==null)this.walk([e],t);else if(e.color!==t){this.conflict(t,e);return}}}connectPorts(){const t=new Map;for(const e of this.cells.values())for(const s of e.pins)if(s.instance.symbol===ut.port){const{name:i}=s.instance;this.names.add(i);let r=t.get(i);if(r==null&&t.set(i,r=this.getColor(i)),r.elements.push(s.instance),e.color==null)this.walk([e],r);else if(e.color!==r){this.conflict(r,e);return}}}connectWithSuggestedNames(){for(const t of this.cells.values())for(const e of t.pins)if(fo.has(e.instance.symbol)&&t.color==null){const s=`_${e.instance.name}_${e.name}`;this.walk([t],this.getColor(this.getUniqueName(s)))}}conflict(t,e){console.warn(`Node naming conflict: [${t.node.name}] and [${e.color.node.name}]`),this.nodes.length=0}walk(t,e){for(;;){const s=t.pop();if(s==null)break;s.color=e;for(const i of s.wires){e.elements.push(i);const r=s.x===i.x1&&s.y===i.y1?jt(i.x0,i.y0):jt(i.x1,i.y1),o=this.cells.get(r);o!=null&&o.color==null&&t.push(o)}for(const i of s.pins)e.pins.push(i)}}getColor(t){const e=[],s=[],i=new lo(t,e,s);return this.nodes.push(i),{node:i,elements:e,pins:s}}getUniqueName(t){if(this.names.has(t)){let e=1;for(;;){let s=`${t}_${e}`;if(!this.names.has(s)){t=s;break}e+=1}}return this.names.add(t),t}}function jt(n,t){return t+32768<<16|n+32768<<0}class wt{static create(t){const e=new wt;return e.#t=new _o(t),e}#t=Pt;#n=null;#s=null;#e=null;constructor(){}[Symbol.iterator](){return this.#t[Symbol.iterator]()}get instances(){return this.#n??=io(this.#t)}get notes(){return this.#s??=oo(this.#t)}get wires(){return this.#e??=ro(this.#t)}get network(){return this.#t.network}get names(){return this.#t.names}append(t){return this.#t.append(t),this.#a()}delete(t){return this.#t.delete(t),this.#a()}unwire(){return this.#t.unwire(),this.#a()}rewire(){return this.#t.rewire(),this.#a()}rename(t="none"){return this.#t.names.rename(t),this.#a()}edit(t){switch(t.type){case"set-note-text":{const{note:e,text:s}=t;e.text!==s&&(e.text=s);break}case"set-note-align":{const{note:e,align:s}=t;e.align!==s&&(e.align=s);break}case"set-note-dir":{const{note:e,dir:s}=t;e.dir!==s&&(e.dir=s);break}case"set-instance-prop":{const{instance:e,name:s,value:i}=t;e.props=e.props.setValue(s,i);break}}return this.#t.rewire(),this.#a()}#a(){const t=new wt;return t.#t=this.#t,this.#t=Pt,this.#n=null,this.#s=null,this.#e=null,t}}const mo={rewire:n=>{},connect:n=>uo()},$n={rewire:eo,connect:ho};let _o=class{#t;#n;#s;#e;constructor(t){this.#t=[],this.#n=$n,this.#s=null,this.#e=null,this.append(t)}[Symbol.iterator](){return this.#t[Symbol.iterator]()}get network(){return this.#s??=this.#n.connect(this.#t)}get names(){return this.#e??=new Ds(this.#t)}append(t){this.#t=[...new An().append(this.#t).append(t)],this.#n.rewire(this.#t),this.#s=null,this.names.rename()}delete(t){this.#t=[...new An().append(this.#t).delete(t)],this.#n.rewire(this.#t),this.#s=null,this.names.rename()}unwire(){this.#n=mo,this.#s=null}rewire(){this.#n=$n,this.#s=null}};class He{static create(t){const e=new He;return e.#t=new vo(t),e}#t=Pt;constructor(){}push(t,e){return this.#t.push(t,e),this.#n()}get canUndo(){return this.#t.canUndo}undo(){return[this.#t.undo(),this.#n()]}get canRedo(){return this.#t.canRedo}redo(){return[this.#t.redo(),this.#n()]}#n(){const t=new He;return t.#t=this.#t,this.#t=Pt,t}}class vo{#t;#n;constructor(t){this.#t=[[ie(t),"initial"]],this.#n=0}get length(){return this.#t.length}push(t,e){this.#n+=1,this.#t.splice(this.#n),this.#t.push([ie(t),e])}get canUndo(){return this.#n>0}undo(){this.canUndo&&(this.#n-=1);const[t]=this.#t[this.#n];return wt.create(Et(t))}get canRedo(){return this.#n<this.#t.length-1}redo(){this.canRedo&&(this.#n+=1);const[t]=this.#t[this.#n];return wt.create(Et(t))}}class In{#t;#n;constructor(t){this.#t=[...t],this.#n=[...t].map(e=>({element:e,x:e.x,y:e.y}))}get elements(){return this.#t}moveBy(t,e){for(const{element:s,x:i,y:r}of this.#n)s.moveTo(i+t,r+e)}reset(){for(const{element:t,x:e,y:s}of this.#n)t.moveTo(e,s)}}const et=10,go=4,yo=30;class V{static defaultZoom=new V;#t;#n;#s;#e;static snap(t){return g(t/et)*et}static floor(t){return Math.floor(t/et)*et}static ceil(t){return Math.ceil(t/et)*et}constructor(t=et,e=0,s=0){t=g(t),e=g(e),s=g(s),t=Math.max(go,t),t=Math.min(yo,t),this.#t=t,this.#n=e,this.#s=s,this.#e=t/et}get gridSize(){return this.#t}get x(){return this.#n}get y(){return this.#s}get scale(){return this.#e}scaleTo(t){return new V(et*t,this.#n,this.#s)}scaleBy(t){return new V(et*(this.#e+t),this.#n,this.#s)}zoomTo(t){return new V(t,this.#n,this.#s)}zoomBy(t){return new V(this.#t+t,this.#n,this.#s)}moveTo(t,e){return new V(this.#t,t,e)}moveBy(t,e){return new V(this.#t,this.#n+t,this.#s+e)}toGridX(t){return g((t-this.#n)/this.#e)}toGridY(t){return g((t-this.#s)/this.#e)}toScreenX(t){return g(t*this.#e+this.#n)}toScreenY(t){return g(t*this.#e+this.#s)}snapScreenX(t){return this.toScreenX(V.snap(this.toGridX(t)))}snapScreenY(t){return this.toScreenY(V.snap(this.toGridY(t)))}static center(t,e,s,i=!1){const r=s.x1-s.x0,o=s.y1-s.y0;let a=V.defaultZoom;return i&&r>0&&o>0&&(a=a.scaleTo(Math.min(t/(r+et*2),e/(o+et*2)))),a.moveTo(t/2-(r/2+s.x0)*a.scale,e/2-(o/2+s.y0)*a.scale)}}it(new V);const E={symbol:{normal:"#222222",selected:"#0000ff"},pin:{normal:"#222222",selected:"#0000ff"},pinFill:{normal:"#ffffff",selected:"#ffffff"},wire:{normal:"#222222",selected:"#0000ff"},outline:"#22222222",selection:"#0000ff11",gridFine:"#00000066",gridCoarse:"#000000FF",crosshair:"#0000FF66"},x=.5;class Gs{#t;#n;constructor(t){this.#t=t,this.#n=t.getContext("2d")}get canvas(){return this.#t}get ctx(){return this.#n}get width(){return this.#t.width}get height(){return this.#t.height}reset(){this.#n.reset()}paintGrid(t){const e=t.scale,s=t.x,i=t.y,r=t.gridSize,o=10,a=s%r,l=s%(r*o),u=i%r,f=i%(r*o);this.#e((h,d,p)=>{if(e>=1){h.strokeStyle=E.gridFine,h.lineWidth=1,h.lineCap="butt",h.setLineDash([1,r-1]);for(let _=u;_<p;_+=r)h.beginPath(),h.moveTo(a,_+x),h.lineTo(d,_+x),h.stroke()}}),this.#e((h,d,p)=>{h.strokeStyle=e>=1?E.gridCoarse:E.gridFine,h.lineWidth=1,h.lineCap="butt",h.setLineDash([1,r-1]);for(let _=f;_<p;_+=r*o)h.beginPath(),h.moveTo(a,_+x),h.lineTo(d,_+x),h.stroke();for(let _=l;_<d;_+=r*o)h.beginPath(),h.moveTo(_+x,u),h.lineTo(_+x,p),h.stroke()}),this.#e((h,d,p)=>{h.strokeStyle=E.gridFine,h.lineWidth=1,h.lineCap="butt",h.beginPath(),h.moveTo(g(s-10*e)+x,g(i)+x),h.lineTo(g(s+10*e)+x,g(i)+x),h.moveTo(g(s)+x,g(i-10*e)+x),h.lineTo(g(s)+x,g(i+10*e)+x),h.stroke()})}paintCrosshair(t,{x:e,y:s},i){this.#e((r,o,a)=>{i?(r.strokeStyle=E.crosshair,r.lineWidth=1,r.lineCap="butt"):(r.strokeStyle=E.outline,r.lineWidth=1,r.lineCap="butt"),r.beginPath(),r.moveTo(0,t.snapScreenY(s)+x),r.lineTo(o,t.snapScreenY(s)+x),r.moveTo(t.snapScreenX(e)+x,0),r.lineTo(t.snapScreenX(e)+x,a),r.stroke()})}paintSelection(t,e,s){this.#e(i=>{i.fillStyle=E.selection,i.fillRect(g(e.x),g(e.y),g(s.x-e.x),g(s.y-e.y))})}paintInstance(t,e,s=!1){const i=t.scale,r=t.x,o=t.y,a=e.x,l=e.y;this.#e(u=>{s?(u.fillStyle=E.symbol.selected,u.strokeStyle=E.symbol.selected,u.lineWidth=3,u.lineCap="square"):(u.fillStyle=E.symbol.normal,u.strokeStyle=E.symbol.normal,u.lineWidth=1,u.lineCap="square");for(const f of e.shapes)switch(f[0]){case"l":{const[h,d,p,_,b]=f;u.beginPath(),u.moveTo(g(r+(a+d)*i)+x,g(o+(l+p)*i)+x),u.lineTo(g(r+(a+_)*i)+x,g(o+(l+b)*i)+x),u.stroke();break}case"c":{const[h,d,p,_]=f;u.beginPath(),u.ellipse(g(r+(a+d)*i)+x,g(o+(l+p)*i)+x,g(_*i),g(_*i),0,0,2*Math.PI),u.stroke();break}case"a":{const[h,d,p,_,b,v]=f;u.beginPath(),u.ellipse(g(r+(a+d)*i)+x,g(o+(l+p)*i)+x,g(_*i),g(_*i),0,b*(Math.PI/180),v*(Math.PI/180)),u.stroke();break}case"t":{const[h,d,p,_,b]=f;this.#s(u,t,_),u.fillText(b,r+(a+d)*i,o+(l+p)*i);break}}})}paintPins(t,e,s=!1){const i=t.scale,r=t.x,o=t.y,a=e.x,l=e.y;this.#e(u=>{s?(u.fillStyle=E.pinFill.selected,u.strokeStyle=E.pin.selected,u.lineWidth=3,u.lineCap="square"):(u.fillStyle=E.pinFill.normal,u.strokeStyle=E.pin.normal,u.lineWidth=1,u.lineCap="square");for(const f of e.pins){const[h,d,p]=f;u.beginPath(),u.ellipse(g(r+(a+d)*i)+x,g(o+(l+p)*i)+x,g(3*i),g(3*i),0,0,2*Math.PI),u.fill(),u.stroke()}})}paintLabels(t,e,s=!1){const i=t.scale,r=t.x,o=t.y,a=e.x,l=e.y;this.#e(u=>{s?u.fillStyle=E.symbol.selected:u.fillStyle=E.symbol.normal;const[f,h,d]=e.labels;this.#s(u,t,d),u.fillText(e.name,r+(a+f)*i,o+(l+h)*i)})}paintWire(t,e,s=!1){const i=t.scale,r=t.x,o=t.y;this.#e(a=>{s?(a.strokeStyle=E.wire.selected,a.lineWidth=3,a.lineCap="square"):(a.strokeStyle=E.wire.normal,a.lineWidth=1,a.lineCap="square");const{x0:l,y0:u,x1:f,y1:h}=e;a.beginPath(),a.moveTo(g(r+l*i)+x,g(o+u*i)+x),a.lineTo(g(r+f*i)+x,g(o+h*i)+x),a.stroke()})}paintJoins(t,e){const s=t.scale,i=t.x,r=t.y;this.#e(o=>{o.fillStyle=E.wire.normal;for(const{x:a,y:l}of e)o.beginPath(),o.ellipse(g(i+a*s)+x,g(r+l*s)+x,g(3*s),g(3*s),0,0,2*Math.PI),o.fill()})}paintOrigin(t,{x:e,y:s},i){const r=t.scale,o=t.x,a=t.y;this.#e(l=>{i?(l.strokeStyle=E.symbol.selected,l.lineWidth=1,l.lineCap="butt"):(l.strokeStyle=E.outline,l.lineWidth=1,l.lineCap="butt"),l.beginPath(),l.moveTo(g(o+(e-10)*r)+x,g(a+s*r)+x),l.lineTo(g(o+(e+10)*r)+x,g(a+s*r)+x),l.moveTo(g(o+e*r)+x,g(a+(s-10)*r)+x),l.lineTo(g(o+e*r)+x,g(a+(s+10)*r)+x),l.stroke()})}paintArea(t,{x0:e,y0:s,x1:i,y1:r},o){const a=t.scale,l=t.x,u=t.y;this.#e(f=>{o?(f.strokeStyle=E.symbol.selected,f.lineWidth=1,f.lineCap="square"):(f.strokeStyle=E.outline,f.lineWidth=1,f.lineCap="square"),f.strokeRect(g(l+e*a)+x,g(u+s*a)+x,g((i-e)*a),g((r-s)*a))})}paintSymbolIcon(t,e,s){const i=Es(t,0,0),r=V.center(e,s,i,!0);this.paintInstance(r,{x:0,y:0,shapes:t.shapes})}#s(t,e,s){switch(t.font=`${20*e.scale}px serif`,ht(s)){case"l":t.textAlign="left";break;case"c":t.textAlign="center";break;case"r":t.textAlign="right";break}switch(ft(s)){case"t":t.textBaseline="top";break;case"m":t.textBaseline="middle";break;case"b":t.textBaseline="bottom";break}}#e=t=>{const e=this.#n;e.save(),t(e,this.#t.width,this.#t.height),e.restore()}}class R{#t;constructor(t=[]){this.#t=new Set;for(const{id:e}of t)this.#t.add(e)}[Symbol.iterator](){return this.#t[Symbol.iterator]()}get size(){return this.#t.size}get full(){return this.#t.size>0}has({id:t}){return this.#t.has(t)}filter(t){return[...t].filter(({id:e})=>this.#t.has(e))}select(t){return new R(t)}add(t){const e=new R;for(const s of this.#t)e.#t.add(s);for(const{id:s}of t)e.#t.add(s);return e}delete(t){const e=new R;for(const s of this.#t)e.#t.add(s);for(const{id:s}of t)e.#t.delete(s);return e}clear(){return new R}}function Se(n,t){const e={x:1/0,y:1/0},s={x:-1/0,y:-1/0};for(const i of n)t||i instanceof F?(e.x=Math.min(e.x,i.area.x0),e.y=Math.min(e.y,i.area.y0),s.x=Math.max(s.x,i.area.x1),s.y=Math.max(s.y,i.area.y1)):(e.x=Math.min(e.x,i.x),e.y=Math.min(e.y,i.y),s.x=Math.max(s.x,i.x),s.y=Math.max(s.y,i.y));return e.x<=s.x&&e.y<=s.y?{x0:e.x,y0:e.y,x1:s.x,y1:s.y}:{x0:0,y0:0,x1:0,y1:0}}function bo(n,t){const e=Se(n,!1);let s=0,i=0;switch(ht(t)){case"l":s=e.x0;break;case"c":s=V.snap((e.x0+e.x1)/2);break;case"r":s=e.x1;break}switch(ft(t)){case"t":i=e.y0;break;case"m":i=V.snap((e.y0+e.y1)/2);break;case"b":i=e.y1;break}for(const r of n)r.moveTo(r.x-s,r.y-i)}function wo(n,t){const e=Se(n,!1),s=V.snap((e.x0+e.x1)/2),i=V.snap((e.y0+e.y1)/2);for(const r of n)r.transformBy(t,s,i)}class Vo{#t={current:null};#n;#s;#e;#a;#i;#o;#r;#c;#l;constructor(t,e){this.#n=t,this.#s=it({showGrid:!0,showCrosshair:!0}),this.#e=it(e),this.#a=it(He.create(e)),this.#i=it(new V),this.#o=it(new R),this.#r=it({type:"idle",cursor:{x:100,y:100},hovered:null});const s=o=>()=>{this.#i.value=this.#i.value.zoomBy(o)},i=(o,a)=>()=>{this.#i.value=this.#i.value.moveBy(o,a)},r=o=>()=>{this.pasteInstance(o)};this.#c=Ts(["Digit0",()=>{this.zoomTo("0")}],["Equal",s(1)],["Minus",s(-1)],["Home",()=>{this.zoomTo("1")}],["Space",()=>{this.zoomTo("all")}],["ArrowLeft",i(-10,0)],["Shift+ArrowLeft",i(-100,0)],["ArrowRight",i(10,0)],["Shift+ArrowRight",i(100,0)],["ArrowUp",i(0,-10)],["Shift+ArrowUp",i(0,-100)],["ArrowDown",i(0,10)],["Shift+ArrowDown",i(0,100)],["Ctrl+a",()=>{this.select("all")}],["Ctrl+x",()=>{this.selectionCut()}],["Ctrl+c",()=>{this.selectionCopy()}],["Ctrl+v",()=>{this.selectionPaste()}],["Delete",()=>{this.selectionDelete()}],["Ctrl+z",()=>{this.undo()}],["Ctrl+y",()=>{this.redo()}],["Alt+l",()=>{if(!this.transformSelection("rl"))return!1}],["Alt+r",()=>{if(!this.transformSelection("rr"))return!1}],["Alt+h",()=>{if(!this.transformSelection("mx"))return!1}],["Alt+v",()=>{if(!this.transformSelection("my"))return!1}],["Escape",()=>{if(!this.#h()){if(this.#o.value.full){this.#o.value=this.#o.value.clear();return}return!1}}],["w",()=>{if(this.#h(),!this.#w())return!1}],["g",r(ut.ground)],["o",r(ut.port)],["v",r(ne.vdc)],["i",r(ne.idc)],["r",r(ge.resistor)],["c",r(ge.capacitor)],["l",r(ge.inductor)],["d",r(K.diode)],["n",r(K.npn)],["p",r(K.pnp)],["Shift+N",r(K.nmos)],["Shift+P",r(K.pmos)],["a",r(K.opamp)],["t",()=>{this.pasteNote("")}])}get focusRef(){return this.#t}get library(){return this.#n}get settings(){return this.#s.value}get schematic(){return this.#e.value}get history(){return this.#a.value}get zoom(){return this.#i.value}get selection(){return this.#o.value}get mouseAction(){return this.#r.value}attach(t){this.#l=new Gs(t),this.#i.value=this.#T(!1)}handleFocus=t=>{this.#u()};handleBlur=t=>{this.#h(),this.#u()};handleKeyDown=t=>{this.#c(t)||this.#d(t)};handleKeyUp=t=>{this.#d(t)};#d(t){const{key:e}=t,s=I.of(t);if(e==="Shift"&&this.#E(e,s)){t.preventDefault();return}if(e==="Alt"&&this.#E(e,s)){t.preventDefault();return}if(e==="Shift"&&this.#x(e,s)){t.preventDefault();return}}handleMouseDown=t=>{Tr();const e=t.button,s=I.of(t),i=this.#f(t);e===0&&s===I.None&&(this.#L(i,s)||this.#y(i,s)||this.#v(i))||e===0&&s===I.Shift&&(this.#L(i,s)||this.#y(i,s)||this.#v(i))||e===0&&s===I.Alt&&this.#L(i,s)||e===1&&s===I.None&&this.#O(i)};handleMouseMove=t=>{const e=I.of(t),s=this.#f(t);this.#I(s)||this.#P(s,e)||this.#C(s)||this.#A(s)||this.#b(s,e)||this.#q(s)||this.#r.value.type==="idle"&&this.#p(s)&&this.#u(s)};handleMouseUp=t=>{const e=this.#f(t);this.#D(e)||this.#H(e)||this.#N(e)||this.#k(e)||this.#u(e)};handleWheel=t=>{t.preventDefault();const e=I.of(t);if(this.#r.value.type==="idle"&&e===I.None){this.#i.value=this.#i.value.zoomBy(-Math.sign(t.deltaY));return}};handleContextMenu=t=>{t.preventDefault()};#f(t){return{x:t.offsetX,y:t.offsetY}}#p(t){const e=this.#i.value.toGridX(t.x),s=this.#i.value.toGridY(t.y),i=this.#i.value.toGridX(this.#r.value.cursor.x),r=this.#i.value.toGridY(this.#r.value.cursor.y);return V.snap(e)!==V.snap(i)||V.snap(s)!==V.snap(r)}#u(t=this.#r.value.cursor){const e=V.snap(this.#i.value.toGridX(t.x)),s=V.snap(this.#i.value.toGridY(t.y)),i=Nn(this.#e.value,e,s,Rt.notWire);this.#r.value={type:"idle",cursor:t,hovered:i}}#v(t){return this.#r.value.type==="idle"?(this.#o.value=this.#o.value.clear(),this.#r.value={type:"select",cursor:{...t},origin:{...t}},!0):!1}#b(t,e){if(this.#r.value.type==="select"){const{origin:s}=this.#r.value,i={x0:this.#i.value.toGridX(Math.min(s.x,t.x)),y0:this.#i.value.toGridY(Math.min(s.y,t.y)),x1:this.#i.value.toGridX(Math.max(s.x,t.x)),y1:this.#i.value.toGridY(Math.max(s.y,t.y))};for(const r of this.#e.value)(e===I.Shift?$r(i,r.area):Ir(i,r.area))?this.#o.value=this.#o.value.add([r]):this.#o.value=this.#o.value.delete([r]);return this.#r.value={type:"select",cursor:t,origin:s},!0}return!1}#x(t,e){return this.#r.value.type==="select"?this.#b(this.#r.value.cursor,e):!1}#k(t){if(this.#r.value.type==="select"){const{origin:e}=this.#r.value;return t.x===e.x&&t.y===e.y&&(this.#o.value=this.#o.value.clear()),this.#u(t),!0}return!1}#M(){return this.#r.value.type==="select"?(this.#o.value=new R,this.#u(),!0):!1}#y(t,e){if(this.#r.value.type==="idle"){const s=Nn(this.#e.value,this.#i.value.toGridX(t.x),this.#i.value.toGridY(t.y));if(s!=null){this.#o.value.has(s)||(this.#o.value=e===I.Shift?this.#o.value.add([s]):this.#o.value.select([s]));const i=ie(this.#e.value),r=new In(this.#o.value.filter(this.#e.value));return this.#e.value=this.#e.value.unwire(),this.#r.value={type:"move",cursor:{...t},origin:{...t},undo:i,mover:r},!0}}return!1}#C(t){if(this.#r.value.type==="move"){if(this.#p(t)){const{origin:e,undo:s,mover:i}=this.#r.value,r=V.snap(this.#i.value.toGridX(e.x)),o=V.snap(this.#i.value.toGridY(e.y)),a=V.snap(this.#i.value.toGridX(t.x)),l=V.snap(this.#i.value.toGridY(t.y));i.moveBy(a-r,l-o),this.#e.value=this.#e.value.unwire(),this.#r.value={type:"move",cursor:t,origin:e,undo:s,mover:i}}return!0}return!1}#H(t){if(this.#r.value.type==="move"){const{origin:e,mover:s}=this.#r.value,i=V.snap(this.#i.value.toGridX(e.x)),r=V.snap(this.#i.value.toGridY(e.y)),o=V.snap(this.#i.value.toGridX(t.x)),a=V.snap(this.#i.value.toGridY(t.y));return s.moveBy(o-i,a-r),this.#e.value=this.#e.value.rewire(),(i!==o||r!==a)&&this.#m("move selection"),this.#u(t),!0}return!1}#S(){if(this.#r.value.type==="move"){const{undo:t}=this.#r.value;return this.#e.value=wt.create(Et(t)),this.#o.value=new R,this.#u(),!0}return!1}#_(t){if(this.#r.value.type==="idle"){const{cursor:e}=this.#r.value;bo(t,"cm");const s=ie(this.#e.value),i=new In(t),r=V.snap(this.#i.value.toGridX(e.x)),o=V.snap(this.#i.value.toGridY(e.y));return i.moveBy(r,o),this.#e.value=this.#e.value.unwire().append(t).rename(),this.#o.value=new R(t),this.#r.value={type:"paste",cursor:e,undo:s,mover:i},!0}return!1}#A(t){if(this.#r.value.type==="paste"){if(this.#p(t)){const{undo:e,mover:s}=this.#r.value,i=V.snap(this.#i.value.toGridX(t.x)),r=V.snap(this.#i.value.toGridY(t.y));s.moveBy(i,r),this.#e.value=this.#e.value.unwire(),this.#r.value={type:"paste",cursor:t,undo:e,mover:s}}return!0}return!1}#N(t){if(this.#r.value.type==="paste"){const{mover:e}=this.#r.value,s=V.snap(this.#i.value.toGridX(t.x)),i=V.snap(this.#i.value.toGridY(t.y));return e.moveBy(s,i),this.#e.value=this.#e.value.rewire(),this.#m("paste"),this.#u(t),!0}return!1}#$(){if(this.#r.value.type==="paste"){const{undo:t}=this.#r.value;return this.#e.value=wt.create(Et(t)),this.#o.value=new R,this.#u(),!0}return!1}#w(){if(this.#r.value.type==="idle"){this.#o.value=this.#o.value.clear();const{cursor:t}=this.#r.value;return this.#r.value={type:"wire-start",cursor:t},!0}return!1}#I(t){return this.#r.value.type==="wire-start"?(this.#r.value={type:"wire-start",cursor:t},!0):!1}#V(){return this.#r.value.type==="wire-start"?(this.#u(),!0):!1}#L(t,e){return this.#r.value.type==="idle"&&this.#B(t)?(this.#o.value=this.#o.value.clear(),this.#r.value={type:"wire",cursor:{...t},origin:{...t},wires:[],shape:Be(e)},!0):this.#r.value.type==="wire-start"?(this.#r.value={type:"wire",cursor:{...t},origin:{...t},wires:[],shape:Be(e)},!0):!1}#P(t,e){if(this.#r.value.type==="wire"){const{origin:s}=this.#r.value,i=V.snap(this.#i.value.toGridX(s.x)),r=V.snap(this.#i.value.toGridY(s.y)),o=V.snap(this.#i.value.toGridX(t.x)),a=V.snap(this.#i.value.toGridY(t.y)),l=Be(e),u=to(i,r,o,a,l);return this.#r.value={type:"wire",cursor:t,origin:s,wires:u,shape:l},!0}return!1}#E(t,e){return this.#r.value.type==="wire"?this.#P(this.#r.value.cursor,e):!1}#D(t){return this.#r.value.type==="wire"?(this.#e.value=this.#e.value.append(this.#r.value.wires),this.#m("draw wires"),this.#u(t),!0):!1}#G(){return this.#r.value.type==="wire"?(this.#u(),!0):!1}#O(t){return this.#r.value.type==="idle"?(this.#r.value={type:"scroll",cursor:{...t},origin:{...t},offset:{x:this.#i.value.x,y:this.#i.value.y}},!0):!1}#q(t){if(this.#r.value.type==="scroll"){const{origin:e,offset:s}=this.#r.value;return this.#i.value=this.#i.value.moveTo(s.x+(t.x-e.x),s.y+(t.y-e.y)),this.#r.value={type:"scroll",cursor:t,origin:e,offset:s},!0}return!1}#h(){return!!(this.#V()||this.#G()||this.#S()||this.#$()||this.#M())}#B(t){const{network:e}=this.#e.value,s=this.#i.value.toGridX(t.x),i=this.#i.value.toGridY(t.y),r=V.snap(s),o=V.snap(i);return r-5<=s&&s<=r+5&&o-5<=i&&i<=o+5&&(e.getWires(r,o)!=null||e.getPins(r,o)!=null)}#T(t){return V.center(this.#l.width,this.#l.height,Se(this.#e.peek(),!0),t)}#m(t){this.#a.value=this.#a.value.push(this.#e.value,t)}edit(t){this.#e.value=this.#e.value.edit(t)}transformSelection(t){if(this.#o.value.full){const e=this.#o.value.filter(this.#e.value);switch(wo(e,t),this.#e.value=this.#e.value.rewire(),t){case"rl":this.#m("rotate counter-clockwise");break;case"rr":this.#m("rotate clockwise");break;case"mx":this.#m("flip from left to right");break;case"my":this.#m("flip from top to bottom");break}return!0}return!1}pasteInstance(t){this.focus(),this.#h(),t===ut.wire?this.#w():this.#_([new pt(t)])}pasteNote(t){this.focus(),this.#h(),this.#_([new Bt(t)])}undo(){if(this.#a.value.canUndo){this.#h();const[t,e]=this.#a.value.undo();this.#e.value=t,this.#a.value=e,this.#o.value=new R}}redo(){if(this.#a.value.canRedo){this.#h();const[t,e]=this.#a.value.redo();this.#e.value=t,this.#a.value=e,this.#o.value=new R}}select(t){switch(this.#h(),t){case"all":this.#o.value=new R(this.#e.value);break;case"none":this.#o.value=new R;break;case"invert":this.#o.value=new R([...this.#e.value].filter(e=>!this.#o.value.has(e)));break;default:this.#o.value=new R(t);break}}selectionCut(){this.#h(),this.#o.value.size>0&&(pe.put(this.#o.value.filter(this.#e.value)),this.#e.value=this.#e.value.delete(this.#o.value),this.#o.value=new R,this.#m("cut"))}selectionCopy(){this.#h(),this.#o.value.size>0&&pe.put(this.#o.value.filter(this.#e.value))}selectionPaste(){pe.full&&(this.#h(),this.#_(pe.take()))}selectionDelete(){this.#h(),this.#o.value.size>0&&(this.#e.value=this.#e.value.delete(this.#o.value),this.#o.value=new R,this.#m("delete"))}zoomTo(t){switch(t){case"+":this.#i.value=this.#i.value.zoomBy(1);break;case"-":this.#i.value=this.#i.value.zoomBy(-1);break;case"0":this.#i.value=new V().moveTo(20,20);break;case"1":this.#i.value=this.#T(!1);break;case"all":this.#i.value=this.#T(!0);break}}updateSettings(t){this.#s.value={...this.#s.value,...t}}focus(){this.#t.current?.focus()}blur(){this.#t.current?.blur()}get focused(){return this.#t.current?.focused??!1}paint(){const t=this.#s.peek(),e=this.#i.peek(),s=this.#r.peek();switch(this.#l.reset(),t.showGrid&&this.#l.paintGrid(e),s.type){case"idle":{this.#g(!1,s.hovered,!1),this.focused&&t.showCrosshair&&this.#l.paintCrosshair(e,s.cursor,!1);break}case"scroll":{this.#g(!1,null,!1);break}case"select":{this.#g(!1,null,!1),this.#l.paintSelection(e,s.origin,s.cursor);break}case"wire-start":{this.#g(!0,null,!1),this.#l.paintCrosshair(e,s.cursor,!0);break}case"wire":{this.#l.paintCrosshair(e,s.cursor,!0),this.#g(!0,null,!1);for(const i of s.wires)this.#l.paintWire(e,i,!0);break}case"move":case"paste":{this.#g(!0,null,!0);const i=Se(s.mover.elements,!1),r=e.toScreenX(V.snap((i.x0+i.x1)/2)),o=e.toScreenY(V.snap((i.y0+i.y1)/2));this.#l.paintCrosshair(e,{x:r,y:o},!0);break}}}#g(t,e,s){const i=this.#e.peek(),r=this.#i.peek(),o=this.#o.peek();for(const a of i.instances)this.#l.paintInstance(r,a,o.has(a)),a.symbol!==ut.ground&&this.#l.paintLabels(r,a,o.has(a)),(a===e||s)&&(this.#l.paintArea(r,a.area,!1),this.#l.paintOrigin(r,a,!1));for(const a of i.notes)o.has(a)?(this.#l.paintArea(r,a.area,!0),this.#l.paintOrigin(r,a,!0)):(a===e||s)&&(this.#l.paintArea(r,a.area,!1),this.#l.paintOrigin(r,a,!1));for(const a of i.wires)this.#l.paintWire(r,a,o.has(a));for(const a of i.instances)(t||a===e)&&this.#l.paintPins(r,a,o.has(a));this.#l.paintJoins(r,i.network.joins)}}const Os=sn(null);function ot(){return rs(Os)}function qs(n){var t,e,s="";if(typeof n=="string"||typeof n=="number")s+=n;else if(typeof n=="object")if(Array.isArray(n)){var i=n.length;for(t=0;t<i;t++)n[t]&&(e=qs(n[t]))&&(s&&(s+=" "),s+=e)}else for(e in n)n[e]&&(s&&(s+=" "),s+=e);return s}function xo(){for(var n,t,e=0,s="",i=arguments.length;e<i;e++)(n=arguments[e])&&(t=qs(n))&&(s&&(s+=" "),s+=t);return s}const ko="_root_1813r_1",Mo="_item_1813r_9",Co="_selected_1813r_22";function Ho(){const n=ot(),{schematic:t,selection:e}=n;return c("ul",{class:ko,children:t.instances.filter(({symbol:s})=>s!==ut.ground&&s!==ut.port).map(s=>c("li",{class:xo(Mo,e.has(s)&&Co),onClick:()=>{n.select([s]),n.focus()},children:[s.symbol.id,":",s.name," (#",s.id,")"]},s.id))})}function Bs({canvas:n,style:t,...e}){return c("canvas",{...e,ref:n,style:{display:"block",inlineSize:"100%",blockSize:"100%",...t}})}const zs=n=>{const t=n.getContext("2d"),e=devicePixelRatio,{width:s,height:i}=n.getBoundingClientRect(),r=Math.max(1,s*e),o=Math.max(1,i*e);return(n.width!==r||n.height!==o)&&(n.width=r,n.height=o,t.scale(e,e)),{width:r,height:o}},So="_root_1ar66_1",Ao="_category_1ar66_5",No="_title_1ar66_10",$o="_list_1ar66_15",Io="_symbol_1ar66_24";function Lo(){const{library:n}=ot(),t=Object.groupBy(n,({category:e})=>e);return c("div",{class:So,children:Object.entries(t).map(([e,s])=>c(To,{name:e,symbols:s},e))})}function To({name:n,symbols:t}){return c("div",{class:Ao,children:[c("div",{class:No,children:n}),c("div",{class:$o,children:t.map(e=>c(Po,{symbol:e},e.id))})]})}function Po({symbol:n}){const t=ot(),e=Tt(null);return Le(()=>{const{width:s,height:i}=zs(e.current);new Gs(e.current).paintSymbolIcon(n,s,i)},[n]),c("div",{class:Io,title:n.name,onClick:()=>{t.pasteInstance(n)},children:c(Bs,{canvas:e})})}const Eo="_root_k0zzy_1",Do="_item_k0zzy_9";function Go(){const n=ot(),{schematic:t}=n;return c("ul",{class:Eo,children:t.network.nodes.map(e=>c("li",{class:Do,onClick:()=>{n.select(e.elements),n.focus()},children:e.name},e.name))})}function Us({inputRef:n={current:null},type:t="text",value:e,onFocus:s,onBlur:i,onChange:r,...o}){const a=Tt(null);is(n,()=>({focus(){a.current.focus()},blur(){a.current.blur()},get focused(){return document.activeElement===a.current},select(){a.current.select()}}));const[l,u]=Ie(e);return t==="textarea"?c("textarea",{...o,ref:a,value:l,onInput:f=>{u(f.currentTarget.value)},onFocus:f=>{s?.(f)},onBlur:f=>{r(l),i?.(f)},onKeyDown:f=>{f.key==="Enter"&&I.of(f)===I.Control&&(f.preventDefault(),r(l))}}):c("input",{...o,ref:a,type:t,value:l,onInput:f=>{u(f.currentTarget.value)},onFocus:f=>{s?.(f)},onBlur:f=>{r(l),i?.(f)},onKeyDown:f=>{f.key==="Enter"&&I.of(f)===I.None&&(f.preventDefault(),r(l))}})}const Oo="_root_hzlci_1",Ln="_title_hzlci_8",qo="_table_hzlci_13",Bo="_propName_hzlci_19",zo="_propValue_hzlci_26",Uo="_propTitle_hzlci_33",Wo="_input_hzlci_41";function Fo({instance:n}){const t=ot(),{device:e}=n.symbol;return c("div",{class:Oo,children:[c("div",{class:Ln,children:n.symbol.name}),c("div",{class:Ln,children:["name: ",n.name]}),e!=null&&c("table",{class:qo,children:c("tbody",{children:Object.entries(e.propsSchema).map(([s,i])=>c("tr",{children:[c("td",{class:Bo,children:s}),c("td",{class:zo,children:c(Us,{class:Wo,type:"text",value:String(i.defaultValue||"0"),onChange:r=>{t.edit({type:"set-instance-prop",instance:n,name:s,value:r})}})}),c("td",{class:Uo,children:i.title})]}))})})]})}var Ro="M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z",jo="M11 2H13V7H21V10H13V14H18V17H13V22H11V17H6V14H11V10H3V7H11V2Z",Zo="M4 22H2V2H4V22M22 7H6V10H22V7M16 14H6V17H16V14Z",Xo="M20 2H22V22H20V2M2 10H18V7H2V10M8 17H18V14H8V17Z",Yo="M22 22H2V20H22V22M10 2H7V18H10V2M17 8H14V18H17V8Z",Ko="M22 11H17V6H14V11H10V3H7V11H1.8V13H7V21H10V13H14V18H17V13H22V11Z",Jo="M22 2V4H2V2H22M7 22H10V6H7V22M14 16H17V6H14V16Z",Qo="M7,2H17A2,2 0 0,1 19,4V20A2,2 0 0,1 17,22H7A2,2 0 0,1 5,20V4A2,2 0 0,1 7,2M7,4V8H17V4H7M7,10V12H9V10H7M11,10V12H13V10H11M15,10V12H17V10H15M7,14V16H9V14H7M11,14V16H13V14H11M15,14V16H17V14H15M7,18V20H9V18H7M11,18V20H13V18H11M15,18V20H17V18H15Z",ta="M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M12 20C7.59 20 4 16.41 4 12S7.59 4 12 4 20 7.59 20 12 16.41 20 12 20M16.59 7.58L10 14.17L7.41 11.59L6 13L10 17L18 9L16.59 7.58Z",ea="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",na="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z",sa="M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z",ia="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z",ra="M3.05,13H1V11H3.05C3.5,6.83 6.83,3.5 11,3.05V1H13V3.05C17.17,3.5 20.5,6.83 20.95,11H23V13H20.95C20.5,17.17 17.17,20.5 13,20.95V23H11V20.95C6.83,20.5 3.5,17.17 3.05,13M12,5A7,7 0 0,0 5,12A7,7 0 0,0 12,19A7,7 0 0,0 19,12A7,7 0 0,0 12,5Z",oa="M20.94 11C20.5 6.83 17.17 3.5 13 3.06V1H11V3.06C9.87 3.18 8.81 3.5 7.84 4.03L9.34 5.53C10.16 5.19 11.06 5 12 5C15.87 5 19 8.13 19 12C19 12.94 18.81 13.84 18.5 14.65L20 16.15C20.5 15.19 20.82 14.13 20.95 13H23V11H20.94M3 4.27L5.04 6.31C3.97 7.62 3.25 9.23 3.06 11H1V13H3.06C3.5 17.17 6.83 20.5 11 20.94V23H13V20.94C14.77 20.74 16.38 20.03 17.69 18.96L19.73 21L21 19.73L4.27 3L3 4.27M16.27 17.54C15.09 18.45 13.61 19 12 19C8.13 19 5 15.87 5 12C5 10.39 5.55 8.91 6.46 7.73L16.27 17.54Z",aa="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z",la="M15 21H17V19H15M19 9H21V7H19M3 5V19C3 20.1 3.9 21 5 21H9V19H5V5H9V3H5C3.9 3 3 3.9 3 5M19 3V5H21C21 3.9 20.1 3 19 3M11 23H13V1H11M19 17H21V15H19M15 5H17V3H15M19 13H21V11H19M19 21C20.1 21 21 20.1 21 19H19Z",ca="M3 15V17H5V15M15 19V21H17V19M19 3H5C3.9 3 3 3.9 3 5V9H5V5H19V9H21V5C21 3.9 20.1 3 19 3M21 19H19V21C20.1 21 21 20.1 21 19M1 11V13H23V11M7 19V21H9V19M19 15V17H21V15M11 19V21H13V19M3 19C3 20.1 3.9 21 5 21V19Z",ua="M20 18H4V8H20M20 6H12L10 4H4A2 2 0 0 0 2 6V18A2 2 0 0 0 4 20H20A2 2 0 0 0 22 18V8A2 2 0 0 0 20 6M14 9H16V13H19L15 17L11 13H14Z",ha="M13 19C13 19.34 13.04 19.67 13.09 20H4C2.9 20 2 19.11 2 18V6C2 4.89 2.89 4 4 4H10L12 6H20C21.1 6 22 6.89 22 8V13.81C21.39 13.46 20.72 13.22 20 13.09V8H4V18H13.09C13.04 18.33 13 18.66 13 19M20 18V15H18V18H15V20H18V23H20V20H23V18H20Z",fa="M20 18H4V8H20M20 6H12L10 4H4A2 2 0 0 0 2 6V18A2 2 0 0 0 4 20H20A2 2 0 0 0 22 18V8A2 2 0 0 0 20 6M16 17H14V13H11L15 9L19 13H16Z",pa="M20.5,18L17.5,21V19H5V17H17.5V15L20.5,18M10.13,10H13.88L12,4.97L10.13,10M12.75,3L17.5,14H15.42L14.5,11.81H9.5L8.58,14H6.5L11.25,3H12.75Z",da="M3 12V13.5L14 18.25V16.15L11.8 15.25V10.25L14 9.35V7.25L3 12M10 14.62L5 12.75L10 10.88V14.62M18 4.25L15 7.25H17V19.75H19V7.25H21L18 4.25Z",ma="M10,4V8H14V4H10M16,4V8H20V4H16M16,10V14H20V10H16M16,16V20H20V16H16M14,20V16H10V20H14M8,20V16H4V20H8M8,14V10H4V14H8M8,8V4H4V8H8M10,14H14V10H10V14M4,2H20A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4C2.92,22 2,21.1 2,20V4A2,2 0 0,1 4,2Z",_a="M0,2.77L1.28,1.5L22.5,22.72L21.23,24L19.23,22H4C2.92,22 2,21.1 2,20V4.77L0,2.77M10,4V7.68L8,5.68V4H6.32L4.32,2H20A2,2 0 0,1 22,4V19.7L20,17.7V16H18.32L16.32,14H20V10H16V13.68L14,11.68V10H12.32L10.32,8H14V4H10M16,4V8H20V4H16M16,20H17.23L16,18.77V20M4,8H5.23L4,6.77V8M10,14H11.23L10,12.77V14M14,20V16.77L13.23,16H10V20H14M8,20V16H4V20H8M8,14V10.77L7.23,10H4V14H8Z",va="M10,19H13V22H10V19M12,2C17.35,2.22 19.68,7.62 16.5,11.67C15.67,12.67 14.33,13.33 13.67,14.17C13,15 13,16 13,17H10C10,15.33 10,13.92 10.67,12.92C11.33,11.92 12.67,11.33 13.5,10.67C15.92,8.43 15.32,5.26 12,5A3,3 0 0,0 9,8H6A6,6 0 0,1 12,2Z",ga="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",ya="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z",ba="M18 16H17.42L16.61 15.19C17.5 14 18 12.5 18 11C18 7.13 14.87 4 11 4C9.5 4 8 4.5 6.79 5.4C3.7 7.72 3.07 12.11 5.39 15.2C7.71 18.29 12.1 18.92 15.19 16.6L16 17.41V18L21 23L23 21L18 16M11 16C8.24 16 6 13.76 6 11S8.24 6 11 6 16 8.24 16 11 13.76 16 11 16M3 6L1 8V1H8L6 3H3V6M21 1V8L19 6V3H16L14 1H21M6 19L8 21H1V14L3 16V19H6Z",wa="M15.5,14H14.71L14.43,13.73C15.41,12.59 16,11.11 16,9.5A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,6.5 0 0,0 9.5,16C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5L19,20.5L20.5,19L15.5,14M9.5,14C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z",Va="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z",xa="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z",ka="M13,4.07V1L8.45,5.55L13,10V6.09C15.84,6.57 18,9.03 18,12C18,14.97 15.84,17.43 13,17.91V19.93C16.95,19.44 20,16.08 20,12C20,7.92 16.95,4.56 13,4.07M7.1,18.32C8.26,19.22 9.61,19.76 11,19.93V17.9C10.13,17.75 9.29,17.41 8.54,16.87L7.1,18.32M6.09,13H4.07C4.24,14.39 4.79,15.73 5.69,16.89L7.1,15.47C6.58,14.72 6.23,13.88 6.09,13M7.11,8.53L5.7,7.11C4.8,8.27 4.24,9.61 4.07,11H6.09C6.23,10.13 6.58,9.28 7.11,8.53Z",Ma="M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,5.55Z",Ca="M9,9H15V15H9M7,17H17V7H7M15,5H17V3H15M15,21H17V19H15M19,17H21V15H19M19,9H21V7H19M19,21A2,2 0 0,0 21,19H19M19,13H21V11H19M11,21H13V19H11M9,3H7V5H9M3,17H5V15H3M5,21V19H3A2,2 0 0,0 5,21M19,3V5H21A2,2 0 0,0 19,3M13,3H11V5H13M3,9H5V7H3M7,21H9V19H7M3,13H5V11H3M3,5H5V3A2,2 0 0,0 3,5Z",Ha="M5,3H7V5H9V3H11V5H13V3H15V5H17V3H19V5H21V7H19V9H21V11H19V13H21V15H19V17H21V19H19V21H17V19H15V21H13V19H11V21H9V19H7V21H5V19H3V17H5V15H3V13H5V11H3V9H5V7H3V5H5V3Z",Sa="M1,4.27L2.28,3L21,21.72L19.73,23L17,20.27V21H15V19H15.73L5,8.27V9H3V7H3.73L1,4.27M20,3A1,1 0 0,1 21,4V5H19V3H20M15,5V3H17V5H15M11,5V3H13V5H11M7,5V3H9V5H7M11,21V19H13V21H11M7,21V19H9V21H7M4,21A1,1 0 0,1 3,20V19H5V21H4M3,15H5V17H3V15M21,15V17H19V15H21M3,11H5V13H3V11M21,11V13H19V11H21M21,7V9H19V7H21Z",Aa="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z",Na="M16.59,5.41L15.17,4L12,7.17L8.83,4L7.41,5.41L12,10M7.41,18.59L8.83,20L12,16.83L15.17,20L16.58,18.59L12,14L7.41,18.59Z",$a="M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z";const Ia="_root_1pl8d_1";function C({class:n=Ia,shape:t,viewBox:e="0 0 24 24",size:s="2rem",...i}){return c("svg",{class:n,viewBox:e,width:s,height:s,...i,children:c("path",{d:t})})}const La="_root_12ddp_1";function S({autoFocus:n,checked:t,class:e=La,disabled:s,icon:i,tabIndex:r,title:o,...a}){return c("button",{class:e,disabled:s,tabIndex:r,autoFocus:n,"aria-checked":t,title:o,...a,children:i})}const Ta="_root_1oe1v_1",Pa="_separator_1oe1v_6";function J({children:n,class:t=Ta}){return c("div",{class:t,children:n})}function Ea(){return c("span",{class:Pa})}J.Separator=Ea;const Da="_root_1dace_1",Ga="_title_1dace_8",Oa="_toolbar_1dace_13",qa="_text_1dace_22";function Ba({note:n}){const t=ot(),e=ht(n.align),s=ft(n.align),i=n.dir;return c("div",{class:Da,children:[c("div",{class:Ga,children:"Note"}),c(J,{class:Oa,children:[c(S,{icon:c(C,{shape:Zo,size:"24px"}),checked:e==="l",onClick:()=>{t.edit({type:"set-note-align",note:n,align:`l${s}`})}}),c(S,{icon:c(C,{shape:jo,size:"24px"}),checked:e==="c",onClick:()=>{t.edit({type:"set-note-align",note:n,align:`c${s}`})}}),c(S,{icon:c(C,{shape:Xo,size:"24px"}),checked:e==="r",onClick:()=>{t.edit({type:"set-note-align",note:n,align:`r${s}`})}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:Jo,size:"24px"}),checked:s==="t",onClick:()=>{t.edit({type:"set-note-align",note:n,align:`${e}t`})}}),c(S,{icon:c(C,{shape:Ko,size:"24px"}),checked:s==="m",onClick:()=>{t.edit({type:"set-note-align",note:n,align:`${e}m`})}}),c(S,{icon:c(C,{shape:Yo,size:"24px"}),checked:s==="b",onClick:()=>{t.edit({type:"set-note-align",note:n,align:`${e}b`})}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:pa,size:"24px"}),checked:i==="h",onClick:()=>{t.edit({type:"set-note-dir",note:n,dir:"h"})}}),c(S,{icon:c(C,{shape:da,size:"24px"}),checked:i==="v",onClick:()=>{t.edit({type:"set-note-dir",note:n,dir:"v"})}})]}),c(Us,{class:qa,type:"textarea",value:n.text,placeholder:"note...",onChange:r=>{t.edit({type:"set-note-text",note:n,text:r})}})]})}const Ws="_root_d1mui_1",za="_empty_d1mui_7",Ua="_title_d1mui_11";function Wa(){const n=ot(),{schematic:t,selection:e}=n,s=e.filter(t);if(s.length===1){const[i]=s;if(i instanceof pt)return c(Fo,{instance:i},i.id);if(i instanceof Bt)return c(Ba,{note:i},i.id);if(i instanceof F)return c(Fa,{wire:i},i.id)}return c("div",{class:Ws,children:c("div",{class:za,children:"-"})})}function Fa({wire:n}){return c("div",{class:Ws,children:c("div",{class:Ua,children:"Wire"})})}function Ra(n){const[t,e]=Ie(new DOMRect);return Le(()=>{const{current:s}=n;if(s==null)return;const i=new ResizeObserver(()=>{e(s.getBoundingClientRect())});return i.observe(s),()=>{i.disconnect()}},[n]),t}function ja(n,t){for(var e in t)n[e]=t[e];return n}function Ke(n,t){for(var e in n)if(e!=="__source"&&!(e in t))return!0;for(var s in t)if(s!=="__source"&&n[s]!==t[s])return!0;return!1}function Tn(n,t){this.props=n,this.context=t}function Za(n,t){function e(i){var r=this.props.ref,o=r==i.ref;return!o&&r&&(r.call?r(null):r.current=null),t?!t(this.props,i)||!o:Ke(this.props,i)}function s(i){return this.shouldComponentUpdate=e,ye(n,i)}return s.displayName="Memo("+(n.displayName||n.name)+")",s.prototype.isReactComponent=!0,s.__f=!0,s}(Tn.prototype=new rt).isPureReactComponent=!0,Tn.prototype.shouldComponentUpdate=function(n,t){return Ke(this.props,n)||Ke(this.state,t)};var Pn=k.__b;k.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),Pn&&Pn(n)};var Xa=k.__e;k.__e=function(n,t,e,s){if(n.then){for(var i,r=t;r=r.__;)if((i=r.__c)&&i.__c)return t.__e==null&&(t.__e=e.__e,t.__k=e.__k),i.__c(n,t)}Xa(n,t,e,s)};var En=k.unmount;function Fs(n,t,e){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(s){typeof s.__c=="function"&&s.__c()}),n.__c.__H=null),(n=ja({},n)).__c!=null&&(n.__c.__P===e&&(n.__c.__P=t),n.__c=null),n.__k=n.__k&&n.__k.map(function(s){return Fs(s,t,e)})),n}function Rs(n,t,e){return n&&e&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(s){return Rs(s,t,e)}),n.__c&&n.__c.__P===t&&(n.__e&&e.appendChild(n.__e),n.__c.__e=!0,n.__c.__P=e)),n}function ze(){this.__u=0,this.o=null,this.__b=null}function js(n){var t=n.__.__c;return t&&t.__a&&t.__a(n)}function de(){this.i=null,this.l=null}k.unmount=function(n){var t=n.__c;t&&t.__R&&t.__R(),t&&32&n.__u&&(n.type=null),En&&En(n)},(ze.prototype=new rt).__c=function(n,t){var e=t.__c,s=this;s.o==null&&(s.o=[]),s.o.push(e);var i=js(s.__v),r=!1,o=function(){r||(r=!0,e.__R=null,i?i(a):a())};e.__R=o;var a=function(){if(!--s.__u){if(s.state.__a){var l=s.state.__a;s.__v.__k[0]=Rs(l,l.__c.__P,l.__c.__O)}var u;for(s.setState({__a:s.__b=null});u=s.o.pop();)u.forceUpdate()}};s.__u++||32&t.__u||s.setState({__a:s.__b=s.__v.__k[0]}),n.then(o,o)},ze.prototype.componentWillUnmount=function(){this.o=[]},ze.prototype.render=function(n,t){if(this.__b){if(this.__v.__k){var e=document.createElement("div"),s=this.__v.__k[0].__c;this.__v.__k[0]=Fs(this.__b,e,s.__O=s.__P)}this.__b=null}var i=t.__a&&ye(Ct,null,n.fallback);return i&&(i.__u&=-33),[ye(Ct,null,t.__a?null:n.children),i]};var Dn=function(n,t,e){if(++e[1]===e[0]&&n.l.delete(t),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.l.size))for(e=n.i;e;){for(;e.length>3;)e.pop()();if(e[1]<e[0])break;n.i=e=e[2]}};(de.prototype=new rt).__a=function(n){var t=this,e=js(t.__v),s=t.l.get(n);return s[0]++,function(i){var r=function(){t.props.revealOrder?(s.push(i),Dn(t,n,s)):i()};e?e(r):r()}},de.prototype.render=function(n){this.i=null,this.l=new Map;var t=we(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&t.reverse();for(var e=t.length;e--;)this.l.set(t[e],this.i=[1,0,this.i]);return n.children},de.prototype.componentDidUpdate=de.prototype.componentDidMount=function(){var n=this;this.l.forEach(function(t,e){Dn(n,e,t)})};var Ya=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,Ka=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Ja=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Qa=/[A-Z0-9]/g,tl=typeof document<"u",el=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(n)};rt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(rt.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(t){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:t})}})});var Gn=k.event;function nl(){}function sl(){return this.cancelBubble}function il(){return this.defaultPrevented}k.event=function(n){return Gn&&(n=Gn(n)),n.persist=nl,n.isPropagationStopped=sl,n.isDefaultPrevented=il,n.nativeEvent=n};var rl={enumerable:!1,configurable:!0,get:function(){return this.class}},On=k.vnode;k.vnode=function(n){typeof n.type=="string"&&function(t){var e=t.props,s=t.type,i={},r=s.indexOf("-")===-1;for(var o in e){var a=e[o];if(!(o==="value"&&"defaultValue"in e&&a==null||tl&&o==="children"&&s==="noscript"||o==="class"||o==="className")){var l=o.toLowerCase();o==="defaultValue"&&"value"in e&&e.value==null?o="value":o==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?o="ondblclick":l!=="onchange"||s!=="input"&&s!=="textarea"||el(e.type)?l==="onfocus"?o="onfocusin":l==="onblur"?o="onfocusout":Ja.test(o)&&(o=l):l=o="oninput":r&&Ka.test(o)?o=o.replace(Qa,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&i[o=l]&&(o="oninputCapture"),i[o]=a}}s=="select"&&i.multiple&&Array.isArray(i.value)&&(i.value=we(e.children).forEach(function(u){u.props.selected=i.value.indexOf(u.props.value)!=-1})),s=="select"&&i.defaultValue!=null&&(i.value=we(e.children).forEach(function(u){u.props.selected=i.multiple?i.defaultValue.indexOf(u.props.value)!=-1:i.defaultValue==u.props.value})),e.class&&!e.className?(i.class=e.class,Object.defineProperty(i,"className",rl)):(e.className&&!e.class||e.class&&e.className)&&(i.class=i.className=e.className),t.props=i}(n),n.$$typeof=Ya,On&&On(n)};var qn=k.__r;k.__r=function(n){qn&&qn(n),n.__c};var Bn=k.diffed;k.diffed=function(n){Bn&&Bn(n);var t=n.props,e=n.__e;e!=null&&n.type==="textarea"&&"value"in t&&t.value!==e.value&&(e.value=t.value==null?"":t.value)};const ol={open:/\$/y,close:/\$/y},al={open:/\\\(/y,close:/\\\)/y},ll={open:/\$\$/y,close:/\$\$/y},cl={open:/\\\[/y,close:/\\\]/y},zn=/\s+|\\\{|\\\}|\\\\/y;function ul(n){const t=Ae(n,"$","$"),e=Ae(n,"\\(","\\)");if(t!==-1&&e!==-1)return Math.min(t,e);if(t!==-1)return t;if(e!==-1)return e}function hl(n,t){return Ne(n,ol,t)||Ne(n,al,t)}function fl(n){const t=Ae(n,"$$","$$"),e=Ae(n,"\\[","\\]");if(t!==-1&&e!==-1)return Math.min(t,e);if(t!==-1)return t;if(e!==-1)return e}function pl(n,t){return Ne(n,ll,t)||Ne(n,cl,t)}function Ae(n,t,e){let s=n.indexOf(t);return s!==-1&&n.indexOf(e,s+t.length+1)===-1&&(s=-1),s}function Ne(n,t,e){if(Ue(n,t.open,0)){let s=t.open.lastIndex;for(;s<n.length;)if(Ue(n,zn,s))s=zn.lastIndex;else{if(Ue(n,t.close,s))return e.raw=n.substring(0,t.close.lastIndex),e.text=n.substring(t.open.lastIndex,s).trim(),!0;s+=1}}return!1}function Ue(n,t,e){return t.lastIndex=e,t.test(n)}function dl(n){return{extensions:[ml(n),_l(n)]}}function ml(n){const t={raw:"",text:""};return{name:"blockKatex",level:"block",start(e){return fl(e)},tokenizer(e){if(pl(e,t))return{type:"blockKatex",raw:t.raw,text:t.text}},renderer({text:e}){return Wn(e,{...n,displayMode:!0})+`
`}}}function _l(n){const t={raw:"",text:""};return{name:"inlineKatex",level:"inline",start(e){return ul(e)},tokenizer(e){if(hl(e,t))return{type:"inlineKatex",raw:t.raw,text:t.text}},renderer({text:e}){return Wn(e,{...n,displayMode:!1})}}}const vl=new Ks(dl({output:"mathml",throwOnError:!1}));function gl(n){return vl.parse(n,{async:!1,silent:!0,gfm:!1,pedantic:!1})}const yl="_root_2mcg2_1",bl=Za(wl);function wl({note:n,text:t,align:e,dir:s,x:i,y:r,width:o,height:a}){const l=Tt(null);Kt(()=>{l.current.setHTMLUnsafe(gl(t||"note..."))},[t]),Kt(()=>{n.width=l.current.offsetWidth,n.height=l.current.offsetHeight});const u=Vl(i,r,e,s);return c("div",{ref:l,class:yl,style:u,"data-align":e,"data-h-align":ht(e),"data-v-align":ft(e),"data-dir":s})}function Vl(n,t,e,s){let i=0,r=0;switch(ht(e)){case"l":i=0;break;case"c":i=-50;break;case"r":i=-100;break}switch(ft(e)){case"t":r=0;break;case"m":r=-50;break;case"b":r=-100;break}let o=0;switch(s){case"v":o=-90;break;case"h":o=0;break}return{position:"absolute",left:n,top:t,transformOrigin:`${-i}% ${-r}%`,translate:`${i}% ${r}%`,rotate:`${o}deg`}}const xl="_root_1nll4_1";function kl(){const{schematic:n,zoom:t}=ot();return c("div",{class:xl,style:{transformOrigin:"0px 0px",translate:`${t.x}px ${t.y}px`,scale:`${t.scale}`},children:n.notes.map(e=>c(bl,{note:e,text:e.text,align:e.align,dir:e.dir,x:e.x,y:e.y,width:e.width,height:e.height},e.id))})}const Ml="_root_1hx45_1";function Cl(){const n=ot(),t=Tt(null),e=Tt(null),{width:s,height:i}=Ra(e);return is(n.focusRef,()=>({focus:()=>{t.current?.focus()},blur:()=>{t.current?.blur()},get focused(){return t.current===document.activeElement}})),Kt(()=>{s>0&&i>0&&(zs(e.current),n.attach(e.current))},[n,s,i]),Kt(()=>{if(s>0&&i>0){const r=requestAnimationFrame(()=>{n.paint()});return()=>{cancelAnimationFrame(r)}}},[n,s,i,n.settings,n.schematic,n.zoom,n.selection,n.mouseAction]),c("div",{ref:t,class:Ml,tabIndex:0,autofocus:!0,onFocus:n.handleFocus,onBlur:n.handleBlur,onKeyDown:n.handleKeyDown,onKeyUp:n.handleKeyUp,style:Hl(n),children:[c(Bs,{canvas:e,onMouseDown:n.handleMouseDown,onMouseMove:n.handleMouseMove,onMouseUp:n.handleMouseUp,onWheel:n.handleWheel,onContextMenu:n.handleContextMenu}),c(kl,{})]})}function Hl(n){switch(n.mouseAction.type){case"scroll":return{cursor:"all-scroll"};case"wire-start":case"wire":return{cursor:"crosshair"};case"move":case"paste":return{cursor:"move"}}return{cursor:"default"}}const Sl=sn(null),Al="_root_3m5pl_1 _fadeIn_kq333_1";let Nl=0;class $l{constructor(t,e){this.message=t,this.options=e}#t=Nl+=1;get key(){return this.#t}}const Dt=it([]);function Il(n){Dt.value=[...Dt.value,n]}function Ll(n){Dt.value=Dt.value.filter(t=>t!==n)}function Tl({message:n}){const t=Tt(null);return Le(()=>{n.options.modal?t.current?.showModal():t.current?.show()},[n]),c("dialog",{ref:t,class:Al,onClose:()=>{Ll(n),n.options.onClose()},children:c(Sl,{value:{close:()=>{t.current?.close()}},children:n.message})},n.key)}const Pl="_root_5uo3x_1";function El(){return c("div",{class:Pl,hidden:Dt.value.length===0,children:Dt.value.map(n=>c(Tl,{message:n}))})}function Un(n,{modal:t=!0,onClose:e=()=>{}}={}){Il(new $l(n,{modal:t,onClose:e}))}const Dl="_alert_ppbdc_1 _fadeIn_kq333_1",Gl="_message_ppbdc_17";class Ol{#t=new Set;get pending(){return this.#t.size}delayed(t,e){let s=!1,i=!1;const r=()=>{i||(i=!0,this.#t.delete(o),clearTimeout(a))},o=new class{cancel(){r()}get fired(){return s}get cancelled(){return i}};this.#t.add(o);const a=setTimeout(()=>{i||(this.#t.delete(o),s=!0,e())},t);return o}repeated(t,e){let s=!1,i=!1;const r=()=>{i||(i=!0,this.#t.delete(o),clearInterval(a))},o=new class{cancel(){r()}get fired(){return s}get cancelled(){return i}};this.#t.add(o);const a=setInterval(()=>{i||(s=!0,e())},t);return o}cancelAll(){for(const t of this.#t)t.cancel();return this}}const ql=new Ol;let Bl=0;class zl{constructor(t,e){this.message=t,this.options=e}#t=Bl+=1;#n=null;get key(){return this.#t}delayed(t,e){this.clearDelayed(),this.#n=ql.delayed(e,t)}clearDelayed(){this.#n!=null&&(this.#n.cancel(),this.#n=null)}}const Gt=it([]);function Ul(n){Gt.value=[...Gt.value,n],Zs(n)}function Je(n){Gt.value=Gt.value.filter(t=>t!==n)}function Wl(n,t){t?n.clearDelayed():Zs(n)}function Zs(n){n.options.autoClose&&n.delayed(()=>{Je(n)},n.options.autoClose)}const Xs=sn(null);function Fl({toast:n,children:t}){return c(Xs,{value:{close:()=>{Je(n)},hover:e=>{n.options.autoClose&&n.options.pauseOnHover&&Wl(n,e)},click:()=>{n.options.closeOnClick&&Je(n)}},children:t})}function fn(){return rs(Xs)}function Ys(n){return{onMouseEnter:()=>{n.hover(!0)},onMouseLeave:()=>{n.hover(!1)},onClick:()=>{n.click()}}}function Rl({children:n}){return ii(n,{...n.props,...Ys(fn())})}function jl(){const n=fn();return c(C,{shape:ea,onClick:()=>{n.close()}})}function Zl({severity:n}){switch(n){case"info":return c(Xl,{});case"success":return c(Yl,{});case"error":return c(Kl,{});default:return null}}function Xl(){return c(C,{shape:ga})}function Yl(){return c(C,{shape:ta})}function Kl(){return c(C,{shape:Ro})}function Jl({children:n,severity:t=null,closeButton:e=!0}){const s=fn();return c("div",{class:Dl,...Ys(s),popover:!0,children:[t&&c(Zl,{severity:t}),c("div",{class:Gl,children:n}),e&&c(jl,{})]})}const Ql="_root_1k080_1";function tc(){return c("div",{class:Ql,hidden:Gt.value.length===0,children:[...Gt.value].reverse().map(n=>c(Fl,{toast:n,children:c(Rl,{children:n.message})},n.key))})}function ec(n,{autoClose:t=3e3,pauseOnHover:e=!0,closeOnClick:s=!0}={}){Ul(new zl(n,{autoClose:t,pauseOnHover:e,closeOnClick:s}))}function Zt({error:n}){return c(Jl,{severity:"error",children:n instanceof AggregateError?n.errors.map((t,e)=>c("p",{children:String(t)},e)):c("p",{children:String(n)})})}function nc(n,{autoClose:t=3e3,pauseOnHover:e=!0,closeOnClick:s=!1}={}){ec(c(Zt,{error:n}),{autoClose:t,pauseOnHover:e,closeOnClick:s})}Zt.report=nc;const sc="_root_yio74_1",ic="_header_yio74_9",rc="_headerText_yio74_14",oc="_headerButton_yio74_25",ac="_content_yio74_29",lc="_resize_yio74_36";function me({title:n,children:t,style:e}){const[s,i]=Ie(!0);return c("div",{class:sc,style:e,children:[c("div",{class:ic,children:[c("span",{class:rc,children:n}),c("span",{class:oc,onClick:()=>{i(!s)},children:c(C,{shape:s?Na:$a})})]}),s&&c(Ct,{children:[c("div",{class:ac,children:t}),c(cc,{})]})]})}function cc(){return c("svg",{class:lc,viewBox:"0 0 24 24",children:c("path",{d:"M22,22H20V20H22V22M22,18H20V16H22V18M18,22H16V20H18V22M18,18H16V16H18V18M14,22H12V20H14V22M22,14H20V12H22V14Z"})})}const uc="_root_948vb_1",hc="_toolbar_948vb_8",fc="_schematic_948vb_17";function pc(){return wt.create(Et([["i",50,50,0,"vdc","V1",{}],["i",150,50,0,"r","R1",{}],["i",50,120,0,"g","G1",{}],["w",50,0,150,0],["w",50,100,150,100],["w",50,0,50,20],["w",50,80,50,100],["w",50,100,50,120],["w",150,0,150,20],["w",150,80,150,100],["n",250,0,"lt","h",`# Ohm's law

*Ohm's law* states that the electric current $I$ through a conductor between two points is directly proportional to the voltage $V$ across the two points.

$$I = \\frac{V}{R}$$

The law was named after the German physicist *Georg Ohm*.`],["n",700,0,"lm","h","\\[ \\int_{a}^{b} x^2 \\, dx \\]"],["n",700,50,"lm","h","\\[ \\iint_V \\mu(u,v) \\, du \\, dv \\]"],["n",700,100,"lm","h","\\[ \\oint_V f(s) \\, ds \\]"],["n",700,150,"lm","h","\\[ \\sum_{n=1}^{\\infty} 2^{-n} = 1 \\]"],["n",700,200,"lm","h","\\[ \\prod_{i=a}^{b} f(i) \\]"],["n",700,250,"lm","h","\\[ \\lim_{x\\to\\infty} f(x) \\]"],["n",700,300,"lm","h","\\[ \\begin{pmatrix} 1 & 2 & 3 \\\\ a & b & c \\end{pmatrix} \\]"]]))}const dc="_root_1bk49_1",mc="_select_1bk49_8",_c="_content_1bk49_13";function vc(){return c("p",{children:"Capacitive reactance"})}function gc(){return c("p",{children:"Inductive reactance"})}function yc(){return c("p",{children:"Resistive voltage divider"})}function bc(){return c("p",{children:"LC resonance"})}function wc(){return c("p",{children:"Wavelength and frequency"})}const _e=[{name:"Resistive voltage divider",component:yc},{name:"Capacitive reactance",component:vc},{name:"Inductive reactance",component:gc},{name:"LC resonance",component:bc},{name:"Wavelength and frequency",component:wc}];function Vc(){const[n,t]=Ie(_e[0]),{component:e}=n;return c("section",{class:dc,children:[c("select",{class:mc,value:n.name,onInput:({target:s})=>{const{value:i}=s;t(_e.find(({name:r})=>r===i)??_e[0])},children:_e.map(({name:s})=>c("option",{value:s,children:s}))}),c("div",{class:_c,children:c(e,{})})]})}const xc="_root_8tr57_1";function kc(){return c("section",{class:xc,children:[c("p",{children:["To draw a wire, click and start moving the pointer from a device pin, a wire end, or a wire junction. To draw a wire from any location on the grid, press ",c("kbd",{children:"W"}),". To change a wire's angle, press ",c("kbd",{children:"Shift"}),". To draw a diagonal wire, press ",c("kbd",{children:"Alt"}),"."]}),c("p",{children:"Shortcuts:"}),c("ul",{children:[c("li",{children:[c("kbd",{children:"W"})," Start drawing a wire from any point on the grid"]}),c("li",{children:[c("kbd",{children:"Shift"})," While drawing a wire, changes the angle of the wire"]}),c("li",{children:[c("kbd",{children:"Alt"})," While drawing a wire, draws a diagonal wire"]}),c("li",{children:[c("kbd",{children:"G"})," Place a ground symbol"]}),c("li",{children:[c("kbd",{children:"O"})," Place a port symbol"]}),c("li",{children:[c("kbd",{children:"V"})," Place a voltage source"]}),c("li",{children:[c("kbd",{children:"I"})," Place a current source"]}),c("li",{children:[c("kbd",{children:"R"})," Place a resistor"]}),c("li",{children:[c("kbd",{children:"C"})," Place a capacitor"]}),c("li",{children:[c("kbd",{children:"L"})," Place an inductor"]}),c("li",{children:[c("kbd",{children:"D"})," Place a diode"]}),c("li",{children:[c("kbd",{children:"N"})," Place an NPN transistor"]}),c("li",{children:[c("kbd",{children:"P"})," Place a PNP transistor"]}),c("li",{children:[c("kbd",{children:"Shift+N"})," Place an N-channel MOSFET"]}),c("li",{children:[c("kbd",{children:"Shift+P"})," Place a P-channel MOSFET"]}),c("li",{children:[c("kbd",{children:"A"})," Place an operational amplifier"]}),c("li",{children:[c("kbd",{children:"Home"})," Zoom to 100%"]}),c("li",{children:[c("kbd",{children:"Space"})," Expand or shrink to cover the whole screen"]}),c("li",{children:[c("kbd",{children:"Ctrl+X"})," Cut selected item(s) to clipboard"]}),c("li",{children:[c("kbd",{children:"Ctrl+C"})," Copy selected item(s) to clipboard"]}),c("li",{children:[c("kbd",{children:"Ctrl+V"})," Paste item(s) from clipboard"]}),c("li",{children:[c("kbd",{children:"Ctrl+A"})," Select all"]}),c("li",{children:[c("kbd",{children:"Delete"})," Delete selected item(s)"]}),c("li",{children:[c("kbd",{children:"Alt+L"})," Rotate selected item(s) to the left"]}),c("li",{children:[c("kbd",{children:"Alt+R"})," Rotate selected item(s) to the right"]}),c("li",{children:[c("kbd",{children:"Alt+H"})," Flip selected item(s) from left to right"]}),c("li",{children:[c("kbd",{children:"Alt+V"})," Flip selected item(s) from top to bottom"]}),c("li",{children:[c("kbd",{children:"Ctrl+Z"})," Undo"]}),c("li",{children:[c("kbd",{children:"Ctrl+Y"})," Redo"]})]})]})}const Mc="_root_1qxgy_1";function Cc(){const n=ot(),{settings:t}=n;return c(J,{class:Mc,children:[c(S,{icon:c(C,{shape:ua}),title:"Open schematic",onClick:()=>{Zt.report("Not implemented")}}),c(S,{icon:c(C,{shape:fa}),title:"Save schematic",onClick:()=>{Zt.report("Not implemented")}}),c(S,{icon:c(C,{shape:ha}),title:"New schematic",onClick:()=>{Zt.report("Not implemented")}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:Ca}),title:"Select all",onClick:()=>{n.select("all"),n.focus()}}),c(S,{icon:c(C,{shape:Ha}),title:"Invert selection",onClick:()=>{n.select("invert"),n.focus()}}),c(S,{icon:c(C,{shape:Sa}),title:"Clear selection",onClick:()=>{n.select("none"),n.focus()}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:sa}),title:"Cut selected item(s) to clipboard",onClick:()=>{n.selectionCut(),n.focus()}}),c(S,{icon:c(C,{shape:na}),title:"Copy selected item(s) to clipboard",onClick:()=>{n.selectionCopy(),n.focus()}}),c(S,{icon:c(C,{shape:ia}),title:"Paste item(s) from clipboard",onClick:()=>{n.selectionPaste(),n.focus()}}),c(S,{icon:c(C,{shape:aa}),title:"Delete selected item(s)",onClick:()=>{n.selectionDelete(),n.focus()}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:ka}),title:"Rotate selected item(s) to the left",disabled:!n.selection.full,onClick:()=>{n.transformSelection("rl"),n.focus()}}),c(S,{icon:c(C,{shape:Ma}),title:"Rotate selected item(s) to the right",disabled:!n.selection.full,onClick:()=>{n.transformSelection("rr"),n.focus()}}),c(S,{icon:c(C,{shape:la}),title:"Flip selected item(s) from left to right",disabled:!n.selection.full,onClick:()=>{n.transformSelection("mx"),n.focus()}}),c(S,{icon:c(C,{shape:ca}),title:"Flip selected item(s) from top to bottom",disabled:!n.selection.full,onClick:()=>{n.transformSelection("my"),n.focus()}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:Aa}),title:"Undo",disabled:!n.history.canUndo,onClick:()=>{n.undo(),n.focus()}}),c(S,{icon:c(C,{shape:xa}),title:"Redo",disabled:!n.history.canRedo,onClick:()=>{n.redo(),n.focus()}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:ya}),title:"Zoom 100%",onClick:()=>{n.zoomTo("1"),n.focus()}}),c(S,{icon:c(C,{shape:Va}),title:"Zoom in",onClick:()=>{n.zoomTo("+"),n.focus()}}),c(S,{icon:c(C,{shape:wa}),title:"Zoom out",onClick:()=>{n.zoomTo("-"),n.focus()}}),c(S,{icon:c(C,{shape:ba}),title:"View all",onClick:()=>{n.zoomTo("all"),n.focus()}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:t.showGrid?_a:ma}),title:t.showGrid?"Hide grid":"Show grid",onClick:()=>{n.updateSettings({showGrid:!t.showGrid}),n.focus()}}),c(S,{icon:c(C,{shape:t.showCrosshair?oa:ra}),title:t.showCrosshair?"Hide crosshair":"Show crosshair",onClick:()=>{n.updateSettings({showCrosshair:!t.showCrosshair}),n.focus()}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:Qo}),title:"Calculator",onClick:()=>{Un(c(Vc,{}),{modal:!0,onClose:()=>{n.focus()}})}}),c(J.Separator,{}),c(S,{icon:c(C,{shape:va}),title:"Help",onClick:()=>{Un(c(kc,{}),{modal:!0,onClose:()=>{n.focus()}})}})]})}function Hc(){const n=Te(()=>new Vo(xs,pc()),[]);return Le(()=>{const t=Ts(["Alt+v",()=>{}],["Alt+h",()=>{}],["Alt+r",()=>{}],["Alt+l",()=>{}],["Ctrl+a",()=>{}],["Ctrl+s",()=>{}],["Ctrl+o",()=>{}],["Ctrl+n",()=>{}],["Ctrl+r",()=>{}]);return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[n]),c(Os,{value:n,children:[c("main",{class:uc,children:[c("div",{class:hc,children:c(Cc,{})}),c("div",{class:fc,children:c(Cl,{})}),c(me,{title:"Instances",style:{insetInlineEnd:"38rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:c(Ho,{})}),c(me,{title:"Nodes",style:{insetInlineEnd:"20rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:c(Go,{})}),c(me,{title:"Library",style:{insetInlineEnd:"2rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:c(Lo,{})}),c(me,{title:"Properties",style:{insetInlineStart:"2rem",insetBlockStart:"4rem"},children:c(Wa,{})})]}),c(El,{}),c(tc,{})]})}si(c(Hc,{}),document.querySelector("#app"));
