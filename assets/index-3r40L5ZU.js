import{M as _i}from"./marked-6_4nRR25.js";import{r as pn}from"./katex-CC6ezK7-.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var De,V,dn,_n,ae,Dt,mn,pt,vn,Vt,dt,_t,gn,Ie={},yn=[],mi=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,tt=Array.isArray;function ne(n,e){for(var t in e)n[t]=e[t];return n}function xt(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function Ze(n,e,t){var i,s,r,o={};for(r in e)r=="key"?i=e[r]:r=="ref"?s=e[r]:o[r]=e[r];if(arguments.length>2&&(o.children=arguments.length>3?De.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(r in n.defaultProps)o[r]===void 0&&(o[r]=n.defaultProps[r]);return Ce(n,o,i,s,null)}function Ce(n,e,t,i,s){var r={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++dn,__i:-1,__u:0};return s==null&&V.vnode!=null&&V.vnode(r),r}function le(n){return n.children}function Q(n,e){this.props=n,this.context=e}function _e(n,e){if(e==null)return n.__?_e(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?_e(n):null}function bn(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return bn(n)}}function mt(n){(!n.__d&&(n.__d=!0)&&ae.push(n)&&!Ye.__r++||Dt!==V.debounceRendering)&&((Dt=V.debounceRendering)||mn)(Ye)}function Ye(){var n,e,t,i,s,r,o,a;for(ae.sort(pt);n=ae.shift();)n.__d&&(e=ae.length,i=void 0,r=(s=(t=n).__v).__e,o=[],a=[],t.__P&&((i=ne({},s)).__v=s.__v+1,V.vnode&&V.vnode(i),kt(t.__P,i,s,t.__n,t.__P.namespaceURI,32&s.__u?[r]:null,o,r??_e(s),!!(32&s.__u),a),i.__v=s.__v,i.__.__k[i.__i]=i,xn(o,i,a),i.__e!=r&&bn(i)),ae.length>e&&ae.sort(pt));Ye.__r=0}function wn(n,e,t,i,s,r,o,a,l,c,f){var h,d,p,_,g,x,y=i&&i.__k||yn,v=e.length;for(l=vi(t,e,y,l,v),h=0;h<v;h++)(p=t.__k[h])!=null&&(d=p.__i===-1?Ie:y[p.__i]||Ie,p.__i=h,x=kt(n,p,d,s,r,o,a,l,c,f),_=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&Ct(d.ref,null,p),f.push(p.ref,p.__c||_,p)),g==null&&_!=null&&(g=_),4&p.__u||d.__k===p.__k?l=Vn(p,l,n):typeof p.type=="function"&&x!==void 0?l=x:_&&(l=_.nextSibling),p.__u&=-7);return t.__e=g,l}function vi(n,e,t,i,s){var r,o,a,l,c,f=t.length,h=f,d=0;for(n.__k=new Array(s),r=0;r<s;r++)(o=e[r])!=null&&typeof o!="boolean"&&typeof o!="function"?(l=r+d,(o=n.__k[r]=typeof o=="string"||typeof o=="number"||typeof o=="bigint"||o.constructor==String?Ce(null,o,null,null,null):tt(o)?Ce(le,{children:o},null,null,null):o.constructor===void 0&&o.__b>0?Ce(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,a=null,(c=o.__i=gi(o,t,l,h))!==-1&&(h--,(a=t[c])&&(a.__u|=2)),a==null||a.__v===null?(c==-1&&d--,typeof o.type!="function"&&(o.__u|=4)):c!=l&&(c==l-1?d--:c==l+1?d++:(c>l?d--:d++,o.__u|=4))):n.__k[r]=null;if(h)for(r=0;r<f;r++)(a=t[r])!=null&&!(2&a.__u)&&(a.__e==i&&(i=_e(a)),kn(a,a));return i}function Vn(n,e,t){var i,s;if(typeof n.type=="function"){for(i=n.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=n,e=Vn(i[s],e,t));return e}n.__e!=e&&(e&&n.type&&!t.contains(e)&&(e=_e(n)),t.insertBefore(n.__e,e||null),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Ke(n,e){return e=e||[],n==null||typeof n=="boolean"||(tt(n)?n.some(function(t){Ke(t,e)}):e.push(n)),e}function gi(n,e,t,i){var s,r,o=n.key,a=n.type,l=e[t];if(l===null||l&&o==l.key&&a===l.type&&!(2&l.__u))return t;if(i>(l!=null&&!(2&l.__u)?1:0))for(s=t-1,r=t+1;s>=0||r<e.length;){if(s>=0){if((l=e[s])&&!(2&l.__u)&&o==l.key&&a===l.type)return s;s--}if(r<e.length){if((l=e[r])&&!(2&l.__u)&&o==l.key&&a===l.type)return r;r++}}return-1}function Et(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||mi.test(e)?t:t+"px"}function We(n,e,t,i,s){var r;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||Et(n.style,e,"");if(t)for(e in t)i&&t[e]===i[e]||Et(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")r=e!=(e=e.replace(vn,"$1")),e=e.toLowerCase()in n||e=="onFocusOut"||e=="onFocusIn"?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+r]=t,t?i?t.u=i.u:(t.u=Vt,n.addEventListener(e,r?_t:dt,r)):n.removeEventListener(e,r?_t:dt,r);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function Bt(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Vt++;else if(e.t<t.u)return;return t(V.event?V.event(e):e)}}}function kt(n,e,t,i,s,r,o,a,l,c){var f,h,d,p,_,g,x,y,v,G,$,F,q,C,L,O,M,W=e.type;if(e.constructor!==void 0)return null;128&t.__u&&(l=!!(32&t.__u),r=[a=e.__e=t.__e]),(f=V.__b)&&f(e);e:if(typeof W=="function")try{if(y=e.props,v="prototype"in W&&W.prototype.render,G=(f=W.contextType)&&i[f.__c],$=f?G?G.props.value:f.__:i,t.__c?x=(h=e.__c=t.__c).__=h.__E:(v?e.__c=h=new W(y,$):(e.__c=h=new Q(y,$),h.constructor=W,h.render=bi),G&&G.sub(h),h.props=y,h.state||(h.state={}),h.context=$,h.__n=i,d=h.__d=!0,h.__h=[],h._sb=[]),v&&h.__s==null&&(h.__s=h.state),v&&W.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=ne({},h.__s)),ne(h.__s,W.getDerivedStateFromProps(y,h.__s))),p=h.props,_=h.state,h.__v=e,d)v&&W.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),v&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(v&&W.getDerivedStateFromProps==null&&y!==p&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(y,$),!h.__e&&(h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(y,h.__s,$)===!1||e.__v==t.__v)){for(e.__v!=t.__v&&(h.props=y,h.state=h.__s,h.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(Y){Y&&(Y.__=e)}),F=0;F<h._sb.length;F++)h.__h.push(h._sb[F]);h._sb=[],h.__h.length&&o.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(y,h.__s,$),v&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(p,_,g)})}if(h.context=$,h.props=y,h.__P=n,h.__e=!1,q=V.__r,C=0,v){for(h.state=h.__s,h.__d=!1,q&&q(e),f=h.render(h.props,h.state,h.context),L=0;L<h._sb.length;L++)h.__h.push(h._sb[L]);h._sb=[]}else do h.__d=!1,q&&q(e),f=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++C<25);h.state=h.__s,h.getChildContext!=null&&(i=ne(ne({},i),h.getChildContext())),v&&!d&&h.getSnapshotBeforeUpdate!=null&&(g=h.getSnapshotBeforeUpdate(p,_)),a=wn(n,tt(O=f!=null&&f.type===le&&f.key==null?f.props.children:f)?O:[O],e,t,i,s,r,o,a,l,c),h.base=e.__e,e.__u&=-161,h.__h.length&&o.push(h),x&&(h.__E=h.__=null)}catch(Y){if(e.__v=null,l||r!=null)if(Y.then){for(e.__u|=l?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,e.__e=a}else for(M=r.length;M--;)xt(r[M]);else e.__e=t.__e,e.__k=t.__k;V.__e(Y,e,t)}else r==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):a=e.__e=yi(t.__e,e,t,i,s,r,o,l,c);return(f=V.diffed)&&f(e),128&e.__u?void 0:a}function xn(n,e,t){for(var i=0;i<t.length;i++)Ct(t[i],t[++i],t[++i]);V.__c&&V.__c(e,n),n.some(function(s){try{n=s.__h,s.__h=[],n.some(function(r){r.call(s)})}catch(r){V.__e(r,s.__v)}})}function yi(n,e,t,i,s,r,o,a,l){var c,f,h,d,p,_,g,x=t.props,y=e.props,v=e.type;if(v=="svg"?s="http://www.w3.org/2000/svg":v=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),r!=null){for(c=0;c<r.length;c++)if((p=r[c])&&"setAttribute"in p==!!v&&(v?p.localName==v:p.nodeType==3)){n=p,r[c]=null;break}}if(n==null){if(v==null)return document.createTextNode(y);n=document.createElementNS(s,v,y.is&&y),a&&(V.__m&&V.__m(e,r),a=!1),r=null}if(v===null)x===y||a&&n.data===y||(n.data=y);else{if(r=r&&De.call(n.childNodes),x=t.props||Ie,!a&&r!=null)for(x={},c=0;c<n.attributes.length;c++)x[(p=n.attributes[c]).name]=p.value;for(c in x)if(p=x[c],c!="children"){if(c=="dangerouslySetInnerHTML")h=p;else if(!(c in y)){if(c=="value"&&"defaultValue"in y||c=="checked"&&"defaultChecked"in y)continue;We(n,c,null,p,s)}}for(c in y)p=y[c],c=="children"?d=p:c=="dangerouslySetInnerHTML"?f=p:c=="value"?_=p:c=="checked"?g=p:a&&typeof p!="function"||x[c]===p||We(n,c,p,x[c],s);if(f)a||h&&(f.__html===h.__html||f.__html===n.innerHTML)||(n.innerHTML=f.__html),e.__k=[];else if(h&&(n.innerHTML=""),wn(n,tt(d)?d:[d],e,t,i,v=="foreignObject"?"http://www.w3.org/1999/xhtml":s,r,o,r?r[0]:t.__k&&_e(t,0),a,l),r!=null)for(c=r.length;c--;)xt(r[c]);a||(c="value",v=="progress"&&_==null?n.removeAttribute("value"):_!==void 0&&(_!==n[c]||v=="progress"&&!_||v=="option"&&_!==x[c])&&We(n,c,_,x[c],s),c="checked",g!==void 0&&g!==n[c]&&We(n,c,g,x[c],s))}return n}function Ct(n,e,t){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(s){V.__e(s,t)}}function kn(n,e,t){var i,s;if(V.unmount&&V.unmount(n),(i=n.ref)&&(i.current&&i.current!==n.__e||Ct(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){V.__e(r,e)}i.base=i.__P=null}if(i=n.__k)for(s=0;s<i.length;s++)i[s]&&kn(i[s],e,t||typeof n.type!="function");t||xt(n.__e),n.__c=n.__=n.__e=void 0}function bi(n,e,t){return this.constructor(n,t)}function wi(n,e,t){var i,s,r,o;e==document&&(e=document.documentElement),V.__&&V.__(n,e),s=(i=!1)?null:e.__k,r=[],o=[],kt(e,n=e.__k=Ze(le,null,[n]),s||Ie,Ie,e.namespaceURI,s?null:e.firstChild?De.call(e.childNodes):null,r,s?s.__e:e.firstChild,i,o),xn(r,n,o)}function Vi(n,e,t){var i,s,r,o,a=ne({},n.props);for(r in n.type&&n.type.defaultProps&&(o=n.type.defaultProps),e)r=="key"?i=e[r]:r=="ref"?s=e[r]:a[r]=e[r]===void 0&&o!==void 0?o[r]:e[r];return arguments.length>2&&(a.children=arguments.length>3?De.call(arguments,2):t),Ce(n.type,a,i||n.key,s||n.ref,null)}function Mt(n,e){var t={__c:e="__cC"+gn++,__:n,Consumer:function(i,s){return i.children(s)},Provider:function(i){var s,r;return this.getChildContext||(s=new Set,(r={})[e]=this,this.getChildContext=function(){return r},this.componentWillUnmount=function(){s=null},this.shouldComponentUpdate=function(o){this.props.value!==o.value&&s.forEach(function(a){a.__e=!0,mt(a)})},this.sub=function(o){s.add(o);var a=o.componentWillUnmount;o.componentWillUnmount=function(){s&&s.delete(o),a&&a.call(o)}}),i.children}};return t.Provider.__=t.Consumer.contextType=t}De=yn.slice,V={__e:function(n,e,t,i){for(var s,r,o;e=e.__;)if((s=e.__c)&&!s.__)try{if((r=s.constructor)&&r.getDerivedStateFromError!=null&&(s.setState(r.getDerivedStateFromError(n)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,i||{}),o=s.__d),o)return s.__E=s}catch(a){n=a}throw n}},dn=0,_n=function(n){return n!=null&&n.constructor==null},Q.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=ne({},this.state),typeof n=="function"&&(n=n(ne({},t),this.props)),n&&ne(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),mt(this))},Q.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),mt(this))},Q.prototype.render=le,ae=[],mn=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,pt=function(n,e){return n.__v.__b-e.__v.__b},Ye.__r=0,vn=/(PointerCapture)$|Capture$/i,Vt=0,dt=Bt(!1),_t=Bt(!0),gn=0;var xi=0;function u(n,e,t,i,s,r){e||(e={});var o,a,l=e;if("ref"in l)for(a in l={},e)a=="ref"?o=e[a]:l[a]=e[a];var c={type:n,props:l,key:t,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--xi,__i:-1,__u:0,__source:s,__self:r};if(typeof n=="function"&&(o=n.defaultProps))for(a in o)l[a]===void 0&&(l[a]=o[a]);return V.vnode&&V.vnode(c),c}var ce,I,lt,Gt,Ne=0,Cn=[],E=V,Ot=E.__b,Wt=E.__r,Ut=E.diffed,Rt=E.__c,zt=E.unmount,Ft=E.__;function Ee(n,e){E.__h&&E.__h(I,n,Ne||e),Ne=0;var t=I.__H||(I.__H={__:[],__h:[]});return n>=t.__.length&&t.__.push({}),t.__[n]}function nt(n){return Ne=1,ki(Sn,n)}function ki(n,e,t){var i=Ee(ce++,2);if(i.t=n,!i.__c&&(i.__=[t?t(e):Sn(void 0,e),function(a){var l=i.__N?i.__N[0]:i.__[0],c=i.t(l,a);l!==c&&(i.__N=[c,i.__[1]],i.__c.setState({}))}],i.__c=I,!I.u)){var s=function(a,l,c){if(!i.__c.__H)return!0;var f=i.__c.__H.__.filter(function(d){return!!d.__c});if(f.every(function(d){return!d.__N}))return!r||r.call(this,a,l,c);var h=i.__c.props!==a;return f.forEach(function(d){if(d.__N){var p=d.__[0];d.__=d.__N,d.__N=void 0,p!==d.__[0]&&(h=!0)}}),r&&r.call(this,a,l,c)||h};I.u=!0;var r=I.shouldComponentUpdate,o=I.componentWillUpdate;I.componentWillUpdate=function(a,l,c){if(this.__e){var f=r;r=void 0,s(a,l,c),r=f}o&&o.call(this,a,l,c)},I.shouldComponentUpdate=s}return i.__N||i.__}function it(n,e){var t=Ee(ce++,3);!E.__s&&Ht(t.__H,e)&&(t.__=n,t.i=e,I.__H.__h.push(t))}function Pe(n,e){var t=Ee(ce++,4);!E.__s&&Ht(t.__H,e)&&(t.__=n,t.i=e,I.__h.push(t))}function me(n){return Ne=5,st(function(){return{current:n}},[])}function Mn(n,e,t){Ne=6,Pe(function(){return typeof n=="function"?(n(e()),function(){return n(null)}):n?(n.current=e(),function(){return n.current=null}):void 0},t==null?t:t.concat(n))}function st(n,e){var t=Ee(ce++,7);return Ht(t.__H,e)&&(t.__=n(),t.__H=e,t.__h=n),t.__}function Hn(n){var e=I.context[n.__c],t=Ee(ce++,9);return t.c=n,e?(t.__==null&&(t.__=!0,e.sub(I)),e.props.value):n.__}function Ci(){for(var n;n=Cn.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(qe),n.__H.__h.forEach(vt),n.__H.__h=[]}catch(e){n.__H.__h=[],E.__e(e,n.__v)}}E.__b=function(n){I=null,Ot&&Ot(n)},E.__=function(n,e){n&&e.__k&&e.__k.__m&&(n.__m=e.__k.__m),Ft&&Ft(n,e)},E.__r=function(n){Wt&&Wt(n),ce=0;var e=(I=n.__c).__H;e&&(lt===I?(e.__h=[],I.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.i=t.__N=void 0})):(e.__h.forEach(qe),e.__h.forEach(vt),e.__h=[],ce=0)),lt=I},E.diffed=function(n){Ut&&Ut(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(Cn.push(e)!==1&&Gt===E.requestAnimationFrame||((Gt=E.requestAnimationFrame)||Mi)(Ci)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.i=void 0})),lt=I=null},E.__c=function(n,e){e.some(function(t){try{t.__h.forEach(qe),t.__h=t.__h.filter(function(i){return!i.__||vt(i)})}catch(i){e.some(function(s){s.__h&&(s.__h=[])}),e=[],E.__e(i,t.__v)}}),Rt&&Rt(n,e)},E.unmount=function(n){zt&&zt(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(i){try{qe(i)}catch(s){e=s}}),t.__H=void 0,e&&E.__e(e,t.__v))};var qt=typeof requestAnimationFrame=="function";function Mi(n){var e,t=function(){clearTimeout(i),qt&&cancelAnimationFrame(e),setTimeout(n)},i=setTimeout(t,100);qt&&(e=requestAnimationFrame(t))}function qe(n){var e=I,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),I=e}function vt(n){var e=I;n.__c=n.__(),I=e}function Ht(n,e){return!n||n.length!==e.length||e.some(function(t,i){return t!==n[i]})}function Sn(n,e){return typeof e=="function"?e(n):e}const Hi={id:"wire",name:"Wire",category:"Conductors",prefix:"W",shapes:[["l",-15,15,15,-15]],pins:[["a",-15,15],["a",15,-15]],labels:[0,0,"cm"],device:null},Si={id:"g",name:"Ground",category:"Conductors",prefix:"G",shapes:[["l",0,0,0,15],["l",-20,15,20,15],["l",-10,20,10,20],["l",-5,25,5,25]],pins:[["a",0,0]],labels:[0,30,"ct"],device:null},Ai={id:"p",name:"Port",category:"Conductors",prefix:"P",shapes:[["l",0,-15,0,0],["c",0,-25,10]],pins:[["a",0,0]],labels:[0,-40,"cb"],device:null},re={wire:Hi,ground:Si,port:Ai};class j extends Error{name="CircuitError";constructor(e,t){super(e,t)}}class b{static number(e){return{type:"number",...e}}static string(e){return{type:"string",...e}}static temp=b.number({defaultValue:26.85,range:["real",">",-273.15],title:"device temperature in degrees Celsius"});schema=new Map;values=new Map;constructor(e){for(const[t,i]of Object.entries(e))this.schema.set(t,i)}names(){return[...this.schema.keys()]}prop(e){const t=this.schema.get(e);if(t==null){const i=this.names();throw new j(`Unknown property [${e}]. Expected one of ${i.map(s=>`[${s}]`).join(", ")}.`)}return t}from(e){for(const[t,i]of e.values.entries())this.set(t,i)}hasAll(){for(const[e,t]of this.schema.entries())if(!this.values.has(e)&&t.defaultValue==null)return!1;return!0}has(e){return this.prop(e),this.values.has(e)}set(e,t){const i=this.prop(e);switch(i.type){case"number":{$i(i,e,t);break}case"string":{Ii(i,e,t);break}}return this.values.set(e,t),this}getNumber(e,t=null){const i=this.prop(e);if(i.type!=="number")throw new j(`Property [${e}] is not a number.`);const s=this.values.get(e)??t??i.defaultValue;if(s==null)throw new j(`Property [${e}] has no value.`);return s}getString(e,t=null){const i=this.prop(e);if(i.type!=="string")throw new j(`Property [${e}] is not a string.`);const s=this.values.get(e)??t??i.defaultValue;if(s==null)throw new j(`Property [${e}] has no value.`);return s}}function $i(n,e,t){if(typeof t!="number")throw new j(`Invalid value for property [${e}]. Expected a number, got ${se(t)}.`);const{range:i=["real"]}=n,[s,...r]=i;switch(s){case"real":if(!Number.isFinite(t))throw new j(`Invalid value for property [${e}]. Not a finite value.`);break;case"integer":if(!Number.isInteger(t))throw new j(`Invalid value for property [${e}]. Not an integer value.`);break}let o=0;for(;o<r.length;){const a=r[o++],l=r[o++];switch(a){case">":if(t<=l)throw new j(`Invalid value for property [${e}]. Expected a value larger than ${l}, got ${se(t)}.`);break;case">=":if(t<l)throw new j(`Invalid value for property [${e}]. Expected a value larger than or equal to ${l}, got ${se(t)}.`);break;case"<":if(t>=l)throw new j(`Invalid value for property [${e}]. Expected a value less than ${l}, got ${se(t)}.`);break;case"<=":if(t>l)throw new j(`Invalid value for property [${e}]. Expected a value less than or equal to ${l}, got ${se(t)}.`);break;case"<>":if(t===l)throw new j(`Invalid value for property [${e}]. Expected a value not equal to ${l}.`);break}}}function Ii(n,e,t){if(typeof t!="string")throw new j(`Invalid value for property [${e}]. Expected a string, got ${se(t)}.`);const{range:i=[]}=n;if(i.length>0&&!i.includes(t))throw new j(`Invalid value for property [${e}]. Expected one of ${i.map(s=>se(s)).join(", ")}, got ${se(t)}.`)}function se(n){switch(typeof n){case"string":return`"${n}"`;case"number":return String(n)}return`[${n}]`}class B{static dummy=new class extends B{static id="DUMMY";static numTerminals=0;static propertiesSchema={};static stateSchema={length:0,ops:[]};constructor(){super("DUMMY")}};static id;static numTerminals;static propertiesSchema;static stateSchema;static linear=!0;static Dc=class extends B{initTr(t,i){this.initDc(t,i)}loadTr(t,i,s){this.loadDc(t,i,s)}endTr(t,i){this.endDc(t,i)}};id;properties;state;diffs=[];constructor(e){this.id=e;const{propertiesSchema:t,stateSchema:i}=this.deviceClass;this.properties=new b(t),this.state=new Float64Array(i.length)}get deviceClass(){return this.constructor}connect(e,t){}init(e){}initDc(e,t){}loadDc(e,t,i){}endDc(e,t){}initTr(e,t){}loadTr(e,t,i){}endTr(e,t){}initAc(e){}loadAc(e,t,i){}endAc(e){}}function Ni(n){const e=new Array(n);for(let t=0;t<n;t++)e[t]=gt(n);return e}function Pi(n,e=0){for(const t of n)t.fill(e)}function gt(n){return new Float64Array(n)}function jt(n,e=0){n.fill(e)}function St(n,e){e.set(n)}function Li(n){const e=new Int32Array(n);return An(e),e}function An(n){for(let e=0;e<n.length;e++)n[e]=e}function $n(n,e,t){return Ti(n,e,t,t)}function Ti(n,e,t,i){let s=t,r=Math.abs(n[t][i]);for(t++;t<e;){const o=Math.abs(n[t][i]);o>r&&(s=t,r=o),t++}return s}function Xe(n,e,t){const i=n[e];n[e]=n[t],n[t]=i}class Di extends Error{name="MathError";constructor(e,t){super(e,t)}}class At extends Di{name="SingularMatrixError";constructor(e){super("Singular matrix.",e)}}function Ei(n){const{size:e,A:t,x:i,b:s}=n;for(let r=0;r<e;r++){n.findPivot(r);const o=t[r][r];if(o===0)throw new At;for(let a=r;a<e;a++)t[r][a]/=o;s[r]/=o;for(let a=0;a<e;a++)if(a!==r){const l=t[a][r];for(let c=r;c<e;c++)t[a][c]-=t[r][c]*l;s[a]-=s[r]*l}}St(s,i)}function Bi(n){const{size:e,A:t,x:i,b:s}=n;for(let r=0;r<e-1;r++){n.findPivot(r);const o=t[r][r];if(o===0)throw new At;for(let a=r+1;a<e;a++){const l=t[a][r]/o;for(let c=r;c<e;c++)t[a][c]-=t[r][c]*l;s[a]-=s[r]*l}}for(let r=e-1;r>=0;r--){s[r]/=t[r][r];for(let o=r-1;o>=0;o--)s[o]-=t[o][r]*s[r]}St(s,i)}function Gi(n){const{size:e,A:t,perm:i}=n;for(let s=0;s<e;s++){Wi(t,i,e,s);const r=t[s][s];if(r===0)throw new At;for(let o=s+1;o<e;o++)t[s][o]/=r;for(let o=s+1;o<e;o++)for(let a=s+1;a<e;a++)t[o][a]-=t[o][s]*t[s][a]}}function Oi(n){const{size:e,A:t,x:i,b:s,perm:r}=n;for(let o=0;o<e;o++){let a=0;for(let l=0;l<o;l++)a+=t[o][l]*i[l];i[o]=(s[r[o]]-a)/t[o][o]}for(let o=e-1;o>=0;o--){let a=0;for(let l=o+1;l<e;l++)a+=t[o][l]*s[l];s[o]=i[o]-a}St(s,i)}function Wi(n,e,t,i){const s=$n(n,t,i);s!==i&&(Xe(n,i,s),Xe(e,i,s))}var Me;(function(n){n.Gauss="gauss",n.GaussJordan="gauss-jordan",n.LU="lu"})(Me||(Me={}));class Ui{size;A;x;b;perm;constructor(e){this.size=e,this.A=Ni(e),this.x=gt(e),this.b=gt(e),this.perm=Li(e)}clear(){Pi(this.A),jt(this.x),jt(this.b),An(this.perm)}solve(e){switch(e){case Me.Gauss:Bi(this);break;case Me.GaussJordan:Ei(this);break;case Me.LU:Gi(this),Oi(this);break}}findPivot(e){const{size:t,A:i,b:s}=this,r=$n(i,t,e);r!==e&&(Xe(i,e,r),Xe(s,e,r))}}var Zt;(function(n){n.Euler="euler",n.Trapezoidal="trapezoidal",n.Gear="gear"})(Zt||(Zt={}));const Yt=Symbol("tran"),Ri=Symbol("index");class In{[Yt];[Ri];V=0;C=0;I=0;Geq=0;Ieq=0;diff(e,t){this[Yt].diff(this,e,t)}}const zi=6;(()=>{const n=new Array;for(let e=0;e<=zi+1;e++)n.push(new Ui(e));return n})();class Fi extends B{static id="C";static numTerminals=2;static propertiesSchema={C:b.number({title:"capacitance",range:["real",">",0]}),V0:b.number({title:"initial voltage",defaultValue:0})};static stateSchema={length:4,ops:[{index:2,name:"V",unit:"V"},{index:3,name:"I",unit:"A"}]};diff=new In;na;nb;constructor(e){super(e),this.diffs.push(this.diff)}connect(e,[t,i]){this.na=t,this.nb=i}init(e){e[0]=this.properties.getNumber("C"),e[1]=this.properties.getNumber("V0")}endDc(e,t){const{na:i,nb:s}=this;e[2]=i.voltage-s.voltage,e[3]=0}loadTr(e,{time:t},i){const{diff:s,na:r,nb:o}=this,a=e[0],l=t>0?r.voltage-o.voltage:e[1];s.diff(l,a),e[2]=s.V,e[3]=s.I,i.stampConductance(r,o,s.Geq),i.stampCurrentSource(r,o,s.Ieq)}loadAc(e,t,i){const{na:s,nb:r}=this,o=e[0],a=2*Math.PI*t*o;i.stampConductance(s,r,0,a)}}class qi extends B{static id="L";static numTerminals=2;static propertiesSchema={L:b.number({title:"inductance",range:["real",">",0]}),I0:b.number({title:"initial current",defaultValue:0})};static stateSchema={length:4,ops:[{index:2,name:"V",unit:"V"},{index:3,name:"I",unit:"A"}]};diff=new In;na;nb;branch;constructor(e){super(e),this.diffs.push(this.diff)}connect(e,[t,i]){this.na=t,this.nb=i,this.branch=e.makeBranch(this.na,this.nb)}init(e){e[0]=this.properties.getNumber("L"),e[1]=this.properties.getNumber("I0")}loadDc(e,t,i){const{na:s,nb:r,branch:o}=this;i.stampVoltageSource(s,r,o,0)}endDc(e,t){const{branch:i}=this;e[2]=0,e[3]=i.current}loadTr(e,{time:t},i){const{diff:s,na:r,nb:o,branch:a}=this,l=e[0],c=t>0?a.current:e[1];s.diff(c,l),e[2]=s.I,e[3]=s.V,i.stampA(a,a,-s.Geq),i.stampVoltageSource(r,o,a,s.Ieq)}loadAc(e,t,i){const{na:s,nb:r}=this,o=e[0],a=-1/(2*Math.PI*t*o);i.stampConductance(s,r,0,a)}}class ji extends B.Dc{static id="R";static numTerminals=2;static propertiesSchema={R:b.number({title:"resistance",range:["real","<>",0]})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};na;nb;connect(e,[t,i]){this.na=t,this.nb=i}init(e){const t=this.properties.getNumber("R");e[0]=1/t}loadDc(e,t,i){const{na:s,nb:r}=this,o=e[0];i.stampConductance(s,r,o)}endDc(e,t){const{na:i,nb:s}=this,r=e[0],o=i.voltage-s.voltage,a=o*r;e[1]=o,e[2]=a}loadAc(e,t,i){const{na:s,nb:r}=this,o=e[0];i.stampConductance(s,r,o,0)}}function Be(n){return n+273.15}const Zi=Be(26.85),Yi=1602176634e-28,Ki=1380649e-29,Xi=3,Ji=1.11,Qi=2/Math.PI,es=Math.PI/2,J=1e-12,Nn="npn",Pn="pnp",$t="nfet",It="pfet";function ts(n){switch(n){case Nn:return 1;case Pn:return-1}}function Ln(n){switch(n){case $t:return 1;case It:return-1}}function de(n,e,t){const i=n/Zi,s=t*n*(Ki/Yi),r=e*Math.pow(i,Xi/t)*Math.exp((i-1)*(Ji/s)),o=s*Math.log(s/Math.sqrt(2)/r);return[s,r,o]}function ue(n,e,t){if(n>=0){const i=1/t;return e*(Math.exp(i*n)-1)}else return 0}function he(n,e,t){if(n>=0){const i=1/t;return i*e*Math.exp(i*n)}else return 0}function fe(n,e,t,i){if(n>=0&&n>i&&Math.abs(n-e)>2*t)if(e>0){const s=(n-e)/t;s>0?n=e+t*(2+Math.log(s-2)):n=e-t*(2+Math.log(2-s))}else n=i;return n}function Ue(n,e){return Math.abs(n-e)>.5?n>e?e+.5:e-.5:n}class Tn extends B.Dc{static id="BJT";static numTerminals=3;static propertiesSchema={polarity:b.string({range:[Nn,Pn],title:"transistor polarity"}),Bf:b.number({defaultValue:100,range:["real",">",0],title:"forward beta"}),Br:b.number({defaultValue:1,range:["real",">",0],title:"reverse beta"}),Is:b.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),Nf:b.number({defaultValue:1,range:["real",">",0],title:"forward emission coefficient"}),Nr:b.number({defaultValue:1,range:["real",">",0],title:"reverse emission coefficient"}),Vaf:b.number({defaultValue:10,range:["real",">=",0],title:"forward Early voltage"}),Var:b.number({defaultValue:0,range:["real",">=",0],title:"reverse Early voltage"}),temp:b.temp};static stateSchema={length:16,ops:[{index:8,name:"Vbe",unit:"V"},{index:9,name:"Vbc",unit:"V"},{index:10,name:"Vce",unit:"V"},{index:11,name:"Ie",unit:"A"},{index:12,name:"Ic",unit:"A"},{index:13,name:"Ib",unit:"A"}]};static linear=!1;ne;nb;nc;connect(e,[t,i,s]){this.ne=t,this.nb=i,this.nc=s}initDc(e,t){const i=this.properties.getString("polarity"),s=this.properties.getNumber("Bf"),r=this.properties.getNumber("Br"),o=this.properties.getNumber("Is"),a=this.properties.getNumber("Nf"),l=this.properties.getNumber("Nr"),c=Be(this.properties.getNumber("temp",t.temp)),f=ts(i),h=s/(s+1),d=r/(r+1),[p,,_]=de(c,o,a),[g,,x]=de(c,o,l),[,y]=de(c,o,1);e[0]=f,e[1]=h,e[2]=d,e[3]=y,e[4]=p,e[5]=g,e[6]=_,e[7]=x}eval(e,t){const{ne:i,nb:s,nc:r}=this,o=e[0],a=e[1],l=e[2],c=e[3],f=e[4],h=e[5],d=e[6],p=e[7];let _=o*(s.voltage-i.voltage),g=o*(s.voltage-r.voltage);t&&(_=fe(_,o*e[8],f,d),g=fe(g,o*e[9],h,p));const x=ue(_,c,f),y=ue(g,c,h),v=l*y-x,G=a*x-y,$=he(_,c,f)+J,F=he(g,c,h)+J;e[8]=o*_,e[9]=o*g,e[10]=o*(_-g),e[11]=o*v,e[12]=o*G,e[13]=o*-(v+G),e[14]=$,e[15]=F}loadDc(e,t,i){const{ne:s,nb:r,nc:o}=this;this.eval(e,!0);const a=e[0],l=e[1],c=e[2],f=a*e[8],h=a*e[9],d=a*e[11],p=a*e[12],_=e[14],g=e[15],x=-_,y=-g,v=c*g,G=l*_;i.stampConductance(s,r,-x),i.stampConductance(o,r,-y),i.stampTransconductance(s,r,o,r,-v),i.stampTransconductance(o,r,s,r,-G),i.stampCurrentSource(s,r,a*(d-x*f-v*h)),i.stampCurrentSource(o,r,a*(p-G*f-y*h))}endDc(e,t){this.eval(e,!1)}}class rt extends B.Dc{static id="Diode";static numTerminals=2;static propertiesSchema={Is:b.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:b.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:b.temp};static stateSchema={length:7,ops:[{index:4,name:"V",unit:"V"},{index:5,name:"I",unit:"A"}]};static linear=!1;na;nc;connect(e,[t,i]){this.na=t,this.nc=i}initDc(e,t){const i=this.properties.getNumber("Is"),s=this.properties.getNumber("N"),r=Be(this.properties.getNumber("temp",t.temp)),[o,a,l]=de(r,i,s);e[0]=a,e[2]=o,e[3]=l}eval(e,t){const{na:i,nc:s}=this,r=e[0],o=e[2],a=e[3];let l=i.voltage-s.voltage;t&&(l=fe(l,e[4],o,a));const c=ue(l,r,o),f=he(l,r,o)+J;e[4]=l,e[5]=c,e[6]=f}loadDc(e,t,i){const{na:s,nc:r}=this;this.eval(e,!0);const o=e[4],a=e[5],l=e[6];i.stampConductance(s,r,l),i.stampCurrentSource(s,r,a-l*o)}endDc(e,t){this.eval(e,!1)}}class Dn extends B.Dc{static id="JFET";static numTerminals=3;static propertiesSchema={polarity:b.string({range:[$t,It],title:"transistor polarity"}),Vth:b.number({defaultValue:-2,range:["real"],title:"threshold voltage"}),beta:b.number({defaultValue:1e-4,range:["real",">",0],title:"transconductance parameter"}),lambda:b.number({defaultValue:0,range:["real",">=",0],title:"channel-length modulation parameter"}),Is:b.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:b.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:b.temp};static stateSchema={length:17,ops:[{index:7,name:"Vgs",unit:"V"},{index:10,name:"Vgd",unit:"V"},{index:13,name:"Vds",unit:"V"},{index:14,name:"Ids",unit:"A"}]};static linear=!1;ns;ng;nd;connect(e,[t,i,s]){this.ns=t,this.ng=i,this.nd=s}initDc(e,t){const i=this.properties.getString("polarity"),s=this.properties.getNumber("Vth"),r=this.properties.getNumber("beta"),o=this.properties.getNumber("lambda"),a=this.properties.getNumber("Is"),l=this.properties.getNumber("N"),c=Be(this.properties.getNumber("temp",t.temp)),f=Ln(i),[h,d,p]=de(c,a,l);e[0]=f,e[1]=s,e[2]=r,e[3]=o,e[4]=d,e[5]=h,e[6]=p}eval(e,t){const{ns:i,ng:s,nd:r}=this,o=e[0],a=e[1],l=e[2],c=e[3],f=e[4],h=e[5],d=e[6];let p=o*(s.voltage-i.voltage),_=o*(s.voltage-r.voltage);t&&(p=fe(p,o*e[7],h,d),_=fe(_,o*e[10],h,d));const g=p-_,x=ue(p,f,h),y=he(p,f,h)+J,v=ue(_,f,h),G=he(_,f,h)+J;let $,F,q;if(p>=_){const C=p-a;if(C<=0)$=0,F=J,q=0;else{const L=c*g,O=l*(1+L);C<=g?($=O*C*C,F=l*c*C*C,q=2*O*C):($=O*g*(2*C-g),F=2*O*(C-g)+l*L*(2*C-g),q=2*O*g)}}else{const C=_-a;if(C<=0)$=0,F=J,q=0;else{const L=-g,O=c*L,M=l*(1+O);C<=L?($=-M*C*C,F=l*c*C*C+2*M*C,q=-2*M*C):($=-M*L*(2*C-L),F=2*M*C+l*O*(2*C-L),q=-2*M*L)}}e[7]=o*p,e[10]=o*_,e[13]=o*g,e[8]=o*x,e[9]=y,e[11]=o*v,e[12]=G,e[14]=o*$,e[15]=F,e[16]=q}loadDc(e,t,i){const{ns:s,ng:r,nd:o}=this;this.eval(e,!0);const a=e[0],l=a*e[7],c=a*e[8],f=e[9],h=a*e[10],d=a*e[11],p=e[15],_=a*e[13],g=a*e[14],x=e[15],y=e[16];i.stampConductance(r,s,f),i.stampCurrentSource(r,s,a*(c-f*l)),i.stampConductance(r,o,p),i.stampCurrentSource(r,o,a*(d-p*h)),i.stampConductance(o,s,x),i.stampTransconductance(o,s,r,s,y),i.stampCurrentSource(o,s,a*(g-x*_-y*l))}endDc(e,t){this.eval(e,!1)}}class En extends B.Dc{static id="MOSFET";static numTerminals=4;static propertiesSchema={polarity:b.string({range:[$t,It],title:"transistor polarity"}),Vth:b.number({range:["real"],title:"threshold voltage"}),beta:b.number({defaultValue:.02,range:["real",">",0],title:"transconductance parameter"}),lambda:b.number({defaultValue:0,range:["real",">=",0],title:"channel-length modulation parameter"}),Is:b.number({defaultValue:1e-14,range:["real",">",0],title:"saturation current"}),N:b.number({defaultValue:1,range:["real",">",0],title:"emission coefficient"}),temp:b.temp};static stateSchema={length:19,ops:[{index:13,name:"Vgs",unit:"V"},{index:14,name:"Vgd",unit:"V"},{index:15,name:"Vds",unit:"V"},{index:16,name:"Ids",unit:"A"}]};static linear=!1;ns;ng;nd;nb;connect(e,[t,i,s,r]){this.ns=t,this.ng=i,this.nd=s,this.nb=r}initDc(e,t){const i=this.properties.getString("polarity"),s=this.properties.getNumber("Vth"),r=this.properties.getNumber("beta"),o=this.properties.getNumber("lambda"),a=this.properties.getNumber("Is"),l=this.properties.getNumber("N"),c=Be(this.properties.getNumber("temp",t.temp)),f=Ln(i),[h,d,p]=de(c,a,l);e[0]=f,e[1]=s,e[2]=r,e[3]=o,e[4]=d,e[5]=h,e[6]=p}eval(e,t){const{ns:i,ng:s,nd:r,nb:o}=this,a=e[0],l=e[1],c=e[2],f=e[3],h=e[4],d=e[5],p=e[6];let _=a*(o.voltage-i.voltage),g=a*(o.voltage-r.voltage),x=e[13]=a*(s.voltage-i.voltage),y=e[14]=a*(s.voltage-r.voltage),v=x-y;t&&(_=fe(_,a*e[7],d,p),g=fe(g,a*e[10],d,p),v>0?(x=Ue(x,a*e[13]),v=Ue(x-y,a*e[15])):(y=Ue(y,a*e[14]),v=Ue(x-y,a*e[15])));const G=ue(_,h,d),$=he(_,h,d)+J,F=ue(g,h,d),q=he(g,h,d)+J;let C,L,O;if(v>0){const M=x-a*l;if(M<=0)C=0,L=J,O=0;else{const W=f*v,Y=c*(1+W);M<=v?(C=1/2*Y*M*M,L=1/2*c*f*M*M,O=Y*M):(C=Y*v*(M-v/2),L=Y*(M-v)+c*W*(M-v/2),O=Y*v)}}else{const M=y-a*l;if(M<=0)C=0,L=J,O=0;else{const W=-v,Y=f*W,ke=c*(1+Y);M<=W?(C=-.5*ke*M*M,L=1/2*c*f*M*M,O=ke*M):(C=-ke*W*(M-W/2),L=ke*M+c*Y*(M-W/2),O=ke*W)}}e[7]=a*_,e[10]=a*g,e[13]=a*x,e[14]=a*y,e[15]=a*v,e[8]=a*G,e[9]=$,e[11]=a*F,e[12]=q,e[16]=a*C,e[17]=L,e[18]=O}loadDc(e,t,i){const{ns:s,ng:r,nd:o,nb:a}=this;this.eval(e,!0);const l=e[0],c=l*e[7],f=l*e[10],h=l*e[13],d=l*e[14],p=l*e[15],_=l*e[8],g=e[9],x=l*e[11],y=e[12],v=l*e[16],G=e[17],$=e[18];i.stampConductance(a,s,g),i.stampCurrentSource(a,s,l*(_-g*c)),i.stampConductance(a,o,y),i.stampCurrentSource(a,o,l*(x-y*f)),p>0?(i.stampConductance(o,s,G),i.stampTransconductance(o,s,r,s,$),i.stampCurrentSource(o,s,l*(v-G*p-$*h))):(i.stampConductance(o,s,G),i.stampTransconductance(o,s,r,o,$),i.stampCurrentSource(o,s,l*(v-G*p-$*d)))}endDc(e,t){this.eval(e,!1)}}class ns extends B.Dc{static id="OpAmp";static numTerminals=3;static propertiesSchema={gain:b.number({defaultValue:1e6,range:["real",">",0],title:"gain"}),Vmax:b.number({defaultValue:15,range:["real",">",0],title:"maximum absolute value of output voltage"})};static stateSchema={length:5,ops:[{index:2,name:"Vin",unit:"V"},{index:3,name:"Vout",unit:"V"}]};static linear=!1;np;nn;no;branch;connect(e,[t,i,s]){this.np=t,this.nn=i,this.no=s,this.branch=e.makeBranch(this.no,e.groundNode)}init(e){const t=this.properties.getNumber("gain"),i=this.properties.getNumber("Vmax");e[0]=t,e[1]=i}loadDc(e,t,i){const{np:s,nn:r,no:o,branch:a}=this,l=e[0],c=e[1],f=s.voltage-r.voltage,h=es*l*f/c,d=c*Qi*Math.atan(h),p=l/(1+h*h)+J;e[2]=f,e[3]=d,e[4]=p,i.stampA(o,a,1),i.stampA(a,s,p),i.stampA(a,r,-p),i.stampA(a,o,-1),i.stampB(a,p*f-d)}}class is extends B.Dc{static id="Ammeter";static numTerminals=2;static propertiesSchema={};static stateSchema={length:1,ops:[{index:0,name:"I",unit:"A"}]};np;nn;branch;connect(e,[t,i]){this.np=t,this.nn=i,this.branch=e.makeBranch(this.np,this.nn)}loadDc(e,t,i){const{np:s,nn:r,branch:o}=this;i.stampVoltageSource(s,r,o,0)}endDc(e,t){const{branch:i}=this;e[0]=i.current}}class ss extends B.Dc{static id="Voltmeter";static numTerminals=2;static propertiesSchema={};static stateSchema={length:1,ops:[{index:0,name:"V",unit:"V"}]};np;nn;connect(e,[t,i]){this.np=t,this.nn=i}endDc(e,t){const{np:i,nn:s}=this;e[0]=i.voltage-s.voltage}}class bl extends B.Dc{static id="CCCS";static numTerminals=4;static propertiesSchema={gain:b.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;ncp;ncn;branch;connect(e,[t,i,s,r]){this.np=t,this.nn=i,this.ncp=s,this.ncn=r,this.branch=e.makeBranch(this.ncp,this.ncn)}init(e){e[0]=this.properties.getNumber("gain")}loadDc(e,t,i){const{np:s,nn:r,ncp:o,ncn:a,branch:l}=this,c=e[0];i.stampVoltageSource(o,a,l,0),i.stampA(s,l,c),i.stampA(r,l,-c)}endDc(e,t){const{np:i,nn:s,branch:r}=this,o=e[0],a=r.current*o,l=i.voltage-s.voltage;e[1]=a,e[2]=l}}class wl extends B.Dc{static id="CCVS";static numTerminals=4;static propertiesSchema={gain:b.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;ncp;ncn;branch1;branch2;connect(e,[t,i,s,r]){this.np=t,this.nn=i,this.ncp=s,this.ncn=r,this.branch1=e.makeBranch(this.np,this.nn),this.branch2=e.makeBranch(this.ncp,this.ncn)}init(e){e[0]=this.properties.getNumber("gain")}loadDc(e,t,i){const{np:s,nn:r,branch1:o,ncp:a,ncn:l,branch2:c}=this,f=e[0];i.stampVoltageSource(s,r,o,0),i.stampVoltageSource(a,l,c,0),i.stampA(o,c,-f)}endDc(e,t){const{np:i,nn:s,branch1:r}=this,o=i.voltage-s.voltage,a=r.current;e[1]=o,e[2]=a}}class Vl extends B{static id="Iac";static numTerminals=2;static propertiesSchema={I:b.number({title:"amplitude"}),f:b.number({title:"frequency"}),phase:b.number({title:"phase",defaultValue:0})};static stateSchema={length:5,ops:[{index:3,name:"I",unit:"A"},{index:4,name:"V",unit:"V"}]};np;nn;connect(e,[t,i]){this.np=t,this.nn=i}init(e){const t=this.properties.getNumber("I"),i=this.properties.getNumber("f"),s=this.properties.getNumber("phase"),r=2*Math.PI*i,o=s/180*Math.PI;e[0]=t,e[1]=r,e[2]=o}endDc(e,t){e[3]=0,e[4]=0}loadTr(e,{time:t,sourceFactor:i},s){const{np:r,nn:o}=this,a=e[0],l=e[1],c=e[2],f=i*a*Math.sin(l*t+c);e[3]=f,s.stampCurrentSource(r,o,f)}endTr(e,t){const{np:i,nn:s}=this;e[4]=i.voltage-s.voltage}loadAc(e,t,i){const{np:s,nn:r}=this,o=e[0],a=e[2],l=o*Math.cos(a),c=o*Math.sin(a);i.stampCurrentSource(s,r,l,c)}}class rs extends B.Dc{static id="I";static numTerminals=2;static propertiesSchema={I:b.number({title:"current"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;connect(e,[t,i]){this.np=t,this.nn=i}init(e){e[0]=this.properties.getNumber("I")}loadDc(e,{sourceFactor:t},i){const{np:s,nn:r}=this,o=e[0],a=t*o;e[1]=a,i.stampCurrentSource(s,r,a)}endDc(e,t){const{np:i,nn:s}=this;e[2]=i.voltage-s.voltage}}class xl extends B{static id="Vac";static numTerminals=2;static propertiesSchema={V:b.number({title:"amplitude"}),f:b.number({title:"frequency"}),phase:b.number({title:"phase",defaultValue:0})};static stateSchema={length:5,ops:[{index:3,name:"V",unit:"V"},{index:4,name:"I",unit:"A"}]};np;nn;branch;connect(e,[t,i]){this.np=t,this.nn=i,this.branch=e.makeBranch(this.np,this.nn)}init(e){const t=this.properties.getNumber("V"),i=this.properties.getNumber("f"),s=this.properties.getNumber("phase"),r=2*Math.PI*i,o=s/180*Math.PI;e[0]=t,e[1]=r,e[2]=o}loadDc(e,t,i){const{np:s,nn:r,branch:o}=this;i.stampVoltageSource(s,r,o,0)}endDc(e,t){e[3]=0,e[4]=0}loadTr(e,{time:t,sourceFactor:i},s){const{np:r,nn:o,branch:a}=this,l=e[0],c=e[1],f=e[2],h=i*l*Math.sin(c*t+f);e[3]=h,s.stampVoltageSource(r,o,a,h)}endTr(e,t){const{branch:i}=this,s=i.current;e[4]=s}loadAc(e,t,i){const{np:s,nn:r,branch:o}=this,a=e[0],l=e[2],c=a*Math.cos(l),f=a*Math.sin(l);i.stampVoltageSource(s,r,o,c,f)}}class kl extends B.Dc{static id="VCCS";static numTerminals=4;static propertiesSchema={gain:b.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"I",unit:"A"},{index:2,name:"V",unit:"V"}]};np;nn;ncp;ncn;branch;connect(e,[t,i,s,r]){this.np=t,this.nn=i,this.ncp=s,this.ncn=r,this.branch=e.makeBranch(this.np,this.nn)}init(e){e[0]=this.properties.getNumber("gain")}loadDc(e,t,i){const{np:s,nn:r,ncp:o,ncn:a,branch:l}=this,c=e[0];i.stampA(s,l,1),i.stampA(r,l,-1),i.stampA(l,o,c),i.stampA(l,a,-c),i.stampA(l,l,-1)}endDc(e,t){const{np:i,nn:s,branch:r}=this;e[1]=r.current,e[2]=i.voltage-s.voltage}}class Cl extends B.Dc{static id="VCVS";static numTerminals=4;static propertiesSchema={gain:b.number({title:"gain"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;ncp;ncn;branch;connect(e,[t,i,s,r]){this.np=t,this.nn=i,this.ncp=s,this.ncn=r,this.branch=e.makeBranch(this.np,this.nn)}init(e){e[0]=this.properties.getNumber("gain")}loadDc(e,t,i){const{np:s,nn:r,ncp:o,ncn:a,branch:l}=this,c=e[0];i.stampVoltageSource(s,r,l,0),i.stampA(l,o,-c),i.stampA(l,a,c)}endDc(e,t){const{np:i,nn:s,branch:r}=this;e[1]=i.voltage-s.voltage,e[2]=r.current}}class os extends B.Dc{static id="V";static numTerminals=2;static propertiesSchema={V:b.number({title:"voltage"})};static stateSchema={length:3,ops:[{index:1,name:"V",unit:"V"},{index:2,name:"I",unit:"A"}]};np;nn;branch;connect(e,[t,i]){this.np=t,this.nn=i,this.branch=e.makeBranch(this.np,this.nn)}init(e){e[0]=this.properties.getNumber("V")}loadDc(e,{sourceFactor:t},i){const{np:s,nn:r,branch:o}=this,a=e[0],l=t*a;e[1]=l,i.stampVoltageSource(s,r,o,l)}endDc(e,t){const{branch:i}=this;e[2]=i.current}}const as={id:"r",name:"Resistor",category:"Linear",prefix:"R",shapes:[["l",0,-30,0,-20],["l",-8,-20,8,-20],["l",-8,20,8,20],["l",-8,-20,-8,20],["l",8,-20,8,20],["l",0,30,0,20]],pins:[["a",0,-30],["b",0,30]],labels:[15,0,"lm"],device:ji},ls={id:"c",name:"Capacitor",category:"Linear",prefix:"C",shapes:[["l",0,-30,0,-6],["l",-20,-6,20,-6],["l",-20,6,20,6],["l",0,30,0,6]],pins:[["a",0,-30],["b",0,30]],labels:[30,0,"lm"],device:Fi},cs={id:"l",name:"Inductor",category:"Linear",prefix:"L",shapes:[["l",0,-30,0,-22],["a",0,-14,7,-90,90],["a",0,0,7,-90,90],["a",0,14,7,-90,90],["l",0,30,0,22]],pins:[["a",0,-30],["b",0,30]],labels:[15,0,"lm"],device:qi},je={resistor:as,capacitor:ls,inductor:cs},ot=(n,e,t,i,s=10)=>{const r=Math.atan2(i-e,t-n),o=r-Math.PI/6,a=r+Math.PI/6;return[["l",n,e,t,i],["l",t,i,t-s*Math.cos(o),i-s*Math.sin(o)],["l",t,i,t-s*Math.cos(a),i-s*Math.sin(a)]]},us={id:"d",name:"Diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-15,-11,15,-11],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:rt},hs={id:"dz",name:"Zener diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-20,-5,-15,-11],["l",-15,-11,15,-11],["l",15,-11,20,-17],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:rt},fs={id:"ds",name:"Schottky diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-10],["l",-9,-17,-15,-17],["l",-15,-17,-15,-11],["l",-15,-11,15,-11],["l",15,-11,15,-5],["l",15,-5,9,-5],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:rt},ps={id:"dv",name:"Varicap diode",category:"Nonlinear",prefix:"D",shapes:[["l",0,-30,0,-17],["l",-15,-17,15,-17],["l",-15,-11,15,-11],["l",0,-10,-15,10],["l",0,-10,15,10],["l",-15,10,15,10],["l",0,30,0,10]],pins:[["a",0,-30],["b",0,30]],labels:[20,0,"lm"],device:rt},ds={id:"npn",name:"NPN bipolar junction transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-20],["l",0,30,0,20],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",-20,-5,0,-20],...ot(-20,5,0,20)],pins:[["c",0,-30],["e",0,30],["b",-30,0]],labels:[10,0,"lm"],device:Tn},_s={id:"pnp",name:"PNP bipolar junction transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-20],["l",0,30,0,20],["l",-30,0,-20,0],["l",-20,-15,-20,15],...ot(0,-20,-20,-5),["l",0,20,-20,5]],pins:[["e",0,-30],["c",0,30],["b",-30,0]],labels:[10,0,"lm"],device:Tn},ms={id:"nfet",name:"N-channel junction field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,10],["l",-30,0,-12,0],["l",0,-10,-12,-10],["l",0,10,-12,10],["l",-12,-15,-12,15],["l",-21,-5,-15,0],["l",-21,5,-15,0]],pins:[["d",0,-30],["s",0,30],["g",-30,0]],labels:[10,0,"lm"],device:Dn},vs={id:"pfet",name:"P-channel junction field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,10],["l",-30,0,-12,0],["l",0,-10,-12,-10],["l",0,10,-12,10],["l",-12,-15,-12,15],["l",-21,0,-15,-5],["l",-21,0,-15,5]],pins:[["s",0,-30],["d",0,30],["g",-30,0]],labels:[10,0,"lm"],device:Dn},gs={id:"nmos",name:"N-channel MOS field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,-10],["l",0,30,0,0],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",0,-10,-15,-10],["l",-15,-15,-15,-6],["l",0,0,-15,0],["l",-15,-3,-15,3],["l",-13,0,-8,-4],["l",-13,0,-8,4],["l",0,10,-15,10],["l",-15,15,-15,6]],pins:[["d",0,-30],["s",0,30],["g",-30,0]],labels:[10,0,"lm"],device:En},ys={id:"pmos",name:"P-channel MOS field-effect transistor",category:"Nonlinear",prefix:"Q",shapes:[["l",0,-30,0,0],["l",0,30,0,10],["l",-30,0,-20,0],["l",-20,-15,-20,15],["l",0,-10,-15,-10],["l",-15,-15,-15,-6],["l",0,0,-15,0],["l",-15,-3,-15,3],["l",-6,-4,-1,0],["l",-6,4,-1,0],["l",0,10,-15,10],["l",-15,15,-15,6]],pins:[["s",0,-30],["d",0,30],["g",-30,0]],labels:[10,0,"lm"],device:En},bs={id:"opamp",name:"Operational amplifier",category:"Nonlinear",prefix:"OA",shapes:[["l",-50,-30,-30,-30],["l",-50,30,-30,30],["l",30,0,50,0],["l",-30,-50,30,0],["l",-30,50,30,0],["l",-30,-50,-30,50],["l",-25,-30,-15,-30],["l",-20,-35,-20,-25],["l",-25,30,-15,30]],pins:[["noninv",-50,-30],["inv",-50,30],["out",50,0]],labels:[-30,55,"lt"],device:ns},K={diode:us,zener:hs,schottky:fs,varicap:ps,npn:ds,pnp:_s,nfet:ms,pfet:vs,nmos:gs,pmos:ys,opamp:bs},ws={id:"vmeter",name:"Voltmeter",category:"Probes",prefix:"Pr",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,30,0,20],["t",0,0,"cm","V"],...ot(-25,25,25,-25)],pins:[["a",0,-30],["b",0,30]],labels:[25,0,"lm"],device:ss},Vs={id:"ameter",name:"Ammeter",category:"Probes",prefix:"Pr",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,30,0,20],["t",0,0,"cm","A"],...ot(-25,25,25,-25)],pins:[["a",0,-30],["b",0,30]],labels:[25,0,"lm"],device:is},xs={vmeter:ws,ameter:Vs},ks={id:"vdc",name:"Ideal DC voltage source",category:"Sources",prefix:"V",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,-15,0,-5],["l",-5,-10,5,-10],["l",-5,10,5,10],["l",0,30,0,20]],pins:[["pos",0,-30],["neg",0,30]],labels:[25,0,"lm"],device:os},Cs={id:"idc",name:"Ideal DC current source",category:"Sources",prefix:"I",shapes:[["l",0,-30,0,-20],["c",0,0,20],["l",0,10,0,-10],["l",0,-11,-5,-3],["l",0,-11,5,-3],["l",0,30,0,20]],pins:[["pos",0,-30],["neg",0,30]],labels:[25,0,"lm"],device:rs},Le={vdc:ks,idc:Cs};class Ms{#e=new Map;constructor(e){for(const t of e)this.#e.set(t.id,t)}[Symbol.iterator](){return this.#e.values()}get(e){const t=this.#e.get(e);if(t==null)throw new Error(`Unknown symbol [${e}]`);return t}}const Bn=new Ms([...Object.values(re),...Object.values(je),...Object.values(K),...Object.values(Le),...Object.values(xs)]);var Hs=Symbol.for("preact-signals");function at(){if(oe>1)oe--;else{for(var n,e=!1;He!==void 0;){var t=He;for(He=void 0,yt++;t!==void 0;){var i=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&On(t))try{t.c()}catch(s){e||(n=s,e=!0)}t=i}}if(yt=0,oe--,e)throw n}}function Ss(n){if(oe>0)return n();oe++;try{return n()}finally{at()}}var A=void 0,He=void 0,oe=0,yt=0,Je=0;function Gn(n){if(A!==void 0){var e=n.n;if(e===void 0||e.t!==A)return e={i:0,S:n,p:A.s,n:void 0,t:A,e:void 0,x:void 0,r:e},A.s!==void 0&&(A.s.n=e),A.s=e,n.n=e,32&A.f&&n.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=A.s,e.n=void 0,A.s.n=e,A.s=e),e}}function z(n){this.v=n,this.i=0,this.n=void 0,this.t=void 0}z.prototype.brand=Hs;z.prototype.h=function(){return!0};z.prototype.S=function(n){this.t!==n&&n.e===void 0&&(n.x=this.t,this.t!==void 0&&(this.t.e=n),this.t=n)};z.prototype.U=function(n){if(this.t!==void 0){var e=n.e,t=n.x;e!==void 0&&(e.x=t,n.e=void 0),t!==void 0&&(t.e=e,n.x=void 0),n===this.t&&(this.t=t)}};z.prototype.subscribe=function(n){var e=this;return Oe(function(){var t=e.value,i=A;A=void 0;try{n(t)}finally{A=i}})};z.prototype.valueOf=function(){return this.value};z.prototype.toString=function(){return this.value+""};z.prototype.toJSON=function(){return this.value};z.prototype.peek=function(){var n=A;A=void 0;try{return this.value}finally{A=n}};Object.defineProperty(z.prototype,"value",{get:function(){var n=Gn(this);return n!==void 0&&(n.i=this.i),this.v},set:function(n){if(n!==this.v){if(yt>100)throw new Error("Cycle detected");this.v=n,this.i++,Je++,oe++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{at()}}}});function ie(n){return new z(n)}function On(n){for(var e=n.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Wn(n){for(var e=n.s;e!==void 0;e=e.n){var t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){n.s=e;break}}}function Un(n){for(var e=n.s,t=void 0;e!==void 0;){var i=e.p;e.i===-1?(e.S.U(e),i!==void 0&&(i.n=e.n),e.n!==void 0&&(e.n.p=i)):t=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=i}n.s=t}function be(n){z.call(this,void 0),this.x=n,this.s=void 0,this.g=Je-1,this.f=4}(be.prototype=new z).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Je))return!0;if(this.g=Je,this.f|=1,this.i>0&&!On(this))return this.f&=-2,!0;var n=A;try{Wn(this),A=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return A=n,Un(this),this.f&=-2,!0};be.prototype.S=function(n){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}z.prototype.S.call(this,n)};be.prototype.U=function(n){if(this.t!==void 0&&(z.prototype.U.call(this,n),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};be.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var n=this.t;n!==void 0;n=n.x)n.t.N()}};Object.defineProperty(be.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var n=Gn(this);if(this.h(),n!==void 0&&(n.i=this.i),16&this.f)throw this.v;return this.v}});function Kt(n){return new be(n)}function Rn(n){var e=n.u;if(n.u=void 0,typeof e=="function"){oe++;var t=A;A=void 0;try{e()}catch(i){throw n.f&=-2,n.f|=8,Nt(n),i}finally{A=t,at()}}}function Nt(n){for(var e=n.s;e!==void 0;e=e.n)e.S.U(e);n.x=void 0,n.s=void 0,Rn(n)}function As(n){if(A!==this)throw new Error("Out-of-order effect");Un(this),A=n,this.f&=-2,8&this.f&&Nt(this),at()}function Ge(n){this.x=n,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}Ge.prototype.c=function(){var n=this.S();try{if(8&this.f||this.x===void 0)return;var e=this.x();typeof e=="function"&&(this.u=e)}finally{n()}};Ge.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Rn(this),Wn(this),oe++;var n=A;return A=this,As.bind(this,n)};Ge.prototype.N=function(){2&this.f||(this.f|=2,this.o=He,He=this)};Ge.prototype.d=function(){this.f|=8,1&this.f||Nt(this)};function Oe(n){var e=new Ge(n);try{e.c()}catch(t){throw e.d(),t}return e.d.bind(e)}var zn,ct,Fn=[];Oe(function(){zn=this.N})();function we(n,e){V[n]=e.bind(null,V[n]||function(){})}function Qe(n){ct&&ct(),ct=n&&n.S()}function qn(n){var e=this,t=n.data,i=Is(t);i.value=t;var s=st(function(){for(var a=e,l=e.__v;l=l.__;)if(l.__c){l.__c.__$f|=4;break}var c=Kt(function(){var p=i.value.value;return p===0?0:p===!0?"":p||""}),f=Kt(function(){return!_n(c.value)}),h=Oe(function(){if(this.N=jn,f.value){var p=c.value;a.base&&a.base.nodeType===3&&(a.base.data=p)}}),d=e.__$u.d;return e.__$u.d=function(){h(),d.call(this)},[f,c]},[]),r=s[0],o=s[1];return r.value?o.peek():o.value}qn.displayName="_st";Object.defineProperties(z.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:qn},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});we("__b",function(n,e){if(typeof e.type=="string"){var t,i=e.props;for(var s in i)if(s!=="children"){var r=i[s];r instanceof z&&(t||(e.__np=t={}),t[s]=r,i[s]=r.peek())}}n(e)});we("__r",function(n,e){Qe();var t,i=e.__c;i&&(i.__$f&=-2,(t=i.__$u)===void 0&&(i.__$u=t=function(s){var r;return Oe(function(){r=this}),r.c=function(){i.__$f|=1,i.setState({})},r}())),Qe(t),n(e)});we("__e",function(n,e,t,i){Qe(),n(e,t,i)});we("diffed",function(n,e){Qe();var t;if(typeof e.type=="string"&&(t=e.__e)){var i=e.__np,s=e.props;if(i){var r=t.U;if(r)for(var o in r){var a=r[o];a!==void 0&&!(o in i)&&(a.d(),r[o]=void 0)}else r={},t.U=r;for(var l in i){var c=r[l],f=i[l];c===void 0?(c=$s(t,l,f,s),r[l]=c):c.o(f,s)}}}n(e)});function $s(n,e,t,i){var s=e in n&&n.ownerSVGElement===void 0,r=ie(t);return{o:function(o,a){r.value=o,i=a},d:Oe(function(){this.N=jn;var o=r.value.value;i[e]!==o&&(i[e]=o,s?n[e]=o:o?n.setAttribute(e,o):n.removeAttribute(e))})}}we("unmount",function(n,e){if(typeof e.type=="string"){var t=e.__e;if(t){var i=t.U;if(i){t.U=void 0;for(var s in i){var r=i[s];r&&r.d()}}}}else{var o=e.__c;if(o){var a=o.__$u;a&&(o.__$u=void 0,a.d())}}n(e)});we("__h",function(n,e,t,i){(i<3||i===9)&&(e.__$f|=2),n(e,t,i)});Q.prototype.shouldComponentUpdate=function(n,e){var t=this.__$u,i=t&&t.s!==void 0;for(var s in e)return!0;if(this.__f||typeof this.u=="boolean"&&this.u===!0){var r=2&this.__$f;if(!(i||r||4&this.__$f)||1&this.__$f)return!0}else if(!(i||4&this.__$f)||3&this.__$f)return!0;for(var o in n)if(o!=="__source"&&n[o]!==this.props[o])return!0;for(var a in this.props)if(!(a in n))return!0;return!1};function Is(n){return st(function(){return ie(n)},[])}var Ns=function(n){queueMicrotask(function(){queueMicrotask(n)})};function Ps(){Ss(function(){for(var n;n=Fn.shift();)zn.call(n)})}function jn(){Fn.push(this)===1&&(V.requestAnimationFrame||Ns)(Ps)}const{round:m}=Math,Ls=(n,e)=>n.x0<=e.x0&&e.x0<=n.x1&&n.y0<=e.y0&&e.y0<=n.y1||n.x0<=e.x0&&e.x0<=n.x1&&n.y0<=e.y1&&e.y1<=n.y1||n.x0<=e.x1&&e.x1<=n.x1&&n.y0<=e.y0&&e.y0<=n.y1||n.x0<=e.x1&&e.x1<=n.x1&&n.y0<=e.y1&&e.y1<=n.y1,Ts=(n,e)=>n.x0<=e.x0&&e.x0<=n.x1&&n.x0<=e.x1&&e.x1<=n.x1&&n.y0<=e.y0&&e.y0<=n.y1&&n.y0<=e.y1&&e.y1<=n.y1,Ds=["input","textarea","select","INPUT","TEXTAREA","SELECT"];function Zn(n){return n instanceof Element&&Ds.includes(n.tagName)}function Es(){const{activeElement:n}=document;Zn(n)&&n.blur()}const S={None:0,Shift:1,Alt:2,Control:4,Meta:8,of:n=>{let e=S.None;return n.shiftKey&&(e|=S.Shift),n.altKey&&(e|=S.Alt),n.ctrlKey&&(e|=S.Control),n.metaKey&&(e|=S.Meta),e}};function Yn(...n){const e=n.map(Bs);return t=>{if(Zn(t.target))return!0;const i=S.of(t);for(const s of e)if((s.key==="any"||s.key===t.key||s.key===t.code)&&s.mod===i&&s.handler(t,i)!==!1)return t.preventDefault(),!0;return!1}}function Bs([n,e]){let t="",i=S.None;const s=n.split("+");for(;s.length>0;){const r=s.shift();switch(r){case"Shift":i|=S.Shift;break;case"Alt":i|=S.Alt;break;case"Ctrl":i|=S.Control;break;case"Meta":i|=S.Meta;break;default:t=r;break}}return{key:t,mod:i,handler:e}}const D=4,N=2,P=1,Gs=[D|N|P,D|P,D|N,D,0,N,P,N|P],Os=[D,D|N,D|P,D|N|P,N|P,P,N,0],Ws=[N,N|P,0,P,D|N,D|P|N,D,D|P],Us=[P,0,N|P,N,D|P,D,D|N|P,D|N],Rs=(n,e)=>{switch(e){case"rl":return Gs[n]??0;case"rr":return Os[n]??0;case"mx":return Ws[n]??0;case"my":return Us[n]??0}return 0},zs=(n,e)=>{let[t,i,s]=n,r=0;return e&D&&(r=i,i=-s,s=r),e&N&&(i=-i),e&P&&(s=-s),[t,i,s]},Kn=(n,e)=>{let t=n.charAt(0),i=n.charAt(1);if(e&N)switch(t){case"l":t="r";break;case"r":t="l";break}if(e&P)switch(i){case"t":i="b";break;case"b":i="t";break}return`${t}${i}`},Fs=(n,e)=>{switch(n[0]){case"l":return qs(n,e);case"c":return js(n,e);case"a":return Zs(n,e);case"t":return Ys(n,e)}return n},qs=(n,e)=>{let[t,i,s,r,o]=n,a=0;return e&D&&(a=i,i=-s,s=a,a=r,r=-o,o=a),e&N&&(i=-i,r=-r),e&P&&(s=-s,o=-o),[t,i,s,r,o]},js=(n,e)=>{let[t,i,s,r]=n,o=0;return e&D&&(o=i,i=-s,s=o),e&N&&(i=-i),e&P&&(s=-s),[t,i,s,r]},Zs=(n,e)=>{let[t,i,s,r,o,a]=n,l=0;return e&D&&(l=i,i=-s,s=l,o+=90,a+=90),e&N&&(i=-i,l=o,o=180-a,a=180-l),e&P&&(s=-s,l=o,o=-a,a=-l),[t,i,s,r,o,a]},Ys=(n,e)=>{let[t,i,s,r,o]=n;r=Kn(r,e);let a=0;return e&D&&(a=i,i=-s,s=a),e&N&&(i=-i),e&P&&(s=-s),[t,i,s,r,o]},Ks=(n,e)=>{let[t,i,s]=n;s=Kn(s,e);let r=0;return e&D&&(r=t,t=-i,i=r),e&N&&(t=-t),e&P&&(i=-i),[t,i,s]},Xn=({shapes:n,pins:e},t,i)=>{const s={x:0,y:0},r={x:0,y:0};for(const o of n)switch(o[0]){case"l":{const[a,l,c,f,h]=o;s.x=Math.min(s.x,l,f),s.y=Math.min(s.y,c,h),r.x=Math.max(r.x,l,f),r.y=Math.max(r.y,c,h);break}case"c":{const[a,l,c,f]=o;s.x=Math.min(s.x,l-f,l+f),s.y=Math.min(s.y,c-f,c+f),r.x=Math.max(r.x,l-f,l+f),r.y=Math.max(r.y,c-f,c+f);break}case"a":{const[a,l,c,f,h,d]=o;s.x=Math.min(s.x,l-f,l+f),s.y=Math.min(s.y,c-f,l+f),r.x=Math.max(r.x,l-f,c+f),r.y=Math.max(r.y,c-f,c+f);break}}for(const[o,a,l]of e)s.x=Math.min(s.x,a),s.y=Math.min(s.y,l),r.x=Math.max(r.x,a),r.y=Math.max(r.y,l);return{x0:t+s.x,y0:i+s.y,x1:t+r.x,y1:i+r.y}};let Xs=0;function Js(){return Xs+=1}class Qs{#e=Js();get id(){return this.#e}}let Pt=class extends Qs{moveTo(e,t){return this}includes(e,t){const{x0:i,y0:s,x1:r,y1:o}=this.area;return i<=e&&e<=r&&s<=t&&t<=o}};class Jn{static anonymous(e){return`${e}?`}#e=new Map;constructor(e){for(const t of e)if(t instanceof ee){const i=this.#i(t.symbol.prefix);i.instances.push(t),i.names.add(t.name)}}getUniqueName(e){const t=this.#i(e);let i=1;for(;;){const s=`${e}${i}`;if(!t.names.has(s))return t.names.add(s),s;i+=1}}rename(e="none"){for(const[t,i]of this.#e.entries()){switch(e){case"none":break;case"horizontal":i.instances.sort((s,r)=>s.x-r.x||s.y-r.y);break;case"vertical":i.instances.sort((s,r)=>s.y-r.y||s.x-r.x);break}i.names.clear();for(const s of i.instances)s.name=this.getUniqueName(t)}}#i(e){let t=this.#e.get(e);return t==null&&this.#e.set(e,t={instances:[],names:new Set}),t}}function er(n,e,t){return Object.assign(Object.create(null),n,{[e]:t})}function tr(n){const e=Object.create(null);if(n!=null)for(const[t,i]of Object.entries(n.propertiesSchema))e[t]=String(i.defaultValue||"");return e}class ee extends Pt{#e;#i;#n;#t;#r;#s;#a=null;#u=null;#p=null;#o=null;constructor(e,t=Jn.anonymous(e.prefix),i=tr(e.device),s=0,r=0,o=0){super(),this.#e=e,this.#i=t,this.#n=i,this.#t=s,this.#r=r,this.#s=o}get symbol(){return this.#e}get name(){return this.#i}set name(e){this.#i=e}get props(){return this.#n}set props(e){this.#n=e}get x(){return this.#t}get y(){return this.#r}get area(){return this.#o??=Xn(this,this.#t,this.#r)}moveTo(e,t){return this.#t=e,this.#r=t,this.#o=null,this}get transform(){return this.#s}transformBy(e){return this.#s=Rs(this.#s,e),this.#a=null,this.#u=null,this.#p=null,this.#o=null,this}get shapes(){return this.#a??=this.#e.shapes.map(e=>Fs(e,this.#s))}get pins(){return this.#u??=this.#e.pins.map(e=>zs(e,this.#s))}get labels(){return this.#p??=Ks(this.#e.labels,this.#s)}}class Ve extends Pt{#e;#i;#n;#t;#r;#s;#a=null;constructor(e,t="lt",i=0,s=0){super(),this.#e=e.trim(),this.#i=t,this.#n=i,this.#t=s,this.#r=0,this.#s=0,this.#a=null}get text(){return this.#e}set text(e){this.#e=e.trim(),this.#r=0,this.#s=0,this.#a=null}get align(){return this.#i}set align(e){this.#i=e,this.#a=null}get x(){return this.#n}get y(){return this.#t}get width(){return this.#r}set width(e){this.#r=e,this.#a=null}get height(){return this.#s}set height(e){this.#s=e,this.#a=null}get area(){return this.#a??=this.#u()}moveTo(e,t){return this.#n=e,this.#t=t,this.#a=null,this}#u(){let e=this.#i.charAt(0),t=this.#i.charAt(1),i=0,s=0,r=0,o=0;switch(e){case"l":i=this.#n,r=this.#n+this.#r;break;case"c":i=this.#n-this.#r/2,r=this.#n+this.#r/2;break;case"r":i=this.#n-this.#r,r=this.#n;break}switch(t){case"t":s=this.#t,o=this.#t+this.#s;break;case"m":s=this.#t-this.#s/2,o=this.#t+this.#s/2;break;case"b":s=this.#t-this.#s,o=this.#t;break}return{x0:i,y0:s,x1:r,y1:o}}}class U extends Pt{#e;#i;#n;#t;#r;constructor(e,t,i,s){super(),this.#e=e,this.#i=t,this.#n=i,this.#t=s,this.#r=null}get x0(){return this.#e}set x0(e){this.#e=e,this.#r=null}get y0(){return this.#i}set y0(e){this.#i=e,this.#r=null}get x1(){return this.#n}set x1(e){this.#n=e,this.#r=null}get y1(){return this.#t}set y1(e){this.#t=e,this.#r=null}get x(){return this.#e}get y(){return this.#i}get area(){return this.#r??={x0:Math.min(this.#e,this.#n),y0:Math.min(this.#i,this.#t),x1:Math.max(this.#e,this.#n),y1:Math.max(this.#i,this.#t)}}moveTo(e,t){const i=this.#n-this.#e,s=this.#t-this.#i;return this.#e=e,this.#i=t,this.#n=e+i,this.#t=t+s,this.#r=null,this}includes(e,t){if(this.#i===this.#t){const h=this.#i,d=Math.min(this.#e,this.#n),p=Math.max(this.#e,this.#n);return d<=e&&e<=p&&h-3<=t&&t<=h+3}if(this.#e===this.#n){const h=this.#e,d=Math.min(this.#i,this.#t),p=Math.max(this.#i,this.#t);return d<=t&&t<=p&&h-3<=e&&e<=h+3}const s=Math.abs((this.#t-this.#i)*e-(this.#n-this.#e)*t+this.#n*this.#i-this.#t*this.#e),r=Math.sqrt((this.#t-this.#i)*(this.#t-this.#i)+(this.#n-this.#e)*(this.#n-this.#e)),o=s/r,a=Math.min(this.#e,this.#n),l=Math.min(this.#i,this.#t),c=Math.max(this.#e,this.#n),f=Math.max(this.#i,this.#t);return a<=e&&e<=c&&l<=t&&t<=f&&o<=3}}function nr(n){const e=new ir,t=new sr;for(const s of n)if(s instanceof U){const{x0:r,y0:o,x1:a,y1:l}=s;if(o===l){e.addWire(o,s);continue}if(r===a){t.addWire(r,s);continue}continue}for(const s of n){if(s instanceof ee){for(const[r,o,a]of s.pins){const l=s.x+o,c=s.y+a;e.split(c,l,n),t.split(l,c,n)}continue}if(s instanceof U){const{x0:r,y0:o,x1:a,y1:l}=s;if(r===a&&o===l)continue;if(o===l){t.split(r,o,n),t.split(a,o,n);continue}if(r===a){e.split(o,r,n),e.split(l,r,n);continue}t.split(r,o,n),t.split(a,l,n),e.split(o,r,n),e.split(l,a,n);continue}}e.merge(),t.merge();let i=0;for(;i<n.length;){const s=n[i];if(s instanceof U){const{x0:r,y0:o,x1:a,y1:l}=s;if(r===a&&o===l){n.splice(i,1);continue}}i+=1}}class ir{lines=new Map;addWire(e,t){const{x0:i,x1:s}=t;t.x0=Math.min(i,s),t.x1=Math.max(i,s),t.y0=e,t.y1=e;let r=this.lines.get(e);r==null&&this.lines.set(e,r={wires:[],breakpoints:[]}),r.wires.push(t)}split(e,t,i){let s=this.lines.get(e);if(s!=null){s.breakpoints.push(t);for(const r of s.wires)if(r.x0<t&&t<r.x1){const o=new U(t,e,r.x1,e);i.push(o),s.wires.push(o),r.x1=t}}}merge(){for(const{wires:e,breakpoints:t}of this.lines.values()){e.sort((s,r)=>s.x0-r.x0);let i=1;for(;i<e.length;){const s=e[i-1],r=e[i],o=t.indexOf(s.x1),a=t.indexOf(r.x0);(o===-1||a===-1||o!==a)&&s.x1>=r.x0&&(r.x0=s.x0,r.x1=Math.max(s.x1,r.x1),s.x1=s.x0),i+=1}}}}class sr{lines=new Map;addWire(e,t){const{y0:i,y1:s}=t;t.y0=Math.min(i,s),t.y1=Math.max(i,s),t.x0=e,t.x1=e;let r=this.lines.get(e);r==null&&this.lines.set(e,r={wires:[],breakpoints:[]}),r.wires.push(t)}split(e,t,i){let s=this.lines.get(e);if(s!=null){s.breakpoints.push(t);for(const r of s.wires)if(r.y0<t&&t<r.y1){const o=new U(e,t,e,r.y1);i.push(o),s.wires.push(o),r.y1=t}}}merge(){for(const{wires:e,breakpoints:t}of this.lines.values()){e.sort((s,r)=>s.y0-r.y0);let i=1;for(;i<e.length;){const s=e[i-1],r=e[i],o=t.indexOf(s.y1),a=t.indexOf(r.y0);(o===-1||a===-1||o!==a)&&s.y1>=r.y0&&(r.y0=s.y0,r.y1=Math.max(s.y1,r.y1),s.y1=s.y0),i+=1}}}}function Te(n){const e=[];for(const t of n){if(t instanceof ee){const{x:i,y:s,transform:r,symbol:o,name:a,props:l}=t;e.push(["i",i,s,r,o.id,a,l])}if(t instanceof U){const{x0:i,y0:s,x1:r,y1:o}=t;e.push(["w",i,s,r,o])}if(t instanceof Ve){const{x:i,y:s,align:r,text:o}=t;e.push(["n",i,s,r,o])}}return e}function ve(n){const e=[];for(const t of n)switch(t[0]){case"i":{const[i,s,r,o,a,l,c]=t;e.push(new ee(Bn.get(a),l,c,s,r,o));break}case"w":{const[i,s,r,o,a]=t;e.push(new U(s,r,o,a));break}case"n":{const[i,s,r,o,a]=t;e.push(new Ve(a,o,s,r));break}}return e}class rr{#e=[];get full(){return this.#e.length>0}take(){return ve(this.#e)}put(e){this.#e=Te(e)}clear(){this.#e=[]}}const Se={instance:1,note:2,wire:4096,notWire:4095,all:65535};function Xt(n,e,t,i=Se.all){for(const s of n)if(i&or(s)&&s.includes(e,t))return s;return null}function or(n){switch(!0){case n instanceof ee:return Se.instance;case n instanceof Ve:return Se.note;case n instanceof U:return Se.wire}return 0}function ar(n){const e=[];for(const t of n)t instanceof ee&&e.push(t);return e}function lr(n){const e=[];for(const t of n)t instanceof U&&e.push(t);return e}function cr(n){const e=[];for(const t of n)t instanceof Ve&&e.push(t);return e}class ur{#e;#i;#n;constructor(e,t,i){this.#e=e,this.#i=t,this.#n=i}get name(){return this.#e}get elements(){return this.#i}get pins(){return this.#n}}class hr{#e;#i;#n;#t;constructor(e,t,i,s){this.#e=e,this.#i=t,this.#n=i,this.#t=s}get x(){return this.#e}get y(){return this.#i}get instance(){return this.#n}get name(){return this.#t}}function fr(){const n=[],e=[],t=[];return new class{get pins(){return n}get joins(){return e}get nodes(){return t}getWires(){return null}getPins(){return null}}}function pr(n){const e=[],t=[],i=[],s=new Map,r=new _r(s,t,i);for(const o of n){if(o instanceof ee){for(const[a,l,c]of o.pins){const f=o.x+l,h=o.y+c,d=new hr(f,h,o,a);e.push(d),r.addPin(d)}continue}o instanceof U&&r.addWire(o)}return r.connect(),new class{get pins(){return e}get joins(){return t}get nodes(){return i}getWires(o,a){return s.get(Ae(o,a))?.wires??null}getPins(o,a){return s.get(Ae(o,a))?.pins??null}}}const dr=new Set([Le.vdc,Le.idc,K.opamp,K.npn,K.pnp,K.nmos,K.pmos,K.nfet,K.pfet]);class _r{cells;joins;nodes;names;constructor(e,t,i){this.cells=e,this.joins=t,this.nodes=i,this.names=new Set(["ground"])}addPin(e){this.getCell(e.x,e.y).pins.push(e)}addWire(e){this.getCell(e.x0,e.y0).wires.push(e),this.getCell(e.x1,e.y1).wires.push(e)}getCell(e,t){const i=Ae(e,t);let s=this.cells.get(i);return s==null&&this.cells.set(i,s={x:e,y:t,wires:[],pins:[],color:null}),s}connect(){this.connectGrounds(),this.connectPorts(),this.connectWithSuggestedNames();let e=1;for(const t of this.cells.values())t.pins.length>0&&t.color==null&&(this.walk([t],this.getColor(this.getUniqueName(`_n${e}`))),e+=1);for(const t of this.cells.values())t.wires.length+t.pins.length>2&&this.joins.push({x:t.x,y:t.y})}connectGrounds(){const e=this.getColor("ground");for(const t of this.cells.values())for(const i of t.pins)if(i.instance.symbol===re.ground){if(e.elements.push(i.instance),t.color==null)this.walk([t],e);else if(t.color!==e){this.conflict(e,t);return}}}connectPorts(){const e=new Map;for(const t of this.cells.values())for(const i of t.pins)if(i.instance.symbol===re.port){const{name:s}=i.instance;this.names.add(s);let r=e.get(s);if(r==null&&e.set(s,r=this.getColor(s)),r.elements.push(i.instance),t.color==null)this.walk([t],r);else if(t.color!==r){this.conflict(r,t);return}}}connectWithSuggestedNames(){for(const e of this.cells.values())for(const t of e.pins)if(dr.has(t.instance.symbol)&&e.color==null){const i=`_${t.instance.name}_${t.name}`;this.walk([e],this.getColor(this.getUniqueName(i)))}}conflict(e,t){console.warn(`Node naming conflict: [${e.node.name}] and [${t.color.node.name}]`),this.nodes.length=0}walk(e,t){for(;;){const i=e.pop();if(i==null)break;i.color=t;for(const s of i.wires){t.elements.push(s);const r=i.x===s.x1&&i.y===s.y1?Ae(s.x0,s.y0):Ae(s.x1,s.y1),o=this.cells.get(r);o!=null&&o.color==null&&e.push(o)}for(const s of i.pins)t.pins.push(s)}}getColor(e){const t=[],i=[],s=new ur(e,t,i);return this.nodes.push(s),{node:s,elements:t,pins:i}}getUniqueName(e){if(this.names.has(e)){let t=1;for(;;){let i=`${e}_${t}`;if(!this.names.has(i)){e=i;break}t+=1}}return this.names.add(e),e}}function Ae(n,e){return e+32768<<16|n+32768<<0}const Jt={rewire:n=>{},connect:n=>fr()},Qt={rewire:nr,connect:pr};class Z{#e;#i;#n;#t;#r;#s;#a;constructor(e,t=Qt){this.#e=[...e],this.#i=t,this.#n=null,this.#t=null,this.#r=null,this.#s=null,this.#a=null,this.#i.rewire(this.#e),e instanceof Z&&e.#u()}[Symbol.iterator](){return this.#e[Symbol.iterator]()}get instances(){return this.#n??=ar(this.#e)}get notes(){return this.#t??=cr(this.#e)}get wires(){return this.#r??=lr(this.#e)}get network(){return this.#s??=this.#i.connect(this.#e)}get names(){return this.#a??=new Jn(this.#e)}append(e){return new Z([...this.#e,...e],this.#i)}delete(e){return new Z(this.#e.filter(t=>!e.has(t)),this.#i)}unwire(){return new Z(this.#e,Jt)}rewire(){return new Z(this.#e,Qt)}rename(e="none"){const t=new Z(this.#e,this.#i);return t.names.rename(e),t}edit(e){switch(e.type){case"set-text":{const{note:t,text:i}=e;t.text!==i&&(t.text=i);break}case"set-prop":{const{instance:t,name:i,value:s}=e;t.props[i]!==s&&(t.props=er(t.props,i,s));break}}return new Z(this,this.#i)}#u(){this.#e=[],this.#i=Jt,this.#n=null,this.#t=null,this.#r=null,this.#s=null,this.#a=null}}class mr{#e;#i;constructor(e){this.#e=[[Te(e),"initial"]],this.#i=0}*[Symbol.iterator](){let e=0;for(const[t,i]of this.#e)yield[e,i],e+=1}get length(){return this.#e.length}push(e,t){this.#i+=1,this.#e.splice(this.#i),this.#e.push([Te(e),t])}get canUndo(){return this.#i>0}undo(){this.canUndo&&(this.#i-=1);const[e]=this.#e[this.#i];return new Z(ve(e))}get canRedo(){return this.#i<this.#e.length-1}redo(){this.canRedo&&(this.#i+=1);const[e]=this.#e[this.#i];return new Z(ve(e))}}function ut(n){return n===S.None?"l":n===S.Shift?"r":n===S.Alt?"d":"l"}function vr(n,e,t,i,s){return n===t&&e===i?[]:s==="d"?[new U(n,e,t,i)]:e===i?[new U(n,e,t,i)]:n===t?[new U(n,e,t,i)]:s==="l"?[new U(n,e,t,e),new U(t,e,t,i)]:[new U(n,e,n,i),new U(n,i,t,i)]}class en{#e;constructor(e){this.#e=[...e].map(t=>({element:t,x:t.x,y:t.y}))}moveBy(e,t){for(const{element:i,x:s,y:r}of this.#e)i.moveTo(s+e,r+t)}reset(){for(const{element:e,x:t,y:i}of this.#e)e.moveTo(t,i)}}const X=10,gr=4,yr=30;class k{static defaultZoom=new k;#e;#i;#n;#t;static snap(e){return m(e/X)*X}static floor(e){return Math.floor(e/X)*X}static ceil(e){return Math.ceil(e/X)*X}constructor(e=X,t=0,i=0){e=m(e),t=m(t),i=m(i),e=Math.max(gr,e),e=Math.min(yr,e),this.#e=e,this.#i=t,this.#n=i,this.#t=e/X}get gridSize(){return this.#e}get x(){return this.#i}get y(){return this.#n}get scale(){return this.#t}scaleTo(e){return new k(X*e,this.#i,this.#n)}scaleBy(e){return new k(X*(this.#t+e),this.#i,this.#n)}zoomTo(e){return new k(e,this.#i,this.#n)}zoomBy(e){return new k(this.#e+e,this.#i,this.#n)}moveTo(e,t){return new k(this.#e,e,t)}moveBy(e,t){return new k(this.#e,this.#i+e,this.#n+t)}toGridX(e){return m((e-this.#i)/this.#t)}toGridY(e){return m((e-this.#n)/this.#t)}toScreenX(e){return m(e*this.#t+this.#i)}toScreenY(e){return m(e*this.#t+this.#n)}snapScreenX(e){return this.toScreenX(k.snap(this.toGridX(e)))}snapScreenY(e){return this.toScreenY(k.snap(this.toGridY(e)))}static center(e,t,i,s=!1){const r=i.x1-i.x0,o=i.y1-i.y0;let a=k.defaultZoom;return s&&r>0&&o>0&&(a=a.scaleTo(Math.min(e/(r+X*2),t/(o+X*2)))),a.moveTo(e/2-(r/2+i.x0)*a.scale,t/2-(o/2+i.y0)*a.scale)}}ie(new k);const T={symbol:{normal:"#222222",selected:"#0000ff"},pin:{normal:"#222222",selected:"#0000ff"},pinFill:{normal:"#ffffff",selected:"#ffffff"},wire:{normal:"#222222",selected:"#0000ff"},outline:"#22222222",selection:"#0000ff11",gridFine:"#00000066",gridCoarse:"#000000FF",crosshair:"#0000FF66"},w=.5;class Qn{#e;#i;constructor(e){this.#e=e,this.#i=e.getContext("2d")}get canvas(){return this.#e}get ctx(){return this.#i}get width(){return this.#e.width}get height(){return this.#e.height}reset(){this.#i.reset()}paintGrid(e){const t=e.scale,i=e.x,s=e.y,r=e.gridSize,o=10,a=i%r,l=i%(r*o),c=s%r,f=s%(r*o);this.#t((h,d,p)=>{if(t>=1){h.strokeStyle=T.gridFine,h.lineWidth=1,h.lineCap="butt",h.setLineDash([1,r-1]);for(let _=c;_<p;_+=r)h.beginPath(),h.moveTo(a,_+w),h.lineTo(d,_+w),h.stroke()}}),this.#t((h,d,p)=>{h.strokeStyle=t>=1?T.gridCoarse:T.gridFine,h.lineWidth=1,h.lineCap="butt",h.setLineDash([1,r-1]);for(let _=f;_<p;_+=r*o)h.beginPath(),h.moveTo(a,_+w),h.lineTo(d,_+w),h.stroke();for(let _=l;_<d;_+=r*o)h.beginPath(),h.moveTo(_+w,c),h.lineTo(_+w,p),h.stroke()}),this.#t((h,d,p)=>{h.strokeStyle=T.gridFine,h.lineWidth=1,h.lineCap="butt",h.beginPath(),h.moveTo(m(i-10*t)+w,m(s)+w),h.lineTo(m(i+10*t)+w,m(s)+w),h.moveTo(m(i)+w,m(s-10*t)+w),h.lineTo(m(i)+w,m(s+10*t)+w),h.stroke()})}paintCrosshair(e,{x:t,y:i},s){this.#t((r,o,a)=>{s?(r.strokeStyle=T.crosshair,r.lineWidth=1,r.lineCap="butt"):(r.strokeStyle=T.outline,r.lineWidth=1,r.lineCap="butt"),r.beginPath(),r.moveTo(0,e.snapScreenY(i)+w),r.lineTo(o,e.snapScreenY(i)+w),r.moveTo(e.snapScreenX(t)+w,0),r.lineTo(e.snapScreenX(t)+w,a),r.stroke()})}paintSelection(e,t,i){this.#t(s=>{s.fillStyle=T.selection,s.fillRect(m(t.x),m(t.y),m(i.x-t.x),m(i.y-t.y))})}paintInstance(e,t,i=!1){const s=e.scale,r=e.x,o=e.y,a=t.x,l=t.y;this.#t(c=>{i?(c.fillStyle=T.symbol.selected,c.strokeStyle=T.symbol.selected,c.lineWidth=3,c.lineCap="square"):(c.fillStyle=T.symbol.normal,c.strokeStyle=T.symbol.normal,c.lineWidth=1,c.lineCap="square");for(const f of t.shapes)switch(f[0]){case"l":{const[h,d,p,_,g]=f;c.beginPath(),c.moveTo(m(r+(a+d)*s)+w,m(o+(l+p)*s)+w),c.lineTo(m(r+(a+_)*s)+w,m(o+(l+g)*s)+w),c.stroke();break}case"c":{const[h,d,p,_]=f;c.beginPath(),c.ellipse(m(r+(a+d)*s)+w,m(o+(l+p)*s)+w,m(_*s),m(_*s),0,0,2*Math.PI),c.stroke();break}case"a":{const[h,d,p,_,g,x]=f;c.beginPath(),c.ellipse(m(r+(a+d)*s)+w,m(o+(l+p)*s)+w,m(_*s),m(_*s),0,g*(Math.PI/180),x*(Math.PI/180)),c.stroke();break}case"t":{const[h,d,p,_,g]=f;this.#n(c,e,_),c.fillText(g,r+(a+d)*s,o+(l+p)*s);break}}})}paintPins(e,t,i=!1){const s=e.scale,r=e.x,o=e.y,a=t.x,l=t.y;this.#t(c=>{i?(c.fillStyle=T.pinFill.selected,c.strokeStyle=T.pin.selected,c.lineWidth=3,c.lineCap="square"):(c.fillStyle=T.pinFill.normal,c.strokeStyle=T.pin.normal,c.lineWidth=1,c.lineCap="square");for(const f of t.pins){const[h,d,p]=f;c.beginPath(),c.ellipse(m(r+(a+d)*s)+w,m(o+(l+p)*s)+w,m(3*s),m(3*s),0,0,2*Math.PI),c.fill(),c.stroke()}})}paintLabels(e,t,i=!1){const s=e.scale,r=e.x,o=e.y,a=t.x,l=t.y;this.#t(c=>{i?c.fillStyle=T.symbol.selected:c.fillStyle=T.symbol.normal;const[f,h,d]=t.labels;this.#n(c,e,d),c.fillText(t.name,r+(a+f)*s,o+(l+h)*s)})}paintWire(e,t,i=!1){const s=e.scale,r=e.x,o=e.y;this.#t(a=>{i?(a.strokeStyle=T.wire.selected,a.lineWidth=3,a.lineCap="square"):(a.strokeStyle=T.wire.normal,a.lineWidth=1,a.lineCap="square");const{x0:l,y0:c,x1:f,y1:h}=t;a.beginPath(),a.moveTo(m(r+l*s)+w,m(o+c*s)+w),a.lineTo(m(r+f*s)+w,m(o+h*s)+w),a.stroke()})}paintJoins(e,t){const i=e.scale,s=e.x,r=e.y;this.#t(o=>{o.fillStyle=T.wire.normal;for(const{x:a,y:l}of t)o.beginPath(),o.ellipse(m(s+a*i)+w,m(r+l*i)+w,m(3*i),m(3*i),0,0,2*Math.PI),o.fill()})}paintOrigin(e,{x:t,y:i}){const s=e.scale,r=e.x,o=e.y;this.#t(a=>{a.strokeStyle=T.outline,a.lineWidth=1,a.lineCap="butt",a.beginPath(),a.moveTo(m(r+(t-10)*s)+w,m(o+i*s)+w),a.lineTo(m(r+(t+10)*s)+w,m(o+i*s)+w),a.moveTo(m(r+t*s)+w,m(o+(i-10)*s)+w),a.lineTo(m(r+t*s)+w,m(o+(i+10)*s)+w),a.stroke()})}paintArea(e,{x0:t,y0:i,x1:s,y1:r}){const o=e.scale,a=e.x,l=e.y;this.#t(c=>{c.strokeStyle=T.outline,c.lineWidth=1,c.lineCap="square",c.strokeRect(m(a+t*o)+w,m(l+i*o)+w,m((s-t)*o),m((r-i)*o))})}paintSymbolIcon(e,t,i){const s=Xn(e,0,0),r=k.center(t,i,s,!0);this.paintInstance(r,{x:0,y:0,shapes:e.shapes})}#n(e,t,i){switch(e.font=`${20*t.scale}px serif`,i.charAt(0)){case"l":e.textAlign="left";break;case"c":e.textAlign="center";break;case"r":e.textAlign="right";break}switch(i.charAt(1)){case"t":e.textBaseline="top";break;case"m":e.textBaseline="middle";break;case"b":e.textBaseline="bottom";break}}#t=e=>{const t=this.#i;t.save(),e(t,this.#e.width,this.#e.height),t.restore()}}class R{#e;constructor(e=[]){this.#e=new Set;for(const{id:t}of e)this.#e.add(t)}[Symbol.iterator](){return this.#e[Symbol.iterator]()}get size(){return this.#e.size}get full(){return this.#e.size>0}has({id:e}){return this.#e.has(e)}filter(e){return[...e].filter(({id:t})=>this.#e.has(t))}select(e){return new R(e)}add(e){const t=new R;for(const i of this.#e)t.#e.add(i);for(const{id:i}of e)t.#e.add(i);return t}delete(e){const t=new R;for(const i of this.#e)t.#e.add(i);for(const{id:i}of e)t.#e.delete(i);return t}clear(){return new R}}function Lt(n){const e={x:1/0,y:1/0},t={x:-1/0,y:-1/0};for(const{area:i}of n)e.x=Math.min(e.x,i.x0),e.y=Math.min(e.y,i.y0),t.x=Math.max(t.x,i.x1),t.y=Math.max(t.y,i.y1);return e.x<t.x&&e.y<t.y?{x0:e.x,y0:e.y,x1:t.x,y1:t.y}:{x0:0,y0:0,x1:0,y1:0}}function br(n,e){const t=e.charAt(0),i=e.charAt(1),s=Lt(n);let r=0,o=0;switch(t){case"l":r=s.x0;break;case"c":r=k.snap((s.x0+s.x1)/2);break;case"r":r=s.x1;break}switch(i){case"t":o=s.y0;break;case"m":o=k.snap((s.y0+s.y1)/2);break;case"b":o=s.y1;break}for(const a of n)a.moveTo(a.x-r,a.y-o)}function wr(n,e){const t=Lt(n),i=k.snap((t.x0+t.x1)/2),s=k.snap((t.y0+t.y1)/2);for(const r of n)r instanceof U?Vr(r,e,s,i):xr(r,e,s,i)}function Vr(n,e,t,i){const{x0:s,y0:r,x1:o,y1:a}=n;switch(e){case"rl":n.x0=i+(r-t),n.y0=t-(s-i),n.x1=i+(a-t),n.y1=t-(o-i);break;case"rr":n.x0=i-(r-t),n.y0=t+(s-i),n.x1=i-(a-t),n.y1=t+(o-i);break;case"mx":n.x0=2*i-s,n.x1=2*i-o;break;case"my":n.y0=2*t-r,n.y1=2*t-a;break}}function xr(n,e,t,i){const{x:s,y:r}=n;switch(e){case"rl":n.moveTo(i+(r-t),t-(s-i));break;case"rr":n.moveTo(i-(r-t),t+(s-i));break;case"mx":n.moveTo(2*i-s,r);break;case"my":n.moveTo(s,2*t-r);break}switch(!0){case n instanceof ee:n.transformBy(e);break}}class kr{#e;#i;#n=ie(new Z([]));#t=ie(new k);#r=ie(new R);#s=ie({type:"idle",cursor:{x:100,y:100},hovered:null});#a=new rr;#u={current:null};#p;#o;constructor(e,t){this.#e=e,this.#i=new mr(t),this.#n.value=t;const i=o=>()=>{this.#t.value=this.#t.value.zoomBy(o)},s=(o,a)=>()=>{this.#t.value=this.#t.value.moveBy(o,a)},r=o=>()=>{this.pasteInstance(o)};this.#p=Yn(["Digit0",()=>{this.zoomTo("0")}],["Equal",i(1)],["Minus",i(-1)],["Home",()=>{this.zoomTo("1")}],["Space",()=>{this.zoomTo("all")}],["ArrowLeft",s(-10,0)],["Shift+ArrowLeft",s(-100,0)],["ArrowRight",s(10,0)],["Shift+ArrowRight",s(100,0)],["ArrowUp",s(0,-10)],["Shift+ArrowUp",s(0,-100)],["ArrowDown",s(0,10)],["Shift+ArrowDown",s(0,100)],["Ctrl+a",()=>{this.select("all")}],["Ctrl+x",()=>{this.selectionCut()}],["Ctrl+c",()=>{this.selectionCopy()}],["Ctrl+v",()=>{this.selectionPaste()}],["Delete",()=>{this.selectionDelete()}],["Ctrl+z",()=>{this.undo()}],["Ctrl+y",()=>{this.redo()}],["Alt+l",()=>{if(!this.transformSelection("rl"))return!1}],["Alt+r",()=>{if(!this.transformSelection("rr"))return!1}],["Alt+h",()=>{if(!this.transformSelection("mx"))return!1}],["Alt+v",()=>{if(!this.transformSelection("my"))return!1}],["Escape",()=>{if(!this.#c()){if(this.#r.value.full){this.#r.value=this.#r.value.clear();return}return!1}}],["w",()=>{if(this.#c(),!this.#y())return!1}],["g",r(re.ground)],["o",r(re.port)],["v",r(Le.vdc)],["i",r(Le.idc)],["r",r(je.resistor)],["c",r(je.capacitor)],["l",r(je.inductor)],["d",r(K.diode)],["n",r(K.npn)],["p",r(K.pnp)],["Shift+N",r(K.nmos)],["Shift+P",r(K.pmos)],["a",r(K.opamp)],["t",()=>{this.pasteNote("note...")}])}get library(){return this.#e}get schematic(){return this.#n.value}get zoom(){return this.#t.value}get selection(){return this.#r.value}get mouseAction(){return this.#s.value}get focusRef(){return this.#u}attach(e){this.#o=new Qn(e),this.#t.value=this.#v(!1)}handleFocus=e=>{this.#l()};handleBlur=e=>{this.#c(),this.#l()};handleKeyDown=e=>{this.#p(e)||this.#g(e)};handleKeyUp=e=>{this.#g(e)};#g(e){const{key:t}=e,i=S.of(e);if(t==="Shift"&&this.#k(t,i)){e.preventDefault();return}if(t==="Alt"&&this.#k(t,i)){e.preventDefault();return}if(t==="Shift"&&this.#S(t,i)){e.preventDefault();return}}handleMouseDown=e=>{Es();const t=e.button,i=S.of(e),s=this.#d(e);t===0&&i===S.None&&(this.#m(s,i)||this.#V(s,i)||this.#b(s))||t===0&&i===S.Shift&&(this.#m(s,i)||this.#V(s,i)||this.#b(s))||t===0&&i===S.Alt&&this.#m(s,i)||t===1&&i===S.None&&this.#G(s)};handleMouseMove=e=>{const t=S.of(e),i=this.#d(e);this.#M(i)||this.#x(i,t)||this.#I(i)||this.#L(i)||this.#w(i,t)||this.#O(i)||this.#s.value.type==="idle"&&this.#C(i)&&this.#l(i)};handleMouseUp=e=>{const t=this.#d(e);this.#E(t)||this.#N(t)||this.#T(t)||this.#A(t)||this.#l(t)};handleWheel=e=>{e.preventDefault();const t=S.of(e);if(this.#s.value.type==="idle"&&t===S.None){this.#t.value=this.#t.value.zoomBy(-Math.sign(e.deltaY));return}};handleContextMenu=e=>{e.preventDefault()};#d(e){return{x:e.offsetX,y:e.offsetY}}#C(e){const t=this.#t.value.toGridX(e.x),i=this.#t.value.toGridY(e.y),s=this.#t.value.toGridX(this.#s.value.cursor.x),r=this.#t.value.toGridY(this.#s.value.cursor.y);return k.snap(t)!==k.snap(s)||k.snap(i)!==k.snap(r)}#l(e=this.#s.value.cursor){const t=k.snap(this.#t.value.toGridX(e.x)),i=k.snap(this.#t.value.toGridY(e.y)),s=Xt(this.#n.value,t,i,Se.notWire);this.#s.value={type:"idle",cursor:e,hovered:s}}#y(){if(this.#s.value.type==="idle"){this.#r.value=this.#r.value.clear();const{cursor:e}=this.#s.value;return this.#s.value={type:"place-wire",cursor:e},!0}return!1}#M(e){return this.#s.value.type==="place-wire"?(this.#s.value={type:"place-wire",cursor:e},!0):!1}#H(){return this.#s.value.type==="place-wire"?(this.#l(),!0):!1}#b(e){return this.#s.value.type==="idle"?(this.#r.value=this.#r.value.clear(),this.#s.value={type:"select",cursor:{...e},origin:{...e}},!0):!1}#w(e,t){if(this.#s.value.type==="select"){const{origin:i}=this.#s.value,s={x0:this.#t.value.toGridX(Math.min(i.x,e.x)),y0:this.#t.value.toGridY(Math.min(i.y,e.y)),x1:this.#t.value.toGridX(Math.max(i.x,e.x)),y1:this.#t.value.toGridY(Math.max(i.y,e.y))};for(const r of this.#n.value)(t===S.Shift?Ls(s,r.area):Ts(s,r.area))?this.#r.value=this.#r.value.add([r]):this.#r.value=this.#r.value.delete([r]);return this.#s.value={type:"select",cursor:e,origin:i},!0}return!1}#S(e,t){return this.#s.value.type==="select"?this.#w(this.#s.value.cursor,t):!1}#A(e){if(this.#s.value.type==="select"){const{origin:t}=this.#s.value;return e.x===t.x&&e.y===t.y&&(this.#r.value=this.#r.value.clear()),this.#l(e),!0}return!1}#$(){return this.#s.value.type==="select"?(this.#r.value=new R,this.#l(),!0):!1}#V(e,t){if(this.#s.value.type==="idle"){const i=Xt(this.#n.value,this.#t.value.toGridX(e.x),this.#t.value.toGridY(e.y));if(i!=null){this.#r.value.has(i)||(this.#r.value=t===S.Shift?this.#r.value.add([i]):this.#r.value.select([i]));const s=Te(this.#n.value),r=new en(this.#r.value.filter(this.#n.value));return this.#n.value=this.#n.value.unwire(),this.#s.value={type:"move",cursor:{...e},origin:{...e},undo:s,mover:r},!0}}return!1}#I(e){if(this.#s.value.type==="move"){const{origin:t,undo:i,mover:s}=this.#s.value,r=k.snap(this.#t.value.toGridX(t.x)),o=k.snap(this.#t.value.toGridY(t.y)),a=k.snap(this.#t.value.toGridX(e.x)),l=k.snap(this.#t.value.toGridY(e.y));return s.moveBy(a-r,l-o),this.#n.value=this.#n.value.unwire(),this.#s.value={type:"move",cursor:e,origin:t,undo:i,mover:s},!0}return!1}#N(e){return this.#s.value.type==="move"?(this.#n.value=this.#n.value.rewire(),this.#l(e),this.#h("move selection"),!0):!1}#P(){if(this.#s.value.type==="move"){const{undo:e}=this.#s.value;return this.#n.value=new Z(ve(e)),this.#r.value=new R,this.#l(),!0}return!1}#_(e){if(this.#s.value.type==="idle"){const{cursor:t}=this.#s.value;br(e,"cm");const i=Te(this.#n.value),s=new en(e),r=k.snap(this.#t.value.toGridX(t.x)),o=k.snap(this.#t.value.toGridY(t.y));return s.moveBy(r,o),this.#n.value=this.#n.value.unwire().append(e).rename(),this.#r.value=new R(e),this.#s.value={type:"paste",cursor:t,undo:i,mover:s},!0}return!1}#L(e){if(this.#s.value.type==="paste"){const{undo:t,mover:i}=this.#s.value,s=k.snap(this.#t.value.toGridX(e.x)),r=k.snap(this.#t.value.toGridY(e.y));return i.moveBy(s,r),this.#n.value=this.#n.value.unwire(),this.#s.value={type:"paste",cursor:e,undo:t,mover:i},!0}return!1}#T(e){return this.#s.value.type==="paste"?(this.#n.value=this.#n.value.rewire(),this.#l(e),this.#h("paste"),!0):!1}#D(){if(this.#s.value.type==="paste"){const{undo:e}=this.#s.value;return this.#n.value=new Z(ve(e)),this.#r.value=new R,this.#l(),!0}return!1}#m(e,t){return this.#s.value.type==="idle"&&this.#W(e)?(this.#r.value=this.#r.value.clear(),this.#s.value={type:"connect",cursor:{...e},origin:{...e},wires:[],shape:ut(t)},!0):this.#s.value.type==="place-wire"?(this.#s.value={type:"connect",cursor:{...e},origin:{...e},wires:[],shape:ut(t)},!0):!1}#x(e,t){if(this.#s.value.type==="connect"){const{origin:i}=this.#s.value,s=k.snap(this.#t.value.toGridX(i.x)),r=k.snap(this.#t.value.toGridY(i.y)),o=k.snap(this.#t.value.toGridX(e.x)),a=k.snap(this.#t.value.toGridY(e.y)),l=ut(t),c=vr(s,r,o,a,l);return this.#s.value={type:"connect",cursor:e,origin:i,wires:c,shape:l},!0}return!1}#k(e,t){return this.#s.value.type==="connect"?this.#x(this.#s.value.cursor,t):!1}#E(e){return this.#s.value.type==="connect"?(this.#n.value=this.#n.value.append(this.#s.value.wires),this.#l(e),this.#h("draw wires"),!0):!1}#B(){return this.#s.value.type==="connect"?(this.#l(),!0):!1}#G(e){return this.#s.value.type==="idle"?(this.#s.value={type:"scroll",cursor:{...e},origin:{...e},offset:{x:this.#t.value.x,y:this.#t.value.y}},!0):!1}#O(e){if(this.#s.value.type==="scroll"){const{origin:t,offset:i}=this.#s.value;return this.#t.value=this.#t.value.moveTo(i.x+(e.x-t.x),i.y+(e.y-t.y)),this.#s.value={type:"scroll",cursor:e,origin:t,offset:i},!0}return!1}#c(){return!!(this.#H()||this.#B()||this.#P()||this.#D()||this.#$())}#W(e){const{network:t}=this.#n.value,i=this.#t.value.toGridX(e.x),s=this.#t.value.toGridY(e.y),r=k.snap(i),o=k.snap(s);return r-5<=i&&i<=r+5&&o-5<=s&&s<=o+5&&(t.getWires(r,o)!=null||t.getPins(r,o)!=null)}#v(e){return k.center(this.#o.width,this.#o.height,Lt(this.#n.peek()),e)}#h(e){this.#i.push(this.#n.value,e)}edit(e){this.#n.value=this.#n.value.edit(e)}transformSelection(e){if(this.#r.value.full){const t=this.#r.value.filter(this.#n.value);switch(wr(t,e),this.#n.value=new Z(this.#n.value),e){case"rl":this.#h("rotate counter-clockwise");break;case"rr":this.#h("rotate clockwise");break;case"mx":this.#h("flip from left to right");break;case"my":this.#h("flip from top to bottom");break}return!0}return!1}pasteInstance(e){this.#c(),e===re.wire?this.#y():this.#_([new ee(e)])}pasteNote(e){this.#c(),this.#_([new Ve(e)])}get canUndo(){return this.#i.canUndo}undo(){this.#i.canUndo&&(this.#c(),this.#n.value=this.#i.undo(),this.#r.value=new R)}get canRedo(){return this.#i.canRedo}redo(){this.#i.canRedo&&(this.#c(),this.#n.value=this.#i.redo(),this.#r.value=new R)}select(e){switch(this.#c(),e){case"all":this.#r.value=new R(this.#n.value);break;case"none":this.#r.value=new R;break;case"invert":this.#r.value=new R([...this.#n.value].filter(t=>!this.#r.value.has(t)));break;default:this.#r.value=new R(e);break}}selectionCut(){this.#c(),this.#r.value.size>0&&(this.#a.put(this.#r.value.filter(this.#n.value)),this.#n.value=this.#n.value.delete(this.#r.value),this.#r.value=new R,this.#h("cut"))}selectionCopy(){this.#c(),this.#r.value.size>0&&this.#a.put(this.#r.value.filter(this.#n.value))}selectionPaste(){this.#a.full&&(this.#c(),this.#_(this.#a.take()))}selectionDelete(){this.#c(),this.#r.value.size>0&&(this.#n.value=this.#n.value.delete(this.#r.value),this.#r.value=new R,this.#h("delete"))}zoomTo(e){switch(e){case"+":this.#t.value=this.#t.value.zoomBy(1);break;case"-":this.#t.value=this.#t.value.zoomBy(-1);break;case"0":this.#t.value=new k().moveTo(20,20);break;case"1":this.#t.value=this.#v(!1);break;case"all":this.#t.value=this.#v(!0);break}}focus(){this.#u.current?.focus()}blur(){this.#u.current?.blur()}get focused(){return this.#u.current?.focused??!1}paint(){const e=this.#t.peek(),t=this.#s.peek();switch(this.#o.reset(),this.#o.paintGrid(e),t.type){case"idle":this.#f(!1,t.hovered),this.focused&&this.#o.paintCrosshair(e,t.cursor,!1);break;case"scroll":this.#f(!1,null);break;case"select":this.#f(!1,null),this.#o.paintSelection(e,t.origin,t.cursor);break;case"place-wire":this.#f(!0,null),this.#o.paintCrosshair(e,t.cursor,!0);break;case"connect":this.#o.paintCrosshair(e,t.cursor,!0),this.#f(!0,null);for(const i of t.wires)this.#o.paintWire(e,i,!0);break;case"move":this.#f(!0,null);break;case"paste":this.#f(!0,null);break}}#f(e,t){const i=this.#n.peek(),s=this.#t.peek(),r=this.#r.peek();for(const o of i.instances)this.#o.paintInstance(s,o,r.has(o));for(const o of i.instances)this.#o.paintLabels(s,o,r.has(o));for(const o of i.notes)o===t&&(this.#o.paintArea(s,o.area),this.#o.paintOrigin(s,o));for(const o of i.wires)this.#o.paintWire(s,o,r.has(o));for(const o of i.instances)(e||o===t)&&this.#o.paintPins(s,o,r.has(o));this.#o.paintJoins(s,i.network.joins)}}const ei=Mt(null);function te(){return Hn(ei)}function ti(n){var e,t,i="";if(typeof n=="string"||typeof n=="number")i+=n;else if(typeof n=="object")if(Array.isArray(n)){var s=n.length;for(e=0;e<s;e++)n[e]&&(t=ti(n[e]))&&(i&&(i+=" "),i+=t)}else for(t in n)n[t]&&(i&&(i+=" "),i+=t);return i}function ni(){for(var n,e,t=0,i="",s=arguments.length;t<s;t++)(n=arguments[t])&&(e=ti(n))&&(i&&(i+=" "),i+=e);return i}const Cr="_root_1813r_1",Mr="_item_1813r_9",Hr="_selected_1813r_22";function Sr(){const n=te(),{schematic:e,selection:t}=n;return u("ul",{class:Cr,children:e.instances.filter(({symbol:i})=>i!==re.ground&&i!==re.port).map(i=>u("li",{class:ni(Mr,t.has(i)&&Hr),onClick:()=>{n.select([i]),n.focus()},children:[i.symbol.id,":",i.name," (#",i.id,")"]},i.id))})}function ii({canvas:n,style:e,...t}){return u("canvas",{...t,ref:n,style:{display:"block",inlineSize:"100%",blockSize:"100%",...e}})}const si=n=>{const e=n.getContext("2d"),t=devicePixelRatio,{width:i,height:s}=n.getBoundingClientRect(),r=Math.max(1,i*t),o=Math.max(1,s*t);return(n.width!==r||n.height!==o)&&(n.width=r,n.height=o,e.scale(t,t)),{width:r,height:o}},Ar="_root_1ar66_1",$r="_category_1ar66_5",Ir="_title_1ar66_10",Nr="_list_1ar66_15",Pr="_symbol_1ar66_24";function Lr(){const{library:n}=te(),e=Object.groupBy(n,({category:t})=>t);return u("div",{class:Ar,children:Object.entries(e).map(([t,i])=>u(Tr,{name:t,symbols:i},t))})}function Tr({name:n,symbols:e}){return u("div",{class:$r,children:[u("div",{class:Ir,children:n}),u("div",{class:Nr,children:e.map(t=>u(Dr,{symbol:t},t.id))})]})}function Dr({symbol:n}){const e=te(),t=me(null);return it(()=>{const{width:i,height:s}=si(t.current);new Qn(t.current).paintSymbolIcon(n,i,s)},[n]),u("div",{class:Pr,title:n.name,onClick:()=>{e.pasteInstance(n),e.focus()},children:u(ii,{canvas:t})})}const Er="_root_k0zzy_1",Br="_item_k0zzy_9";function Gr(){const n=te(),{schematic:e}=n;return u("ul",{class:Er,children:e.network.nodes.map(t=>u("li",{class:Br,onClick:()=>{n.select(t.elements),n.focus()},children:t.name},t.name))})}function ri({inputRef:n={current:null},type:e="text",value:t,onFocus:i,onBlur:s,onChange:r,...o}){const a=me(null);Mn(n,()=>({focus(){a.current.focus()},blur(){a.current.blur()},get focused(){return document.activeElement===a.current},select(){a.current.select()}}));const[l,c]=nt(t);return e==="textarea"?u("textarea",{...o,ref:a,value:l,onInput:f=>{c(f.currentTarget.value)},onFocus:f=>{i?.(f)},onBlur:f=>{r(l),s?.(f)},onKeyDown:f=>{f.key==="Enter"&&S.of(f)===S.Control&&(f.preventDefault(),r(l))}}):u("input",{...o,ref:a,type:e,value:l,onInput:f=>{c(f.currentTarget.value)},onFocus:f=>{i?.(f)},onBlur:f=>{r(l),s?.(f)},onKeyDown:f=>{f.key==="Enter"&&S.of(f)===S.None&&(f.preventDefault(),r(l))}})}const Or="_root_hzlci_1",tn="_title_hzlci_8",Wr="_table_hzlci_13",Ur="_propName_hzlci_19",Rr="_propValue_hzlci_26",zr="_propTitle_hzlci_33",Fr="_input_hzlci_41";function qr({instance:n}){const e=te(),{device:t}=n.symbol;return u("div",{class:Or,children:[u("div",{class:tn,children:n.symbol.name}),u("div",{class:tn,children:["name: ",n.name]}),t!=null&&u("table",{class:Wr,children:u("tbody",{children:Object.entries(t.propertiesSchema).map(([i,s])=>u("tr",{children:[u("td",{class:Ur,children:i}),u("td",{class:Rr,children:u(ri,{class:Fr,type:"text",value:String(s.defaultValue||"0"),onChange:r=>{e.edit({type:"set-prop",instance:n,name:i,value:r})}})}),u("td",{class:zr,children:s.title})]}))})})]})}const jr="_root_1ssdo_1",Zr="_title_1ssdo_8",Yr="_text_1ssdo_13";function Kr({note:n}){const e=te();return u("div",{class:jr,children:[u("div",{class:Zr,children:"Note"}),u(ri,{class:Yr,type:"textarea",value:n.text,placeholder:"note text...",onChange:t=>{e.edit({type:"set-text",note:n,text:t})}})]})}const oi="_root_d1mui_1",Xr="_empty_d1mui_7",Jr="_title_d1mui_11";function Qr(){const n=te(),{schematic:e,selection:t}=n,i=t.filter(e);if(i.length===1){const[s]=i;if(s instanceof ee)return u(qr,{instance:s},s.id);if(s instanceof Ve)return u(Kr,{note:s},s.id);if(s instanceof U)return u(eo,{wire:s},s.id)}return u("div",{class:oi,children:u("div",{class:Xr,children:"-"})})}function eo({wire:n}){return u("div",{class:oi,children:u("div",{class:Jr,children:"Wire"})})}function to(n){const[e,t]=nt(new DOMRect);return it(()=>{const{current:i}=n;if(i==null)return;const s=new ResizeObserver(()=>{t(i.getBoundingClientRect())});return s.observe(i),()=>{s.disconnect()}},[n]),e}const no={open:/\$/y,close:/\$/y},io={open:/\\\(/y,close:/\\\)/y},so={open:/\$\$/y,close:/\$\$/y},ro={open:/\\\[/y,close:/\\\]/y},ai={open:/\\begin\{equation}/y,close:/\\end\{equation}/y},li={open:/\\begin\{align}/y,close:/\\end\{align}/y},nn=/\s+|\\\{|\\\}|\\\\/y;function oo(n){let e=et(n,"$","$"),t=et(n,"\\(","\\)");if(e!==-1&&t!==-1)return Math.min(e,t);if(e!==-1)return e;if(t!==-1)return t}function ao(n,e){return pe(n,no,e)||pe(n,io,e)}function lo(n){let e=et(n,"$$","$$"),t=et(n,"\\[","\\]");if(e!==-1&&t!==-1)return Math.min(e,t);if(e!==-1)return e;if(t!==-1)return t}function co(n,e){return pe(n,so,e)||pe(n,ro,e)||pe(n,ai,e)||pe(n,li,e)}function et(n,e,t){let i=n.indexOf(e);return i!==-1&&n.indexOf(t,i+e.length+1)===-1&&(i=-1),i}function pe(n,e,t){if(ht(n,e.open,0)){let i=e.open.lastIndex,s=0;for(;i<n.length;)if(ht(n,nn,i))i=nn.lastIndex;else{switch(n.charCodeAt(i)){case 123:s+=1;break;case 125:if(s-=1,s<0)return!1;break;default:if(s===0&&ht(n,e.close,i))return t.raw=n.substring(0,e.close.lastIndex),e===ai||e===li?t.text=t.raw:t.text=n.substring(e.open.lastIndex,i).trim(),!0;break}i+=1}}return!1}function ht(n,e,t){return e.lastIndex=t,e.test(n)}function uo(n){return{extensions:[ho(n),fo(n)]}}function ho(n){const e={raw:"",text:""};return{name:"blockKatex",level:"block",start(t){return lo(t)},tokenizer(t){if(co(t,e))return{type:"blockKatex",raw:e.raw,text:e.text}},renderer({text:t}){return pn(t,{...n,displayMode:!0})+`
`}}}function fo(n){const e={raw:"",text:""};return{name:"inlineKatex",level:"inline",start(t){return oo(t)},tokenizer(t){if(ao(t,e))return{type:"inlineKatex",raw:e.raw,text:e.text}},renderer({text:t}){return pn(t,{...n,displayMode:!1})}}}const po=new _i(uo({output:"mathml",throwOnError:!1}));function _o(n){return po.parse(n,{async:!1,silent:!0,gfm:!1,pedantic:!1})}const mo="_root_1gdb4_1",vo="_selected_1gdb4_7";function go({note:n,text:e,align:t,x:i,y:s,width:r,height:o,selected:a}){const l=me(null);return Pe(()=>{l.current.setHTMLUnsafe(_o(e||"note...")),n.width=l.current.offsetWidth,n.height=l.current.offsetHeight},[n,e]),Pe(()=>{(r===0||o===0)&&(n.width=l.current.offsetWidth,n.height=l.current.offsetHeight)},[n,r,o]),u("div",{ref:l,class:ni(mo,a&&vo),style:yo(i,s,t)})}function yo(n,e,t){switch(t){case"lt":return{position:"absolute",left:n,top:e,translate:"0% 0%"};case"lm":return{position:"absolute",left:n,top:e,translate:"0% -50%"};case"lb":return{position:"absolute",left:n,top:e,translate:"0% -100%"};case"ct":return{position:"absolute",left:n,top:e,translate:"-50% 0%"};case"cm":return{position:"absolute",left:n,top:e,translate:"-50% -50%"};case"cb":return{position:"absolute",left:n,top:e,translate:"-50% -100%"};case"rt":return{position:"absolute",left:n,top:e,translate:"-100% 0%"};case"rm":return{position:"absolute",left:n,top:e,translate:"-100% -50%"};case"rb":return{position:"absolute",left:n,top:e,translate:"-100% -100%"}}}const bo="_root_1nll4_1";function wo(){const{schematic:n,zoom:e,selection:t}=te();return u("div",{class:bo,style:{transformOrigin:"0px 0px",translate:`${e.x}px ${e.y}px`,scale:`${e.scale}`},children:n.notes.map(i=>u(go,{note:i,text:i.text,align:i.align,x:i.x,y:i.y,width:i.width,height:i.height,selected:t.has(i)},i.id))})}const Vo="_root_1hx45_1";function xo(){const n=te(),e=me(null),t=me(null),{width:i,height:s}=to(t);return Mn(n.focusRef,()=>({focus:()=>{e.current?.focus()},blur:()=>{e.current?.blur()},get focused(){return e.current===document.activeElement}})),Pe(()=>{i>0&&s>0&&(si(t.current),n.attach(t.current))},[n,i,s]),Pe(()=>{if(i>0&&s>0){const r=requestAnimationFrame(()=>{n.paint()});return()=>{cancelAnimationFrame(r)}}},[n,i,s,n.schematic,n.zoom,n.selection,n.mouseAction]),u("div",{ref:e,class:Vo,tabIndex:0,autofocus:!0,onFocus:n.handleFocus,onBlur:n.handleBlur,onKeyDown:n.handleKeyDown,onKeyUp:n.handleKeyUp,children:[u(ii,{canvas:t,onMouseDown:n.handleMouseDown,onMouseMove:n.handleMouseMove,onMouseUp:n.handleMouseUp,onWheel:n.handleWheel,onContextMenu:n.handleContextMenu}),u(wo,{})]})}const ko=Mt(null),Co="_root_3m5pl_1 _fadeIn_kq333_1";let Mo=0;class Ho{constructor(e,t){this.message=e,this.options=t}#e=Mo+=1;get key(){return this.#e}}const ge=ie([]);function So(n){ge.value=[...ge.value,n]}function Ao(n){ge.value=ge.value.filter(e=>e!==n)}function $o({message:n}){const e=me(null);return it(()=>{n.options.modal?e.current?.showModal():e.current?.show()},[n]),u("dialog",{ref:e,class:Co,onClose:()=>{Ao(n),n.options.onClose()},children:u(ko.Provider,{value:{close:()=>{e.current?.close()}},children:n.message})},n.key)}const Io="_root_5uo3x_1";function No(){return u("div",{class:Io,hidden:ge.value.length===0,children:ge.value.map(n=>u($o,{message:n}))})}function sn(n,{modal:e=!0,onClose:t=()=>{}}={}){So(new Ho(n,{modal:e,onClose:t}))}const Po="_alert_ppbdc_1 _fadeIn_kq333_1",Lo="_message_ppbdc_17";var To="M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z",Do="M7,2H17A2,2 0 0,1 19,4V20A2,2 0 0,1 17,22H7A2,2 0 0,1 5,20V4A2,2 0 0,1 7,2M7,4V8H17V4H7M7,10V12H9V10H7M11,10V12H13V10H11M15,10V12H17V10H15M7,14V16H9V14H7M11,14V16H13V14H11M15,14V16H17V14H15M7,18V20H9V18H7M11,18V20H13V18H11M15,18V20H17V18H15Z",Eo="M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M12 20C7.59 20 4 16.41 4 12S7.59 4 12 4 20 7.59 20 12 16.41 20 12 20M16.59 7.58L10 14.17L7.41 11.59L6 13L10 17L18 9L16.59 7.58Z",Bo="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z",Go="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z",Oo="M19,3L13,9L15,11L22,4V3M12,12.5A0.5,0.5 0 0,1 11.5,12A0.5,0.5 0 0,1 12,11.5A0.5,0.5 0 0,1 12.5,12A0.5,0.5 0 0,1 12,12.5M6,20A2,2 0 0,1 4,18C4,16.89 4.9,16 6,16A2,2 0 0,1 8,18C8,19.11 7.1,20 6,20M6,8A2,2 0 0,1 4,6C4,4.89 4.9,4 6,4A2,2 0 0,1 8,6C8,7.11 7.1,8 6,8M9.64,7.64C9.87,7.14 10,6.59 10,6A4,4 0 0,0 6,2A4,4 0 0,0 2,6A4,4 0 0,0 6,10C6.59,10 7.14,9.87 7.64,9.64L10,12L7.64,14.36C7.14,14.13 6.59,14 6,14A4,4 0 0,0 2,18A4,4 0 0,0 6,22A4,4 0 0,0 10,18C10,17.41 9.87,16.86 9.64,16.36L12,14L19,21H22V20L9.64,7.64Z",Wo="M19,20H5V4H7V7H17V4H19M12,2A1,1 0 0,1 13,3A1,1 0 0,1 12,4A1,1 0 0,1 11,3A1,1 0 0,1 12,2M19,2H14.82C14.4,0.84 13.3,0 12,0C10.7,0 9.6,0.84 9.18,2H5A2,2 0 0,0 3,4V20A2,2 0 0,0 5,22H19A2,2 0 0,0 21,20V4A2,2 0 0,0 19,2Z",Uo="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z",Ro="M15 21H17V19H15M19 9H21V7H19M3 5V19C3 20.1 3.9 21 5 21H9V19H5V5H9V3H5C3.9 3 3 3.9 3 5M19 3V5H21C21 3.9 20.1 3 19 3M11 23H13V1H11M19 17H21V15H19M15 5H17V3H15M19 13H21V11H19M19 21C20.1 21 21 20.1 21 19H19Z",zo="M3 15V17H5V15M15 19V21H17V19M19 3H5C3.9 3 3 3.9 3 5V9H5V5H19V9H21V5C21 3.9 20.1 3 19 3M21 19H19V21C20.1 21 21 20.1 21 19M1 11V13H23V11M7 19V21H9V19M19 15V17H21V15M11 19V21H13V19M3 19C3 20.1 3.9 21 5 21V19Z",Fo="M20 18H4V8H20M20 6H12L10 4H4A2 2 0 0 0 2 6V18A2 2 0 0 0 4 20H20A2 2 0 0 0 22 18V8A2 2 0 0 0 20 6M14 9H16V13H19L15 17L11 13H14Z",qo="M13 19C13 19.34 13.04 19.67 13.09 20H4C2.9 20 2 19.11 2 18V6C2 4.89 2.89 4 4 4H10L12 6H20C21.1 6 22 6.89 22 8V13.81C21.39 13.46 20.72 13.22 20 13.09V8H4V18H13.09C13.04 18.33 13 18.66 13 19M20 18V15H18V18H15V20H18V23H20V20H23V18H20Z",jo="M20 18H4V8H20M20 6H12L10 4H4A2 2 0 0 0 2 6V18A2 2 0 0 0 4 20H20A2 2 0 0 0 22 18V8A2 2 0 0 0 20 6M16 17H14V13H11L15 9L19 13H16Z",Zo="M10,19H13V22H10V19M12,2C17.35,2.22 19.68,7.62 16.5,11.67C15.67,12.67 14.33,13.33 13.67,14.17C13,15 13,16 13,17H10C10,15.33 10,13.92 10.67,12.92C11.33,11.92 12.67,11.33 13.5,10.67C15.92,8.43 15.32,5.26 12,5A3,3 0 0,0 9,8H6A6,6 0 0,1 12,2Z",Yo="M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11,17H13V11H11V17Z",Ko="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z",Xo="M18 16H17.42L16.61 15.19C17.5 14 18 12.5 18 11C18 7.13 14.87 4 11 4C9.5 4 8 4.5 6.79 5.4C3.7 7.72 3.07 12.11 5.39 15.2C7.71 18.29 12.1 18.92 15.19 16.6L16 17.41V18L21 23L23 21L18 16M11 16C8.24 16 6 13.76 6 11S8.24 6 11 6 16 8.24 16 11 13.76 16 11 16M3 6L1 8V1H8L6 3H3V6M21 1V8L19 6V3H16L14 1H21M6 19L8 21H1V14L3 16V19H6Z",Jo="M15.5,14H14.71L14.43,13.73C15.41,12.59 16,11.11 16,9.5A6.5,6.5 0 0,0 9.5,3A6.5,6.5 0 0,0 3,9.5A6.5,6.5 0 0,0 9.5,16C11.11,16 12.59,15.41 13.73,14.43L14,14.71V15.5L19,20.5L20.5,19L15.5,14M9.5,14C7,14 5,12 5,9.5C5,7 7,5 9.5,5C12,5 14,7 14,9.5C14,12 12,14 9.5,14M7,9H12V10H7V9Z",Qo="M15.5,14L20.5,19L19,20.5L14,15.5V14.71L13.73,14.43C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.43,13.73L14.71,14H15.5M9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14M12,10H10V12H9V10H7V9H9V7H10V9H12V10Z",ea="M18.4,10.6C16.55,9 14.15,8 11.5,8C6.85,8 2.92,11.03 1.54,15.22L3.9,16C4.95,12.81 7.95,10.5 11.5,10.5C13.45,10.5 15.23,11.22 16.62,12.38L13,16H22V7L18.4,10.6Z",ta="M13,4.07V1L8.45,5.55L13,10V6.09C15.84,6.57 18,9.03 18,12C18,14.97 15.84,17.43 13,17.91V19.93C16.95,19.44 20,16.08 20,12C20,7.92 16.95,4.56 13,4.07M7.1,18.32C8.26,19.22 9.61,19.76 11,19.93V17.9C10.13,17.75 9.29,17.41 8.54,16.87L7.1,18.32M6.09,13H4.07C4.24,14.39 4.79,15.73 5.69,16.89L7.1,15.47C6.58,14.72 6.23,13.88 6.09,13M7.11,8.53L5.7,7.11C4.8,8.27 4.24,9.61 4.07,11H6.09C6.23,10.13 6.58,9.28 7.11,8.53Z",na="M16.89,15.5L18.31,16.89C19.21,15.73 19.76,14.39 19.93,13H17.91C17.77,13.87 17.43,14.72 16.89,15.5M13,17.9V19.92C14.39,19.75 15.74,19.21 16.9,18.31L15.46,16.87C14.71,17.41 13.87,17.76 13,17.9M19.93,11C19.76,9.61 19.21,8.27 18.31,7.11L16.89,8.53C17.43,9.28 17.77,10.13 17.91,11M15.55,5.55L11,1V4.07C7.06,4.56 4,7.92 4,12C4,16.08 7.05,19.44 11,19.93V17.91C8.16,17.43 6,14.97 6,12C6,9.03 8.16,6.57 11,6.09V10L15.55,5.55Z",ia="M9,9H15V15H9M7,17H17V7H7M15,5H17V3H15M15,21H17V19H15M19,17H21V15H19M19,9H21V7H19M19,21A2,2 0 0,0 21,19H19M19,13H21V11H19M11,21H13V19H11M9,3H7V5H9M3,17H5V15H3M5,21V19H3A2,2 0 0,0 5,21M19,3V5H21A2,2 0 0,0 19,3M13,3H11V5H13M3,9H5V7H3M7,21H9V19H7M3,13H5V11H3M3,5H5V3A2,2 0 0,0 3,5Z",sa="M5,3H7V5H9V3H11V5H13V3H15V5H17V3H19V5H21V7H19V9H21V11H19V13H21V15H19V17H21V19H19V21H17V19H15V21H13V19H11V21H9V19H7V21H5V19H3V17H5V15H3V13H5V11H3V9H5V7H3V5H5V3Z",ra="M1,4.27L2.28,3L21,21.72L19.73,23L17,20.27V21H15V19H15.73L5,8.27V9H3V7H3.73L1,4.27M20,3A1,1 0 0,1 21,4V5H19V3H20M15,5V3H17V5H15M11,5V3H13V5H11M7,5V3H9V5H7M11,21V19H13V21H11M7,21V19H9V21H7M4,21A1,1 0 0,1 3,20V19H5V21H4M3,15H5V17H3V15M21,15V17H19V15H21M3,11H5V13H3V11M21,11V13H19V11H21M21,7V9H19V7H21Z",oa="M12.5,8C9.85,8 7.45,9 5.6,10.6L2,7V16H11L7.38,12.38C8.77,11.22 10.54,10.5 12.5,10.5C16.04,10.5 19.05,12.81 20.1,16L22.47,15.22C21.08,11.03 17.15,8 12.5,8Z",aa="M16.59,5.41L15.17,4L12,7.17L8.83,4L7.41,5.41L12,10M7.41,18.59L8.83,20L12,16.83L15.17,20L16.58,18.59L12,14L7.41,18.59Z",la="M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z";function ca(n,e){for(var t in e)n[t]=e[t];return n}function bt(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var i in e)if(i!=="__source"&&n[i]!==e[i])return!0;return!1}function rn(n,e){this.props=n,this.context=e}function ua(n,e){function t(s){var r=this.props.ref,o=r==s.ref;return!o&&r&&(r.call?r(null):r.current=null),e?!e(this.props,s)||!o:bt(this.props,s)}function i(s){return this.shouldComponentUpdate=t,Ze(n,s)}return i.displayName="Memo("+(n.displayName||n.name)+")",i.prototype.isReactComponent=!0,i.__f=!0,i}(rn.prototype=new Q).isPureReactComponent=!0,rn.prototype.shouldComponentUpdate=function(n,e){return bt(this.props,n)||bt(this.state,e)};var on=V.__b;V.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),on&&on(n)};var ha=V.__e;V.__e=function(n,e,t,i){if(n.then){for(var s,r=e;r=r.__;)if((s=r.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(n,e)}ha(n,e,t,i)};var an=V.unmount;function ci(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(i){typeof i.__c=="function"&&i.__c()}),n.__c.__H=null),(n=ca({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c=null),n.__k=n.__k&&n.__k.map(function(i){return ci(i,e,t)})),n}function ui(n,e,t){return n&&t&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(i){return ui(i,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.appendChild(n.__e),n.__c.__e=!0,n.__c.__P=t)),n}function ft(){this.__u=0,this.o=null,this.__b=null}function hi(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function Re(){this.i=null,this.l=null}V.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&32&n.__u&&(n.type=null),an&&an(n)},(ft.prototype=new Q).__c=function(n,e){var t=e.__c,i=this;i.o==null&&(i.o=[]),i.o.push(t);var s=hi(i.__v),r=!1,o=function(){r||(r=!0,t.__R=null,s?s(a):a())};t.__R=o;var a=function(){if(!--i.__u){if(i.state.__a){var l=i.state.__a;i.__v.__k[0]=ui(l,l.__c.__P,l.__c.__O)}var c;for(i.setState({__a:i.__b=null});c=i.o.pop();)c.forceUpdate()}};i.__u++||32&e.__u||i.setState({__a:i.__b=i.__v.__k[0]}),n.then(o,o)},ft.prototype.componentWillUnmount=function(){this.o=[]},ft.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),i=this.__v.__k[0].__c;this.__v.__k[0]=ci(this.__b,t,i.__O=i.__P)}this.__b=null}var s=e.__a&&Ze(le,null,n.fallback);return s&&(s.__u&=-33),[Ze(le,null,e.__a?null:n.children),s]};var ln=function(n,e,t){if(++t[1]===t[0]&&n.l.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.l.size))for(t=n.i;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.i=t=t[2]}};(Re.prototype=new Q).__a=function(n){var e=this,t=hi(e.__v),i=e.l.get(n);return i[0]++,function(s){var r=function(){e.props.revealOrder?(i.push(s),ln(e,n,i)):s()};t?t(r):r()}},Re.prototype.render=function(n){this.i=null,this.l=new Map;var e=Ke(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.l.set(e[t],this.i=[1,0,this.i]);return n.children},Re.prototype.componentDidUpdate=Re.prototype.componentDidMount=function(){var n=this;this.l.forEach(function(e,t){ln(n,t,e)})};var fa=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,pa=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,da=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,_a=/[A-Z0-9]/g,ma=typeof document<"u",va=function(n){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(n)};Q.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(Q.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var cn=V.event;function ga(){}function ya(){return this.cancelBubble}function ba(){return this.defaultPrevented}V.event=function(n){return cn&&(n=cn(n)),n.persist=ga,n.isPropagationStopped=ya,n.isDefaultPrevented=ba,n.nativeEvent=n};var wa={enumerable:!1,configurable:!0,get:function(){return this.class}},un=V.vnode;V.vnode=function(n){typeof n.type=="string"&&function(e){var t=e.props,i=e.type,s={},r=i.indexOf("-")===-1;for(var o in t){var a=t[o];if(!(o==="value"&&"defaultValue"in t&&a==null||ma&&o==="children"&&i==="noscript"||o==="class"||o==="className")){var l=o.toLowerCase();o==="defaultValue"&&"value"in t&&t.value==null?o="value":o==="download"&&a===!0?a="":l==="translate"&&a==="no"?a=!1:l[0]==="o"&&l[1]==="n"?l==="ondoubleclick"?o="ondblclick":l!=="onchange"||i!=="input"&&i!=="textarea"||va(t.type)?l==="onfocus"?o="onfocusin":l==="onblur"?o="onfocusout":da.test(o)&&(o=l):l=o="oninput":r&&pa.test(o)?o=o.replace(_a,"-$&").toLowerCase():a===null&&(a=void 0),l==="oninput"&&s[o=l]&&(o="oninputCapture"),s[o]=a}}i=="select"&&s.multiple&&Array.isArray(s.value)&&(s.value=Ke(t.children).forEach(function(c){c.props.selected=s.value.indexOf(c.props.value)!=-1})),i=="select"&&s.defaultValue!=null&&(s.value=Ke(t.children).forEach(function(c){c.props.selected=s.multiple?s.defaultValue.indexOf(c.props.value)!=-1:s.defaultValue==c.props.value})),t.class&&!t.className?(s.class=t.class,Object.defineProperty(s,"className",wa)):(t.className&&!t.class||t.class&&t.className)&&(s.class=s.className=t.className),e.props=s}(n),n.$$typeof=fa,un&&un(n)};var hn=V.__r;V.__r=function(n){hn&&hn(n),n.__c};var fn=V.diffed;V.diffed=function(n){fn&&fn(n);var e=n.props,t=n.__e;t!=null&&n.type==="textarea"&&"value"in e&&e.value!==t.value&&(t.value=e.value==null?"":e.value)};const Va="_root_1pl8d_1",xe=ua(function({shape:e,viewBox:t="0 0 24 24",size:i="2rem",...s}){return u("svg",{class:Va,viewBox:t,width:i,height:i,...s,children:u("path",{d:e})})});class xa{#e=new Set;get pending(){return this.#e.size}delayed(e,t){let i=!1,s=!1;const r=()=>{s||(s=!0,this.#e.delete(o),clearTimeout(a))},o=new class{cancel(){r()}get fired(){return i}get cancelled(){return s}};this.#e.add(o);const a=setTimeout(()=>{s||(this.#e.delete(o),i=!0,t())},e);return o}repeated(e,t){let i=!1,s=!1;const r=()=>{s||(s=!0,this.#e.delete(o),clearInterval(a))},o=new class{cancel(){r()}get fired(){return i}get cancelled(){return s}};this.#e.add(o);const a=setInterval(()=>{s||(i=!0,t())},e);return o}cancelAll(){for(const e of this.#e)e.cancel();return this}}const ka=new xa;let Ca=0;class Ma{constructor(e,t){this.message=e,this.options=t}#e=Ca+=1;#i=null;get key(){return this.#e}delayed(e,t){this.clearDelayed(),this.#i=ka.delayed(t,e)}clearDelayed(){this.#i!=null&&(this.#i.cancel(),this.#i=null)}}const ye=ie([]);function Ha(n){ye.value=[...ye.value,n],fi(n)}function wt(n){ye.value=ye.value.filter(e=>e!==n)}function Sa(n,e){e?n.clearDelayed():fi(n)}function fi(n){n.options.autoClose&&n.delayed(()=>{wt(n)},n.options.autoClose)}const pi=Mt(null);function Aa({toast:n,children:e}){return u(pi.Provider,{value:{close:()=>{wt(n)},hover:t=>{n.options.autoClose&&n.options.pauseOnHover&&Sa(n,t)},click:()=>{n.options.closeOnClick&&wt(n)}},children:e})}function Tt(){return Hn(pi)}function di(n){return{onMouseEnter:()=>{n.hover(!0)},onMouseLeave:()=>{n.hover(!1)},onClick:()=>{n.click()}}}function $a({children:n}){return Vi(n,{...n.props,...di(Tt())})}function Ia(){const n=Tt();return u(xe,{shape:Bo,onClick:()=>{n.close()}})}function Na({severity:n}){switch(n){case"info":return u(Pa,{});case"success":return u(La,{});case"error":return u(Ta,{});default:return null}}function Pa(){return u(xe,{shape:Yo})}function La(){return u(xe,{shape:Eo})}function Ta(){return u(xe,{shape:To})}function Da({children:n,severity:e=null,closeButton:t=!0}){const i=Tt();return u("div",{class:Po,...di(i),popover:!0,children:[e&&u(Na,{severity:e}),u("div",{class:Lo,children:n}),t&&u(Ia,{})]})}const Ea="_root_1k080_1";function Ba(){return u("div",{class:Ea,hidden:ye.value.length===0,children:[...ye.value].reverse().map(n=>u(Aa,{toast:n,children:u($a,{children:n.message})},n.key))})}function Ga(n,{autoClose:e=3e3,pauseOnHover:t=!0,closeOnClick:i=!0}={}){Ha(new Ma(n,{autoClose:e,pauseOnHover:t,closeOnClick:i}))}function $e({error:n}){return u(Da,{severity:"error",children:n instanceof AggregateError?n.errors.map((e,t)=>u("p",{children:String(e)},t)):u("p",{children:String(n)})})}function Oa(n,{autoClose:e=3e3,pauseOnHover:t=!0,closeOnClick:i=!1}={}){Ga(u($e,{error:n}),{autoClose:e,pauseOnHover:t,closeOnClick:i})}$e.report=Oa;const Wa="_root_yio74_1",Ua="_header_yio74_9",Ra="_headerText_yio74_14",za="_headerButton_yio74_25",Fa="_content_yio74_29",qa="_resize_yio74_36";function ze({title:n,children:e,style:t}){const[i,s]=nt(!0);return u("div",{class:Wa,style:t,children:[u("div",{class:Ua,children:[u("span",{class:Ra,children:n}),u("span",{class:za,onClick:()=>{s(!i)},children:u(xe,{shape:i?aa:la})})]}),i&&u(le,{children:[u("div",{class:Fa,children:e}),u(ja,{})]})]})}function ja(){return u("svg",{class:qa,viewBox:"0 0 24 24",children:u("path",{d:"M22,22H20V20H22V22M22,18H20V16H22V18M18,22H16V20H18V22M18,18H16V16H18V18M14,22H12V20H14V22M22,14H20V12H22V14Z"})})}const Za="_root_948vb_1",Ya="_toolbar_948vb_8",Ka="_schematic_948vb_17";function Xa(){return new Z(ve([["i",50,50,0,"vdc","V1",{}],["i",150,50,0,"r","R1",{}],["i",50,120,0,"g","G1",{}],["w",50,0,150,0],["w",50,100,150,100],["w",50,0,50,20],["w",50,80,50,100],["w",50,100,50,120],["w",150,0,150,20],["w",150,80,150,100],["n",300,0,"lt",`# Ohm's law

*Ohm's law* states that the electric current $I$ through a conductor between two points is directly proportional to the voltage $V$ across the two points.

$$I = \\frac{V}{R}$$

The law was named after the German physicist *Georg Ohm*.`]]))}const Ja="_root_sg434_1",Qa="_button_sg434_8",el="_separator_sg434_38";function H({children:n}){return u("div",{class:Ja,children:n})}function tl({shape:n,title:e,...t}){return u("button",{...t,class:Qa,title:e,children:u(xe,{shape:n})})}H.Button=tl;function nl(){return u("span",{class:el})}H.Separator=nl;const il="_root_1bk49_1",sl="_select_1bk49_8",rl="_content_1bk49_13";function ol(){return u("p",{children:"Capacitive reactance"})}function al(){return u("p",{children:"Inductive reactance"})}function ll(){return u("p",{children:"Resistive voltage divider"})}function cl(){return u("p",{children:"LC resonance"})}function ul(){return u("p",{children:"Wavelength and frequency"})}const Fe=[{name:"Resistive voltage divider",component:ll},{name:"Capacitive reactance",component:ol},{name:"Inductive reactance",component:al},{name:"LC resonance",component:cl},{name:"Wavelength and frequency",component:ul}];function hl(){const[n,e]=nt(Fe[0]),{component:t}=n;return u("section",{class:il,children:[u("select",{class:sl,value:n.name,onInput:({target:i})=>{const{value:s}=i;e(Fe.find(({name:r})=>r===s)??Fe[0])},children:Fe.map(({name:i})=>u("option",{value:i,children:i}))}),u("div",{class:rl,children:u(t,{})})]})}const fl="_root_8tr57_1";function pl(){return u("section",{class:fl,children:[u("p",{children:["To draw a wire, click and start moving the pointer from a device pin, a wire end, or a wire junction. To draw a wire from any location on the grid, press ",u("kbd",{children:"W"}),". To change a wire's angle, press ",u("kbd",{children:"Shift"}),". To draw a diagonal wire, press ",u("kbd",{children:"Alt"}),"."]}),u("p",{children:"Shortcuts:"}),u("ul",{children:[u("li",{children:[u("kbd",{children:"W"})," Start drawing a wire from any point on the grid"]}),u("li",{children:[u("kbd",{children:"Shift"})," While drawing a wire, changes the angle of the wire"]}),u("li",{children:[u("kbd",{children:"Alt"})," While drawing a wire, draws a diagonal wire"]}),u("li",{children:[u("kbd",{children:"G"})," Place a ground symbol"]}),u("li",{children:[u("kbd",{children:"O"})," Place a port symbol"]}),u("li",{children:[u("kbd",{children:"V"})," Place a voltage source"]}),u("li",{children:[u("kbd",{children:"I"})," Place a current source"]}),u("li",{children:[u("kbd",{children:"R"})," Place a resistor"]}),u("li",{children:[u("kbd",{children:"C"})," Place a capacitor"]}),u("li",{children:[u("kbd",{children:"L"})," Place an inductor"]}),u("li",{children:[u("kbd",{children:"D"})," Place a diode"]}),u("li",{children:[u("kbd",{children:"N"})," Place an NPN transistor"]}),u("li",{children:[u("kbd",{children:"P"})," Place a PNP transistor"]}),u("li",{children:[u("kbd",{children:"Shift+N"})," Place an N-channel MOSFET"]}),u("li",{children:[u("kbd",{children:"Shift+P"})," Place a P-channel MOSFET"]}),u("li",{children:[u("kbd",{children:"A"})," Place an operational amplifier"]}),u("li",{children:[u("kbd",{children:"Home"})," Zoom to 100%"]}),u("li",{children:[u("kbd",{children:"Space"})," Expand or shrink to cover the whole screen"]}),u("li",{children:[u("kbd",{children:"Ctrl+X"})," Cut selected item(s) to clipboard"]}),u("li",{children:[u("kbd",{children:"Ctrl+C"})," Copy selected item(s) to clipboard"]}),u("li",{children:[u("kbd",{children:"Ctrl+V"})," Paste item(s) from clipboard"]}),u("li",{children:[u("kbd",{children:"Ctrl+A"})," Select all"]}),u("li",{children:[u("kbd",{children:"Delete"})," Delete selected item(s)"]}),u("li",{children:[u("kbd",{children:"Alt+L"})," Rotate selected item(s) to the left"]}),u("li",{children:[u("kbd",{children:"Alt+R"})," Rotate selected item(s) to the right"]}),u("li",{children:[u("kbd",{children:"Alt+H"})," Flip selected item(s) from left to right"]}),u("li",{children:[u("kbd",{children:"Alt+V"})," Flip selected item(s) from top to bottom"]}),u("li",{children:[u("kbd",{children:"Ctrl+Z"})," Undo"]}),u("li",{children:[u("kbd",{children:"Ctrl+Y"})," Redo"]})]})]})}function dl(){const n=te();return u(H,{children:[u(H.Button,{shape:Fo,title:"Open schematic",onClick:()=>{$e.report("Not implemented")}}),u(H.Button,{shape:jo,title:"Save schematic",onClick:()=>{$e.report("Not implemented")}}),u(H.Button,{shape:qo,title:"New schematic",onClick:()=>{$e.report("Not implemented")}}),u(H.Separator,{}),u(H.Button,{shape:ia,title:"Select all",onClick:()=>{n.select("all"),n.focus()}}),u(H.Button,{shape:sa,title:"Invert selection",onClick:()=>{n.select("invert"),n.focus()}}),u(H.Button,{shape:ra,title:"Clear selection",onClick:()=>{n.select("none"),n.focus()}}),u(H.Separator,{}),u(H.Button,{shape:Oo,title:"Cut selected item(s) to clipboard",onClick:()=>{n.selectionCut(),n.focus()}}),u(H.Button,{shape:Go,title:"Copy selected item(s) to clipboard",onClick:()=>{n.selectionCopy(),n.focus()}}),u(H.Button,{shape:Wo,title:"Paste item(s) from clipboard",onClick:()=>{n.selectionPaste(),n.focus()}}),u(H.Button,{shape:Uo,title:"Delete selected item(s)",onClick:()=>{n.selectionDelete(),n.focus()}}),u(H.Separator,{}),u(H.Button,{shape:ta,title:"Rotate selected item(s) to the left",disabled:!n.selection.full,onClick:()=>{n.transformSelection("rl")}}),u(H.Button,{shape:na,title:"Rotate selected item(s) to the right",disabled:!n.selection.full,onClick:()=>{n.transformSelection("rr")}}),u(H.Button,{shape:Ro,title:"Flip selected item(s) from left to right",disabled:!n.selection.full,onClick:()=>{n.transformSelection("mx")}}),u(H.Button,{shape:zo,title:"Flip selected item(s) from top to bottom",disabled:!n.selection.full,onClick:()=>{n.transformSelection("my")}}),u(H.Separator,{}),u(H.Button,{shape:oa,title:"Undo",disabled:!n.canUndo,onClick:()=>{n.undo(),n.focus()}}),u(H.Button,{shape:ea,title:"Redo",disabled:!n.canRedo,onClick:()=>{n.redo(),n.focus()}}),u(H.Separator,{}),u(H.Button,{shape:Ko,title:"Zoom 100%",onClick:()=>{n.zoomTo("1"),n.focus()}}),u(H.Button,{shape:Qo,title:"Zoom in",onClick:()=>{n.zoomTo("+"),n.focus()}}),u(H.Button,{shape:Jo,title:"Zoom out",onClick:()=>{n.zoomTo("-"),n.focus()}}),u(H.Button,{shape:Xo,title:"View all",onClick:()=>{n.zoomTo("all"),n.focus()}}),u(H.Separator,{}),u(H.Button,{shape:Do,title:"Calculator",onClick:()=>{sn(u(hl,{}),{modal:!0,onClose:()=>{n.focus()}})}}),u(H.Separator,{}),u(H.Button,{shape:Zo,title:"Help",onClick:()=>{sn(u(pl,{}),{modal:!0,onClose:()=>{n.focus()}})}})]})}function _l(){const n=st(()=>new kr(Bn,Xa()),[]);return it(()=>{const e=Yn(["Alt+v",()=>{}],["Alt+h",()=>{}],["Alt+r",()=>{}],["Alt+l",()=>{}],["Ctrl+a",()=>{}],["Ctrl+s",()=>{}],["Ctrl+o",()=>{}],["Ctrl+n",()=>{}],["Ctrl+r",()=>{}]);return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[n]),u(ei.Provider,{value:n,children:[u("main",{class:Za,children:[u("div",{class:Ya,children:u(dl,{})}),u("div",{class:Ka,children:u(xo,{})}),u(ze,{title:"Instances",style:{insetInlineEnd:"38rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:u(Sr,{})}),u(ze,{title:"Nodes",style:{insetInlineEnd:"20rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:u(Gr,{})}),u(ze,{title:"Library",style:{insetInlineEnd:"2rem",insetBlockStart:"4rem",inlineSize:"15rem"},children:u(Lr,{})}),u(ze,{title:"Properties",style:{insetInlineStart:"2rem",insetBlockStart:"4rem"},children:u(Qr,{})})]}),u(No,{}),u(Ba,{})]})}wi(u(_l,{}),document.querySelector("#app"));
